(()=>{"use strict";var e,o,t,n={2634:(e,o,t)=>{var n=t(85893),r=t(73935),i=t(70655),s=t(67294),a=t(54612),d=t(86125),l=t(50492),c=t(30365),u=t(41650),p=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.errorHandler=function(e,o){var t=e||(0,u.getLang)("global_error");(0,a.showFastBox)({title:(0,u.getLang)("global_error")},t,(0,u.getLang)("global_close"),(function(){o(),(0,d.curBox)().hide()}))},o.save=function(e,t,n){var r;void 0===n&&(n={}),o.props.onClickSave(),window.StoryPublisher.saveStory(e,{attachment:JSON.stringify(o.props.attachment),clickable_stickers:n.clickableStickers,mini_app_id:o.props.miniAppId,question_id:o.props.questionId,situational_suggest_id:null===(r=o.props.serviceInfo)||void 0===r?void 0:r.situational_suggest_id,analytics:n.analytics,mediaEditorAnalytics:n.mediaEditorAnalytics,hash:n.storyUploadUrlHash,entry_point:o.props.entrypoint,ref:window.cur.module},n.storySaveHash).then((function(e){o.onClose(!0,!1,e),t()})).catch((function(e){return o.errorHandler(e,t),!0}))},o.onClose=function(e,t,n){var r,i;if(t)o.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),o.props.onClose(!0,n);else{(null===(i=null===(r=window.cur.photoEditorStore)||void 0===r?void 0:r.getState())||void 0===i?void 0:i.past.length)>1?(0,a.showFastBox)({title:(0,u.getLang)("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},(0,u.getLang)("photos_pe_story_editor_close_text"),(0,u.getLang)("box_yes"),(function(){(0,d.curBox)().hide(),o.props.onClose(!1)}),(0,u.getLang)("box_no"),(function(){(0,d.curBox)().hide()})):o.props.onClose(!1)}},o}return(0,i.__extends)(o,e),o.prototype.render=function(){var e=this,o=Math.min(900,window.innerHeight-100),t=o/1.78;return(0,n.jsx)(c.default,(0,i.__assign)({disableBodyScroll:!0,onClose:function(){return e.onClose()}},{children:(0,n.jsx)(l.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:t,artboardHeight:o,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers,serviceInfo:this.props.serviceInfo},void 0)}),void 0)},o}(s.Component),h=t(52205),f=t(86067),v=t(40906),y=t(61540);var _={init:function(e,o,t){var n=this;this.onClickSave=o||function(){},this.cb=t,this.loadStatic().then((function(){n.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var o=(null==e?void 0:e.entrypoint)||"",t=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===o?(0,h.sendStat)(h.EVENTS.ADD_STORY_FROM_SHARING):(0,h.sendStat)(h.EVENTS.ADD_STORY);var i=document.querySelector(".StoryPublisher");i||((i=document.createElement("div")).classList.add("StoryPublisher"),document.body.appendChild(i)),r.render((0,n.jsx)(p,{entrypoint:o,miniAppId:t,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers,serviceInfo:null==e?void 0:e.serviceInfo,questionId:null==e?void 0:e.questionId},void 0),i)},destroy:function(e,o){var t=document.querySelector(".StoryPublisher");t&&r.unmountComponentAtNode(t),this.cb&&this.cb(e,o),delete window.cur.photoEditorStore,delete window.cur.renderImageFromState,e&&(0,d.showDoneBox)((0,f.getLang)("photos_pe_story_published"))},saveStory:function(e,o,t){return function(e){return new Promise((function(o,t){window.ajax.post((0,y.isMvk)()?"stories.php":"al_stories.php",(0,i.__assign)({act:"get_upload_url"},e),{onDone:o,onError:t,onFail:t})}))}(o).then((function(o){return function(e,o){var t=new FormData,n=encodeURIComponent("edited_"+(0,v.irand)(0,99999)+".jpg");return t.append("file0",e,n),fetch(o,{method:"POST",body:t}).then((function(e){return e.json()}))}(e,o)})).then((function(e){var o=e.response;return function(e,o){return new Promise((function(t,n){window.ajax.post((0,y.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:o},{onDone:t,onError:n,onFail:n})}))}(o&&o.upload_result,t)}))}};window.StoryPublisher=_;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}}},r={};function i(e){var o=r[e];if(void 0!==o)return o.exports;var t=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.loaded=!0,t.exports}i.m=n,e=[],i.O=(o,t,n,r)=>{if(!t){var s=1/0;for(c=0;c<e.length;c++){for(var[t,n,r]=e[c],a=!0,d=0;d<t.length;d++)(!1&r||s>=r)&&Object.keys(i.O).every((e=>i.O[e](t[d])))?t.splice(d--,1):(a=!1,r<s&&(s=r));if(a){e.splice(c--,1);var l=n();void 0!==l&&(o=l)}}return o}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[t,n,r]},i.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return i.d(o,{a:o}),o},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,n){if(1&n&&(e=this(e)),8&n)return e;if("object"==typeof e&&e){if(4&n&&e.__esModule)return e;if(16&n&&"function"==typeof e.then)return e}var r=Object.create(null);i.r(r);var s={};o=o||[null,t({}),t([]),t(t)];for(var a=2&n&&e;"object"==typeof a&&!~o.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((o=>s[o]=()=>e[o]));return s.default=()=>e,i.d(r,s),r},i.d=(e,o)=>{for(var t in o)i.o(o,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},i.e=()=>Promise.resolve(),i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={55198:0};i.O.j=o=>0===e[o];var o=(o,t)=>{var n,r,[s,a,d]=t,l=0;for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(d)var c=d(i);for(o&&o(t);l<s.length;l++)r=s[l],i.o(e,r)&&e[r]&&e[r][0](),e[s[l]]=0;return i.O(c)},t=self.webpackChunkvk=self.webpackChunkvk||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))})();var s=i.O(void 0,[76429,22897,75514,24509,40885,49685,68592,25901],(()=>i(2634)));s=i.O(s)})();