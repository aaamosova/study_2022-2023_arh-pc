(self.webpackChunkvk=self.webpackChunkvk||[]).push([[68069],{95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},47934:(e,n,t)=>{"use strict";t.d(n,{default:()=>a});const a=(0,t(63192).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="add_20"><path clip-rule="evenodd" d="M10 2a.75.75 0 0 1 .75.75v6.499h6.499a.75.75 0 0 1 0 1.5H10.75v6.499a.75.75 0 0 1-1.5 0v-6.5H2.751a.75.75 0 0 1 0-1.5H9.25V2.75A.75.75 0 0 1 10 2z" fill="currentColor" fill-rule="evenodd" /></symbol>',20,20,!1,void 0)},11099:(e,n,t)=>{"use strict";var a=t(95318);n.classNames=function(){for(var e=[],n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return t.forEach((function(n){if(n)switch((0,i.default)(n)){case"string":e.push(n);break;case"object":Object.keys(n).forEach((function(t){n[t]&&e.push(t)}));break;default:e.push("".concat(n))}})),e.join(" ")};var i=a(t(50008))},76497:(e,n,t)=>{"use strict";t.d(n,{init:()=>Ou});var a,i=t(70655),o=t(85893),r=t(73935),s=t(59397),l=t(67294),c=t(35886),d=t(73674),u=function(){return(0,c.useDispatch)()};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear",e.DISABLED="disabled"}(a||(a={}));var _=(0,l.forwardRef)((function(e,n){var t=e.icon,r=e.text,l=e.type,c=e.className,d=(0,i.__rest)(e,["icon","text","type","className"]),u=(0,s.classNames)("CallButton","CallButton--"+l,c,{"CallButton--withText":!!r},"CallButton--withAnimation"),_=(0,s.classNames)("CallButton__icon","CallButton__icon--withAnimation"),v=(0,i.__assign)((0,i.__assign)({},d),{onMouseDown:function(e){e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,o.jsxs)("button",(0,i.__assign)({className:u},v,{disabled:l===a.DISABLED,ref:n},{children:[(0,o.jsx)("figure",(0,i.__assign)({className:_},{children:t}),void 0),r]}),void 0)})),v=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"},void 0)}),void 0)},p=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"},void 0)}),void 0)},f=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"},void 0)}),void 0)},A=function(e){var n=e.id,t=e.className,a=e.children,r=(0,l.useMemo)((function(){return"radial-gradient(circle, rgb("+(48+Math.abs(n)%3*4)+","+(48+Math.abs(n)%4*5)+","+(52+Math.abs(n)%5*6)+") 40%, #0a0a0a 100%)"}),[]),c=(0,s.classNames)("BlurredBackground",t);return(0,o.jsx)("div",(0,i.__assign)({className:c,style:{background:r}},{children:a}),void 0)},g=t(3065);function h(e){var n=e.title,t=e.description,a=e.className;return(0,o.jsxs)("header",(0,i.__assign)({className:(0,s.classNames)("IncomingCallHeader",a)},{children:[(0,o.jsx)("h1",(0,i.__assign)({className:"IncomingCallHeader__title"},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"IncomingCallHeader__description"},{children:t}),void 0)]}),void 0)}var m=(0,l.forwardRef)((function(e,n){var t,a=e.type,r=e.isActive,l=e.icon,c=e.className,d=(0,i.__rest)(e,["type","isActive","icon","className"]),u=(0,s.classNames)("CallIconButton",c,"CallIconButton--withAnimation",((t={"CallIconButton--active":r})["CallIconButton--"+a]=!!a,t)),_=(0,i.__assign)((0,i.__assign)({},d),{onMouseDown:function(e){e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,o.jsx)("button",(0,i.__assign)({},_,{className:u,ref:n},{children:l}),void 0)})),C=t(97404),E=t(71192);function S(e){var n=e.id,t=e.photo,a=e.title,r=e.description,s=e.onCollapseCall,c=e.children,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("section",(0,i.__assign)({className:"IncomingCall"},{children:[(0,o.jsx)(A,{id:n},void 0),(0,o.jsx)(C.default,(0,i.__assign)({position:"b",text:d("calls_collapse"),marginTop:-6},{children:(0,o.jsx)(m,{type:"collapse",className:"IncomingCall__collapse",onClick:s},void 0)}),void 0),(0,o.jsx)(h,{title:a,description:r},void 0),(0,o.jsx)(g.CallPhoto,{id:n,waves:!0,photo:t,alt:a||"",className:"IncomingCall__photo"},void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"IncomingCall__footer"},{children:c}),void 0)]}),void 0)}var T=t(30365),I=function(){function e(e,n,t){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=t||function(){},this.prepareFunc=n||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),n=this.iterCur;n<e;n++){var t=this.list[n];try{t._order=n}catch(e){}this.add(t)}this.iterCur=n,n>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var n,t={},a=(n=e,n.replace(/&#(\d\d+);/g,(function(e,n){return(n=!0===(t=n)?1:parseInt(t)||0)>=32?String.fromCharCode(n):e;var t})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),i=a.length;i--;){var o=a[i],r="";if(o){for(var s=0;s<6;s++){var l=o.charCodeAt(s);if(l){var c=this.toTranslit[l],d=o.substr(s,1);r+=null!=c?c:d}}t[r]=1}}return t},e.prototype.strToSearchPrefixes=function(e){for(var n=[],t=e.toLowerCase().split(this.delimiter),a=t.length;a--;){var i={},o=t[a],r="",s="",l="",c=o.length>1;if(o){for(var d=0;d<6;d++){var u=o.charCodeAt(d);if(u){var _=this.toTranslit[u],v=o.substr(d,1);if(r+=null!=_?_:v,c){var p=this.toLocalCase[v],f=this.toLocalTranslit[u];s+=null!=p?p:v,l+=null!=f?f:v}}}i[r]=1,c&&(i[s]=2,i[l]=3),n.push(i)}}return n},e.prototype.toIndexTree=function(e,n){for(var t=this.index,a=0;a<6;a++){var i=e.substr(a,1)||-1;t=t[i]?t[i]:t[i]=5==a?[]:{}}t.push(n)},e.prototype.remove=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)if(t.hasOwnProperty(a)){for(var i=this.index,o=0;o<6;o++){var r=a.substr(o,1)||-1;if(!i[r])break;i=i[r]}if(i.length)for(var o in i)if(this.equals(i[o],e)){i.splice(o,1);break}}},e.prototype.equals=function(e,n){for(var t in e)if(e.hasOwnProperty(t))switch(typeof e[t]){case"object":if(!this.equals(e[t],n[t]))return!1;break;case"function":if(void 0===e[t]||e[t].toString()!=n[t].toString())return!1;break;default:if(e[t]!=n[t])return!1}for(var t in n)if(void 0===n[t])return!1;return!0},e.prototype.intersect=function(e,n){var t=[];if(N(e[0])||N(n[0]))return e.filter((function(e){return-1!==n.indexOf(e)}));for(;e.length>0&&n.length>0;)if(e[0]._order<n[0]._order)e.shift();else if(e[0]._order>n[0]._order)n.shift();else{if(this.equals(e[0],n[0])){var a=e.shift();a&&t.push(a)}n.shift()}return t},e.prototype.add=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)t.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var n=this.index,t=this.strToSearchPrefixes(e),a=[],i=!1;for(var o in t)if(t.hasOwnProperty(o)){if(i&&!a)break;var r=this.localSearch(t[o],0,n);r.sort((function(e,n){return e._order-n._order})),a=i?this.intersect(a,r):r,i=!0}for(var s=a[0],l=a.length+1,c=[],d=1;d<l;d++){var u=a[d];u!=s&&(c.push(s),s=u)}return c},e.prototype.localSearch=function(e,n,t){if(!t)return[];var a={};for(var i in e)e.hasOwnProperty(i)&&(a[r=i.substr(n,1)||-1]||(a[r]={}),a[r][i]=1);if(6==n++)return t;var o=[];for(var r in a)if("-1"===r)for(var s in t)t.hasOwnProperty(s)&&o.push.apply(o,this.localSearch(a[r],n,t[s]));else{var l=this.localSearch(a[r],n,t[r]);o.push.apply(o,l)}return o},e}();function N(e){return!isNaN(e)}var x=function(e,n,t){var a=(0,l.useRef)(null);a.current=a.current?a.current:new I(e,n);var o=a.current,r=(0,l.useCallback)((function(e){return e.reduce((function(e,n){return e[t(n)]=!0,e}),{})}),[]),s=(0,i.__read)((0,l.useState)(e),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(r(e)),2),_=u[0],v=u[1];return(0,l.useEffect)((function(){var n=r(e),a=e.filter((function(e){return!_[t(e)]})),i=c.filter((function(e){return!n[t(e)]}));(a.length||i.length)&&(a.forEach((function(e){o.add(e)})),i.forEach((function(e){o.remove(e)})),d(e),v(n))}),[e]),o};var y=t(10930),b=function(e){var n=e.onClose,t=e.onBackdropClick,a=e.isIncoming,r=void 0!==a&&a,c=e.isCautionBoxShown,_=void 0!==c&&c,v=e.children,p=u(),f=(0,l.useContext)(y.ConfigContext).withAnimation,A=(0,s.classNames)("CallModal",{"CallModal--withAnimation":f,"CallModal--isIncoming":r});(0,l.useEffect)((function(){return document.body.classList.add("layers_shown"),function(){document.body.classList.remove("layers_shown")}}),[]);var g=(0,l.useCallback)((function(){return _?void p({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!0,isIncoming:r||!1}):n()}),[_]);return(0,o.jsx)(T.default,(0,i.__assign)({className:A,disableBodyScroll:!0,onClose:g,onBackdropClick:t},{children:v}),void 0)},O=t(67921),w=t(73294);function L(e){var n=e.SDK,t=e.bridge,r=(0,c.useSelector)((function(e){return e})),s=r.peer,A=r.callData,g=r.participants,h=r.caller,m=u(),C=(0,l.useContext)(E.LangContext).getLang,T=h;T||(T=(0,O.isGroupCallByPeer)(s)?A.conversation:g[s]);var I=A.type===d.CallType.VIDEO,N=C(I?"calls_incoming_videocall":"calls_incoming_audiocall"),x=C(I?"calls_reply_with_audio":"calls_reply"),y=C(I?"calls_reject_call":"calls_reject"),L=function(){n.declineCall(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:A.callId,peer_id:s,is_group_call:(0,O.isGroupCallByPeer)(s),reason:"none"})};return(0,o.jsx)(b,(0,i.__assign)({onClose:L,isIncoming:!0,isCautionBoxShown:!0},{children:(0,o.jsx)(S,(0,i.__assign)({id:s,title:(null==T?void 0:T.tab)||"",description:N,photo:(null==T?void 0:T.photo)||"",onCollapseCall:function(){m({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.COLLAPSED})}},{children:(0,o.jsxs)(o.Fragment,{children:[I&&(0,o.jsx)(_,{text:C("calls_reply_with_video"),type:a.POSITIVE,icon:(0,o.jsx)(v,{},void 0),onClick:function(){return t.acceptCall(!0,!0)}},void 0),(0,o.jsx)(_,{text:x,type:I?a.REGULAR:a.POSITIVE,icon:(0,o.jsx)(p,{},void 0),onClick:function(){return t.acceptCall(!1,!0)}},void 0),(0,o.jsx)(_,{text:y,type:a.NEGATIVE,icon:(0,o.jsx)(f,{},void 0),onClick:L},void 0)]},void 0)}),void 0)}),void 0)}var k=c.useSelector,P=t(15464);function M(){var e=k((0,l.useCallback)((function(e){return e.devices}),[])),n=k((0,l.useCallback)((function(e){return e.participantsChunk}),[]));return(0,l.useMemo)(P.getActiveDevicesCount,[e,n])}function D(e,n){return"/video"+e+"_"+n}function j(e){var n=document.createElement("video"),t=function(){n.classList.add("Video--visible"),n.removeEventListener("loadeddata",t)};return n.addEventListener("loadeddata",t),n.autoplay=!0,n.controls=!1,n.crossOrigin="anonymous",n.playsInline=!0,n.preload="metadata",n.srcObject=e,n.volume=0,n}var R=new WeakMap,B=(0,l.memo)((function(e){var n=e.stream,t=e.participantId,a=e.isMirrored,i=void 0!==a&&a,r=e.isContained,c=void 0!==r&&r,d=e.isStartWithVisible,u=void 0!==d&&d,_=e.isLocalSchreenShare,v=void 0!==_&&_,p=e.className,f=(0,l.useRef)(null),A=(0,l.useRef)(null),g=(0,l.useRef)(n);return(0,l.useEffect)((function(){var e,a,o,r;if(!(null===(e=f.current)||void 0===e?void 0:e.lastElementChild)||g.current!==n){var l=u;if(n&&(R.has(n)?null===(null===(a=R.get(n))||void 0===a?void 0:a.closest("body"))?(A.current=null!==(o=R.get(n))&&void 0!==o?o:null,l=!0):(A.current=j(n),A.current.dataset.participantId=t):(A.current=j(n),A.current.dataset.participantId=t,R.set(n,A.current))),A.current&&A.current.dataset.participantId!==t){var d=A.current;d.dataset.participantId=t,d.srcObject=null,d.srcObject=n;var _=function(){d.classList.add("Video--visible"),d.removeEventListener("loadeddata",_)};d.addEventListener("loadeddata",_),l=!1,d.classList.remove("Video--visible")}if(A.current&&f.current&&f.current.lastElementChild!==A.current){var p=(0,s.classNames)("Video",{"Video--contain":c,"Video--mirrored":i,"Video--visible":l||(null===(r=A.current)||void 0===r?void 0:r.classList.contains("Video--visible"))});f.current.lastElementChild&&(f.current.innerHTML=""),A.current.className=p,f.current.appendChild(A.current),A.current.play()}var h=function(){if(!v)return function(){return null};var e=n.getVideoTracks()[0],t=function(){A.current&&(A.current.srcObject=A.current.srcObject)};return null==e||e.addEventListener("mute",t),function(){return null==e?void 0:e.removeEventListener("mute",t)}}();return function(){h(),A.current&&A.current!==R.get(n)&&(A.current.srcObject=null,A.current.src="",A.current.pause(),A.current.removeAttribute("src"),A.current.load()),f.current&&(f.current.innerHTML="")}}}),[n,f.current,t]),(0,l.useEffect)((function(){A.current&&A.current.classList.toggle("Video--mirrored",i)}),[i]),(0,o.jsx)("div",{ref:f,className:p},void 0)})),U=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},n,{children:(0,o.jsx)("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"},void 0)}),void 0)},H=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"},void 0)}),void 0)},G=t(4495),V=t(13984),F=t(70226),W=function(e){var n=e.item,t=e.setOpen,a=n.disabled,r=void 0!==a&&a,l=(0,s.classNames)("CallsDropdown__button",{"CallsDropdown__button--disabled":r});return"href"in n?(0,o.jsx)("a",(0,i.__assign)({href:n.href,rel:"noopener noreferrer",target:"_blank",onClick:r?void 0:function(e){e.stopPropagation(),"onClick"in n&&void 0!==n.onClick&&n.onClick(e),t(!1)},className:l},{children:n.text}),void 0):"onClick"in n?(0,o.jsxs)("button",(0,i.__assign)({onClick:r?void 0:function(e){e.stopPropagation(),n.onClick(e),t(!1)},className:l},{children:[(0,o.jsx)(V.default,{children:String(n.text)},void 0),void 0!==n.isEnabled&&(0,o.jsx)(F.default,{className:"CallsDropdown__switch",checked:n.isEnabled},void 0)]}),void 0):null},z=function(e){var n=e.isListEdge;return(0,o.jsx)("div",{className:(0,s.classNames)({CallsDropdown__separator:!n})},void 0)},K=function(e){var n=e.children,t=e.items,a=e.open,r=void 0!==a&&a,s=e.setOpen,c=e.placement;return(0,o.jsx)(G.Dropdown,(0,i.__assign)({placement:c,onShownChange:s,content:(0,o.jsx)("ul",(0,i.__assign)({className:"CallsDropdown"},{children:t.map((function(e,n,t){return(0,o.jsx)("li",(0,i.__assign)({className:"CallsDropdown__item"},{children:"separator"in e?(0,o.jsx)(z,{isListEdge:!n||t.length-1===n},void 0):(0,o.jsx)(W,{item:e,setOpen:s},void 0)}),e.key||n)}))}),void 0),shown:r},{children:(0,l.cloneElement)(n,(0,i.__assign)((0,i.__assign)({},n.props),{"data-active":r}))}),void 0)},Y=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"25",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:[(0,o.jsx)("path",{d:"M10 8a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"},void 0),(0,o.jsx)("path",{d:"M6.558 10a.024.024 0 00-.017.04l3.254 3.255-2.947 2.948a1 1 0 001.414 1.414l2.948-2.948 3.25 3.25c.015.015.04.005.04-.017v-2.114c0-1.81.72-3.547 2-4.828l1.658-.414a.2.2 0 00.093-.336l-4-4a.2.2 0 00-.336.093L13.5 8a6.828 6.828 0 01-4.829 2H6.558z"},void 0)]}),void 0)},Q=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"56",height:"56",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("path",{d:"M28.5 37.5A1.5 1.5 0 0030 36V22.622l4.94 4.939a1.5 1.5 0 002.007.103l.114-.103a1.5 1.5 0 000-2.122l-7.5-7.5a1.5 1.5 0 00-2.122 0l-7.5 7.5a1.5 1.5 0 002.122 2.122l4.938-4.939L27 36a1.5 1.5 0 001.355 1.493l.145.007z"},void 0),(0,o.jsx)("path",{d:"M19.883 8c-5.019 0-7.117.465-9.244 1.603a10.924 10.924 0 00-4.536 4.536C4.965 16.266 4.5 18.364 4.5 23.383v9.234c0 5.019.465 7.117 1.603 9.244a10.924 10.924 0 004.536 4.536C12.766 47.535 14.864 48 19.883 48h17.234c5.019 0 7.117-.465 9.244-1.603a10.924 10.924 0 004.536-4.536c1.138-2.127 1.603-4.225 1.603-9.244v-9.234c0-5.019-.465-7.117-1.603-9.244a10.924 10.924 0 00-4.536-4.536C44.234 8.465 42.136 8 37.117 8H19.883zm-7.83 4.248c1.486-.794 3-1.248 7.83-1.248h17.234c4.83 0 6.344.454 7.83 1.248a7.925 7.925 0 013.305 3.306c.794 1.485 1.248 3 1.248 7.83v9.233c0 4.83-.454 6.344-1.248 7.83a7.925 7.925 0 01-3.306 3.305c-1.485.794-3 1.248-7.83 1.248H19.884c-4.83 0-6.344-.454-7.83-1.248a7.925 7.925 0 01-3.305-3.306c-.794-1.485-1.248-3-1.248-7.83v-9.233c0-4.83.454-6.344 1.248-7.83a7.925 7.925 0 013.306-3.305z"},void 0)]}),void 0)};function Z(e){var n=e.isInverted,t=(0,s.classNames)("CallingStatus",{"CallingStatus--inverted":!!n}),a=(0,s.classNames)("CallingStatus__part","CallingStatus__part--withAnimation");return(0,o.jsxs)("div",(0,i.__assign)({className:t},{children:[(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0)]}),void 0)}var J=t(53996),X=t(63192);const q=(0,X.makeIcon)("Icon16Connection","connection_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="connection_16"><path d="M12 2a1 1 0 0 0-1 1v10a1 1 0 1 0 2 0V3a1 1 0 0 0-1-1ZM7 5.5a1 1 0 0 1 2 0V13a1 1 0 1 1-2 0V5.5ZM3 8a1 1 0 0 1 2 0v5a1 1 0 1 1-2 0V8Z" /></symbol>',16,16,!1,void 0);var $,ee;!function(e){e.VkCalls="vkcalls",e.Sferum="sferum"}(ee||(ee={}));var ne=function(){function e(){}return e.setAppType=function(n){e._appType=n},e.getAppType=function(){return e._appType},e.getLsKeys=function(){return e._lsKeysMap[e._appType]},e._appType=ee.VkCalls,e._lsKeysMap=(($={})[ee.VkCalls]=d.LS_KEYS,$[ee.Sferum]=d.LS_SFERUM_KEYS,$),e}(),te={queryOption:function(e){return te.getOptions()[e]},getOptions:function(){try{var e=ne.getLsKeys(),n=localStorage.getItem(e.VIDEO_OPTIONS);if("string"!=typeof n)throw new Error("no value stored");return JSON.parse(n)}catch(e){return te.getDefaultOptions()}},saveOption:function(e,n){var t,a=(0,i.__assign)((0,i.__assign)({},te.getOptions()),((t={})[e]=n,t)),o=ne.getLsKeys();return localStorage.setItem(o.VIDEO_OPTIONS,JSON.stringify(a)),a},saveOptions:function(e){var n=ne.getLsKeys();return localStorage.setItem(n.VIDEO_OPTIONS,JSON.stringify(e)),e},getDefaultOptions:function(){return{calls_is_video_mirrored:!0}}},ae=function(){var e=ne.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT);return"string"!=typeof n?d.EVideoEffectType.NONE:/^\d+$/.test(n)?+n:n},ie=function(e){var n=ne.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT,""+e)},oe=function(){var e=ne.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS);return"string"!=typeof n?0:+n},re=function(e){var n=ne.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS,""+e)},se=function(){var e=ne.getLsKeys();localStorage.removeItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS)},le=function(){var e=(0,c.useSelector)((function(e){return e.virtualBackgroundSettings.videoOptions})),n=u(),t=(0,i.__read)((0,l.useState)(te.getOptions),2),a=t[0],o=t[1],r=(0,l.useCallback)((function(){o(te.getOptions())}),[]),_=(0,l.useCallback)((function(){te.saveOptions(a),n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[a]),v=(0,l.useCallback)((function(e,n){o((function(t){var a;return(0,i.__assign)((0,i.__assign)({},t),((a={})[e]=n,a))}))}),[]);return(0,l.useEffect)((function(){(0,s.isEqual)(e,a)||n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[]),{videoOptions:a,storedVideoOptions:e,setVideoOptions:o,onRestoreSettings:r,onSaveSettings:_,onChangeVideoOption:v}},ce=(0,l.memo)((function(e){var n=e.externalId,t=e.isVisible,a=void 0===t||t,r=e.isOrator,c=void 0!==r&&r,u=e.isInfoShown,_=e.isPinned,v=e.isPinnedByAdmin,p=e.isHandRaised,f=e.photo,h=e.hasVideo,m=e.hasAudio,C=e.isSharingScreen,S=e.isSpeaking,T=void 0!==S&&S,I=e.stream,N=void 0===I?null:I,x=e.isMe,b=void 0!==x&&x,O=e.name,w=e.letter,L=e.status,k=void 0===L?J.ParticipantStatus.CONNECTED:L,M=e.wasConnected,D=void 0===M||M,j=e.networkStatus,R=void 0===j?1:j,G=e.onClickParticipant,V=e.onDblClickParticipant,F=e.onStopScreenShare,W=e.allowContain,z=e.actions,X=(0,l.useContext)(E.LangContext).getLang,$=(0,l.useContext)(y.ConfigContext),ee=$.withAnimation,ne=$.anonymPhoto,te=(0,l.useRef)(null),ae=(0,P.isParticipantAnonym)(n),ie=le().storedVideoOptions,oe=(0,P.externalIdToString)(n),re=!!G||!!V,se=c&&C&&b,ce=(0,s.classNames)("Participant",{"Participant--isInteractive":re,"Participant--isPinned":_,"Participant--isSpeaking":T,"Participant--isOrator":c,"Participant--withAnimation":ee}),de=(0,s.classNames)("Participant__more",{"Participant__more--withAnimation":ee}),ue=(0,i.__read)((0,l.useState)(!1),2),_e=ue[0],ve=ue[1],pe=(0,l.useCallback)((function(e){G&&G(e,n)}),[G]),fe=(0,l.useCallback)((function(e){V&&V(e,n)}),[V]),Ae=(0,s.classNames)({Participant__offsetCard:u,Participant__oratorPhoto:c});return(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__wrapper"},{children:[a&&z&&z.length>0&&(0,o.jsx)(K,(0,i.__assign)({items:z,open:_e,setOpen:ve},{children:(0,o.jsx)("button",(0,i.__assign)({className:de,"aria-label":X("calls_actions")},{children:(0,o.jsx)(H,{},void 0)}),void 0)}),void 0),(0,o.jsxs)("article",(0,i.__assign)({ref:te,className:ce,onClick:pe,onDoubleClick:fe,"participant-id":oe},{children:[!a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(A,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(g.CallPhoto,{id:+n.id,photo:!ne&&ae?"":f,alt:O||"",letter:w,className:Ae},void 0)}),void 0),u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:O}),void 0),(D||b)&&!m&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0),a&&(0,o.jsxs)(o.Fragment,{children:[!(h&&c)&&(0,o.jsx)(A,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(g.CallPhoto,{id:+n.id,photo:!ne&&ae?"":f,alt:O||"",className:Ae},void 0)}),void 0),p&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(U,{className:"Participant__handIcon"},void 0)}),void 0),se&&(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__screenSharer"},{children:[(0,o.jsx)(Q,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"Participant__screenSharerText"},{children:X("calls_you_are_screen_sharer")}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:"Participant__screenSharerButton",onClick:F},{children:X("calls_screen_share_stop")}),void 0)]}),void 0),N&&h&&!se&&(0,o.jsx)(B,{className:"Participant__main",participantId:oe,stream:N,isMirrored:b&&!C&&ie[d.EVideoOptionType.IS_VIDEO_MIRRORED],isContained:W||C,isStartWithVisible:b,isLocalSchreenShare:b&&C},void 0),k!==J.ParticipantStatus.CONNECTED&&!b&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__status"},{children:(0,o.jsx)(Z,{isInverted:!0},void 0)}),void 0),!c&&u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(m||N||C)&&R<.6&&(0,o.jsx)(q,{fill:R<=.3?"#ff5c5c":"#FECE00"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:O}),void 0),(D||b)&&!m&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0),!v&&_&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)("div",{className:"Participant__pin"},void 0)}),void 0),v&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)(Y,{className:"Participant__icon"},void 0)}),void 0)]}),void 0)]}),void 0)})),de=(0,l.memo)((function(e){var n=(0,P.externalIdToString)(e.externalId),t=k((0,l.useCallback)((function(e){var t;return null===(t=e.speakers)||void 0===t?void 0:t[n]}),[n])),a=e.hasAudio&&t&&e.isVisible;return(0,o.jsx)(ce,(0,i.__assign)({},e,{isSpeaking:a}),void 0)})),ue=t(25685),_e=function(){var e,n,t,a,r=(0,ue.useLang)().getLang,l=k((function(e){var n=e.localDevice,t=e.externalId,a=e.me,i=e.peer,o=e.devices,r=e.participants;return{localDevice:n,peerDevice:(0,P.getPeerIdDeviceInfo)(i,o),meParticipant:t&&r[a],peerParticipant:r[i],externalId:t}})),c=l.externalId,d=l.localDevice,u=l.meParticipant,_=l.peerDevice,v=l.peerParticipant,p=(0,P.isParticipantWithVideo)(d),f=!(!_||!(0,P.isParticipantWithVideo)(_)),A=(0,s.classNames)("OneToOne",{"OneToOne--hasVideo":p,"OneToOne--opponentHasVideo":f});return(0,o.jsxs)("div",(0,i.__assign)({className:A},{children:[(0,o.jsx)("aside",(0,i.__assign)({className:"OneToOne__local"},{children:c&&u&&(0,o.jsx)(ce,{externalId:c,hasVideo:p,hasAudio:!!(null===(e=d.mediaSettings)||void 0===e?void 0:e.isAudioEnabled),isSharingScreen:!!(null===(n=d.mediaSettings)||void 0===n?void 0:n.isScreenSharingEnabled),stream:(0,P.getStream)(d),isMe:!0,name:r("calls_own_label"),letter:null==u?void 0:u.name.slice(0,1),wasConnected:d.wasConnected,allowContain:!0,networkStatus:d.networkStatus},void 0)}),void 0),(0,o.jsx)("main",(0,i.__assign)({className:"OneToOne__remote"},{children:v&&_&&(0,o.jsx)(ce,{externalId:_.externalId,hasVideo:f,hasAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isSharingScreen:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:(0,P.getStream)(_),photo:v.photo,name:v.name,allowContain:!0,wasConnected:_.wasConnected,networkStatus:_.networkStatus},void 0)}),void 0)]}),void 0)},ve=(0,l.forwardRef)((function(e,n){var t=e.children,a=e.className,r=e.alignX,l=e.alignY,c=e.size,d=void 0===c?"m":c,u=(0,i.__rest)(e,["children","className","alignX","alignY","size"]),_=(0,s.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+r,"CallIconButtonGroup--"+l,"CallIconButtonGroup--size-"+d,a);return(0,o.jsx)("div",(0,i.__assign)({className:_,ref:n},u,{children:t}),void 0)})),pe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"},void 0)}),void 0)},fe=(0,l.forwardRef)((function(e,n){var t=e.unreadCount,a=void 0===t?0:t,r=(0,i.__rest)(e,["unreadCount"]),c=(0,l.useContext)(y.ConfigContext).withAnimation,d="",u="";switch(!0){case!a:d="none";break;case a<=9:d="single",u=a.toString();break;case a<=99:d="double",u=a.toString();break;case a>99:d="max",u="99+"}var _=(0,s.classNames)("ChatIconButton","ChatIconButton--"+d,{"ChatIconButton--withAnimation":c});return(0,o.jsx)("button",(0,i.__assign)({className:_},r,{ref:n},{children:u&&(0,o.jsx)("div",(0,i.__assign)({className:"ChatIconButton__count "},{children:u}),void 0)}),void 0)})),Ae=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M20.465 4.4c-.489-.26-.974-.4-2.31-.4H5.844c-1.336 0-1.821.14-2.31.4A2.726 2.726 0 002.4 5.536C2.139 6.024 2 6.509 2 7.845v8.31c0 1.336.14 1.821.4 2.31.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h12.31c1.336 0 1.821-.14 2.31-.4a2.726 2.726 0 001.134-1.135c.262-.489.401-.974.401-2.31v-8.31c0-1.336-.14-1.821-.4-2.31A2.726 2.726 0 0020.464 4.4zm-11.81 5.728l2.97-2.978c.207-.2.543-.2.75 0l2.97 2.978c.33.318.077.872-.376.872H13v4.979c0 .564-.442 1.021-1 1.021s-1-.457-1-1.021V11H9.031c-.44 0-.715-.545-.375-.872z"},void 0)}),void 0)},ge=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"},void 0)}),void 0)},he=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"},void 0)}),void 0)},me=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"},void 0)}),void 0)},Ce=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"},void 0)}),void 0)},Ee=t(51013),Se=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.49 4.293a4.402 4.402 0 116.225 6.225l-1.072 1.072a.9.9 0 01-1.273-1.273l1.071-1.072a2.601 2.601 0 10-3.678-3.678l-3.537 3.537a2.601 2.601 0 000 3.678.9.9 0 01-1.274 1.273 4.402 4.402 0 010-6.225l3.537-3.537zm-.708 5.66a.9.9 0 011.273 0 4.402 4.402 0 010 6.225l-3.537 3.537a4.402 4.402 0 11-6.225-6.226l1.122-1.121a.9.9 0 111.273 1.273l-1.121 1.122a2.601 2.601 0 103.678 3.678l3.537-3.537a2.601 2.601 0 000-3.678.9.9 0 010-1.274z",fill:"#fff"},void 0)}),void 0)};const Te=(0,X.makeIcon)("Icon24Live","live_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="live_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M12 22.5C6.201 22.5 1.5 17.799 1.5 12S6.201 1.5 12 1.5 22.5 6.201 22.5 12 17.799 22.5 12 22.5Zm0-2a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm0-2a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13Zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Zm0-2a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var Ie=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"},void 0)}),void 0)},Ne=(0,l.forwardRef)((function(e,n){var t=e.participantCount,r=e.onClick,l=e.isParticipantControlActive,c=(0,o.jsx)(Ie,{},void 0);if(t&&t>0){var d="";(d=t>99?"99+":null==t?void 0:t.toString())&&(c=(0,o.jsxs)("div",{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)({ParticipantIconButton__count:!0,"ParticipantIconButton__count--lt99":t<=99})},{children:d}),void 0),c]},void 0))}return(0,o.jsx)(_,{type:l?a.OFF:a.ON,icon:c,onClick:r,className:"Call__footerButton",ref:n},void 0)})),xe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"},void 0)]}),void 0)},ye=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"},void 0)}),void 0)},be=t(11099),Oe=function(){var e=(0,be.classNames)({MicIconWithSpeakingIndicator__scale:!0});return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},{children:[(0,o.jsx)("mask",(0,i.__assign)({id:"MicIconWithSpeakingIndicatorMask"},{children:(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0)}),void 0),(0,o.jsx)("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"},void 0),(0,o.jsx)("g",(0,i.__assign)({mask:"url(#MicIconWithSpeakingIndicatorMask)"},{children:(0,o.jsxs)("g",(0,i.__assign)({className:e},{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"},void 0)]}),void 0)}),void 0)]}),void 0)},we=(0,l.forwardRef)((function(e,n){var t=e.isAudioAllowed,i=e.isAudioEnabled,r=e.onToggleAudio,s=k((function(e){return!(!e.externalId||!e.speakers[(0,P.externalIdToString)(e.externalId)])})),l=i?s?(0,o.jsx)(Oe,{},void 0):(0,o.jsx)(xe,{},void 0):(0,o.jsx)(ye,{},void 0),c=t?i?a.ON:a.OFF:a.DISABLED;return(0,o.jsx)(_,{type:c,icon:l,onClick:r,className:"Call__footerButton",ref:n},void 0)}));const Le=(0,X.makeIcon)("Icon24Settings","settings_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="settings_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9.127 5.052c1.256-.72 1.473-1.469 1.623-2.219.167-.833.417-.833.833-.833h.834c.416 0 .583 0 .833.833.225.751.383 1.502 1.631 2.223 1.397.379 2.08.002 2.717-.422.707-.471.884-.294 1.178 0l.59.59c.294.294.412.412 0 1.178-.372.69-.791 1.333-.418 2.725.72 1.256 1.469 1.473 2.219 1.623.833.167.833.417.833.833v.834c0 .416 0 .583-.833.833-.751.225-1.502.383-2.223 1.631-.379 1.397-.002 2.08.422 2.717.471.707.294.884 0 1.178l-.59.59c-.294.294-.412.412-1.178 0-.69-.372-1.333-.791-2.725-.418-1.256.72-1.473 1.469-1.623 2.219-.167.833-.417.833-.833.833h-.834c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.631-2.223-1.397-.379-2.08-.002-2.717.422-.707.471-.884.294-1.178 0l-.59-.59c-.294-.294-.412-.412 0-1.178.372-.69.791-1.333.418-2.725-.72-1.256-1.469-1.473-2.219-1.623C2 13.083 2 12.833 2 12.417v-.834c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.223-1.631.379-1.397.002-2.08-.422-2.717-.471-.707-.294-.884 0-1.178l.59-.59c.294-.294.412-.412 1.178 0 .69.372 1.333.791 2.725.418ZM12 16.75a4.75 4.75 0 1 0 0-9.5 4.75 4.75 0 0 0 0 9.5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var ke=function(e){var n=e.tooltips,t=e.onTooltipChange,a=e.getRootRef,r=e.isDropdownOpen,s=e.tooltipTitle,l=(0,i.__rest)(e,["tooltips","onTooltipChange","getRootRef","isDropdownOpen","tooltipTitle"]);return(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:s,open:n.settings,delay:300,onOpen:function(){return t("settings",!0)},onClose:function(){return t("settings",!1)},forceClose:r},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallSettingsButton__outer"},{children:(0,o.jsx)("div",(0,i.__assign)({},l,{ref:a,className:"CallSettingsButton__inner"},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(Le,{},void 0)},void 0)}),void 0)}),void 0)}),void 0)};function Pe(e){var n,t,r=e.info,c=e.chatUnreadCount,u=void 0===c?0:c,p=e.callMenuActions,f=e.isAudioAllowed,A=void 0!==f&&f,g=e.isVideoAllowed,h=void 0!==g&&g,C=e.isVideoEnabled,S=void 0!==C&&C,T=e.isAudioEnabled,I=void 0!==T&&T,N=e.isScreenSharingEnabled,x=void 0!==N&&N,b=e.isOratorMode,O=void 0===b||b,w=e.isFullScreen,L=void 0!==w&&w,k=e.onToggleVideo,P=e.onToggleAudio,M=e.onLeaveCall,D=e.onCollapseCall,j=e.onToggleOratorMode,R=e.onChat,B=e.onHandClick,U=e.onToggleScreenShare,H=e.onFullScreenToggle,G=e.onDeferredStreamStart,V=e.isParticipantControlActive,F=void 0!==V&&V,W=e.isLayoutSwitchShown,z=void 0!==W&&W,Y=e.isScreenShareControlShown,Q=void 0!==Y&&Y,Z=e.isHandRaised,J=void 0!==Z&&Z,X=e.isHandControlShown,q=void 0!==X&&X,$=e.isChatControlShown,ee=void 0!==$&&$,ne=e.isStreamingControlShown,te=void 0!==ne&&ne,ae=e.isChainControlShown,ie=void 0!==ae&&ae,oe=e.onParticipantsClick,re=e.onTooltipChange,se=e.onHidePanel,le=e.notification,ce=e.tooltips,de=e.onChainClick,ue=e.notificationWithButton,_e=e.withoutPadding,Ie=void 0!==_e&&_e,xe=e.participantCount,ye=void 0===xe?0:xe,be=e.children,Oe=e.isPopupOrModalOpen,Le=(0,l.useContext)(y.ConfigContext),Pe=Le.withAnimation,Me=Le.isModalView,De=(0,l.useContext)(E.LangContext).getLang,je=(0,s.classNames)("Call",{"Call--fullscreen":L||!Me}),Re=(0,s.classNames)("Call__content",{"Call__content--withoutPadding":Ie}),Be=300,Ue=null===(t=null===(n=window.location)||void 0===n?void 0:n.host)||void 0===t?void 0:t.includes(d.VK_HOST),He=(0,l.useRef)(null),Ge=(0,l.useRef)(null),Ve=(0,l.useRef)(null),Fe=(0,l.useRef)(null),We=(0,i.__read)((0,l.useState)(!1),2),ze=We[0],Ke=We[1],Ye=(0,i.__read)(function(e,n,t,a,o,r){var c=(0,i.__read)((0,l.useState)(!0),2),d=c[0],u=c[1],_=(0,l.useRef)(null),v=(0,l.useRef)(!1),p=(0,l.useRef)(!1),f=(0,l.useRef)(!1);f.current!==r&&(f.current=r);var A=(0,l.useRef)(!1),g=function(){v.current||A.current?A.current=!1:(_.current&&window.clearTimeout(_.current),u(!0),p.current||f.current||(_.current=window.setTimeout((function(){u(!1),_.current=null,o&&o()}),5e3)))};return(0,l.useEffect)((function(){g();var i=(0,s.throttle)((function(){g()}),1e3),o=function(){p.current=!0},r=function(){p.current=!1};return n.current.addEventListener("mouseenter",o),n.current.addEventListener("mouseleave",r),t.current.addEventListener("mouseenter",o),t.current.addEventListener("mouseleave",r),a.current.addEventListener("mouseenter",o),a.current.addEventListener("mouseleave",r),e.current.addEventListener("mousemove",i),function(){v.current=!0,_.current&&window.clearTimeout(_.current),n.current&&(n.current.removeEventListener("mouseenter",o),n.current.removeEventListener("mouseleave",r)),t.current&&(t.current.removeEventListener("mouseenter",o),t.current.removeEventListener("mouseleave",r)),a.current&&(a.current.removeEventListener("mouseenter",o),a.current.removeEventListener("mouseleave",r)),e.current&&e.current.removeEventListener("mousemove",i)}}),[p,f.current]),[d,function(e){e?u(!0):(u(!1),A.current=!0)}]}(He,Ge,Ve,Fe,se,ze),2),Qe=Ye[0],Ze=Ye[1],Je=(0,s.classNames)({"Call__controlPanel--withAnimation":Pe,"Call__controlPanel--hideBottomWithAnimation":Pe,"Call__controlPanel--hideBottom":!Qe},"CallsWithZIndex--1"),Xe=(0,s.classNames)({"Call__controlPanel--withAnimation":Pe,"Call__controlPanel--hideBottomWithAnimation":Pe,"Call__controlPanel--hideBottom":!Qe},"Call__curtain"),qe=(0,s.classNames)("Call__buttons",{"Call__controlPanel--withAnimation":Pe,"Call__controlPanel--hideBottomWithAnimation":Pe,"Call__controlPanel--hideBottom":!Qe},"CallsWithZIndex--1"),$e=(0,l.useCallback)((function(){return Ze(!0)}),[]),en=(0,l.useCallback)((function(){Oe||(Ze(!1),ce.streaming&&re("streaming",!1))}),[Oe,ce.streaming]);return(0,o.jsxs)("section",(0,i.__assign)({className:je,onMouseEnter:$e,onMouseLeave:en,ref:He},{children:[r,le,(0,o.jsx)("div",(0,i.__assign)({className:Re,"data-calls-id":"content"},{children:be}),void 0),(0,o.jsx)("div",{className:Xe},void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"l",alignY:"b",className:Je,ref:Ve},{children:(0,o.jsxs)(o.Fragment,{children:[ee&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_chat"),open:ce.chat,delay:Be,onOpen:function(){return re("chat",!0)},onClose:function(){return re("chat",!1)}},{children:(0,o.jsx)(fe,{unreadCount:u,onClick:R},void 0)}),void 0),q&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(J?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:ce.hand,delay:Be,onOpen:function(){return re("hand",!0)},onClose:function(){return re("hand",!1)}},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(ge,{},void 0),type:"hand",isActive:J,onClick:B},void 0)}),void 0),Q&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(x?"calls_stop_screen_share":"calls_start_screen_share"),open:ce.screenShare,delay:Be,onOpen:function(){return re("screenShare",!0)},onClose:function(){return re("screenShare",!1)}},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(Ae,{},void 0),isActive:x,onClick:U},void 0)}),void 0),te&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_call_menu_translation"),open:ce.streaming,delay:Be,onOpen:function(){return re("streaming",!0)},onClose:function(){return re("streaming",!1)}},{children:(0,o.jsx)(m,{icon:(0,o.jsx)(Te,{},void 0),isActive:te,onClick:G},void 0)}),void 0)]},void 0)}),void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"r",alignY:"b",style:L&&Ue?{right:"78px"}:void 0,className:Je,ref:Fe},{children:(0,o.jsxs)(o.Fragment,{children:[z&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(O?"calls_show_grid":"calls_show_orator"),open:ce.layout,delay:Be,onOpen:function(){return re("layout",!0)},onClose:function(){return re("layout",!1)}},{children:(0,o.jsx)(m,{type:O?"changeToGrid":"changeToOrator",onClick:j},void 0)}),void 0),p&&(0,o.jsx)(K,(0,i.__assign)({items:p,open:ze,setOpen:Ke,placement:"top-end"},{children:(0,o.jsx)(ke,{onTooltipChange:re,tooltips:ce,isDropdownOpen:ze,tooltipTitle:De("calls_settings")},void 0)}),void 0),D&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_collapse"),open:ce.collapse,delay:Be,onOpen:function(){return re("collapse",!0)},onClose:function(){return re("collapse",!1)}},{children:(0,o.jsx)(m,{type:"collapse",onClick:D},void 0)}),void 0),H&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(L?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:ce.fullscreen,delay:Be,onOpen:function(){return re("fullscreen",!0)},onClose:function(){return re("fullscreen",!1)}},{children:(0,o.jsx)(m,{onClick:H,icon:L?(0,o.jsx)(he,{},void 0):(0,o.jsx)(me,{},void 0)},void 0)}),void 0)]},void 0)}),void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"Call__footer",ref:Ge},{children:(0,o.jsxs)("div",(0,i.__assign)({className:qe},{children:[ie&&de&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_menu_link"),open:ce.chainlink,delay:Be,onOpen:function(){return re("chainlink",!0)},onClose:function(){return re("chainlink",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.ON,icon:(0,o.jsx)(Se,{},void 0),onClick:de,className:"Call__footerButton"},void 0)}),void 0),oe&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_participants"),open:ce.participants,delay:Be,onOpen:function(){return re("participants",!0)},onClose:function(){return re("participants",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(Ne,{isParticipantControlActive:F,onClick:oe,participantCount:ye},void 0)}),void 0),(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(S?"calls_camera_turn_off":"calls_camera_turn_on"),open:ce.video,delay:Be,onOpen:function(){return re("video",!0)},onClose:function(){return re("video",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:h?S?a.ON:a.OFF:a.DISABLED,icon:S?(0,o.jsx)(v,{},void 0):(0,o.jsx)(Ce,{},void 0),onClick:k,className:"Call__footerButton"},void 0)}),void 0),P&&(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De(I?"calls_mic_turn_off":"calls_mic_turn_on"),open:ce.audio,delay:Be,onOpen:function(){return re("audio",!0)},onClose:function(){return re("audio",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(we,{isAudioAllowed:A,isAudioEnabled:I,onToggleAudio:P},void 0)}),void 0),(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:De("calls_exit"),open:ce.leaveCall,delay:Be,onOpen:function(){return re("leaveCall",!0)},onClose:function(){return re("leaveCall",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.NEGATIVE,icon:(0,o.jsx)(pe,{},void 0),onClick:M,className:"Call__footerButton"},void 0)}),void 0)]}),void 0)}),void 0),ue&&ue]}),void 0)}var Me=t(39664),De=function(e){var n=e.onScroll,t=e.scrollPosition,a=e.participantsCount,r=e.participantsShiftCount,c=e.children,d=l.Children.toArray(c),u=(0,s.classNames)("CallGridNew","CallGridNew--c"+a),_=(0,l.useRef)(null);(0,l.useEffect)((function(){var e=function(){null!==_.current&&n(_.current.scrollTop)};return null!==_.current&&_.current.addEventListener("scroll",e),function(){_.current&&_.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;n(t),null===(e=_.current)||void 0===e||e.scrollTo(0,t)}),[_.current]);var v=(0,l.useMemo)((function(){return new Array(r).fill(0).map((function(e,n){return(0,o.jsx)("article",{className:"CallGridNew__item CallGridNew__item--empty"},-n)}))}),[r]),p=a-r-d.length>0;return(0,o.jsxs)("section",(0,i.__assign)({className:u,ref:_},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallGridNew__in"},{children:[v,d.map((function(e,n){return(0,o.jsx)("article",(0,i.__assign)({className:"CallGridNew__item","data-calls-id":"grid-item"},{children:e}),e.key||n)}))]}),void 0),p&&(0,o.jsx)(Me.default,{color:"white",size:64,duration:1,className:"CallGridNew__spinner"},void 0)]}),void 0)},je=function(e){var n=e.children,t=e.orator,a=e.oratorTitle,r=e.onToggleParticipantsAside,c=e.isShownParticipantsAside,d=e.onScroll,u=e.scrollPosition,_=e.participantsAsideCount,v=e.participantsAsideShift,p=l.Children.toArray(n),f=(0,s.classNames)({CallOrator__toggleIcon:!0,"CallOrator__toggleIcon--withAnimation":!0}),A=(0,s.classNames)({CallOrator:!0,"CallOrator--withoutOthers":!c}),g=(0,s.classNames)({CallOrator__others:!0,"CallOrator__others--hide":!c}),h=(0,s.classNames)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":c,"CallOrator__toggleArrow--toRight":!c}),m=(0,l.useRef)(null);return(0,l.useEffect)((function(){var e=function(){null!==m.current&&d(m.current.scrollTop)};return null!==m.current&&m.current.addEventListener("scroll",e),function(){m.current&&m.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;d(u),null===(e=m.current)||void 0===e||e.scrollTo(0,u)}),[m.current]),(0,o.jsxs)("article",(0,i.__assign)({className:A,ref:m},{children:[(0,o.jsx)("main",(0,i.__assign)({className:"CallOrator__orator"},{children:t}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:"CallOrator__toggleOthers",onClick:r},{children:(0,o.jsx)("div",(0,i.__assign)({className:f},{children:(0,o.jsx)("div",{className:h},void 0)}),void 0)}),void 0),(0,o.jsx)("aside",(0,i.__assign)({className:g},{children:(0,o.jsxs)("ul",(0,i.__assign)({className:"CallOrator__list",style:{height:148*_-8+"px"}},{children:[v>0&&(0,o.jsx)("li",{className:"CallOrator__participant","data-calls-id":"participant",style:{height:v+"px"}},-1),p.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallOrator__participant","data-calls-id":"participant"},{children:e}),"key"in e?e.key:void 0)}))]}),void 0)}),void 0),a]}),void 0)},Re=t(41118);function Be(e,n){var t=e.browser.hasMicrophonePermission(),a=e.browser.hasCameraPermission(),o=n.includes(J.MediaOption.AUDIO)&&!t,r=n.includes(J.MediaOption.VIDEO)&&!a;return o||r?function(e,n,t){return(0,i.__awaiter)(this,void 0,void 0,(function(){return(0,i.__generator)(this,(function(a){return[2,e.browser.getUserMedia(n,t).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))]}))}))}(e,r,o):Promise.resolve()}var Ue=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"14",height:"12",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"},void 0)}),void 0)},He=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("CallNotification",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},Ge=function(e){var n=e.duration;return(0,o.jsx)("div",{className:"CallTimer","aria-label":n,"data-duration":n},void 0)},Ve=t(78658),Fe=t(90355),We=function(e){var n=e.status,t=(0,l.useContext)(E.LangContext).getLang;switch(n){case J.ParticipantStatus.WAITING:return(0,o.jsx)(Fe.default,{children:t("calls_status_waiting")},void 0);case J.ParticipantStatus.CONNECTING:case J.ParticipantStatus.RECONNECT:return(0,o.jsx)(Fe.default,{children:t("calls_status_connecting")},void 0);case J.ParticipantStatus.ERROR:return t("calls_error");case J.ParticipantStatus.HANGUP:return(0,o.jsx)(Fe.default,{children:t("calls_status_hangup")},void 0);case J.ParticipantStatus.PERMISSIONS:return t("calls_status_no_permissions");case J.ParticipantStatus.CONNECTED:default:return null}};function ze(e){return e?(0,o.jsx)(Ge,{duration:(0,Ve.calculateCallDuration)(e)},void 0):null}function Ke(e,n){if(e.hangupType)switch(e.hangupType){case d.HANGUP_TYPE_BUSY:return n("calls_busy");case d.HANGUP_TYPE_CALLEE_IS_OFFLINE:return n("calls_callee_is_offline");case d.HANGUP_TYPE_REJECTED:return n("calls_rejected_status");case d.HANGUP_TYPE_CANCELED:case d.HANGUP_TYPE_MISSED:case d.HANGUP_TYPE_HUNGUP:case d.HANGUP_TYPE_REMOVED:return null;case d.HANGUP_TYPE_CALLER_IS_BLOCKED:case d.HANGUP_TYPE_EXTERNAL_API_ERROR:case d.HANGUP_TYPE_FAILED:case d.HANGUP_TYPE_NOT_FRIENDS:case d.HANGUP_TYPE_OLD_VERSION:case d.HANGUP_TYPE_SERVICE_DISABLED:case d.HANGUP_TYPE_UNKNOWN_ERROR:case d.HANGUP_TYPE_UNSUPPORTED:return n("calls_error")}return null}var Ye=function(e,n){return e?Ke(e,n)||function(e,n){var t,a=null;return(a=n===e.me?e.localDevice:(0,P.getPeerIdDeviceInfo)(n,e.devices))&&a.status===J.ParticipantStatus.CONNECTED||a&&a.status===J.ParticipantStatus.WAITING_HALL||(0,P.getActiveParticipantsCount)(e)<2?null:(0,o.jsx)(We,{status:null!==(t=null==a?void 0:a.status)&&void 0!==t?t:J.ParticipantStatus.WAITING},void 0)}(e,(0,O.isGroupCallByPeer)(e.peer)?e.me:e.peer)||function(e,n){return void 0===((0,O.isGroupCallByPeer)(e.peer)?e.callData.ts:e.callData.localTimeStamp)?(0,o.jsx)(Fe.default,{children:n("calls_status_waiting")},void 0):null}(e,n):""},Qe=function(e){var n=e.dispatch,t=e.notification,a=e.participant,r=(0,l.useContext)(E.LangContext),s=r.getLang,u=r.langSex,_=(0,c.useSelector)((function(e){return e})),v=(0,l.useMemo)((function(){return function(e,n,t,a){void 0===a&&(a={name:"",sex:"0",shortName:""});if(!e)return null;switch(e.type){case d.NotificationType.SPEAKING_ON_MUTE:return n("calls_notification_mic_is_mute");case d.NotificationType.SCREEN_SHARING_STARTED:if(!a||!a.name)return(0,o.jsx)("span",{children:n("calls_notification_screen_sharing_started")},void 0);var r=t(a.sex,"calls_notification_user_started_screen_sharing",n("calls_notification_user_started_screen_sharing",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.RAISED_HAND:if(!a||!a.name)return null;r=t(a.sex,"calls_notification_raised_hand",n("calls_notification_raised_hand",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION:return(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection")},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[(0,o.jsx)(Ue,{},"icon"),(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection_disable_camera")},"text")];case d.NotificationType.ADMIN_ROLE_GRANTED:return(0,o.jsx)("span",{children:n("calls_notification_admin_role_granted")},"text");case d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE:if(!a||!a.name&&!a.shortName)return null;var s=n("calls_notification_user_granted_with_admin_role").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PINNED_BY_ADMIN:return(0,o.jsx)("span",{children:n("calls_notification_admin_pinned_self")},"text");case d.NotificationType.USER_PINNED_BY_ADMIN:if(!a||!a.name&&!a.shortName)return null;s=n("calls_notification_admin_pinned_user").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PUSH_TO_TALK:s=n("calls_notification_push_to_talk_enabled");return[e.data?(0,o.jsx)(Oe,{},"icon"):(0,o.jsx)(xe,{},"icon"),(0,o.jsx)("div",(0,i.__assign)({className:"CallNotification__pushToTalkText"},{children:s}),"text")];case d.NotificationType.LINK_COPIED_TO_CLIPBOARD:s=n("calls_create_call_by_link_copied");return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.ADMIN_MUTE:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute")},"text");case d.NotificationType.ADMIN_MUTE_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_video")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_video")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_audio")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_video")},"text");default:return null}}(t,s,u,a)}),[t,a]),p=(0,l.useRef)(0);(0,l.useEffect)((function(){return p.current&&window.clearTimeout(p.current),t&&0!==t.timer&&(p.current=window.setTimeout((function(){n({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),p.current=0}),t.timer||d.defaultNotificationLifeSpan)),function(){p.current&&window.clearTimeout(p.current)}}),[t]);var f=(0,l.useMemo)((function(){return(0,P.getActiveDevices)(_).activeDevices}),[_.devices,_.participantsChunk,_.me,_.groupId,_.meGroup]),A=(0,l.useMemo)((function(){return(0,O.isGroupCallByPeer)(_.peer)}),[_.peer]),g=f.length>1,h=A||f.length>2,m=g||(0,P.isParticipantWithVideo)(_.localDevice),C=h&&m&&_.isOratorMode,S=(0,be.classNames)("",{CallNotification__pushToTalk:(null==t?void 0:t.type)===d.NotificationType.PUSH_TO_TALK,CallNotification__orator:C&&_.isShownParticipantsAside}),T=_.peer,I=(0,O.isGroupCallByPeer)(T)?_.callData.conversation:(0,P.getPeerIdDeviceInfo)(T,_.devices),N=(0,i.__read)((0,l.useState)(),2),x=N[0],y=N[1],b=(0,i.__read)((0,l.useState)(""),2),w=b[0],L=b[1];return(null==I?void 0:I.status)!==x&&(L(Ye(_,s)),y(null==I?void 0:I.status)),(0,l.useEffect)((function(){L(Ye(_,s))}),[_]),t||w?(0,o.jsx)(He,(0,i.__assign)({className:S},{children:w||v}),void 0):null};var Ze=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"28px",height:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 28 10"},n,{children:(0,o.jsx)("path",{fill:"#F2F3F5",fillRule:"evenodd",d:"M1 0a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2H2V1a1 1 0 00-1-1zm7 1a1 1 0 112 0v8a1 1 0 11-2 0V1zm15-1a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2h-3V6h3a1 1 0 100-2h-3V2h3a1 1 0 100-2h-4zm-8.325 9.31l-2.55-7.824a.993.993 0 01-.117-.363L12 1.1h.005A1 1 0 1113.995.9L14 .9l2 6.4 2-6.4h.005a1 1 0 011.99.2H20l-.008.023a.993.993 0 01-.118.363l-2.55 7.824a1 1 0 01-.95.69h-.748a1 1 0 01-.95-.69z",clipRule:"evenodd"},void 0)}),void 0)},Je=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"10",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0C4.546 0 1.596 2.073.4 5c1.196 2.927 4.146 5 7.6 5 3.455 0 6.405-2.073 7.6-5-1.195-2.927-4.145-5-7.6-5zm3.5 5a3.5 3.5 0 11-7 0 3.5 3.5 0 017 0zM8 7a2 2 0 100-4 2 2 0 000 4z",fill:"#F5F5F5"},void 0)}),void 0)},Xe=t(53449),qe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({xmlns:"http://www.w3.org/2000/svg",width:"8",height:"4",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},n,{children:(0,o.jsx)("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"},void 0)}),void 0)};const $e=(0,X.makeIcon)("Icon12Hand","hand_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="hand_12"><path d="M2.5 2.5A.5.5 0 0 1 3 3v2.5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0V5a.5.5 0 0 0 1 0V1a.5.5 0 0 1 1 0v4.063a.5.5 0 0 0 1 0V1.938a.5.5 0 0 1 1 0V7.5l-.28-.032 1.774-1.898a.67.67 0 0 1 .995.9c-.677.774-2.013 2.306-2.615 3.029C7.935 10.624 6.56 11 5.526 11 2.15 11 2 8.727 2 7.958V3a.5.5 0 0 1 .5-.5Z" /></symbol>',12,12,!1,void 0),en=(0,X.makeIcon)("Icon20RecordingCircleFill","recording_circle_fill_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="recording_circle_fill_20"><path d="M10 14a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" /><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-1.657 0a6.343 6.343 0 1 1-12.686 0 6.343 6.343 0 0 1 12.686 0Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var nn=function(e){var n=e.translationTimer,t=e.viewersCount,a=void 0===t?0:t,r=e.isLiveIndicatorOff,l=void 0!==r&&r,c=e.actions,d=void 0===c?[]:c,u=e.tooltipText,_=void 0===u?"":u,v=(0,s.classNames)({TranslationStatus__translationIndicator:!0,"TranslationStatus__translationIndicator--disabled":l}),p=(null==d?void 0:d.length)>0,f=(0,s.classNames)({TranslationStatus__translationTimer:!0,"TranslationStatus__translationTimer--hasIndicator":!l}),A=(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translation"},{children:[(0,o.jsx)(Ze,{className:v},void 0),(0,o.jsxs)(o.Fragment,{children:[!!n&&(0,o.jsx)("div",(0,i.__assign)({className:f},{children:n}),void 0),!l&&(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCount"},{children:[(0,o.jsx)(Je,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCountNumber"},{children:a}),void 0)]}),void 0),p&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationDropdown"},{children:(0,o.jsx)(qe,{},void 0)}),void 0)]},void 0)]}),"translation");return p?A=(0,o.jsx)(Xe.default,(0,i.__assign)({position:"b",align:"center",horizontalPosition:"right",trigger:"hover",marginLeft:-10,data:d,className:"TranslationStatus_dropdown"},{children:A}),void 0):_&&(A=(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:(0,o.jsx)(o.Fragment,{children:_},void 0)},{children:A}),void 0)),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus"},{children:A}),void 0)},tn=function(e){var n=e.translationTimer,t=e.hands,a=e.isMeAuthor,r=e.recordStartTimeMs,l=e.recordAuthorDisplayName,c=e.onStopRecord,d=e.isCanStopRecord,u=(0,ue.useLang)().getLang,_=Date.now()-(r||0)>5e3,v=!!n&&_,p=!!n&&!_,f=!n&&!a&&!!l,A=(t||0)>0,g=!(!a&&!d);return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TranslationStatus","TranslationStatus--is-record")},{children:[A&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__hands"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__hands CallHeader__hands--visible"},{children:[(0,o.jsx)($e,{},void 0)," ",t]}),void 0)}),void 0),(0,o.jsx)("div",{className:"TranslationStatus__divider"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({TranslationStatus__translation:!0,"TranslationStatus__translation--is-not-author":!g})},{children:[(0,o.jsx)(en,{fill:"#FF3347",width:16,height:16},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationTimer"},{children:[v&&n,p&&u("calls_recording_in_progress"),f&&u("calls_name_is_recording").replace("{name}",l)]}),void 0),g&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationStatus__endRecord",onClick:c},{children:u("calls_end_recording")}),void 0)]}),"translation")]}),void 0)},an=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.978 3.423a1.792 1.792 0 00-1.645 1.785v1.765l-.1.021a8.254 8.254 0 00-6.44 8.917.75.75 0 001.343.379l.175-.22a7.577 7.577 0 015.022-2.721v2.08a1.792 1.792 0 002.897 1.41l6.52-5.11a1.792 1.792 0 000-2.82l-6.52-5.11a1.791 1.791 0 00-1.105-.382l-.147.006zm.147 1.494c.065 0 .129.021.18.062l6.52 5.11a.292.292 0 010 .459l-6.52 5.11a.292.292 0 01-.472-.23v-2.873a.75.75 0 00-.767-.75l-.215.005-.305.016a9.065 9.065 0 00-5.162 2.056l-.037.032.004-.027a6.752 6.752 0 015.823-5.533.75.75 0 00.659-.744V5.208c0-.16.13-.291.292-.291z",fill:"#99A2AD"},void 0)}),void 0)},on=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.72 4.72a.75.75 0 011.06 0L10 8.94l4.22-4.22a.75.75 0 111.06 1.06L11.06 10l4.22 4.22a.75.75 0 11-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 01-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 010-1.06z",fill:"#99A2AD"},void 0)}),void 0)},rn=t(82280),sn=t(71618);function ln(e){var n,t,a,i;return!(!(0,P.isAdmin)(e.localDevice)&&!(0,P.isCreator)(e.localDevice))||!!(null===(t=null===(n=e.translation)||void 0===n?void 0:n.host)||void 0===t?void 0:t.id)&&+(null===(i=null===(a=e.translation)||void 0===a?void 0:a.host)||void 0===i?void 0:i.id)===(0,P.getMeId)(e)}function cn(e){return!(!(0,P.isAdmin)(e.localDevice)&&!(0,P.isCreator)(e.localDevice))||dn(e)}function dn(e){return(0,P.isParticipantGroup)(e.groupId)?e.groupId===e.translation.ownerId:e.me===e.translation.ownerId}var un=function(e){var n=e.hands,t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langNumeric,c=k((function(e){return e})),_=u(),v=(0,i.__read)((0,l.useState)(null),2),p=v[0],f=v[1],A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],h=A[1],m=(0,i.__read)((0,l.useState)(""),2),C=m[0],S=m[1],T=(0,i.__read)((0,l.useState)(0),2),I=T[0],N=T[1],x=(0,i.__read)((0,l.useState)([]),2),y=x[0],b=x[1],O=(0,i.__read)((0,l.useState)((function(){return An(c.translation.startTime)})),2),w=O[0],L=O[1],M=(0,i.__read)((0,l.useState)(fn(w)),2),D=M[0],j=M[1],R=(0,i.__read)((0,l.useState)(""),2),B=R[0],U=R[1],H=(0,i.__read)((0,l.useState)(!1),2),G=H[0],V=H[1],F=(0,l.useMemo)((function(){return(0,P.isAdmin)(c.localDevice)||(0,P.isCreator)(c.localDevice)}),[c.localDevice]),W=function(e){var n=(0,i.__read)((0,l.useState)(),2),t=n[0],a=n[1],o=k((function(n){return e.ownerId?n.participants[e.ownerId]:void 0}));(0,l.useEffect)((function(){if(e.isRecord&&e.ownerId&&e.videoId&&!o){var n=new AbortController,t=e.ownerId+"_"+e.videoId;return(0,sn.videoGet)({videos:t},{signal:n.signal}).then(a),function(){n.abort()}}}),[e.ownerId,e.videoId,e.isRecord,o]);var r=(0,l.useMemo)((function(){var e="";if(o)e=o.shortName||o.name||e;else{var n=null==t?void 0:t.items[0].owner_id;if(!(0,s.isUndefined)(n)&&(0,P.isParticipantGroup)(n)&&(null==t?void 0:t.groups)){var a=t.groups.find((function(e){return e.id===-n}));e=(null==a?void 0:a.name)||e}}return e}),[t,o]);return{data:t,recordAuthorDisplayName:r}}({isRecord:c.translation.isRecord,ownerId:c.translation.ownerId,videoId:c.translation.videoId}),z=(0,P.isParticipantGroup)(c.groupId)?c.groupId===c.translation.ownerId:c.me===c.translation.ownerId,K=(0,l.useCallback)((function(){_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]);return(0,l.useEffect)((function(){var e=ln(c);h(e)}),[c.translation,c.localDevice]),(0,l.useEffect)((function(){var e,n;if(null===(e=c.translation.host)||void 0===e?void 0:e.id){var t=c.participants[null===(n=c.translation.host)||void 0===n?void 0:n.id],a=(null==t?void 0:t.shortName)||(null==t?void 0:t.name);a!==p&&f(a)}else p&&f(null)}),[c.translation,c.participants]),(0,l.useEffect)((function(){var e=[];if(g){if(D){var n={text:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemWillStartSoon"},{children:a("calls_info_translation_will_start_soon")}),void 0)};e.push(n)}e.push(_n((0,o.jsx)(an,{},void 0),a("calls_info_translation_share_menu_item"),(function(){return _({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}))),e.push(_n((0,o.jsx)(on,{},void 0),a("calls_translation_stop_menu_item"),K))}b(e)}),[g,D]),(0,l.useEffect)((function(){var e=fn(w);e&&w>-4&&g&&!G&&(V(!0),_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})),j(e)}),[w]),(0,l.useEffect)((function(){var e=An(c.translation.startTime);L(e);var n=setInterval((function(){return L(An(c.translation.startTime))}),rn.SECOND_JS);return function(){return clearInterval(n)}}),[c.translation.startTime]),(0,l.useEffect)((function(){var e="";if(D){var n=Math.abs(w);if(n>rn.DAY){var t=Math.floor(n/rn.DAY);e=r(t,"calls_translation_upcoming_time_more_day_short",a("calls_translation_upcoming_time_more_day_short",t)).replace("%s",t)}else e=vn("-"+pn(n))}else e=vn(pn(w));S(e)}),[w,D]),(0,l.useEffect)((function(){var e,n=c.translation,t=n.ownerId,a=n.videoId;if(t&&a&&!D){var i=function(){var e={owner_id:t,video_id:a};(0,sn.videoLiveGetSpectators)(e).then((function(e){var n;N(null===(n=e.spectators)||void 0===n?void 0:n.count)}))};i(),e=setInterval(i,15*rn.SECOND_JS)}return function(){return clearInterval(e)}}),[D,c.translation.ownerId,c.translation.videoId]),(0,l.useEffect)((function(){if(!g){var e="";e=D?a("calls_info_translation_will_start_soon"):p?a("calls_translation_host_info").replace("{name}",p):a("calls_translation_host_info_unknown"),U(e)}}),[D,p,g]),c.translation.isRecord?z?(0,o.jsx)(tn,{hands:n,onStopRecord:K,recordStartTimeMs:c.translation.startTime,isMeAuthor:z,translationTimer:C},void 0):(0,o.jsx)(tn,{hands:n,onStopRecord:K,recordStartTimeMs:c.translation.startTime,isCanStopRecord:F,recordAuthorDisplayName:W.recordAuthorDisplayName},void 0):(0,o.jsx)(nn,{translationTimer:C,viewersCount:I,isLiveIndicatorOff:D,actions:y,tooltipText:B},void 0)};function _n(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}}function vn(e){return(0,o.jsx)(Ge,{duration:e},void 0)}function pn(e){return 0===e?"00:00":e<=599?"0"+(0,s.formatDuration)(e):(0,s.formatDuration)(e)}function fn(e){return e<0}function An(e){var n=Date.now();return Math.floor((n-e)/1e3)}var gn=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 10 11"},n,{children:(0,o.jsx)("path",{fill:"#F5F5F5",d:"M.5 2.5A.5.5 0 011 3v2.5a.5.5 0 001 0v-4a.5.5 0 011 0V5a.5.5 0 001 0V1a.5.5 0 011 0v4.063a.5.5 0 001 0V1.938a.5.5 0 011 0V7.5l-.28-.032L8.494 5.57a.67.67 0 01.995.9 232.32 232.32 0 00-2.615 3.029C5.935 10.624 4.56 11 3.526 11 .15 11 0 8.727 0 7.958V3a.5.5 0 01.5-.5z"},void 0)}),void 0)},hn=(0,l.memo)((function(e){var n=e.translation,t=e.speakers,a=e.hands,r=e.time,l=e.network,c=e.networkTooltipText,d=e.isTranslationRecord,u=(0,s.classNames)("CallHeader__hands",{"CallHeader__hands--visible":a>0});return(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__main"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({CallHeader__timeAndNetwork:!0,"CallHeader__timeAndNetwork--is-record":d})},{children:[l<.6&&(0,o.jsx)(C.default,(0,i.__assign)({text:c,align:"left",className:"Call__oldTooltip"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__network"},{children:(0,o.jsx)(q,{fill:l<=.3?"#ff5c5c":"#FECE00"},void 0)}),void 0)}),void 0),r]}),void 0),n&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__translation"},{children:n}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__aside"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__participants"},{children:t}),void 0),!d&&(0,o.jsxs)("div",(0,i.__assign)({className:u},{children:[(0,o.jsx)(gn,{},void 0)," ",a]}),void 0)]}),void 0)]}),void 0)}));function mn(e){var n,t=e.onHandCountChanged,a=(0,c.useSelector)((function(e){return e})),r=(0,O.isGroupCallByPeer)(a.peer),s=(0,l.useContext)(E.LangContext),d=s.getLang,u=s.langNumeric,_=(0,i.__read)((0,l.useState)(null),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(0),2),A=f[0],g=f[1],h=(0,i.__read)((0,l.useState)(null),2),m=h[0],C=h[1];(0,l.useEffect)((function(){var e=(0,O.isGroupCallByPeer)(a.peer)?a.callData.ts:a.callData.localTimeStamp;C(ze(e));var n=setInterval((function(){return C(ze(e))}),1e3);return function(){return clearInterval(n)}}),[a.peer,a.callData.localTimeStamp,a.callData.ts]),(0,l.useEffect)((function(){var e=(0,P.getRaisedHands)(a.devices,a.localDevice,a.handState);e!==A&&(g(e),t&&t(e))}),[a.devices,a.localDevice,a.handState]),(0,l.useEffect)((function(){if(r){var e=a.speakersInHeader.reduce((function(e,n){var t=a.devices[n],i=t&&a.participants[t.externalId.id];return i&&(i.shortName||i.name)&&e.push(i),e}),[]);if(e.length>0){var n=d("calls_participants_speak",e.length).split(" ");p((0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",(0,i.__assign)({className:"CallHeader__speak"},{children:[n[0]," "]}),void 0),(0,Ve.getParticipantsListLabel)(e,e.slice(0,2),(function(e){return e.shortName||e.name}),d,u,0,2)]},void 0))}else p(null)}}),[a.participants,a.speakersInHeader,a.devices]);var S=(0,l.useMemo)((function(){return a.translation.isOn&&a.translation.isRecord?(0,o.jsx)(un,{hands:A},void 0):a.translation.isOn?(0,o.jsx)(un,{},void 0):""}),[a.translation.isOn,A,a.translation.isRecord]);return(0,o.jsx)(hn,{translation:S,isTranslationRecord:!(!a.translation.isOn||!a.translation.isRecord),speakers:r?v:null,hands:A,time:m,network:null!==(n=a.localDevice.networkStatus)&&void 0!==n?n:1,networkTooltipText:d("calls_status_bad_internet_connection")},void 0)}var Cn=t(74351),En=t(27814),Sn=function(e){var n=e.title,t=e.onCloseModal,a=e.hint,r=e.actionButtons,s=e.isWithBackButton,c=e.onBackClick,d=e.children,u=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({className:"CallManagementModal",onClose:t,actionButtons:r||[],footerHint:a,backText:s?u("calls_back"):void 0,onBack:c,title:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__content"},{children:l.Children.toArray(d).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)},Tn=t(2291),In=t(87255),Nn=t(80044),xn=t(48206),yn=t(78981),bn=function(e){var n=e.isLinkBlockShown,t=e.linkBlockTitle,a=e.onLinkBlockClick,r=e.callUrlLink,s=(0,l.useContext)(y.ConfigContext).allowWaitingHall,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Tn.default,{children:n&&(0,o.jsxs)(In.default,(0,i.__assign)({onClick:a,chevron:!0,icon:(0,o.jsx)(Nn.ListIcon,{icon:(0,o.jsx)(xn.LinkIcon,{},void 0),color:Nn.ListIconColors.GREEN},void 0),aside:s?(0,o.jsx)("span",(0,i.__assign)({className:"CallManagementMenu__asideHint"},{children:c("calls_menu_link_setup")}),void 0):""},{children:[t,r&&(0,o.jsx)(yn.ListCopyControl,{value:r,copyText:c("calls_menu_link_copy"),doneText:c("calls_menu_link_copied")},void 0)]}),void 0)},void 0)},On=t(89366),wn=t(69666),Ln=t(25633),kn=t(47560),Pn=function(e){var n=e.link,t=void 0===n?"":n,a=e.isLinkLoading,r=e.isCopied,s=e.hideCopiedText,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"CallLink__info"},{children:c("calls_management_link_info_desc")}),void 0),a?(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallLink__input"},{children:(0,o.jsx)(kn.default,{},void 0)}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__input"},{children:[(0,o.jsx)(On.default,{readOnly:"readonly",value:t},void 0),(0,o.jsx)("div",{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__hint"},{children:[c("calls_management_add_warning"),(0,o.jsx)(wn.default,(0,i.__assign)({className:"CallLink__copied",shown:r,callback:s},{children:c("calls_link_copied")}),void 0)]}),void 0)},void 0)]}),void 0)]}),void 0)},Mn=t(78517),Dn=t(63205),jn=function(e){var n=e.searchQuery,t=e.onSearchChange,a=e.length,r=e.children,s=e.waitingHallList,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList"},{children:[(0,o.jsx)(Mn.BlockSearchInput,{value:n,placeholder:c("calls_search_participants_placeholder"),onChange:t,onInput:t,onPaste:t,className:"CallParticipantList__input"},void 0),!!s&&s,(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:a||""},{children:c("calls_participant_list_header")}),void 0),(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list"},{children:r}),void 0)]}),void 0)},Rn=t(39132),Bn=t(19316),Un=t(88420),Hn=function(e){var n=e.members,t=void 0===n?[]:n,a=e.totalCount,r=void 0===a?0:a,s=e.navigateToProfile,c=e.onPromote,d=e.onForbid,u=(0,l.useContext)(E.LangContext).getLang;return 0===t.length?(0,o.jsx)(o.Fragment,{},void 0):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:r||""},{children:u("calls_waiting_hall_list_header")}),void 0),(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list CallParticipantList__list--waitingList"},{children:t.map((function(e){return(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return d(e.peerId)},appearance:"secondary"},{children:u("calls_waiting_hall_forbid")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return c(e.peerId)}},{children:u("calls_waiting_hall_join")}),void 0)]},void 0)},{children:(0,o.jsx)(Bn.default,{onLinkClick:s,photo:(0,o.jsx)(g.CallPhoto,{id:e.peerId,photo:e.photo,alt:e.name||""},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.peerId)}))}),void 0)]},void 0)},Gn=t(42194),Vn=t(93385);function Fn(e,n,t){var a=(0,Vn.getExternalIdByUserId)(e);return(0,J.promoteParticipant)(a).then((function(){Wn(e,n,t)}))}function Wn(e,n,t){n&&(n.totalCount-=1,n.members.delete(e),t({type:d.E_ACTION.SET_WAITING_HALL,data:n}))}function zn(e,n,t,a){return function(e,n){if(0===n.length)return Promise.resolve([]);if(e>n.length)return(0,J.getWaitingHall)(null,e).then((function(e){return e.participants}));return Promise.resolve(n)}(e,n).then((function(n){var a=t.waitingHall||{members:new Map,hasNew:!1},o=a.members,r=a.hasNew,s=(0,i.__read)(function(e,n){return e.reduce((function(e,t){var a=(0,i.__read)(e,2),o=a[0],r=a[1],s=+t.id;return n.has(s)?r.push(s):o.push(s),[o,r]}),[[],[]])}(n,o),2),l=s[0],c=s[1],d=l.length>0,u=c.reduce((function(e,n){var t=o.get(n);return t&&e.set(n,t),e}),new Map),_={totalCount:e,members:u,hasNew:!!d||r};return d?function(e,n){var t=e.me,a=e.callData,o=e.anonymSecret,r=a.callId||"",s=t<0,l=s?t:0;return(0,sn.getCallParticipantsApiCall)(r,n,s,o,l).then((function(e){var n=e.profiles,t=void 0===n?[]:n,a=e.anonyms,o=void 0===a?[]:a,r=e.groups,s=void 0===r?[]:r;return(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(o.map(Vn.normalizeUser)),!1),(0,i.__read)(t.map(Vn.normalizeUser)),!1),(0,i.__read)(s.map(Vn.normalizeGroup)),!1)}))}(t,l).then((function(e){return e.forEach((function(e){e&&e.peerId&&_.members.set(e.peerId,e)})),_})).catch((function(){return _})):_})).then((function(e){e.members&&a({type:d.E_ACTION.SET_WAITING_HALL,data:e})}))}function Kn(e,n){if(!e.waitingHall)return Promise.resolve();var t=e.waitingHall.totalCount;return t>e.waitingHall.members.size?new Promise((function(a){(0,J.getWaitingHall)(null,t).then((function(t){zn(t.totalCount,t.participants,e,n).then((function(){a()}))}))})):Promise.resolve()}var Yn=function(e){var n,t,a,r,s,_=e.isModal,v=e.onMore,p=e.navigateToProfile,f=e.isWithBackButton,A=e.onBackClick,g=f?A:function(){},h=(0,c.useSelector)((function(e){return e})),m=u(),C=(0,l.useContext)(E.LangContext).getLang,S=(0,i.__read)((0,l.useState)(Qn(h,_)),2),T=S[0],I=S[1],N=(0,i.__read)((0,l.useState)(""),2),y=N[0],b=N[1],O=h.waitingHall?Array.from(null===(n=h.waitingHall)||void 0===n?void 0:n.members.values()):[],w=(0,l.useCallback)((function(e){return e.name}),[]),L=(0,l.useCallback)((function(e){return e.peerId}),[]),k=x(_?O:[],w,L),P=(0,l.useCallback)((function(e){b(e.target.value)}),[]),M=_?O:O.slice(0,5);y&&(M=k.search(y)),(0,l.useEffect)((function(){I(Qn(h,_))}),[null===(t=h.waitingHall)||void 0===t?void 0:t.totalCount]);var D=(0,l.useCallback)((function(e){var n,t=null===(n=h.waitingHall)||void 0===n?void 0:n.members.get(e);t&&m({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(a=h.waitingHall)||void 0===a?void 0:a.members,h.participants]),j=(0,l.useCallback)((function(e){h.waitingHall&&Fn(e,h.waitingHall,m)}),[null===(r=h.waitingHall)||void 0===r?void 0:r.members]),R=(0,l.useCallback)((function(){v&&v()}),[h.waitingHall]),B=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Hn,{members:M,totalCount:null===(s=h.waitingHall)||void 0===s?void 0:s.totalCount,navigateToProfile:p,onPromote:j,onForbid:D},void 0),T&&(0,o.jsx)(Gn.ListMore,(0,i.__assign)({onClick:R},{children:C("calls_waiting_hall_more_text")}),void 0)]},void 0);return _?(0,o.jsx)(Sn,(0,i.__assign)({title:C("calls_waiting_hall_title"),onCloseModal:function(){m({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),m({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},isWithBackButton:f,onBackClick:g},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList CallParticipantList--waiting-hall"},{children:[O.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Mn.BlockSearchInput,{value:y,placeholder:C("calls_search_participants_placeholder"),onChange:P,onInput:P,onPaste:P,className:"CallParticipantList__input"},void 0),B,y&&0===M.length&&(0,o.jsx)(Re.default,{children:C("calls_participants_not_found")},void 0)]},void 0),0===O.length&&(0,o.jsx)(Re.default,{children:C("calls_waiting_hall_not_users")},void 0)]}),void 0)}),void 0):B};function Qn(e,n){if(n)return!1;var t=e.waitingHall;return!!t&&t.totalCount>5}var Zn=t(17179),Jn=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"},void 0)}),void 0)},Xn=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"},void 0)}),void 0)},qn=function(){var e=(0,be.classNames)("VolumeMeterAnimation","VolumeMeterAnimation--withAnimation");return(0,o.jsx)("div",{className:e},void 0)},$n=function(e){var n=e.showSpeaking,t=e.showAudioDisabled,a=e.showRaisedHand,r=e.showConnecting,c=e.showRaisedHandTooltip,d=e.onRaisedHandClick,u=(0,l.useContext)(E.LangContext).getLang,_=(0,o.jsx)("span",(0,i.__assign)({className:(0,s.classNames)("ParticipantIndicators__item",{"ParticipantIndicators__item--interactive":void 0!==d}),onClick:null!=d?d:void 0},{children:(0,o.jsx)(Xn,{className:"ParticipantIndicators__hand"},void 0)}),void 0);return(0,o.jsxs)("span",(0,i.__assign)({className:"ParticipantIndicators"},{children:[n&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(qn,{},void 0)}),void 0),t&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Jn,{className:"ParticipantIndicators__muted"},void 0)}),void 0),a?c?(0,o.jsx)(C.default,(0,i.__assign)({className:"ParticipantIndicators__tooltip",text:u("calls_participant_menu_enable_media_request"),position:"t",align:"center",appearance:"light"},{children:_}),void 0):_:null,r&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Z,{},void 0)}),void 0)]}),void 0)},et=t(67406),nt=function(e){var n=e.position,t=e.align,a=e.trigger,r=e.marginTop,s=e.marginLeft,l=e.actions;return l.length>0?(0,o.jsx)(Xe.default,(0,i.__assign)({position:n,align:t,trigger:a,marginTop:r,marginLeft:s,className:"ParticipantMenu__dropdown",data:l},{children:(0,o.jsx)(et.ListActionsControl,{},void 0)}),void 0):null},tt=function(e){var n=e.SDK,t=e.participant,a=e.navigateToConvo,i=e.navigateToProfile,r=e.device,s=(0,c.useSelector)((function(e){return e})),d=u(),_=(0,l.useContext)(E.LangContext).getLang,v=t&&(0,P.getParticipantActions)({state:s,SDK:n,dispatch:d,participant:t,addProfileLink:!1,getLang:_,navigateToConvo:a,navigateToProfile:i,separatedList:!0,device:r});return(null==v?void 0:v.length)?(0,o.jsx)(nt,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:v},void 0):null},at=(0,l.memo)((function(e){var n,t,a,r,s=e.device,l=e.canMute,c=e.onUnmuteDevice,d=e.SDK,u=e.navigateToConvo,_=e.navigateToProfile,v=e.deviceId,p=k((function(e){return e.me})),f=k((function(e){return e.participants[s.externalId.id]})),A=k((function(e){return e.externalId})),h=k((function(e){return e.speakers[v]})),m=(0,P.isSameExternalId)(s.externalId,A),C=m?Zn.GlobalStore.getCallsState().localDevice:f,E=(null==f?void 0:f.peerId)!==p&&s.status===J.ParticipantStatus.WAITING,S=!E&&!(null===(n=s.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),T=!E&&!(null===(t=s.mediaSettings)||void 0===t?void 0:t.isVideoEnabled),I=!E&&!!(null===(r=null===(a=s.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state),N=E||S||I||h,x=!E&&(S||T)&&l&&!m;return(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[N&&(0,o.jsx)($n,{showSpeaking:h,showRaisedHand:I,showAudioDisabled:S,showConnecting:E,showRaisedHandTooltip:x,onRaisedHandClick:x?function(){return c(s)}:void 0},"indicators"),(0,o.jsx)(tt,{SDK:d,participant:f,device:s,navigateToConvo:u,navigateToProfile:_},"menu")]},void 0)},{children:(0,o.jsx)(Bn.default,{onLinkClick:_,photo:(0,o.jsx)(g.CallPhoto,{id:null==f?void 0:f.peerId,photo:null==f?void 0:f.photo,alt:(null==f?void 0:f.name)||"",showCreatorBadge:(0,P.isCreator)(C),showAdminBadge:(0,P.isAdmin)(C)},void 0),title:null==f?void 0:f.name,href:null==f?void 0:f.link,target:"_blank"},void 0)}),v)})),it={acc:{},timer:0,tasks:0};function ot(e,n,t,a){!function(e,n,t,a,o){void 0===a&&(a=100);var r=(0,P.externalIdToString)(e),s=(0,i.__assign)((0,i.__assign)({},n),{externalId:e});o.acc[r]=o.acc[r]&&"object"==typeof o.acc[r]?(0,i.__assign)((0,i.__assign)({},o.acc[r]),s):s,o.tasks++,o.timer&&clearTimeout(o.timer);o.timer=window.setTimeout((function(){o.tasks>0&&(t(o.acc),o.acc={},o.tasks=0),o.timer=0}),a)}(n,t,(function(n){e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:n})}),a,it)}function rt(e,n,t){var a,o,r,s,l;if(t)try{for(var c=(0,i.__values)(t),d=c.next();!d.done;d=c.next()){var u=d.value;ot(n,u.uid,{mediaSettings:u.mediaSettings,markers:u.markers,status:u.status||J.ParticipantStatus.CONNECTING,statusData:u.participantState?(0,P.convertParticipantStateFromSDK)(u.participantState):void 0,wasConnected:!1});var _=e.devices[(0,P.externalIdToString)(u.uid)],v=(null===(r=null==_?void 0:_.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||!1;(null===(s=null==u?void 0:u.mediaSettings)||void 0===s?void 0:s.isScreenSharingEnabled)!==v&&(0,P.toggleScreenSharing)(e,n,null===(l=null==u?void 0:u.mediaSettings)||void 0===l?void 0:l.isScreenSharingEnabled,u.uid,!0)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}}function st(e){return new Promise((function(n,t){var a=new Image;a.src=e,a.onload=n,a.onerror=t}))}function lt(e){return Promise.resolve(e)}function ct(e,n,t){if(e.authorizedGroupId)return Promise.resolve();if((0,Ve.unpackState)(n).friends.length>0)return Promise.resolve();if(e.getFriends){var a=e.getFriends();if(null!==a)return t({type:d.E_ACTION.SET_FRIENDS,data:a}),Promise.resolve()}return(0,sn.loadFriends)().then((function(e){var n=e.items,t=e.count;return{friends:n.map(Vn.normalizeUser),count:t}})).then((function(e){var n=e.count,a=e.friends;t({type:d.E_ACTION.SET_FRIENDS,data:a,friendsCount:n})}))}function dt(e,n,t,a){return(0,sn.loadChatMembers)(t).then((function(t){t.profiles&&n({type:d.E_ACTION.SET_CHAT_INFO,data:ut(t).sort((function(n,t){var a=(0,Ve.unpackState)(e).me;return n.peerId===a?-1:t.peerId===a?1:0})),conversation:a})}))}function ut(e){var n,t,a=function(e){var n,t,a={};if(!e)return a;try{for(var o=(0,i.__values)(e),r=o.next();!r.done;r=o.next()){var s=r.value;a[s.id]=s}}catch(e){n={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(n)throw n.error}}return a}(e.profiles),o=[];try{for(var r=(0,i.__values)(e.items),s=r.next();!s.done;s=r.next()){var l=a[s.value.member_id];l&&o.push((0,Vn.normalizeUser)(l))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(n)throw n.error}}return o}function _t(e,n,t){return e.authorizedGroupId?n.groupMembers.length>0?Promise.resolve():(0,sn.getGroupMembers)(-e.authorizedGroupId,0,d.COUNT_OF_GROUP_MEMBERS_TO_LOAD).then((function(e){var n=e.items,t=e.count,a=[],i=[];return n.forEach((function(e){e.deactivated||(a.push((0,Vn.normalizeUser)(e)),e.can_call_from_group||i.push(e.id))})),{groupMembers:a,unableToCallGroupMembersIds:i,count:t}})).then((function(e){var n=e.groupMembers,a=e.unableToCallGroupMembersIds,i=e.count;return t({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:i,groupMembers:n,unableToCallGroupMembersIds:a}),Promise.resolve()})):Promise.resolve()}function vt(e,n,t){return(0,sn.retryLoadCallPeers)(t).then((function(e){var t=(0,i.__read)((0,Ve.convertServerData)(e),3),a=t[0],o=t[1],r=t[2];return mt(n,r),lt({conversation:a,members:o})})).then((function(e){var a=e.conversation,i=e.members;n({type:d.E_ACTION.LOAD_PEERS,conversation:a,members:i,peerId:t})}))}function pt(e,n,t){return t?(0,sn.loadCallPeers)(t).then((function(e){var t=e.items,a=(0,i.__read)(t,1)[0];mt(n,a)})):Promise.resolve()}var ft,At={acc:[],timer:0,promise:null,promiseResolve:null,tasks:0,timeout:300};function gt(e,n,t,a,o,r){var s,l;return(s=At.acc).push.apply(s,(0,i.__spreadArray)([],(0,i.__read)(o),!1)),At.timer&&clearTimeout(At.timer),At.timer=window.setTimeout((function(){var o=At.acc,s=At.promiseResolve;At.promise=null,At.promiseResolve=null,At.acc=[],function(e,n,t,a,o,r){var s=(0,Ve.unpackState)(e).me,l=(0,Ve.unpackState)(e).anonymSecret,c=s<0?s:void 0;return(0,sn.getCallParticipants)(a,o,c,s<0,l).then((function(e){var s=e.profiles,l=void 0===s?[]:s,c=e.anonyms,u=void 0===c?[]:c,_=e.secret,v=e.groups,p=void 0===v?[]:v;_&&n({type:d.E_ACTION.UPDATE_ANON_SECRET,secret:_});var f=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(u),!1),(0,i.__read)(p),!1),A=o.filter((function(e){var n=f.find((function(n){return n&&n.id===e}));return!n}));A.length>0&&t.eventHandlers.onError&&t.eventHandlers.onError(new Error("callId: "+a+", timestamp: "+Date.now()+", cant find in participants: "+A.join(", ")));var g=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(u),!1),(0,i.__read)(l),!1).map(Vn.normalizeUser);(null==p?void 0:p.length)>0&&(g=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(g),!1),(0,i.__read)(p.map(Vn.normalizeGroup)),!1));var h=lt([{},g]);return r.awaitImages?h.then((function(){return[null,g]})):[null,g]})).then((function(e){var t=(0,i.__read)(e,2)[1];t.length>0&&n({type:d.E_ACTION.LOAD_PEERS,members:t})})).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))}(e,n,t,a,o,r).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)})).finally(s)}),At.timeout),At.promise=null!==(l=At.promise)&&void 0!==l?l:new Promise((function(e){At.promiseResolve=e}))}function ht(e,n,t,a){return void 0===a&&(a=0),(0,sn.getCallUrlLink)(n,t,a).then((function(n){var t=n.join_link;return e({type:d.E_ACTION.CALL_STATE,callData:{callUrlLink:t}}),t}))}function mt(e,n){if(n&&n.call_in_progress){var t=n.unread_count,a=n.last_message_id,i=n.call_in_progress.has_link,o=n.call_in_progress.can_finish_call;e({type:d.E_ACTION.CALL_STATE,callData:{canFinishCall:o,hasUrlLink:i}}),(t||a)&&e({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t,chatUpToMsgId:a})}}function Ct(e,n){return void 0===n&&(n=!1),(0,J.startStream)(n,null,e).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))}function Et(e,n,t){void 0===t&&(t=0),ht(e,n,!1,t).then((function(n){(0,s.copyTextToClipboard)(n).then((function(n){n&&e({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.LINK_COPIED_TO_CLIPBOARD}})}))})).catch(console.log)}function St(e,n,t,a){n(t),Mt(e)&&jt(a,n,t)}!function(e){e.CONTAIN="cn",e.COVER="cv"}(ft||(ft={}));function Tt(e,n,t){return(0,O.isGroupCallByPeer)(e.peer)?e.uiMode===d.UIMode.COLLAPSED?function(e){var n=(0,Ve.isAnyoneWithVideo)(e),t=(0,P.getCallVisibleParticipant)(e,n),a=(0,P.getActiveDevices)(e).activeDevices,i=e.config,o=i.enableScreenTrack,r=i.enableProducerScreenTrack;return a.reduce((function(n,a){var i=a.externalId,s=a.mediaSettings;if((0,P.isSameExternalId)(a.externalId,e.externalId))return n;var l=(0,P.externalIdToString)(i);if(o||r){var c=!!(null==s?void 0:s.isScreenSharingEnabled),d=!!(null==s?void 0:s.isVideoEnabled),u=(0,P.isSameExternalId)(i,null==t?void 0:t.externalId);u&&c&&(n.set(Lt(l,J.MediaType.SCREEN),xt(t,J.MediaType.SCREEN)),n.set(Lt(l,J.MediaType.CAMERA),Nt(a,J.MediaType.CAMERA))),u&&!c&&d&&(n.set(Lt(l,J.MediaType.CAMERA),xt(t,J.MediaType.CAMERA)),n.set(Lt(l,J.MediaType.SCREEN),Nt(a,J.MediaType.SCREEN))),u&&(c||d)||(n.set(Lt(l,J.MediaType.SCREEN),Nt(a,J.MediaType.SCREEN)),n.set(Lt(l,J.MediaType.CAMERA),Nt(a,J.MediaType.CAMERA)))}else(0,P.isSameExternalId)(null==t?void 0:t.externalId,i)&&wt(s)?n.set(l,xt(t)):n.set(l,Nt(a));return n}),new Map)}(e):e.isOratorMode?function(e,n,t){var a,i,o=(0,P.getSelectedDevice)(e),r=o.externalId,s=(0,P.externalIdToString)(r),l=(0,P.getActiveDevices)(e).activeDevices,c=0,u=e.config,_=u.enableScreenTrack,v=u.enableProducerScreenTrack;if((_||v)&&s){var p=new Map,f=!!(null===(a=null==o?void 0:o.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),A=!!(null===(i=null==o?void 0:o.mediaSettings)||void 0===i?void 0:i.isVideoEnabled),g=e.uiMode===d.UIMode.FULLSCREEN,h=!(0,P.isSameExternalId)(r,e.externalId);return f&&h&&(c++,p.set(Lt(s,J.MediaType.SCREEN),bt(o,g,!1,n,t,J.MediaType.SCREEN))),f&&A&&h&&(c++,p.set(Lt(s,J.MediaType.CAMERA),Ot(o,J.MediaType.CAMERA))),f&&!A&&h&&p.set(Lt(s,J.MediaType.CAMERA),Nt(o,J.MediaType.CAMERA)),!f&&A&&h&&(c++,p.set(Lt(s,J.MediaType.CAMERA),bt(o,g,!1,n,t,J.MediaType.CAMERA)),p.set(Lt(s,J.MediaType.SCREEN),Nt(o,J.MediaType.SCREEN))),f||A||!h||(p.set(Lt(s,J.MediaType.CAMERA),Nt(o,J.MediaType.CAMERA)),p.set(Lt(s,J.MediaType.SCREEN),Nt(o,J.MediaType.SCREEN))),l.reduce((function(n,t){var a=t.externalId,i=t.mediaSettings;if((0,P.isSameExternalId)(a,e.externalId)||(0,P.isSameExternalId)(a,r))return n;var o=(0,P.externalIdToString)(a),s=!!(null==i?void 0:i.isScreenSharingEnabled),l=!!(null==i?void 0:i.isVideoEnabled),d=t.visible&&c<e.config.videoSlotsCount;return d&&l&&(c++,n.set(Lt(o,J.MediaType.CAMERA),Ot(t,J.MediaType.CAMERA)),n.set(Lt(o,J.MediaType.SCREEN),Nt(t,J.MediaType.SCREEN))),d&&!l&&s&&(c++,n.set(Lt(o,J.MediaType.SCREEN),Ot(t,J.MediaType.SCREEN)),n.set(Lt(o,J.MediaType.CAMERA),Nt(t,J.MediaType.CAMERA))),d&&(l||s)||(n.set(Lt(o,J.MediaType.SCREEN),Nt(t,J.MediaType.SCREEN)),n.set(Lt(o,J.MediaType.CAMERA),Nt(t,J.MediaType.CAMERA))),n}),p),p}return l.reduce((function(a,i){var o=i.externalId,s=i.mediaSettings;if((0,P.isSameExternalId)(o,e.externalId))return a;var l=(0,P.externalIdToString)(o);if((0,P.isSameExternalId)(r,o)&&wt(s)){var u=bt(i,e.uiMode===d.UIMode.FULLSCREEN,!1,n,t);a.set(l,u)}else wt(s)&&i.visible&&c<e.config.videoSlotsCount?(c++,a.set(l,Ot(i))):a.set(l,Nt(i));return a}),new Map)}(e,n,t):function(e,n,t){var a=e.uiMode===d.UIMode.FULLSCREEN,i=a?n:900,o=a?t:504,r=(0,P.getActiveDevices)(e).activeDevices,s=function(e,n,t){switch(t){case 1:return n;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(n/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(n/3);default:return Math.round(e/6)}}(i,o,r.length),l=s<200?1:2,c=0,u=e.config,_=u.enableScreenTrack,v=u.enableProducerScreenTrack;return r.reduce((function(n,t){if((0,P.isSameExternalId)(t.externalId,e.externalId))return n;var a=t.externalId,i=t.mediaSettings,o=(0,P.externalIdToString)(a);if(_||v){var r=!!(null==i?void 0:i.isScreenSharingEnabled),d=!!(null==i?void 0:i.isVideoEnabled),u=t.visible&&c<e.config.videoSlotsCount;return u&&r&&(c++,n.set(Lt(o,J.MediaType.SCREEN),yt(t,s,l,J.MediaType.SCREEN)),n.set(Lt(o,J.MediaType.CAMERA),Nt(t,J.MediaType.CAMERA))),u&&!r&&d&&(c++,n.set(Lt(o,J.MediaType.CAMERA),yt(t,s,l,J.MediaType.CAMERA)),n.set(Lt(o,J.MediaType.SCREEN),Nt(t,J.MediaType.SCREEN))),u&&(r||d)||(n.set(Lt(o,J.MediaType.CAMERA),Nt(t,J.MediaType.CAMERA)),n.set(Lt(o,J.MediaType.SCREEN),Nt(t,J.MediaType.SCREEN))),n}return wt(i)&&t.visible&&c<e.config.videoSlotsCount?(n.set(o,yt(t,s,l)),c++):n.set(o,Nt(t)),n}),new Map)}(e,n,t):function(e,n,t){var a=new Map,i=(0,P.getPeerIdDeviceInfo)(e.peer,e.devices);if(!i)return a;var o=e.config,r=o.enableScreenTrack,s=o.enableProducerScreenTrack,l=e.uiMode===d.UIMode.FULLSCREEN,c=e.uiMode===d.UIMode.COLLAPSED,u=i.externalId,_=i.mediaSettings;if((0,P.isSameExternalId)(u,e.externalId))return a;var v=(0,P.externalIdToString)(u);if(r||s){var p=!!(null==_?void 0:_.isScreenSharingEnabled),f=!!(null==_?void 0:_.isVideoEnabled);if(p&&f&&(a.set(Lt(v,J.MediaType.SCREEN),bt(i,l,c,n,t,J.MediaType.SCREEN)),a.set(Lt(v,J.MediaType.CAMERA),Ot(i,J.MediaType.CAMERA))),p!==f){var A=p?J.MediaType.SCREEN:J.MediaType.CAMERA,g=p?J.MediaType.CAMERA:J.MediaType.SCREEN;a.set(Lt(v,A),bt(i,l,c,n,t,A)),a.set(Lt(v,g),Nt(i,g))}return p||f||(a.set(Lt(v,J.MediaType.SCREEN),Nt(i,J.MediaType.SCREEN)),a.set(Lt(v,J.MediaType.CAMERA),Nt(i,J.MediaType.CAMERA))),a}return a.set(v,wt(_)?bt(i,l,c,n,t):Nt(i)),a}(e,n,t)}function It(e){return e&&!e.stopStream}function Nt(e,n){return void 0===n&&(n=null),{stopStream:!0,uid:e.externalId,mediaType:n}}function xt(e,n){return void 0===n&&(n=null),{fit:ft.CONTAIN,width:265,height:200,priority:2,uid:e.externalId,mediaType:n}}function yt(e,n,t,a){return void 0===a&&(a=null),{fit:ft.COVER,width:n,height:n,priority:t,uid:e.externalId,mediaType:a}}function bt(e,n,t,a,i,o){return void 0===o&&(o=null),{fit:ft.CONTAIN,width:n?a:t?265:900,height:n?i:t?200:504,priority:3,uid:e.externalId,mediaType:o}}function Ot(e,n){void 0===n&&(n=null);var t=e.mediaSettings;return{fit:(null==t?void 0:t.isScreenSharingEnabled)?ft.CONTAIN:ft.COVER,width:140,height:140,priority:1,uid:e.externalId,mediaType:n}}function wt(e){var n;return null!==(n=!!(null==e?void 0:e.isVideoEnabled)||!!(null==e?void 0:e.isScreenSharingEnabled))&&void 0!==n&&n}function Lt(e,n){return void 0===n&&(n=null),n?e+":"+n:e}var kt="GRID";function Pt(e){var n=1*e;return Math.min(n+e+n,128)}function Mt(e){var n;return Boolean(null===(n=e.config)||void 0===n?void 0:n.enableParticipantListChunk)}function Dt(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(Mt(e)&&r){var s=(0,P.externalIdToString)(i),l=$t(e,s),c=zt(Yt(o),e),d=c>-1,u=-1===c;if(Xt(n,i,!1),d){var _=sa(c,r),v={countBefore:r.countBefore,ids:_,countAfter:r.countAfter};la(n,v),function(e,n,t,a){if(0===a.countAfter&&0===a.countBefore||ha(a,e))return Promise.resolve();Ca(e,n,t)}(e,n,t,v)}else u?(la(n,{countBefore:r.countBefore-1}),Ea(e,n,t)):la(n,{countAfter:r.countAfter-1});l&&qt(e,n,s)}}function jt(e,n,t){var a=t.numberOfVisible,o=t.firstVisible;return(0,i.__awaiter)(this,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(i){return t=Zn.GlobalStore.getCallsState(),o=_a(Math.max(0,o)),a=Math.ceil(a),function(e,n,t){var a=e.participantsChunk;if(!a)return!0;var i=a.countBefore,o=a.countAfter,r=i,s=r+a.ids.length,l=n+t,c=Math.ceil(1*t*.2);if((0===i||n-r>=c)&&(0===o||s-l>=c))return!1;return!0}(t,o,a)?[2,Ca(t,n,e,{firstVisible:o,numberOfVisible:a})]:[2]}))}))}function Rt(e,n,t,a,o){var r=o.externalId,s=o.markers,l=o.mediaSettings,c=l.isScreenSharingEnabled,d=e.participantsChunk,u=oa(d,ia(e,s));c||u?(!function(e,n,t){t&&ta(e,n,{markers:t})}(n,r,s),Gt(e,n,a,r,{mediaSettings:l})):qt(e,n,(0,P.externalIdToString)(r));var _=0===(null==d?void 0:d.countBefore);(0,P.getOrator)(e).device!==e.localDevice||_||function(e,n,t){(0,i.__awaiter)(this,void 0,void 0,(function(){var a,o;return(0,i.__generator)(this,(function(r){switch(r.label){case 0:return[4,Ut(e,{count:1,fromIdx:0})];case 1:return a=i.__read.apply(void 0,[r.sent().participants,1]),(o=a[0])?((0,P.toggleScreenSharing)(n,t,o.mediaSettings.isScreenSharingEnabled,o.uid),[2]):[2]}}))}))}(t,e,n),Zt(e,n,t,a,{externalId:r,markers:s})}var Bt=[];function Ut(e,n,t){var a=n.count,o=n.fromIdx,r=void 0===o?0:o,s=n.fromMarker,l=(void 0===t?{}:t).signal,c=void 0===l?null:l;return(0,i.__awaiter)(this,void 0,void 0,(function(){var n,t;return(0,i.__generator)(this,(function(i){return n=!1,t=function(){return n=!0},c&&c.addEventListener("abort",t,{once:!0}),[2,e.getParticipantListChunk({count:a,fromIdx:s?void 0:r,fromMarker:s,listType:kt}).then((function(e){return n?Promise.reject(new Error("aborted")):e})).finally((function(){c&&c.removeEventListener("abort",t)}))]}))}))}function Ht(e,n,t,a){var i=na(e,n,t,a.map((function(e){return e.externalId})));return Wt(n,a),i}function Gt(e,n,t,a,o){Ht(e,n,t,[(0,i.__assign)({externalId:a},o)])}function Vt(e){var n;if(e){var t=null!==(n=e.countBefore)&&void 0!==n?n:0;return t?va(t,1):t}return 0}function Ft(e,n){var t=ua(e),a=fa(e),i=t+a,o=n.countBefore;return n.ids.reduce((function(e,n,a){var r=o+a,s=r>=t&&r<i;return e.push({externalId:n,visible:s}),e}),[])}function Wt(e,n){var t=n.reduce((function(e,n){return e[(0,P.externalIdToString)(n.externalId)]=n,e}),{});e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:t})}function zt(e,n){var t=n.participantsChunk,a=(null==t?void 0:t.ids)||[];return(0,Ve.binarySearch)(a,(function(t){var a=(0,P.externalIdToString)(t),i=ea(n,a);if(!i)return 1;var o=Yt(i.markers);return J.Utils.participantMarkerCompare(e,o)}))}function Kt(e,n,t){var a;!function(e,n,t){var a,i,o=null!==(i=null===(a=e.participantsChunk)||void 0===a?void 0:a.ids)&&void 0!==i?i:[];if(!o.length)return;var r=t.participants.reduce((function(e,n){return e[(0,P.externalIdToString)(n.uid)]=!0,e}),{});Aa(e,n,o.filter((function(e){var n=(0,P.externalIdToString)(e);return!r[n]})))}(e,n,t);var i=null!==(a=null==t?void 0:t.participants)&&void 0!==a?a:[],o={countBefore:t.countBefore,ids:i.map((function(e){return e.uid})),countAfter:t.countAfter};la(n,o);var r=i.map((function(e){return{externalId:e.uid,markers:e.markers}}));Wt(n,r),rt(e,n,i),Ft(e,o).forEach((function(e){ot(n,e.externalId,e)}))}function Yt(e){return null==e?void 0:e.GRID}function Qt(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(r){var s=aa(e,i),l=ia(e,o),c=s>-1,d=oa(r,l);if(d&&!c){var u=0===r.countBefore&&r.countAfter?r.countAfter-1:r.countAfter;ga(e,n,t,{externalId:i,markers:o,countBefore:0===r.countAfter&&r.countBefore?r.countBefore-1:r.countBefore,countAfter:u})}else{if(c&&!d)!function(e,n,t,a){if(!a)return;var i=sa(n,a),o=0===t;function r(e,n){return e?n+1:n}la(e,{countBefore:r(o,a.countBefore),ids:i,countAfter:r(!o,a.countAfter)})}(n,s,l,r);else c&&d&&s!==l&&function(e,n,t,a,i){var o=Array.from(i);o.splice(t,0,a);var r=n+(t<=n?1:0);o.splice(r,1),la(e,{ids:o})}(n,s,l,i,r.ids)}}}function Zt(e,n,t,a,i){Qt(e,n,a,{externalId:i.externalId,markers:i.markers}),Ea(e,n,t)}function Jt(e,n,t){(null==t?void 0:t.hand)&&Xt(e,n,t.hand.state)}function Xt(e,n,t){e({type:d.E_ACTION.SET_PARTICIPANT_HAND_STATE,key:(0,P.externalIdToString)(n),value:t})}function qt(e,n,t){$t(e,t)&&n({type:d.E_ACTION.REMOVE_DEVICE_FROM_CACHE,id:t})}function $t(e,n){return Boolean(ea(e,n))}function ea(e,n){return e.devices[n]}function na(e,n,t,a){return(0,i.__awaiter)(this,void 0,Promise,(function(){var o,r,s;return(0,i.__generator)(this,(function(i){return(o=a.reduce((function(n,t){var a=Number(t.id);return e.participants[a]||n.push(a),n}),[])).length?(r=e.callData.callId||"",s={withConversation:!e.callData.conversation,awaitImages:!1},[2,gt(e,n,t,r,o,s)]):[2,Promise.resolve()]}))}))}function ta(e,n,t){Wt(e,[(0,i.__assign)({externalId:n},t)])}function aa(e,n){var t=ea(e,(0,P.externalIdToString)(n));return t?zt(Yt(t.markers),e):-1}function ia(e,n){var t=zt(Yt(n),e);return t>-1?t:-(t+1)}function oa(e,n){if(!e)return!1;var t=e.ids;return 0===n&&0===e.countBefore||n===t.length&&0===e.countAfter||n>0&&n<t.length}function ra(e,n,t,a,o){var r=o.externalId,s=o.marker;return(0,i.__awaiter)(this,void 0,void 0,(function(){var o;return(0,i.__generator)(this,(function(i){return o=(0,P.externalIdToString)(r),[2,Ut(t,{count:1,fromMarker:s}).then((function(t){var i=t.participants[0];(0,P.externalIdToString)(i.uid)===o&&Gt(e,n,a,i.uid,{markers:i.markers,mediaSettings:i.mediaSettings})}))]}))}))}function sa(e,n){if(!n)return[];var t=n.ids,a=Array.from(t);return a.splice(e,1),a}function la(e,n){e({type:d.E_ACTION.SET_PARTICIPANTS_CHUNK,data:n})}function ca(e,n,t,a){var i=(0,P.externalIdToString)(t);(a.stream||a.screenSharingStream||$t(e,i))&&ot(n,t,a)}function da(e,n){var t=1*n;return Math.max(0,e-t)}function ua(e){return _a(pa(e))}function _a(e){return va(e,-1)}function va(e,n){return Math.max(e+n,0)}function pa(e){var n;return null!==(n=e.isOratorMode?e.oratorScrollFirstVisible:e.gridScrollFirstVisible)&&void 0!==n?n:0}function fa(e){return e.isOratorMode?Math.ceil(e.oratorScrollNumberOfVisible):d.GRID_SCROLL_NUMBER_OF_VISIBLE}function Aa(e,n,t){var a=[e.adminPinnedParticipant,e.screenSharingPinnedParticipant,e.pinnedParticipant].filter(Boolean).map((function(e){return(0,P.externalIdToString)(e)})).reduce((function(e,n){return e[n]=!0,e}),{});t.filter((function(e){var n=(0,P.externalIdToString)(e);return!a[n]})).forEach((function(t){var a=(0,P.externalIdToString)(t);qt(e,n,a)}))}function ga(e,n,t,a){var o=a.externalId,r=a.markers,s=a.countBefore,l=a.countAfter,c=e.participantsChunk;if(c){s=null!=s?s:c.countBefore,l=null!=l?l:c.countAfter;var d=Sa(Yt(r),e),u=ma(e),_=da(ua(e),fa(e)),v=Math.max(_-s,0),p=c.ids,f=Array.from(p);f.splice(d,0,o);var A=f.splice(0,v),g=f.splice(u),h={countBefore:s+A.length,ids:f,countAfter:l+g.length};Gt(e,n,t,o,{markers:r,status:J.ParticipantStatus.CONNECTED}),la(n,h),function(e,n,t){t&&Wt(n,Ft(e,t))}(e,n,h),Aa(e,n,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(A),!1),(0,i.__read)(g),!1))}}function ha(e,n){var t=ma(n);return e.ids.length>=t}function ma(e){return Pt(fa(e))}function Ca(e,n,t,a){var i=void 0===a?{}:a,o=i.firstVisible,r=void 0===o?ua(e):o,s=i.numberOfVisible,l=void 0===s?fa(e):s,c=Pt(l),d=function(e,n,t){return e.participantsChunk?da(n,t):0}(e,r,l);return Ut(t,{count:c,fromIdx:d}).then((function(t){Kt(Zn.GlobalStore.isSet()?Zn.GlobalStore.getCallsState():e,n,t)}))}function Ea(e,n,t){return jt(t,n,{firstVisible:pa(e),numberOfVisible:fa(e)})}function Sa(e,n){return-(zt(e,n)+1)}var Ta=100,Ia=function(e){var n=e.SDK,t=e.bridge,a=e.onAddClick,r=e.navigateToProfile,s=e.navigateToConvo,d=e.onShowMoreWaitingHall,u=(0,c.useSelector)((function(e){return e})),_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(""),2),p=v[0],f=v[1],A=(0,i.__read)((0,l.useState)(Ta),2),g=A[0],h=A[1],m=(0,P.canMuteParticipants)(u.localDevice),C=function(e,n,t,a){var o=k((function(e){return e})),r=Mt(o),s=(0,l.useMemo)((function(){return o.externalId?(0,i.__assign)((0,i.__assign)({},o.localDevice),{externalId:o.externalId}):null}),[o.localDevice,o.externalId]);return(r?Na:xa)(e,n,t,s,{offset:a})}(p,n,t,g-Ta),S=C.participants,T=C.isLoading,I=(0,l.useCallback)((function(e){f(e.target.value)}),[]),N=!(0,P.isParticipantAnonym)(u.me),x=M(),y=(0,l.useCallback)((function(e){n.muteParticipant(e.externalId,{},[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]).catch(console.log)}),[]);return(0,o.jsxs)(jn,(0,i.__assign)({searchQuery:p,onSearchChange:I,length:x,waitingHallList:u.waitingHall&&(0,o.jsx)(Yn,{isModal:!1,navigateToProfile:r,onMore:d},void 0)},{children:[!p&&N&&(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,border:!1},{children:(0,o.jsx)(Rn.ListAddControl,(0,i.__assign)({onClick:a},{children:_("calls_add_participants")}),void 0)}),"add"),!!S.length&&S.slice(0,g).map((function(e){var t=(0,P.externalIdToString)(e.externalId);return(0,o.jsx)(at,{deviceId:t,SDK:n,canMute:m,device:e,navigateToConvo:s,navigateToProfile:r,onUnmuteDevice:y},t)})),T&&(0,o.jsx)(Me.default,{},void 0),!T&&x>g&&(0,o.jsx)(In.default,{children:(0,o.jsx)(Gn.ListMore,(0,i.__assign)({className:"CallParticipantList__more",onClick:function(){h((function(e){return e+Ta}))}},{children:_("calls_participants_show_more").replace("{n}",String(Ta))}),void 0)},"limit"),p&&0===S.length&&(0,o.jsx)(Re.default,{children:_("calls_participants_not_found")},void 0)]}),void 0)};function Na(e,n,t,a,o){var r,s=(void 0===o?{}:o).offset,c=void 0===s?0:s,_=k((function(e){return e.devices})),v=k((function(e){return e.participants})),p=k((function(e){return e.participantsChunk})),f=k((function(e){var n;return null!==(n=e.callData.callId)&&void 0!==n?n:""})),A=u(),g=(0,i.__read)((0,l.useState)([]),2),h=g[0],m=g[1],C=(0,i.__read)((0,l.useState)(!1),2),E=C[0],S=C[1],T=(r=p)?r.countBefore+r.ids.length+r.countAfter:0,I=0===c&&T<=Ta?T:null;return(0,l.useEffect)((function(){var a=new AbortController,o=!1;return a.signal.addEventListener("abort",(function(){o=!0}),{once:!0}),S(!0),(e?new Promise((function(t,i){var r=setTimeout((function(){t(function(){function t(e,n){return{id:String(e.id),type:n}}(0,sn.searchCallParticipants)(f,{search:e},{signal:a.signal}).then((function(e){var n=e.profiles,a=void 0===n?[]:n,i=e.anonyms,o=void 0===i?[]:i,r=e.groups,s=void 0===r?[]:r,l=[],c=[];return o.forEach((function(e){l.push((0,Vn.normalizeUser)(e)),c.push(t(e,J.ExternalIdType.ANONYM))})),a.forEach((function(e){l.push((0,Vn.normalizeUser)(e)),c.push(t(e,J.ExternalIdType.USER))})),s.forEach((function(e){l.push((0,Vn.normalizeGroup)(e)),c.push(t(e,J.ExternalIdType.GROUP))})),lt([{},l]),A({type:d.E_ACTION.LOAD_PEERS,members:l}),c})).then((function(e){return n.getParticipants({externalIds:e})})).then((function(e){if(!o){var n=Zn.GlobalStore.getCallsState(),t=e.map((function(e){var n=e.uid;return(0,P.externalIdToString)(n)}));rt(n,A,e),m(t)}}))}())}),1e3);a.signal.addEventListener("abort",(function(){clearTimeout(r),i()}),{once:!0})})):Ut(n,{fromIdx:c,count:100},{signal:a.signal}).then((function(e){var n=Zn.GlobalStore.getCallsState(),a=e.participants.map((function(e){var n=e.uid,t=(0,i.__rest)(e,["uid"]);return(0,i.__assign)({externalId:n},t)})),o=a.map((function(e){var n=e.externalId;return(0,P.externalIdToString)(n)})),r=Ht(n,A,t,a);return m((function(e){return c>=e.length?e.concat(o):o})),r}))).finally((function(){S(!1)})),function(){return a.abort()}}),[f,e,c,I]),{participants:h.reduce((function(e,n){var t=_[n];if(t){var a=t.externalId.id,i=v[a];i&&i.name&&e.push(t)}return e}),e||!a?[]:[a]),isLoading:E}}function xa(e){var n,t,a=(0,i.__read)((n=k((function(e){return e})),t=(0,l.useMemo)((function(){if(n.externalId)return(0,i.__assign)((0,i.__assign)({},n.localDevice),{externalId:n.externalId})}),[n.localDevice,n.externalId]),(0,l.useMemo)((function(){var e=[[],[]],a=function(e,t){var a=n.participants[t.externalId.id];return a&&t.status?(e[0].push(t),a.name&&e[1].push(t),e):e};return t&&a(e,t),(0,Ve.objectReduce)(n.devices,a,e)}),[n.devices,n.participants,n.localDevice,n.externalId])),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){var n;return null===(n=Zn.GlobalStore.getCallsState().participants[e.externalId.id])||void 0===n?void 0:n.name}),[]),c=(0,l.useCallback)((function(e){return(0,P.externalIdToString)(e.externalId)}),[]),d=x(r,s,c);return{participants:e?d.search(e):o,isLoading:!1}}var ya,ba=t(58346);!function(e){e.Participants="participants",e.Friends="friends",e.Community="community"}(ya||(ya={}));var Oa,wa=t(88822),La=t(71831);function ka(e,n,t){return t&&t[e]||(0,P.isParticipantInCall)(n,e)}function Pa(e){var n=e.member,t=e.state,a=e.selectedMap,i=(null==n?void 0:n.peerId)||0;if((0,P.isParticipantInCall)(t,i))return!0;if(ka(i,t,a))return!1;if((0,O.isAuthedByGroupId)(t)){if((0,P.isParticipantUnavailableToCallFromGroup)(t,i))return!0}else if(!(null==n?void 0:n.canCall))return!0;return!(0,La.isUserPeer)(i)}!function(e){e.Friends="friends",e.CommunityMembers="groupMembers",e.Members="members"}(Oa||(Oa={}));var Ma=function(e){return e?(0,wa.escape)(e.replace(/\t/g,"\n")):""},Da=function(e){return e.name},ja=t(70720),Ra=function(e){var n=e.tokens,t=e.onRemoveToken,a=e.value,i=e.onChange,r=e.onSelect,s=e.renderSuggest,c=e.data,d=e.hideInputWithName,u=(0,l.useRef)((function(){})),_=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(ja.default,{className:"CallsMultiSelect",tokens:n,removeTokenPlaceholder:_("calls_remove_token"),onRemoveToken:t,placeholder:_("calls_search_participants_placeholder"),value:a,onChange:i,onSelect:r,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:u.current,notFoundText:_("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:s,data:c,hideInputWithName:d},void 0)};const Ba=(0,X.makeIcon)("Icon20CheckCircleOn","check_circle_on_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="check_circle_on_20"><path fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm5.35-12.72a.75.75 0 1 0-1.062-1.06l-5.955 5.968L5.81 9.66a.75.75 0 1 0-1.062 1.06l3.054 3.06a.75.75 0 0 0 1.062 0l6.486-6.5Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),Ua=(0,X.makeIcon)("Icon20CheckCircleOff","check_circle_off_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" viewBox="0 0 20 20" id="check_circle_off_20"><defs><path id="check_circle_off_20_a" fill="currentColor" fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm0-1a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" clip-rule="evenodd" /></defs><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);function Ha(e){var n=e.member,t=e.selected,a=void 0!==t&&t,r=e.disabled,l=void 0!==r&&r,c=(0,s.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":a,"ParticipantSuggest--disabled":l}),d=a?Ba:Ua;return(0,o.jsxs)("div",(0,i.__assign)({className:c,"data-id":n.id},{children:[(0,o.jsx)(Bn.default,{className:"ParticipantSuggest__entity",size:"34",title:n.name,photo:n.photo},void 0),(0,o.jsx)(d,{className:"ParticipantSuggest__checkIcon"},void 0)]}),void 0)}var Ga=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"},void 0)}),void 0)},Va=(0,l.memo)((function(e){var n=e.data,t=e.onClick,a=e.selected,r=e.disabled;if("type"in n)switch(n.type){case d.SearchResultType.HEADER:return(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--header",extra:n.count},{children:n.text}),void 0);case d.SearchResultType.CALL_ALL_IN_CHAT:return(0,o.jsx)("div",(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--select"},{children:(0,o.jsxs)(Un.default,(0,i.__assign)({appearance:"secondary",wide:!0,onClick:t},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"CallsSearchResult__icon"},{children:(0,o.jsx)(Ga,{},void 0)}),void 0),n.text]}),void 0)}),void 0);case d.SearchResultType.MEMBERS_MORE:case d.SearchResultType.FRIENDS_MORE:case d.SearchResultType.GROUP_MEMBERS_MORE:return(0,o.jsx)(Gn.ListMore,(0,i.__assign)({onClick:t},{children:n.text}),void 0)}return(0,o.jsx)(In.default,(0,i.__assign)({"data-id":n.peerId,onClick:t,selectable:!r},{children:(0,o.jsx)(Ha,{member:n,selected:a,disabled:r},void 0)}),void 0)})),Fa=function(e){var n=e.onChange,t=e.initMembers,a=e.selected,r=e.personCache,s=e.memberType,_=(0,l.useRef)(!1),v=(0,l.useRef)(),p=(0,c.useSelector)((function(e){return e})),f=u(),A=(0,ue.useLang)().getLang,g=(0,i.__read)((0,l.useState)(t),2),h=g[0],m=g[1],C=(0,i.__read)((0,l.useState)(""),2),E=C[0],S=C[1],T=(0,i.__read)((0,l.useState)(!1),2),N=T[0],x=T[1],y=(0,i.__read)((0,l.useState)(!1),2),b=y[0],O=y[1],w=(0,l.useMemo)((function(){return a.reduce((function(e,n){return e[n]=!0,e}),{})}),[a]),L=p.groupMembersCount>d.COUNT_OF_GROUP_MEMBERS_TO_LOAD,k=(0,l.useMemo)((function(){return new I(h,Da)}),[]),P=(0,l.useCallback)((function(e){if(e){var n=k.search(e);if(_.current){var t={};return n.forEach((function(e){t[e.id]=e})),Object.values(t)}return n}return function(e){var n=e.getLang,t=e.members,a=e.showMore,o=e.memberType,r={type:d.SearchResultType.MEMBERS_MORE,text:n("calls_show_all_members")},s={type:d.SearchResultType.FRIENDS_MORE,text:n("calls_show_all_friends")},l={type:d.SearchResultType.GROUP_MEMBERS_MORE,text:n("calls_show_all_group_members")},c=[];switch(o){case Oa.Members:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(var u=0;u<10;u++)c.push(t[u]);c.push(r)}break;case Oa.Friends:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(s)}break;case Oa.CommunityMembers:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(l)}}return c}({getLang:A,members:h,showMore:N,memberType:s})}),[h,k,A,N,s]),M=(0,i.__read)((0,l.useState)((function(){return P(E)})),2),D=M[0],j=M[1],R=(0,l.useCallback)((function(e){var t=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(a),!1),[+e],!1);n(t)}),[a,n]),B=(0,l.useCallback)((function(e){var t=a.filter((function(n){return n!==+e}));n(t)}),[a,n]);(0,l.useEffect)((function(){j(P(E))}),[N]),(0,l.useEffect)((function(){var e=E;return L&&(e.length>=3&&!b?v.current=setTimeout((function(){(function(e,n,t,a){return void 0===n&&(n=""),(0,sn.searchGroupMembers)(e,n).then((function(e){var n=e.items,o=[],r=[];return n&&n.forEach((function(e){e.deactivated||e.id in t.groupMembersCache||(o.push((0,Vn.normalizeUser)(e)),e.can_call_from_group||r.push(e.id))})),o.length>0&&a({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:t.groupMembersCount,groupMembers:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.groupMembers),!1),(0,i.__read)(o),!1),unableToCallGroupMembersIds:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.unableToCallGroupMembersIds),!1),(0,i.__read)(r),!1)}),o}))})(-p.groupId,e,p,f).then((function(n){var t,a;if(O(!1),n.length){_.current=!0;var o=(0,i.__spreadArray)([],(0,i.__read)(h),!1);try{for(var r=(0,i.__values)(n),s=r.next();!s.done;s=r.next()){var l=s.value;o.push(l),k.add(l)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}m(o),j(P(e))}}))}),1e3):v.current&&(O(!1),clearTimeout(v.current))),function(){v.current&&clearTimeout(v.current)}}),[E]);var U=(0,l.useCallback)((function(e){S(e.target.value),j(P(e.target.value))}),[P]),H=(0,l.useCallback)((function(e){return B(e),Promise.resolve()}),[B]),G=(0,l.useCallback)((function(e){return ka(e,p,w)?B(e):Pa({member:r.current.get(+e),state:p,selectedMap:w})||(R(e),S(""),j(P(""))),Promise.resolve()}),[p,w,P,R,B]),V=(0,l.useCallback)((function(e,n){return"type"in e?function(){return x(!0)}:n}),[]),F=(0,l.useCallback)((function(e,n){var t="peerId"in e?e.peerId:0;return(0,o.jsx)(Va,{data:e,onClick:V(e,n),selected:ka(t,p,w),disabled:Pa({member:r.current.get(+t),state:p,selectedMap:w})},t||"text"in e&&e.text||void 0)}),[w,p.groupId,p.participants,p.me,p.unableToCallGroupMembersIds]);return{query:E,found:D,onRemoveToken:H,onChangeHandler:U,onSelect:G,renderSuggest:F}},Wa=function(e){var n=e.tokens,t=e.onChange,a=e.selected,i=e.personCache,r=e.initMembers,s=e.memberType,l=Fa({selected:a,onChange:t,personCache:i,initMembers:r,memberType:s});return(0,o.jsx)(Ra,{tokens:n,onRemoveToken:l.onRemoveToken,value:l.query,onChange:l.onChangeHandler,onSelect:l.onSelect,renderSuggest:l.renderSuggest,data:l.found,hideInputWithName:!0},void 0)},za=function(e){var n=e.onChange,t=e.onChangeTab,a=e.tab,r=e.tabs,d=e.selected,u=(0,c.useSelector)((function(e){return e.friends})),_=(0,c.useSelector)((function(e){return e.chatMembers})),v=(0,c.useSelector)((function(e){return e.groupMembers})),p=function(){var e=(0,c.useSelector)((function(e){return e.groupMembers})),n=(0,c.useSelector)((function(e){return e.chatMembers})),t=(0,c.useSelector)((function(e){return e.friends})),a=(0,l.useRef)({}),i=(0,l.useRef)();i.current||(i.current=new Map);var o=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){e.forEach((function(e){i.current.set(e.id,e)}))}))};return a.current.chatMembers!==n&&(o(n),a.current.chatMembers=n),a.current.groupMembers!==e&&(o(e),a.current.groupMembers=e),a.current.friends!==t&&(o(t),a.current.friends=t),(0,l.useEffect)((function(){return function(){i.current.clear(),a.current={}}}),[]),{personCache:i}}().personCache,f=function(e){var n=e.selected,t=e.personCache,a=(0,c.useSelector)((function(e){return e})),o=(0,l.useMemo)((function(){var e,o,r,s,l=(0,P.getActiveDevices)(a).activeDevices,c=new Map;try{for(var d=(0,i.__values)(l),u=d.next();!u.done;u=d.next()){var _=u.value,v=a.participants[_.externalId.id];v&&c.set(v.peerId,{id:v.peerId.toString(),text:Ma(v.name),locked:!0})}}catch(n){e={error:n}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(e)throw e.error}}try{for(var p=(0,i.__values)(n),f=p.next();!f.done;f=p.next()){var A=f.value,g=a.participants[A]||t.current.get(A);c.set(A,{text:Ma(null==g?void 0:g.name),id:A.toString(),locked:!1})}}catch(e){r={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(r)throw r.error}}return(0,i.__spreadArray)([],(0,i.__read)(c.values()),!1)}),[n,a.participants,a.me,a.groupId,a.meGroup,a.adminPinnedParticipant,a.isOratorMode,a.oratorScrollFirstVisible,a.gridScrollFirstVisible,a.oratorScrollNumberOfVisible]);return o}({selected:d,personCache:p});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ba.ConfigProvider,(0,i.__assign)({platform:ba.Platform.VKCOM,scheme:"inherit"},{children:(0,o.jsx)(ba.Tabs,(0,i.__assign)({className:"AddParticipants__tabs"},{children:r.map((function(e){var n,r=e.id,l=e.label,c=e.counter;return(0,o.jsx)(ba.TabsItem,(0,i.__assign)({className:"AddParticipants__tabsItem",onClick:function(){return t(r)},selected:r===a,after:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("AddParticipants__count",(n={},n["AddParticipants__count--inactive"]=r!==a,n))},{children:c}),void 0)},{children:l}),r)}))}),void 0)}),void 0),a===ya.Participants&&(0,o.jsx)(Wa,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:_,memberType:Oa.Members},ya.Participants),a===ya.Friends&&(0,o.jsx)(Wa,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:u,memberType:Oa.Friends},ya.Friends),a===ya.Community&&(0,o.jsx)(Wa,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:v,memberType:Oa.CommunityMembers},ya.Community)]},void 0)};const Ka=(0,X.makeIcon)("Icon16Phone","phone_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="phone_16"><path d="m5.443 2.64.575.684c.796.943.713 2.365-.19 3.268l-.49.49a.475.475 0 0 0-.11.499c.179.487.634 1.096 1.364 1.827.732.731 1.34 1.185 1.827 1.364.174.064.369.02.5-.11l.489-.49c.903-.902 2.324-.985 3.269-.19l.683.574c.779.656.858 1.839.175 2.64-.372.431-.896.702-1.463.756-2.182.294-4.471-.758-6.868-3.155-2.398-2.398-3.45-4.688-3.156-6.87a2.213 2.213 0 0 1 .756-1.464c.802-.68 1.984-.602 2.64.178z" fill="currentColor" /></symbol>',16,16,!1,void 0);var Ya=function(e){var n=e.isAddSubmitDisabled,t=e.onAdd,a=e.onAddAll,r=e.tab,s=e.showCallAll,l=(0,ue.useLang)().getLang;return(0,o.jsxs)(o.Fragment,{children:[r===ya.Participants&&s&&(0,o.jsxs)(Un.default,(0,i.__assign)({className:"CallManagementModal__callAllButton",appearance:"secondary",onClick:a},{children:[(0,o.jsx)(Ka,{height:15,className:"CallManagementModal__callAllButton__icon"},void 0),(0,o.jsx)("div",{children:l("calls_call_all")},void 0)]}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({disabled:n,onClick:t},{children:l("calls_add")}),void 0)]},void 0)},Qa=function(e){var n=e.SDK,t=e.isWithBackButton,a=e.onBackClick,r=(0,c.useSelector)((function(e){return e})),s=(0,c.useSelector)((function(e){return e.me})),_=(0,c.useSelector)((function(e){return e.participants})),v=u(),p=(0,l.useContext)(E.LangContext).getLang,f=(0,i.__read)((0,l.useState)(r.preselectedIds||[]),2),A=f[0],g=f[1],h=(0,c.useSelector)((function(e){return e.chatMembers.length})),m=(0,c.useSelector)((function(e){return e.friendsCount||0})),C=(0,c.useSelector)((function(e){return e.groupMembersCount})),S=(0,c.useSelector)((function(e){return 0!==e.groupId})),T=(0,l.useMemo)((function(){return(0,P.getParticipantsInfo)({me:s,participants:_,excludeAnonymFromCount:!0})}),[_,s]),I=T.creatorPeerId,N=T.membersCount,x=(0,P.isParticipantGroup)(I),y=N+A.length,b=function(e){var n=e.friendsCount,t=e.membersCount,a=e.defaultTab,o=e.groupMembersCount,r=e.displayTabs,s=(0,ue.useLang)().getLang,c=(0,i.__read)((0,l.useState)(a||ya.Participants),2),d=c[0],u=c[1],_=function(e){switch(e){case ya.Participants:return{id:ya.Participants,label:s("calls_call_patricipants"),counter:t};case ya.Friends:return{id:ya.Friends,label:s("calls_call_friends"),counter:n};case ya.Community:return{id:ya.Community,label:s("calls_call_community_members"),counter:o}}},v=(0,l.useMemo)((function(){var e,n,t=[];try{for(var a=(0,i.__values)(r),o=a.next();!o.done;o=a.next()){var s=o.value;s&&t.push(_(s))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return t}),[s,t,n,d,o,r]);return{tab:d,tabs:v,onChangeTab:(0,l.useCallback)((function(e){u(e)}),[])}}({membersCount:N,friendsCount:m,groupMembersCount:C,displayTabs:(0,l.useMemo)((function(){return[!S&&!x&&ya.Participants,S?ya.Community:ya.Friends]}),[S]),defaultTab:S?ya.Community:x?ya.Friends:h>1?ya.Participants:ya.Friends}),L=b.onChangeTab,k=b.tab,M=b.tabs,D=function(){v({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),v({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},j=0===A.length,R=function(e){D(),v({type:d.E_ACTION.MANUAL_ADD_PARTICIPANTS,participants:e});var t=e.map((function(e){return new Promise((function(t){n.addParticipant(String(e)).then(t).catch((function(n){"auth.banned"===n.message?t(e):"vk-participant-is-rejected-error"===n.message?v({type:d.E_ACTION.ERROR,text:p("calls_error_cant_add_because_of_privacy")}):t(null)}))}))}));Promise.all(t).then((function(e){if((e=e.filter((function(e){return void 0!==e}))).length){var n=function(e,n){var t=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.friends),!1),(0,i.__read)(e.chatMembers),!1),(0,i.__read)(e.groupMembers),!1),a=[];return t.filter((function(e){var t=e.id;return!(!n.includes(t)||a.includes(t))&&(a.push(t),!0)}))}(r,e);v({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:{members:n}})}}));var a=(0,i.__read)((0,Ve.convertClientData)(function(e,n){var t=e.chatData||e.callData.conversation,a=n.reduce((function(n,t){return e.participants[t]||n.set(t,!0),n}),new Map);if(0===a.size)return[t,[]];var o=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,r=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,s=o.reduce((function(e,n){return a.get(n.id)&&(e.smallerListData.push(n),e.smallerListMap.set(n.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),l=s.smallerListData,c=s.smallerListMap;if(l.length===a.size)return[t,l];var d=r.filter((function(e){return!c.get(e.id)&&a.get(e.id)}));return[t,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(d),!1)]}(r,e)),2),o=a[0],s=a[1];v({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:s}),w.callStats.logEvent({call_event_type:d.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:r.callData.callId,peer_id:r.peer.toString(),is_group_call:(0,O.isGroupCallByPeer)(r.peer),group_call_users_count:A.length})};return(0,o.jsx)(Sn,(0,i.__assign)({title:p("calls_add_participants_to_call"),onCloseModal:D,actionButtons:(0,o.jsx)(Ya,{isAddSubmitDisabled:j,onAdd:function(){R(A)},onAddAll:function(){var e=function(e){var n=e.state,t=e.selectedMap,a=(0,P.getActiveDevices)(n).activeDevices.reduce((function(e,n){return e[n.externalId.id]=!0,e}),{});return n.chatMembers.reduce((function(e,i){var o=i.peerId;return a[o]||Pa({member:i,state:n,selectedMap:t})||e.push(o),e}),[])}({state:r});R(e)},tab:k,showCallAll:h>N},void 0),hint:k!==ya.Participants?Za(y,p):void 0,isWithBackButton:t,onBackClick:t?a:function(){}},{children:(0,o.jsx)(za,{onChange:g,tab:k,tabs:M,onChangeTab:L,selected:A},void 0)}),void 0)};function Za(e,n){if(e<2)return n("calls_management_add_warning")}var Ja=t(63035),Xa=function(e,n,t){var a=null,i=e;return e===d.EVideoEffectType.BLUR?(a=Ja.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED,i=d.VIRTUAL_BACKGROUND_BLUR_ID):"number"==typeof e&&(a=e>4e3?Ja.CallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DISABLED:Ja.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED),{prevSendValue:i,disabledActionType:a,effectDuration:Math.round((n-t)/1e3)}},qa=function(e){var n=oe();if(n){se();var t=ae(),a=Date.now(),i=e.callData.callId,o=e.peer,r=(0,O.isGroupCallByPeer)(o),s=Xa(t,a,n),l=s.disabledActionType,c=s.effectDuration,d=s.prevSendValue;null!==l&&w.callStats.logEvent({call_event_type:l,is_group_call:r,peer_id:o,session_id:i,background_duration:c,background_id:d})}};function $a(e,n,t,a){var i=n.callData.callId||"";t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),t({type:d.E_ACTION.SET_LAST_CALL_DATA,data:{isMeEndedCallForAll:!0}}),(0,sn.forceCallFinish)(i).catch((function(e){console.error(e),t({type:d.E_ACTION.ERROR,text:a("calls_error_force_call_finish"),handleType:d.ErrorHandleType.FATAL}),t({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})})).finally((function(){t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})),qa(n)}var ei=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#paint0_linear)"},void 0),(0,o.jsx)("path",{d:"M6.746 14.391c-.165-1.078-.204-1.206-.493-1.614-.363-.513-.415-1.1.38-1.255 2.042-.397 4.252-.1 6.265.268a5.546 5.546 0 002.204 0c2.013-.368 4.223-.665 6.264-.268.796.154.744.742.38 1.255-.288.408-.327.536-.492 1.614-.248 1.617-1.607 2.275-3.29 2.276-1.85 0-2.465-1.055-3.04-2.494-.557-1.398-1.29-1.398-1.849 0-.574 1.439-1.19 2.494-3.038 2.494-1.684 0-3.043-.66-3.29-2.276z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"paint0_linear",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},ni=function(e){var n=e.hint,t=e.className,a=e.children,r=(0,i.__rest)(e,["hint","className","children"]),s=!!n,l={"ListItem--withHint":s};return(0,o.jsxs)(In.default,(0,i.__assign)({},r,{className:(0,be.classNames)(l,t)},{children:[a,s&&(0,o.jsx)("div",(0,i.__assign)({className:"ListItem--hint"},{children:n}),void 0)]}),void 0)};const ti=(0,X.makeIcon)("Icon24DoorArrowLeftOutline","door_arrow_left_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="door_arrow_left_outline_24"><path d="M18.754 20.366c-.763.407-1.512.534-3.082.534H13a.9.9 0 1 1 0-1.8h2.672c1.487 0 1.87-.128 2.233-.322.336-.18.594-.438.773-.773.194-.362.322-.746.322-2.233V8.228c0-1.487-.128-1.871-.322-2.233a1.847 1.847 0 0 0-.773-.774c-.362-.193-.746-.321-2.233-.321H13a.9.9 0 1 1 0-1.8h2.672c1.57 0 2.32.127 3.082.534.65.347 1.164.863 1.512 1.512.407.762.534 1.512.534 3.082v7.544c0 1.57-.127 2.32-.534 3.082a3.647 3.647 0 0 1-1.512 1.512Z" /><path d="m9.364 15.364 2.463-2.464H3.9a.9.9 0 0 1 0-1.8h7.927L9.364 8.636a.9.9 0 1 1 1.272-1.272l4 4a.9.9 0 0 1 0 1.272l-4 4a.9.9 0 0 1-1.272-1.272Z" /></symbol>',24,24,!1,void 0);var ai,ii=function(e){var n=e.requireAuthToJoin,t=void 0!==n&&n,a=e.onRequireAuthToJoinChanged,r=e.isWaitingHallBlockShown,s=void 0!==r&&r,c=e.isWaitingHallEnabled,d=void 0!==c&&c,u=e.onWaitingHallEnabledChanged,_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(!t),2),p=v[0],f=v[1],A=(0,i.__read)((0,l.useState)(d),2),g=A[0],h=A[1],m=!1,C=(0,l.useCallback)((function(){if(!m){m=!0;var e=!p;f(e),a&&a(!e)}}),[t]),S=!1,T=(0,l.useCallback)((function(){if(!S){S=!0;var e=!g;h(e),u&&u(e)}}),[d]);return(0,o.jsxs)(Tn.default,{children:[s&&(0,o.jsx)(ni,(0,i.__assign)({onClick:T,canBeHovered:!1,icon:(0,o.jsx)(Nn.ListIcon,{icon:(0,o.jsx)(ti,{width:20,height:20},void 0),color:Nn.ListIconColors.BLUE},void 0),hint:_("calls_menu_waiting_hall_description"),selectable:!0,aside:(0,o.jsx)(F.default,{onChange:T,checked:g},void 0)},{children:_("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,onClick:C,selectable:!0,icon:(0,o.jsx)(ei,{},void 0),aside:(0,o.jsx)(F.default,{onChange:C,checked:p},void 0)},{children:_("calls_management_link_allow_anonymous")}),void 0)]},void 0)},oi=t(9670);!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS",e[e.WAITING_HALL=3]="WAITING_HALL"}(ai||(ai={}));var ri=function(e){var n,t,a=e.bridge,r=e.SDK,s=e.navigateToConvo,_=e.navigateToProfile,v=e.allowAddMembers,p=void 0!==v&&v,f=(0,c.useSelector)((function(e){return e})),A=u(),g=k((function(e){return e.callData.callUrlLink||""})),h=(0,l.useContext)(y.ConfigContext).allowWaitingHall,m=f.managementView||ai.MAIN,C=(0,i.__read)((0,l.useState)(m),2),S=C[0],T=C[1],I=(0,i.__read)((0,l.useState)(!1),2),N=I[0],x=I[1],b=(0,i.__read)((0,l.useState)(!1),2),w=b[0],L=b[1],M=(0,i.__read)((0,l.useState)(!1),2),D=M[0],j=M[1],R=(0,i.__read)((0,l.useState)(!1),2),B=R[0],U=R[1],H=(0,i.__read)((0,l.useState)(!1),2),G=H[0],V=H[1],F=p||!!(null===(n=f.callData.conversation)||void 0===n?void 0:n.canAddMembers),W=(null===(t=f.callData)||void 0===t?void 0:t.canFinishCall)||0!==f.groupId&&g,z=(0,l.useContext)(E.LangContext).getLang,K=(0,O.isRequireAuthToJoin)(f),Y=(0,O.isWaitingHallEnabled)(f),Q=(0,l.useCallback)((function(){A({type:d.E_ACTION.MANAGEMENT,isOpen:!1})}),[]),Z=(0,l.useCallback)((function(){T(ai.MAIN)}),[]),X=function(e){var n=f.callData.callId||"";return x(!0),ht(A,n,e,(0,O.isAuthedByGroupId)(f)?f.groupId:0).catch((function(e){console.error(e),A({type:d.E_ACTION.ERROR,text:z("calls_get_url_link_error_text")})})).finally((function(){x(!1)}))},q=(0,l.useCallback)((function(){T(ai.CALL_LINK),g||X(!1).catch((function(){T(ai.MAIN)}))}),[f.callData.callId,g]),$=(0,l.useCallback)((function(){A({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[ct(a,f,A)].concat((0,La.isChatPeer)(f.peer)?[dt(f,A,f.peer,f.callData.conversation)]:[]).concat(a.authorizedGroupId?[_t(a,f,A)]:[]);return Promise.all(e).then((function(){A({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),T(ai.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),A({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[f.peer,f.callData,f.friends,f.groupMembers]),ee=(0,l.useCallback)((function(){A({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[Kn(f,A)];return Promise.all(e).then((function(){A({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),T(ai.WAITING_HALL)})).catch((function(e){console.error(e),A({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[f.waitingHall]),ne=(0,l.useCallback)((function(){A({type:d.E_ACTION.TOGGLE_POPUP}),$a(0,f,A,z)}),[f.callData.callId,f.imHash]);(0,l.useEffect)((function(){m===ai.CALL_LINK&&q()}),[]),(0,l.useEffect)((function(){var e=(0,P.participantIsAdmin)(f.localDevice),n=e;j(e),U(n),V(h&&e)}),[f.localDevice,h]);var te=(0,l.useCallback)((function(e){!function(e){var n;(0,J.changeConversationOptions)(((n={})[J.ConversationOption.REQUIRE_AUTH_TO_JOIN]=e,n))}(e)}),[]),ae=(0,l.useCallback)((function(e){!function(e){var n;(0,J.changeConversationOptions)(((n={})[J.ConversationOption.WAITING_HALL]=e,n))}(e)}),[]),ie=(0,l.useCallback)((function(){return L(!0)}),[]),oe=(0,l.useCallback)((function(){return L(!1)}),[]),re=(0,l.useCallback)((function(){X(!0).catch((function(){T(ai.MAIN)}))}),[f.callData.callId,g]);return(0,o.jsxs)(o.Fragment,{children:[S===ai.MAIN&&(0,o.jsxs)(Sn,(0,i.__assign)({title:z("calls_management_participants"),actionButtons:(0,o.jsxs)(o.Fragment,{children:[W&&(0,o.jsx)(Un.default,(0,i.__assign)({onClick:ne,appearance:"secondary"},{children:z("calls_force_call_finish")}),"forceCallFinish"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:r.hangup},{children:z("calls_leave_call")}),"leave")]},void 0),onCloseModal:Q},{children:[(0,o.jsx)(bn,{isLinkBlockShown:F,linkBlockTitle:z("calls_menu_link"),onLinkBlockClick:q,callUrlLink:g},void 0),(0,o.jsx)(Ia,{SDK:r,bridge:a,onAddClick:$,onShowMoreWaitingHall:ee,navigateToProfile:_,navigateToConvo:s},void 0)]}),void 0),S===ai.CALL_LINK&&(0,o.jsxs)(Sn,(0,i.__assign)({title:z("calls_management_link"),hint:K?z("calls_management_link_anonymous_disallowed_hint"):"",onCloseModal:Q,isWithBackButton:m!==ai.CALL_LINK,onBackClick:Z,actionButtons:(B?[(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"tertiary",onClick:re},{children:z("calls_link_invalidate")}),"invalidate-link")]:[]).concat([(0,o.jsx)(oi.CopyText,(0,i.__assign)({text:g},{children:(0,o.jsx)(Un.default,(0,i.__assign)({className:"CallManagementModal__copyTextButton",disabled:N,onClick:ie},{children:z("calls_link_copy")}),void 0)}),"copy-link")])},{children:[(0,o.jsx)(Pn,{link:g,isLinkLoading:N,isCopied:w,hideCopiedText:oe},void 0),D&&(0,o.jsx)(ii,{onRequireAuthToJoinChanged:te,requireAuthToJoin:K,isWaitingHallBlockShown:G,onWaitingHallEnabledChanged:ae,isWaitingHallEnabled:Y},void 0)]}),void 0),S===ai.ADD_PARTICIPANTS&&(0,o.jsx)(Qa,{SDK:r,isWithBackButton:!0,onBackClick:Z},void 0),S===ai.WAITING_HALL&&(0,o.jsx)(Yn,{isModal:!0,isWithBackButton:!0,onBackClick:Z,navigateToProfile:_},void 0)]},void 0)};const si=(0,X.makeIcon)("Icon12CancelOutline","cancel_outline_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="cancel_outline_12"><path clip-rule="evenodd" d="M9.03 2.97a.75.75 0 0 1 0 1.06L7.06 6l1.97 1.97a.75.75 0 0 1-1.06 1.06L6 7.06 4.03 9.03a.75.75 0 0 1-1.06-1.06L4.94 6 2.97 4.03a.75.75 0 0 1 1.06-1.06L6 4.94l1.97-1.97a.75.75 0 0 1 1.06 0z" fill="currentColor" fill-rule="evenodd" /></symbol>',12,12,!1,void 0);var li=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("NotificationWithButton",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},ci=t(91750);const di=(0,ci.makeIcon)("Icon56LogoSferumColor","logo_sferum_color_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="logo_sferum_color_56"><path fill="#07F" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_a)" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_b)" d="M41.468 19.586c-.898-.897-2.067-1.436-3.412-1.643-.206-1.344-.745-2.513-1.642-3.411-6.042-6.043-15.84-6.043-21.882 0-6.043 6.042-6.043 15.84 0 21.882.898.898 2.067 1.436 3.411 1.643.207 1.345.745 2.514 1.643 3.411 6.042 6.043 15.84 6.043 21.882 0 6.043-6.042 6.043-15.84 0-21.882Z" /><path fill="url(#logo_sferum_color_56_c)" d="M24.12 24.12c4.51-4.511 9.98-6.785 13.937-6.177-.206-1.344-.745-2.514-1.642-3.411-3.539-3.539-11.306-1.51-17.348 4.534-6.043 6.042-8.073 13.81-4.534 17.348.898.898 2.067 1.436 3.411 1.643-.609-3.956 1.665-9.427 6.176-13.938Z" /><defs><radialGradient id="logo_sferum_color_56_a" cx="0" cy="0" r="1" gradientTransform="matrix(29.98957 -32.53844 17.18804 15.84163 27.683 27.922)" gradientUnits="userSpaceOnUse"><stop offset=".281" stop-color="#4BF9E8" /><stop offset=".319" stop-color="#41D8D3" /><stop offset=".384" stop-color="#32A4B2" /><stop offset=".451" stop-color="#247696" /><stop offset=".518" stop-color="#19517E" /><stop offset=".584" stop-color="#11356C" /><stop offset=".65" stop-color="#0B205F" /><stop offset=".716" stop-color="#071458" /><stop offset=".779" stop-color="#061055" /></radialGradient><radialGradient id="logo_sferum_color_56_c" cx="0" cy="0" r="1" gradientTransform="rotate(-128.972 23.696 8.511) scale(13.7017 20.209)" gradientUnits="userSpaceOnUse"><stop stop-color="#0B25CE" /><stop offset=".486" stop-color="#2C93DB" /><stop offset=".838" stop-color="#42DCE4" /><stop offset="1" stop-color="#4BF9E8" /></radialGradient><linearGradient id="logo_sferum_color_56_b" x1="16.716" x2="39.042" y1="37.874" y2="18.339" gradientUnits="userSpaceOnUse"><stop stop-color="#0000C9" /><stop offset=".128" stop-color="#2006C9" /><stop offset=".322" stop-color="#4A0EC8" /><stop offset=".511" stop-color="#6B14C8" /><stop offset=".691" stop-color="#8318C7" /><stop offset=".858" stop-color="#911BC7" /><stop offset="1" stop-color="#961CC7" /></linearGradient></defs></symbol>',56,56),ui=(0,ci.makeIcon)("Icon96LogoVkCallsColor","logo_vk_calls_color_96","0 0 96 96",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 96 96" id="logo_vk_calls_color_96"><path fill="#07F" d="M62.72 0C89.6 0 96 6.4 96 33.28v29.44C96 89.6 89.6 96 62.72 96H33.28C6.4 96 0 89.6 0 62.72V33.28C0 6.4 6.4 0 33.28 0h29.44Z" /><path fill="#77BEFF" d="M95.999 63.146c-.01 3.725-.146 7.051-.446 10.018a55.994 55.994 0 0 1-20.404 3.823c-10.73 0-20.756-3.01-29.281-8.232a2.563 2.563 0 0 0-2.38-.15c-5.3 2.357-11.26 3.594-17.93 4.13-1.841.148-3.08-1.8-2.29-3.471 2.633-5.574 4.358-10.617 5.41-15.635a2.41 2.41 0 0 0-.365-1.821c-5.877-8.875-9.3-19.516-9.3-30.957 0-7.198 1.355-14.08 3.823-20.404C25.916.135 29.382 0 33.28 0h29.44c26.77 0 33.227 6.348 33.279 32.952V63.146Z" /><path fill="#fff" d="M22.834.447a55.996 55.996 0 0 0-3.821 20.398c0 11.44 3.423 22.082 9.3 30.957a2.41 2.41 0 0 1 .365 1.821c-.758 3.618-1.866 7.25-3.413 11.083l-.004.01a77.91 77.91 0 0 1-.289.706 87.244 87.244 0 0 1-1.705 3.836c-.79 1.67.45 3.619 2.292 3.47a79.068 79.068 0 0 0 5.177-.584l.038-.006c4.605-.69 8.836-1.815 12.715-3.539.77-.342 1.66-.29 2.379.15 8.525 5.222 18.551 8.232 29.28 8.232 7.2 0 14.081-1.355 20.405-3.824-.356 3.523-.945 6.539-1.83 9.111A64.15 64.15 0 0 1 75.149 85c-11.245 0-21.833-2.9-31.036-7.995-5.64 2.12-11.655 3.215-17.913 3.718-8.562.687-13.358-8.176-10.183-14.892 2-4.232 3.376-8.019 4.303-11.659-5.918-9.717-9.326-21.135-9.326-33.327 0-6.448.953-12.683 2.729-18.565 2.572-.886 5.588-1.476 9.11-1.833Z" /><path fill="#fff" fill-rule="evenodd" d="M43.164 15.03c2.618-.308 4.793 1.844 6.05 4.356l1.408 2.817a6.894 6.894 0 0 1-2.664 9.022c-.501.296-.659.952-.333 1.44a56.82 56.82 0 0 0 7.084 8.626 56.826 56.826 0 0 0 8.626 7.084 1.017 1.017 0 0 0 1.44-.333 6.894 6.894 0 0 1 9.022-2.664l2.817 1.409c2.512 1.256 4.664 3.431 4.357 6.05-.165 1.403-.744 2.65-1.81 3.717-2.702 2.701-7.448 3.134-12.984 1.453-5.518-1.675-11.729-5.428-17.242-10.942-5.514-5.513-9.267-11.724-10.942-17.242-1.68-5.536-1.248-10.282 1.453-12.984 1.066-1.066 2.313-1.645 3.718-1.81Z" clip-rule="evenodd" /></symbol>',96,96);var _i=t(61108),vi=function(e,n,t){void 0===t&&(t=!1);var a=document.createElement("a");t&&(a.target="_blank"),a.download=n,a.href=e,document.body.appendChild(a),a.click(),a.remove()};function pi(e){if(e)return function(){switch(_i.Platform.OS){case _i.OS.MAC:case _i.OS.WINDOWS:return{url:d.SFERUM_APP_URL[_i.Platform.OS],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[_i.Platform.OS]};case _i.OS.LINUX:return{url:d.SFERUM_APP_URL[_i.Platform.OS].deb[_i.ARCH.X64],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[_i.Platform.OS].deb[_i.ARCH.X64]};default:return null}}();var n=null;return _i.Platform.OS===_i.OS.MAC?n={url:d.DESKTOP_CALLS_DOWNLOAD[_i.OS.MAC],filename:d.DESKTOP_CALLS_FILENAME[_i.OS.MAC]}:_i.Platform.OS===_i.OS.WINDOWS?n={url:d.DESKTOP_CALLS_DOWNLOAD[_i.OS.WINDOWS],filename:d.DESKTOP_CALLS_FILENAME[_i.OS.WINDOWS]}:_i.Platform.OS===_i.OS.LINUX&&(n={url:d.DESKTOP_CALLS_DOWNLOAD[_i.OS.LINUX].deb[_i.ARCH.X64],filename:d.DESKTOP_CALLS_FILENAME[_i.OS.LINUX].deb[_i.ARCH.X64]}),n}function fi(){s.localStorage.setItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED,"true")}var Ai=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"12",height:"13",viewBox:"0 0 12 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.21967 2.96967C4.51256 2.67678 4.98744 2.67678 5.28033 2.96967L8.28033 5.96967C8.57322 6.26256 8.57322 6.73744 8.28033 7.03033L5.28033 10.0303C4.98744 10.3232 4.51256 10.3232 4.21967 10.0303C3.92678 9.73744 3.92678 9.26256 4.21967 8.96967L6.68934 6.5L4.21967 4.03033C3.92678 3.73744 3.92678 3.26256 4.21967 2.96967Z",fill:"white",fillOpacity:"0.64"},void 0)}),void 0)},gi=function(e){var n=e.onClose,t=e.isSferum,a=(0,ue.useLang)().getLang,r=pi(t),s=_i.Platform.OS===_i.OS.MAC?"macOS":_i.Platform.OS===_i.OS.WINDOWS?"Windows":null,l=s?a("calls_notification_native_app_button_for").replace("{name}",s):a("calls_notification_native_app_button");return(0,o.jsxs)("div",(0,i.__assign)({className:"NotificationDesktopApp"},{children:[(0,o.jsx)(si,{className:"NotificationDesktopApp--close",onClick:n,width:16,height:16},void 0),!!t&&(0,o.jsx)(di,{className:"NotificationDesktopApp--icon"},void 0),!t&&(0,o.jsx)(ui,{className:"NotificationDesktopApp--icon",width:56,height:56},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"NotificationDesktopApp--text"},{children:a("calls_notification_native_app_text")}),void 0),null!==s&&(0,o.jsxs)(Un.default,(0,i.__assign)({onClick:function(){r&&vi(r.url,r.filename),n()},appearance:"overlay_primary",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Ai,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),null===s&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Ai,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0)]}),void 0)};const hi=(0,X.makeIcon)("Icon20ClockOutline","clock_outline_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="clock_outline_20"><g fill="currentColor"><path d="M10.25 6.5a.75.75 0 0 0-1.5 0v4a.75.75 0 0 0 .516.713l3.5 1.15a.75.75 0 1 0 .468-1.425l-2.984-.981z" /><path clip-rule="evenodd" d="M18.5 10a8.5 8.5 0 1 0-17 0 8.5 8.5 0 0 0 17 0zM3 10a7 7 0 1 1 14 0 7 7 0 0 1-14 0z" fill-rule="evenodd" /></g></symbol>',20,20,!1,void 0),mi=(0,X.makeIcon)("Icon20ChevronRight","chevron_right_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="chevron_right_20"><path fill-rule="evenodd" d="M7.293 4.293a1 1 0 0 1 1.414 0l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 0 1-1.414-1.414L11.586 10 7.293 5.707a1 1 0 0 1 0-1.414Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var Ci=function(e){var n=e.open,t=e.onClose,a=e.onExit,r=(0,ue.useLang)().getLang,s=(0,l.useRef)(null),c=(0,l.useRef)(null),d=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t){var e=function(){d.current&&clearTimeout(d.current)};return e(),d.current=setTimeout((function(){t(!0)}),1e4),e}}),[n,t]),(0,l.useEffect)((function(){var e;if(!n)return null===(e=s.current)||void 0===e||e.addEventListener("transitionend",t),c.current=setTimeout(t,600),i;function t(){i(),null==a||a()}function i(){var e;null===(e=s.current)||void 0===e||e.removeEventListener("transitionend",t),c.current&&clearTimeout(c.current)}}),[n,a]),(0,o.jsxs)("div",(0,i.__assign)({ref:s,onClick:function(){return null==t?void 0:t()},className:(0,ba.classNames)({CallsNotificationRecordEnded:!0,"CallsNotificationRecordEnded--closing":!n})},{children:[(0,o.jsx)(hi,{className:"CallsNotificationRecordEnded--clock",fill:"#529EF4"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc__title"},{children:r("calls_record_is_processed")}),void 0),(0,o.jsx)("div",{children:r("calls_open_record_list")},void 0)]}),void 0),(0,o.jsx)(mi,{className:"CallsNotificationRecordEnded--chevron",fill:"var(--steel_gray_200)"},void 0)]}),void 0)};const Ei=(0,X.makeIcon)("Icon24ErrorCircleOutline","error_circle_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="error_circle_outline_24"><path fill-rule="evenodd" d="M4.929 4.929A9.971 9.971 0 0 1 12 2a9.972 9.972 0 0 1 7.071 2.929A9.972 9.972 0 0 1 22 12a9.972 9.972 0 0 1-2.929 7.071A9.972 9.972 0 0 1 12 22a9.972 9.972 0 0 1-7.071-2.929A9.972 9.972 0 0 1 2 12a9.972 9.972 0 0 1 2.929-7.071ZM12 3.8a8.172 8.172 0 0 0-5.798 2.402A8.172 8.172 0 0 0 3.8 12a8.17 8.17 0 0 0 2.402 5.798A8.171 8.171 0 0 0 12 20.2a8.172 8.172 0 0 0 5.798-2.402A8.172 8.172 0 0 0 20.2 12a8.171 8.171 0 0 0-2.402-5.798A8.172 8.172 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var Si=function(e){var n=e.onClose,t=e.onClickJoin,a=(0,l.useContext)(E.LangContext).getLang,r=pi(),c=_i.Platform.OS===_i.OS.LINUX?"Linux":_i.Platform.OS===_i.OS.MAC?"macOS":_i.Platform.OS===_i.OS.WINDOWS?"Windows":null,u=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),_=u[0],v=u[1],p=c?a("calls_warning_native_app_button_for").replace("{name}",c):a("calls_warning_native_app_button"),f=null===c||_i.Platform.BROWSER===_i.BROWSER.FIREFOX;return(0,o.jsxs)("div",(0,i.__assign)({className:"WarningDesktopApp"},{children:[(0,o.jsx)(Ei,{fill:"#FF5C5C"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--title"},{children:a("calls_warning_native_app_title")}),void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--text"},{children:a("calls_warning_native_app_text")}),void 0),!_&&!f&&(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){r&&(vi(r.url,r.filename),fi(),v(!0))},appearance:"overlay_primary"},{children:p}),void 0),!_&&f&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"WarningDesktopApp--link",onClick:function(){fi(),v(!0)}},{children:[p," ",(0,o.jsx)(Ai,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),_&&(0,o.jsx)(Un.default,(0,i.__assign)({onClick:t,appearance:"overlay_primary"},{children:a("calls_warning_native_app_join_button")}),void 0),(0,o.jsx)(si,{className:"WarningDesktopApp--close",onClick:n,width:16,height:16},void 0)]}),void 0)};function Ti(e){return new Promise((function(n,t){if(_i.Platform.isMobile)t("is_mobile");else if(document.body.focus(),"hidden"===document.visibilityState||document.hidden)t("hidden_page");else{var a,i=function(){a&&clearTimeout(a),window.removeEventListener("blur",i),n(!0)};if(window.addEventListener("blur",i),a=setTimeout((function(){window.removeEventListener("blur",i),t("timed_out")}),3e3),_i.Platform.BROWSER===_i.BROWSER.SAFARI||_i.Platform.BROWSER===_i.BROWSER.FIREFOX){var o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o);var r=o.contentWindow;r?(r.location.href=e,setTimeout((function(){o.parentNode&&o.parentNode.removeChild(o)}),100)):window.location.href=e}else window.location.href=e}}))}var Ii=function(e){var n=e.joinLink,t=e.vkJoinLink,a=e.userId,i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?joinLink="+n+"&userId="+a;return 0!==a&&a||(i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?callId="+t+"&joinLink="+n),console.log("deeplink: ",i),i},Ni=navigator.userAgent.toLowerCase(),xi={version:(Ni.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test(Ni)&&/webkit|safari|khtml/i.test(Ni),edge:/(edge)\/(\d+)\.(\d+)/.test(Ni),chrome:/(chrome)\/(\d+)\.(\d+)/.test(Ni),firefox:/(firefox)\/(\d+)\.(\d+)/.test(Ni)};function yi(e){var n,t=null==e?void 0:e.find((function(e){return xi[e.browser]&&void 0===e.version})),a=null==e?void 0:e.find((function(e){return xi[e.browser]&&String(xi.version).startsWith(String(e.version))}));return null!==(n=null!=a?a:t)&&void 0!==n?n:null}function bi(){var e,n=((null===(e=/\.?(?<host>[^.]+\.[^.]+)$/.exec(window.location.host))||void 0===e?void 0:e.groups)||{}).host;return n&&/vk\.(com|ru)/.test(n)?n:"https://vk.com"}var Oi=function(){var e,n,t,a,r=(0,c.useSelector)((function(e){return e})),s=u(),_=(0,ue.useLang)(),v=_.getLang,p=_.langNumeric,f=r.config.desktopAppNotification,A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],h=A[1];(0,l.useEffect)((function(){r.shouldShowRecordEndedDesktopAppNotification&&h(!0)}),[r.shouldShowRecordEndedDesktopAppNotification]);var m=(0,l.useMemo)((function(){return yi(r.config.browserWarnings)}),[r.config.browserWarnings]),C=(0,l.useCallback)((function(e){var n,t=null===(n=r.waitingHall)||void 0===n?void 0:n.members.get(e);t&&s({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(e=r.waitingHall)||void 0===e?void 0:e.members,r.participants]),E=(0,l.useCallback)((function(){var e=[Kn(r,s)];return Promise.all(e).then((function(){s({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:ai.WAITING_HALL})}))}),[r.waitingHall]),S=(0,l.useCallback)((function(e){r.waitingHall&&Fn(e,r.waitingHall,s)}),[null===(n=r.waitingHall)||void 0===n?void 0:n.members]),T=(0,l.useCallback)((function(){!function(e,n){e&&(e.hasNew=!1,n({type:d.E_ACTION.SET_WAITING_HALL,data:e}))}(r.waitingHall,s)}),[null===(t=r.waitingHall)||void 0===t?void 0:t.hasNew]);if(r.waitingHall&&0!==r.waitingHall.members.size&&r.waitingHall.hasNew){var I=Array.from(r.waitingHall.members.values()),N=v("calls_notification_users_in_waiting_hall_notification",r.waitingHall.totalCount).replace("{names}",(0,Ve.getParticipantsListLabel)(I,I.slice(0,3),(function(e){return e.shortName||e.name}),v,p,r.waitingHall.totalCount)),x=null;if(1===I.length){var y=I[0];x=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return S(y.peerId)},appearance:"overlay_primary"},{children:v("calls_waiting_hall_join")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return C(y.peerId)},appearance:"overlay_secondary"},{children:v("calls_waiting_hall_forbid")}),void 0)]},void 0)}else x=(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return E()},appearance:"overlay_primary"},{children:v("calls_waiting_show_participants")}),void 0);return(0,o.jsx)(li,{children:(0,o.jsxs)("div",{children:[(0,o.jsx)(si,{className:"NotificationWithButton--close",onClick:T},void 0),(0,o.jsx)("span",{children:N},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"NotificationWithButton--buttons"},{children:x}),void 0)]},void 0)},void 0)}if(r.shouldShowRecordEndedDesktopAppNotification&&dn(r))return(0,o.jsx)(Ci,{open:g,onClose:function(e){var n,t;!e&&r.translation.ownerId&&window.open&&window.open((n=r.translation.ownerId,t=bi(),(0,P.isParticipantGroup)(n)?t+"/video/playlist/"+n+"_-8":t+function(e){return"/video/@"+e+"/recorded_calls"}(n)),"_blank"),h(!1)},onExit:function(){s({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION})}},void 0);if(m&&r.shouldShowWarningDesktopAppNotification&&(0,O.isGroupCallByPeer)(r.peer)&&(null===(a=r.join)||void 0===a?void 0:a.joinLink)){return(0,o.jsx)(Si,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION,data:!1}),s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},onClickJoin:function(){var e,n,t,a;if(null===(e=r.join)||void 0===e?void 0:e.joinLink)return Ti(Ii({joinLink:null===(n=r.join)||void 0===n?void 0:n.joinLink,vkJoinLink:null===(t=r.join)||void 0===t?void 0:t.vkJoinLink,userId:null===(a=window.vk)||void 0===a?void 0:a.id}))}},void 0)}if(f&&r.shouldShowDesktopAppNotification){return(0,o.jsx)(gi,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},isSferum:!!r.config.sferum},void 0)}return null},wi=!1,Li=!0;function ki(e){Li=e}function Pi(e,n,t){if(void 0===t&&(t=!0),Li)if(e){var a=!(!n||!n.isAudioEnabled);t&&(wi=a),a&&(0,J.toggleLocalAudio)(!1)}else wi&&(0,J.toggleLocalAudio)(!0);else ki(!0)}var Mi,Di=!1;function ji(e,n,t,a){var i=e.keyCode,o=e.type,r=e.repeat,s="keydown"===o;if(32===i){if(e&&e.target){if(["FCComposer__input","FCSearch__input","fc_editable","fc_clist_filter_text"].some((function(n){return e.target.classList.contains(n)})))return}if(e.preventDefault(),r)return;if(Di)return clearTimeout(Mi),void(Di=!1);Di=!0,Mi=setTimeout((function(){(function(e,n,t,a){var i=function(){var n,i,o=(null===(n=a.notification)||void 0===n?void 0:n.type)===d.NotificationType.PUSH_TO_TALK,r=!1;if(e&&!o?r=!0:e&&o?r=(null===(i=a.notification)||void 0===i?void 0:i.data)!==(0,O.isIAmSpeaking)(a):!e&&o&&(r=!0),r){var s=null;e&&(s={type:d.NotificationType.PUSH_TO_TALK,timer:0,data:(0,O.isIAmSpeaking)(a)}),t({type:d.E_ACTION.CALL_NOTIFICATION,notification:s})}};return e&&n||!e&&!n?Promise.resolve().then(i):(0,J.toggleLocalAudio)(e).then(i)})(s,n,t,a).then((function(){Di=!1}))}),s?200:100)}}const Ri=(0,X.makeIcon)("Icon16MicrophoneSlash","microphone_slash_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="microphone_slash_16"><path d="M5.498 7.06v.44a2.501 2.501 0 0 0 2.909 2.467l1.2 1.198a4.005 4.005 0 0 1-5.521-2.822.75.75 0 0 0-1.47.314A5.508 5.508 0 0 0 7.25 12.95v1.301a.75.75 0 0 0 1.502 0v-1.3a5.473 5.473 0 0 0 1.972-.669l1.25 1.25a.751.751 0 0 0 1.062-1.061L3.88 3.32a.75.75 0 1 0-1.06 1.06l2.678 2.68Zm6.356 1.529c-.089.314-.03.66.2.89.37.37.993.284 1.16-.211a5.44 5.44 0 0 0 .17-.61.75.75 0 1 0-1.469-.315 3.945 3.945 0 0 1-.061.246ZM6.303 2.662c-.332.307-.254.818.066 1.138l3.428 3.424a.4.4 0 0 0 .683-.279l.022-2.445a2.501 2.501 0 0 0-4.199-1.838Z" /></symbol>',16,16,!1,void 0),Bi=(0,X.makeIcon)("Icon16PinDot","pin_dot_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="pin_dot_16"><path d="M6.25 4a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5Z" /><path d="m13.892 5.77-3.657-3.664c-.231-.232-.634-.057-.634.263v.526a.896.896 0 0 1-.263.634L7.623 5.244a.895.895 0 0 1-.633.262H3.995c-.565 0-.847.71-.455 1.102l2.29 2.29-3.569 3.574a.894.894 0 0 0 1.263 1.264l3.57-3.572 2.301 2.301c.402.402 1.101.098 1.101-.456V9.013a.9.9 0 0 1 .262-.633l1.715-1.715a.895.895 0 0 1 .633-.263h.523c.327 0 .488-.407.263-.633Z" /></symbol>',16,16,!1,void 0),Ui=(0,X.makeIcon)("Icon16Pin","pin_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="pin_16"><path d="m10.235 2.106 3.657 3.663c.225.226.064.633-.263.633h-.523a.895.895 0 0 0-.633.263L10.758 8.38a.896.896 0 0 0-.262.633v2.996c0 .554-.7.858-1.1.456l-2.301-2.3-3.57 3.57a.893.893 0 1 1-1.264-1.263L5.83 8.898l-2.29-2.29c-.391-.392-.109-1.102.456-1.102H6.99a.895.895 0 0 0 .633-.262L9.338 3.53a.896.896 0 0 0 .263-.634V2.37c0-.32.403-.495.634-.263z" fill="currentColor" /></symbol>',16,16,!1,void 0);var Hi=(0,l.memo)((function(e){var n,t,a,r,s,c=e.orator,d=e.me,u=e.isPinned,_=e.isPinnedByAdmin,v=e.isPinnedByShareScreen,p=e.isUnpinAllowed,f=e.onTooltipChange,A=e.onUnpin,g=e.tooltips,h=e.oratorDevice,m=(0,l.useContext)(E.LangContext).getLang,C=_||v||u,S=(0,l.useCallback)((function(){f("oratorPin",!1),A()}),[A]),T=(0,l.useCallback)((function(){return f("oratorPin",!0)}),[]),I=(0,l.useCallback)((function(){return f("oratorPin",!1)}),[]),N=(h.wasConnected||c.peerId===d)&&!(null===(n=h.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),x=null===(t=h.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled,y=c.shortName||c.name,b=c.shortNameGen||c.shortName||c.name,O=((null===(a=h.mediaSettings)||void 0===a?void 0:a.isAudioEnabled)||(null===(r=h.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||(null===(s=h.mediaSettings)||void 0===s?void 0:s.isVideoEnabled))&&(h.networkStatus||1)<.6,w=(0,o.jsxs)(o.Fragment,{children:[O&&(0,o.jsx)(q,{fill:(h.networkStatus||1)<=.3?"#ff5c5c":"#FECE00"},void 0),x&&(0,o.jsx)("span",(0,i.__assign)({className:"OratorTitle__additionInfo"},{children:m("calls_orator_screen_sharing")}),void 0),x?b:y,N&&(0,o.jsx)(Ri,{},void 0),_&&(0,o.jsx)(Bi,{},void 0),!_&&(v||u)&&(0,o.jsx)(Ui,{},void 0)]},void 0);return C?(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({position:"b",align:"center",content:m(_&&p?"calls_hint_admin_pin_for_admin":_?"calls_hint_admin_pin_for_user":"calls_hint_user_pin"),open:g.oratorPin,delay:300,onOpen:T,onClose:I},{children:(0,o.jsx)("button",(0,i.__assign)({className:"OratorTitle OratorTitle--button",onClick:S,disabled:!p},{children:w}),void 0)}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:"OratorTitle"},{children:w}),void 0)})),Gi=(0,l.memo)((function(e){var n=e.externalId,t=e.isInfoShown,a=e.isPinned,r=e.isPinnedByAdmin,c=e.isHandRaised,d=void 0!==c&&c,u=e.photo,_=e.hasAudio,v=e.isMe,p=void 0!==v&&v,f=e.name,h=e.letter,m=e.wasConnected,C=void 0===m||m,E=e.onClickParticipant,S=e.onDblClickParticipant,T=(0,l.useContext)(y.ConfigContext).anonymPhoto,I=(0,l.useRef)(null),N=(0,P.isParticipantAnonym)(n),x=(0,s.classNames)("Participant","Participant--withAnimation",{"Participant--isPinned":a}),b=(0,P.externalIdToString)(n),O=(0,l.useCallback)((function(e){E&&E(e,n)}),[E,n]),w=(0,l.useCallback)((function(e){S&&S(e,n)}),[S,n]);return(0,o.jsxs)("article",(0,i.__assign)({ref:I,className:x,onClick:O,onDoubleClick:w,"participant-id":b},{children:[(0,o.jsx)(A,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(g.CallPhoto,{id:+n.id,photo:!T&&N?"":u,alt:f||"",letter:h,className:t?"Participant__offsetCard":""},void 0)}),void 0),d&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(U,{className:"Participant__handIcon"},void 0)}),void 0),t&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:f}),void 0),(C||p)&&!_&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0),!r&&a&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)("div",{className:"Participant__pin"},void 0)}),void 0),r&&(0,o.jsx)("header",(0,i.__assign)({className:"Participant__header"},{children:(0,o.jsx)(Y,{className:"Participant__icon"},void 0)}),void 0)]}),void 0)})),Vi=t(37441);function Fi(e){var n,t,a,r,_,v,p,f,A,h,m,C=e.SDK,S=e.navigateToConvo,T=e.navigateToProfile,I=e.onHandCountChanged,N=e.isVirtualBackgroundSupported,x=(0,c.useSelector)((function(e){return e})),L=u(),k=(0,l.useContext)(E.LangContext).getLang,D=(0,l.useContext)(y.ConfigContext),j=D.isModalView,R=D.debugLog,B=D.enableScreenTrack,U=D.enableProducerScreenTrack,H=D.allowPushToTalk,G=x.peer,V=(0,l.useMemo)((function(){var e,n,t;return(0,O.isGroupCallByPeer)(G)||!!(null===(e=x.localDevice.mediaSettings)||void 0===e?void 0:e.isScreenSharingEnabled)||!!(null===(t=null===(n=(0,P.getPeerIdDeviceInfo)(G,x.devices))||void 0===n?void 0:n.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled)}),[G,x.localDevice,x.devices]),F=V?x.callData.conversation:x.participants[G],W=x.localDevice,z=W.mediaSettings,K=W.permissions,Y=M(),Q=Y>1,Z=(0,P.isCallHaveOtherParticipants)(),X=Q||(0,P.isParticipantWithVideo)(W),q=(0,l.useMemo)((function(){var e;if(!V||!(0,P.participantIsAdmin)(W))return!1;if(x.externalId&&!!(null===(e=x.maps.vkIdToDevices.get(+x.externalId.id))||void 0===e?void 0:e.size))return!1;var n=(0,P.getNonAnonymousConnectParticipantsCount)(),t=n.admins;return!!n.users&&!t}),[V,W.roles,x.externalId,x.participants,x.devices,x.me]),$=V||Y>2,ee=$&&X&&!x.isOratorMode,ne=$&&X&&x.isOratorMode,te=null!==x.adminPinnedParticipant,ae=!te&&null!==x.pinnedParticipant,ie=!ae&&null!==x.screenSharingPinnedParticipant,oe=x.uiMode===d.UIMode.FULLSCREEN,re=(0,l.useMemo)((function(){return C.browser.isScreenCapturingSupported()}),[]),se=(null===(n=x.callData)||void 0===n?void 0:n.canFinishCall)||V&&0===G&&(0,P.isCreator)(W),le=!!x.translation.deferredId&&!x.translation.isOn,ce=(0,i.__read)((0,l.useState)(!1),2),ue=ce[0],ve=ce[1],pe=(0,i.__read)((0,l.useState)(!1),2),fe=pe[0],Ae=pe[1],ge=(0,i.__read)((0,l.useState)(0),2),he=ge[0],me=ge[1],Ce=Mt(x),Ee=(0,l.useMemo)((function(){return Ce?function(e){var n,t,a,o=null!==(t=null===(n=e.participantsChunk)||void 0===n?void 0:n.ids.reduce((function(n,t){var a=(0,P.externalIdToString)(t),i=ea(e,a);return i&&n.push(i),n}),[]))&&void 0!==t?t:Bt;return 0===(null===(a=e.participantsChunk)||void 0===a?void 0:a.countBefore)&&e.externalId&&o.unshift((0,i.__assign)((0,i.__assign)({},e.localDevice),{externalId:e.externalId})),{activeDevices:Bt=(0,Ve.shallowEqual)(Bt,o)?Bt:o}}(x):(0,P.getActiveDevices)(x)}),[x.devices,x.participantsChunk,x.adminPinnedParticipant,x.gridScrollFirstVisible,x.oratorScrollFirstVisible,x.isOratorMode,x.localDevice,x.oratorScrollNumberOfVisible,x.externalId,Ce]),Se=(0,i.__read)(function(e){if(e.participantsChunk){var n=Vt(e.participantsChunk);return[n,n+e.participantsChunk.ids.length]}var t=e.isOratorMode,a=t?e.oratorScrollNumberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE,i=t?P.PARTICIPANTS_LIST_BUFFER_SIZE.ORATOR:P.PARTICIPANTS_LIST_BUFFER_SIZE.GRID,o=t?e.oratorScrollFirstVisible:e.gridScrollFirstVisible;return[o<i?0:o-i,o+a+i]}(x),2),Te=Se[0],Ie=Se[1],Ne=(0,l.useMemo)((function(){var e=Ee.activeDevices;return Ce?e:e.slice(Te,Ie)}),[Ee.activeDevices,Ce,Te,Ie]),xe=(null===(t=x.callData.conversation)||void 0===t?void 0:t.canAddMembers)&&!(0,P.isParticipantAnonym)(x.me),ye=(0,l.useCallback)((function(e,n){var t=(0,P.isSameExternalId)(x.pinnedParticipant,n)?null:n;(0,P.isSameExternalId)(x.screenSharingPinnedParticipant,n)&&(t=null),x.screenSharingPinnedParticipant&&L({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),L({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:t})}),[x.pinnedParticipant,x.screenSharingPinnedParticipant]),be=(0,l.useCallback)((function(e,n){x.isOratorMode||L({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),(0,P.isSameExternalId)(x.pinnedParticipant,n)||L({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:n})}),[x.isOratorMode,x.pinnedParticipant]),Oe=(0,l.useMemo)((function(){return Ne.map((function(e){var n,t,a,i,r,s,l,c,d,u,_=e.mediaSettings,v=_.isAudioEnabled,p=_.isScreenSharingEnabled,f=(0,P.isSameExternalId)(e.externalId,x.externalId),A=x.participants[e.externalId.id],g=f?k("calls_own_label"):(null==A?void 0:A.shortName)?null==A?void 0:A.shortName:null==A?void 0:A.name,h=(0,P.externalIdToString)(e.externalId);if(!e.visible)return(0,o.jsx)(Gi,{externalId:e.externalId,isInfoShown:!0,isMe:f,isHandRaised:e.wasConnected&&(null===(t=null===(n=e.statusData)||void 0===n?void 0:n.hand)||void 0===t?void 0:t.state),hasAudio:!!v,photo:null==A?void 0:A.photo,name:g,letter:null!==(i=null===(a=null==A?void 0:A.name)||void 0===a?void 0:a[0])&&void 0!==i?i:"",wasConnected:e.wasConnected,onClickParticipant:ye,isPinned:x.isOratorMode&&(0,P.isSameExternalId)(x.pinnedParticipant,e.externalId)||(0,P.isSameExternalId)(x.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:x.isOratorMode&&(0,P.isSameExternalId)(x.adminPinnedParticipant,e.externalId)},h);var m=x.isOratorMode&&(B||U),E=(0,P.getStream)(e,m&&(null===(r=e.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)),I=!(m&&(null===(s=e.mediaSettings)||void 0===s?void 0:s.isVideoEnabled)||!p),N=(0,P.isParticipantWithVideo)(e),y=x.localDevice.status===J.ParticipantStatus.CONNECTED?e.status:J.ParticipantStatus.CONNECTED,b=A&&(0,P.getParticipantActions)({state:x,SDK:C,dispatch:L,participant:A,addProfileLink:!0,getLang:k,navigateToConvo:S,navigateToProfile:T,separatedList:!1,device:e});return(0,o.jsx)(de,{externalId:e.externalId,isVisible:e.visible,isInfoShown:!0,isMe:f,isHandRaised:null===(c=null===(l=e.statusData)||void 0===l?void 0:l.hand)||void 0===c?void 0:c.state,hasVideo:!!N,hasAudio:!!v,isSharingScreen:!!I,stream:E,photo:null==A?void 0:A.photo,name:g,letter:null!==(u=null===(d=null==A?void 0:A.name)||void 0===d?void 0:d[0])&&void 0!==u?u:"",status:y,allowContain:!1,wasConnected:e.wasConnected,networkStatus:e.networkStatus,onClickParticipant:x.isOratorMode?ye:void 0,onDblClickParticipant:x.isOratorMode?void 0:be,actions:b,isPinned:x.isOratorMode&&(0,P.isSameExternalId)(x.pinnedParticipant,e.externalId)||(0,P.isSameExternalId)(x.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:x.isOratorMode&&(0,P.isSameExternalId)(x.adminPinnedParticipant,e.externalId)},h)}))}),[Ne,x.externalId,x.participants,x.isOratorMode,x.pinnedParticipant,x.screenSharingPinnedParticipant,x.adminPinnedParticipant,x.groupId,x.me,x.peer,x.config,x.localDevice,x.callData]),we=function(e){L({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},Le=function(){Be(C,[J.MediaOption.AUDIO,J.MediaOption.VIDEO]).then((function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_SETTINGS})}))},ke=function(e){L(e?{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_RECORD}:{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION})},Me=(0,l.useCallback)((function(){zi({isModalView:j,uiMode:x.uiMode,changeUIMode:we})}),[x.uiMode]);(0,Vi.useNavGoListener)(Me,!x.config.enableNavChangeCallCollapse),(0,Vi.useBoxLayerObserver)(Me,!x.config.enableNavChangeCallCollapse);var Ue=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!x.isOratorMode})}),[x.isOratorMode]),He=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!x.isShownParticipantsAside})}),[x.isShownParticipantsAside]),Ge=(0,l.useCallback)((function(){L({type:d.E_ACTION.MANAGEMENT,isOpen:!0})}),[]),Fe=(0,l.useCallback)((function(){L({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:ai.CALL_LINK})}),[]),We=(0,l.useCallback)((function(){if(!fe){var e=!z.isVideoEnabled||!!z.isScreenSharingEnabled&&!B;(e?Be(C,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){Ae(!0),B||z.isScreenSharingEnabled&&C.captureScreen(!1),C.toggleLocalVideo(e).catch((function(){})).finally((function(){Ae(!1)}))})),w.callStats.logEvent({call_event_type:e?d.CallActionEventType.VIDEO_ENABLED:d.CallActionEventType.VIDEO_DISABLED,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer),reason:e?void 0:"manual"})}}),[z,fe]),ze=(0,l.useCallback)((function(){C.captureScreen(!z.isScreenSharingEnabled).catch((function(){"MacOS"===C.browser.os()&&"Chrome"===C.browser.browserName()?L({type:d.E_ACTION.ERROR,text:k("calls_error_disabled_screen_sharing_macos_chrome")}):L({type:d.E_ACTION.ERROR,text:k("calls_error_disabled_screen_sharing")})})),w.callStats.logEvent({call_event_type:z.isScreenSharingEnabled?d.CallActionEventType.SCREEN_SHARING_STOPPED:d.CallActionEventType.SCREEN_SHARING_STARTED,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})}),[z.isScreenSharingEnabled,x.screenSharers,x.callData.callId,x.peer]),Ye=(0,l.useCallback)((function(){S(x.peer)===Vi.ENavigateToConvoDirection.Messenger&&Me()}),[x.peer,x.uiMode]),Ze=(0,l.useCallback)((function(){if(!ue){var e=!z.isAudioEnabled;(e?Be(C,[J.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;ve(!0),(null===(n=x.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&L({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),C.toggleLocalAudio(e).catch((function(){})).finally((function(){ve(!1)}))}))}}),[z,ue]),Je=(0,l.useCallback)((function(){var e,n,t,a,o=!(null===(n=null===(e=W.statusData)||void 0===e?void 0:e.hand)||void 0===n?void 0:n.state);C.changeParticipantState({hand:o?d.SdkHandType.RAISED:d.SdkHandType.LOWERED}),L({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,i.__assign)((0,i.__assign)({},W.statusData),{hand:{state:!(null===(a=null===(t=W.statusData)||void 0===t?void 0:t.hand)||void 0===a?void 0:a.state),ts:Date.now()}})}}),w.callStats.logEvent({call_event_type:o?d.CallActionEventType.HAND_RAISED:d.CallActionEventType.HAND_LOWERED,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})}),[null===(r=null===(a=W.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state]),Xe=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_EXIT})}),[]),qe=(0,l.useCallback)((function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSFER_ADMIN_RIGHTS})}),[]),$e=(0,l.useCallback)((function(){C.hangup(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer),reason:"none",group_call_users_count:Y})}),[x.callData.callId,x.peer,Y]),en=(0,l.useCallback)((function(){L({type:d.E_ACTION.CHANGE_UI_MODE,mode:oe?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),L({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[x.uiMode]),nn=(0,l.useCallback)((function(e,n){var t;L({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),tn=(0,l.useCallback)((function(){L({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){le&&nn("streaming",!0)}),[le]);(0,l.useEffect)((function(){x.isOratorMode||function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===t?void 0:t.offsetWidth)||1/0,i=6*Math.floor(e/a),o=Ee.activeDevices,r=0;r<o.length;r++){var s=n+r,l=s>=i&&s<i+30;o[r].visible!==l&&((0,P.isSameExternalId)(x.externalId,o[r].externalId)?L({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:l}}):ot(L,o[r].externalId,{visible:l}))}}(x.gridScrollPosition,Vt(x.participantsChunk))}),[x.isOratorMode,x.uiMode,x.gridScrollPosition,Ee.activeDevices,null===(_=x.participantsChunk)||void 0===_?void 0:_.countBefore]),(0,l.useEffect)((function(){x.isOratorMode&&function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===t?void 0:t.offsetHeight)||0,i=Math.max(0,Math.floor(e/148)-1),o=Math.min(x.config.videoSlotsCount,Math.floor(a/148+3)),r=Ee.activeDevices,s=0;s<r.length;s++){var l=n+s,c=l>=i&&l<i+o;r[s].visible!==c&&((0,P.isSameExternalId)(x.externalId,r[s].externalId)?L({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:c}}):ot(L,r[s].externalId,{visible:c}))}}(x.oratorScrollPosition,Vt(x.participantsChunk))}),[x.externalId,x.config.videoSlotsCount,x.isOratorMode,x.uiMode,x.oratorScrollPosition,Ee.activeDevices,null===(v=x.participantsChunk)||void 0===v?void 0:v.countBefore]);var an=(0,l.useCallback)((0,s.debounce)((function(e){var n,t=(null===(n=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===n?void 0:n.offsetWidth)||1/0,a=6*Math.floor(e/t);St(x,L,{type:d.E_ACTION.SET_GRID_SCROLL_POSITION,position:e,firstVisible:a,numberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE},C)}),200),[]),on=(0,l.useCallback)((0,s.throttle)((function(e){var n,t=document.querySelectorAll('[data-calls-id="participant"]')[0],a=t?t.offsetWidth+8:1/0,i=(null===(n=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===n?void 0:n.offsetHeight)||0,o=Math.floor(e/a)-1,r=Math.min(x.config.videoSlotsCount,i/a+3);St(x,L,{type:d.E_ACTION.SET_ORATOR_SCROLL_POSITION,position:e,firstVisible:o,numberOfVisible:r},C)}),100),[x.config]),rn=(0,l.useMemo)((function(){var e,n,t=[{text:k("calls_call_menu_settings"),key:"settings",onClick:Le,disabled:!1}];if(x.config.streaming&&!(0,P.isParticipantAnonym)(x.me)&&(t.push({text:k("calls_call_menu_translation"),key:"translation",onClick:function(){return ke(!1)},disabled:!!(null===(e=x.translation)||void 0===e?void 0:e.isOn)&&(!!x.translation.isRecord||ln(x))}),x.config.enableTranslationSplit)){var a=!(!(null===(n=x.translation)||void 0===n?void 0:n.isOn)||!x.translation.isRecord),i=function(){var e;return a?!cn(x):!!(null===(e=x.translation)||void 0===e?void 0:e.isOn)}(),o=function(){var e;return(null===(e=x.translation)||void 0===e?void 0:e.isOn)?function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}:function(){return ke(!0)}}();t.push({text:a&&cn(x)?k("calls_record_stop_confirmation"):k("calls_call_menu_recording"),key:"recording",onClick:o,disabled:i})}(0,P.canMuteParticipants)(W)&&V&&(t.push({text:k("calls_call_menu_mute_audio_all"),key:"muteAllAudio",onClick:function(){L({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_AUDIO}})}}),t.push({text:k("calls_call_menu_mute_video_all"),key:"muteAllVideo",onClick:function(){L({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_VIDEO}})}})),(0,P.canMuteParticipants)(W)&&V&&Z&&t.push({text:k("calls_call_menu_enable_media_request"),key:"unmuteRequest",onClick:function(){C.muteParticipant(null,{},[J.MediaOption.AUDIO,J.MediaOption.VIDEO,J.MediaOption.SCREEN_SHARING]).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASK_ALL_TO_UNMUTE,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})}});return R&&t.push({text:k("calls_call_menu_debug"),key:"debugLog",onClick:function(){window.__VKCallsSDKLogs__()},disabled:!1}),N&&(t.push({separator:!0}),t.push({text:k("calls_virtual_background"),key:d.POPUP_VIRUTAL_BACKGROUND,onClick:function(){L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}}),t.push({separator:!0})),t}),[x.peer,x.config.streaming,x.me,x.groupId,null===(p=x.translation)||void 0===p?void 0:p.isOn,null===(f=x.translation)||void 0===f?void 0:f.isRecord,x.conversationOptions,x.permissions,x.callData.callId,x.localDevice.roles,W,V,Z]);(0,l.useEffect)((function(){return function(){L({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var sn=(0,l.useCallback)((function(){te&&(0,P.canPinParticipants)(W)?(C.pinParticipant(x.adminPinnedParticipant,!0).then((function(){L({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:x.callData.callId,peer_id:x.peer,is_group_call:(0,O.isGroupCallByPeer)(x.peer)})):(L({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),L({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:null}))}),[x.adminPinnedParticipant,x.peer,x.callData.callId]),dn=(0,l.useCallback)((function(e){K.audio>0&&ji(e,!!z.isAudioEnabled,L,x)}),[K.audio,z.isAudioEnabled,x.notification]);(0,l.useEffect)((function(){H&&K.audio>0&&Pi(x.pushToTalkEnabled,z,!0)}),[]),(0,l.useEffect)((function(){return H&&!function(e){return e.uiMode===d.UIMode.COLLAPSED}(x)&&x.pushToTalkEnabled?(e=dn,window.addEventListener("keydown",e),window.addEventListener("keyup",e),function(){!function(e){window.removeEventListener("keydown",e),window.removeEventListener("keyup",e)}(dn)}):function(){};var e}),[x.uiMode,x.pushToTalkEnabled,dn]);var un=(0,l.useMemo)((function(){var e;return(0,o.jsx)(Qe,{dispatch:L,notification:x.notification,participant:x.participants[null===(e=x.notification)||void 0===e?void 0:e.data]},void 0)}),[x.notification,x.participants[null===(A=x.notification)||void 0===A?void 0:A.data]]),_n=(0,l.useMemo)((function(){return(0,o.jsx)(Oi,{},void 0)}),[x.waitingHall,x.shouldShowDesktopAppNotification,x.shouldShowWarningDesktopAppNotification,x.join]);(0,l.useEffect)((function(){if(!x.callData.localTimeStamp&&!(0,O.isGroupCallByPeer)(x.peer)&&!Ke(x,k)){var e=(0,P.getPeerIdDeviceInfo)(x.peer,x.devices);e&&e.status===J.ParticipantStatus.CONNECTED&&L({type:d.E_ACTION.LOCAL_TIME_START,data:Date.now()})}}),[x]),(0,l.useEffect)((function(){V&&me(Y)}),[Y]);var vn=(0,l.useRef)({}),pn=(0,l.useRef)({});return(0,l.useEffect)((function(){var e,n,t,a,o,r=[],s=function(e){var n,t=x.devices[e],a=t&&x.participants[t.externalId.id],i=a?a.peerId:e.split(":")[0];return(!a||(0,Ve.isEmpty)(null==t?void 0:t.mediaSettings)||!a.name)&&(null!==(n=vn.current[i])&&void 0!==n?n:0)<5&&(void 0===pn.current[i]||Date.now()-pn.current[i]>1e4)},l=Date.now();try{for(var c=(0,i.__values)(Ne),d=c.next();!d.done;d=c.next()){var u=d.value,_=(0,P.externalIdToString)(u.externalId),v=+u.externalId.id;s(_)&&(r.push(v),vn.current[v]=(null!==(o=vn.current[v])&&void 0!==o?o:0)+1,pn.current[v]=l)}}catch(n){e={error:n}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var p=(0,i.__values)(x.speakersInHeader),f=p.next();!f.done;f=p.next()){s(_=f.value)&&x.devices[_]&&r.push(+x.devices[_].externalId.id)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(a=p.return)&&a.call(p)}finally{if(t)throw t.error}}if(window.Calls&&r.length>0){var A=x.callData.callId||"",g={withConversation:!x.callData.conversation,awaitImages:!1};gt(x,L,window.Calls,A,r,g)}}),[x.peer,x.speakersInHeader,Ne]),(0,o.jsx)(b,(0,i.__assign)({onClose:q?qe:$e,isCautionBoxShown:!q,onBackdropClick:Me},{children:(0,o.jsx)(Pe,(0,i.__assign)({info:(0,o.jsx)(mn,{onHandCountChanged:I},void 0),callMenuActions:rn,isVideoAllowed:z.isVideoEnabled||K.video>0,isAudioAllowed:z.isAudioEnabled||K.audio>0,isVideoEnabled:B?!!z.isVideoEnabled:!!z.isVideoEnabled&&!z.isScreenSharingEnabled,isAudioEnabled:z.isAudioEnabled,isScreenSharingEnabled:z.isScreenSharingEnabled,isOratorMode:x.isOratorMode,isFullScreen:oe,onToggleVideo:We,onToggleAudio:Ze,onToggleScreenShare:ze,onLeaveCall:q?qe:se?Xe:$e,onCollapseCall:j?Me:null,onToggleOratorMode:Ue,onFullScreenToggle:en,onTooltipChange:nn,onHidePanel:tn,onChat:Ye,onHandClick:Je,isParticipantControlActive:x.isManagementOpen,isLayoutSwitchShown:V&&Q,isHandRaised:null===(m=null===(h=W.statusData)||void 0===h?void 0:h.hand)||void 0===m?void 0:m.state,isHandControlShown:V,isChatControlShown:!!G&&!x.groupId,isScreenShareControlShown:K.screenSharing>0&&re,isStreamingControlShown:le,isChainControlShown:xe,onDeferredStreamStart:function(){if(x.translation.deferredId){var e={isOn:!1,startStreamParams:{upcomingStreamParams:{ovId:x.translation.deferredId}}};L({type:d.E_ACTION.SET_TRANSLATION,data:e}),L({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})}},onParticipantsClick:Ge,chatUnreadCount:x.chatUnreadCount,notification:un,tooltips:x.tooltips,onChainClick:Fe,notificationWithButton:_n,participantCount:he,isPopupOrModalOpen:!(!x.popup&&!x.isManagementOpen)},{children:(0,o.jsxs)(o.Fragment,{children:[!$&&(0,o.jsx)(_e,{},void 0),ee&&(0,o.jsx)(De,(0,i.__assign)({onScroll:an,scrollPosition:x.gridScrollPosition,participantsCount:Y,participantsShiftCount:Te},{children:Oe}),void 0),ne&&(0,o.jsx)(je,(0,i.__assign)({orator:Wi(x,k,ze),oratorTitle:(0,o.jsx)(Hi,{orator:(0,P.getOrator)(x).participant,oratorDevice:(0,P.getOrator)(x).device,me:x.me,isPinned:ae,isPinnedByAdmin:te,isPinnedByShareScreen:ie,isUnpinAllowed:(0,P.canPinParticipants)(W)||!te,onUnpin:sn,tooltips:x.tooltips,onTooltipChange:nn},void 0),onToggleParticipantsAside:He,isShownParticipantsAside:x.isShownParticipantsAside,onScroll:on,scrollPosition:x.oratorScrollPosition,participantsAsideCount:Y,participantsAsideShift:0===Te?0:148*Te-8},{children:Oe}),void 0),$&&!X&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(g.CallPhoto,{id:G,photo:F&&F.photo||"",waves:!0,alt:F&&F.tab||"",className:"CallPhoto--orator"},void 0)},void 0)]},void 0)}),void 0)}),void 0)}function Wi(e,n,t){var a,i,r,s,l,c=(0,P.getOrator)(e),d=c.device,u=c.participant;"externalId"in d?(r=(0,P.isSameExternalId)(d.externalId,e.externalId),s=(0,P.externalIdToString)(d.externalId),l=d.externalId):(r=(null==u?void 0:u.peerId)===e.me,s=null==u?void 0:u.peerId,l=e.externalId||(0,P.getDefaultExternalId)()),r&&e.groupId&&e.meGroup&&(u=u&&(0,Vn.mergeGroupToParticipant)(e.meGroup,u));var _=(0,P.isParticipantWithVideo)(d),v=(0,P.getStream)(d);return(0,o.jsx)(ce,{externalId:l,isOrator:!0,isInfoShown:!0,isMe:r,hasVideo:!!_,hasAudio:!!(null===(a=d.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isSharingScreen:!!(null===(i=d.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled),stream:v,photo:null==u?void 0:u.photo,name:r?n("calls_own_label"):null==u?void 0:u.name,status:d.status,wasConnected:d.wasConnected,networkStatus:d.networkStatus,allowContain:!0,onStopScreenShare:t},s)}function zi(e){var n=e.isModalView,t=e.uiMode,a=e.changeUIMode;n&&(t===d.UIMode.FULLSCREEN?((0,Cn.pause)(.3,null).then((function(){a(d.UIMode.COLLAPSED)})),a(d.UIMode.DEFAULT)):a(d.UIMode.COLLAPSED))}var Ki=function(e,n,t,a){var i=Math.max(e,Math.min(n,t));return Math.abs(i-e)<a?e:Math.abs(i-n)<a?n:i},Yi={bottom:0,left:0,right:0,top:0},Qi=[15,-15],Zi=function(e){var n=e.children,t=e.style,a=e.startCoords,r=void 0===a?Qi:a,s=e.padding,c=void 0===s?Yi:s,d=e.className,u=e.onUpdateStartCoords,_=e.ignoredSelectors,v=(0,l.useRef)(null),p=(0,l.useRef)(!1),f=(0,i.__read)(function(){var e=(0,i.__read)((0,l.useState)((function(){return[window.innerHeight,window.innerWidth]})),2),n=e[0],t=e[1],a=(0,l.useRef)();return(0,l.useEffect)((function(){var e=function(){a.current&&clearTimeout(a.current),a.current=setTimeout((function(){t([window.innerHeight,window.innerWidth])}),300)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),n}(),2),A=f[0],g=f[1],h=(0,i.__read)(function(e){var n=(0,i.__read)((0,l.useState)([0,0]),2),t=n[0],a=n[1];return(0,l.useEffect)((function(){if(e.current){var n=e.current.getBoundingClientRect();a([n.width,n.height])}}),[]),t}(v),2),m=h[0],C=h[1],E=(0,i.__read)((0,l.useState)([0,0]),2),S=(0,i.__read)(E[0],2),T=S[0],I=S[1],N=E[1],x=(0,i.__read)((0,l.useState)(r),2),y=(0,i.__read)(x[0],2),b=y[0],O=y[1],w=x[1],L=(0,l.useCallback)((function(e,n){var t=0+c.left,a=0-c.top;return[Ki(t,g-m-c.right,e,10),Ki(-A+C+c.bottom,a,n,10)]}),[g,A,m,C,c]);(0,l.useEffect)((function(){w(L(b,O))}),[L]),(0,l.useEffect)((function(){null==u||u([b,O])}),[b,O,u]);var k=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),p.current||N([e.shiftX,e.shiftY])}),[b,O]),P=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),p.current?p.current=!1:(w((function(n){var t=(0,i.__read)(n,2),a=t[0],o=t[1];return L(a+e.shiftX,o+e.shiftY)})),N([0,0]))}),[L]),M=(0,l.useCallback)((function(e){(function(e,n){return!!n&&n.some((function(n){var t,a;return null===(a=(t=e.originalEvent.target).closest)||void 0===a?void 0:a.call(t,n)}))})(e,_)&&(p.current=!0)}),[]),D=(0,i.__read)(L(b+T,O+I),2),j=D[0],R=D[1];return(0,o.jsx)(ba.Touch,(0,i.__assign)({className:d,Component:"div",getRootRef:v,style:(0,i.__assign)((0,i.__assign)({},t),{transform:"translate("+j+"px, "+R+"px)"}),onStart:M,onMove:k,onEnd:P},{children:n}),void 0)};function Ji(e){var n={h:!1,v:!1};if(!e)return n;var t=document.querySelector(e);return t?(t.scrollHeight>window.innerHeight&&(n.v=!0),t.scrollWidth>window.innerWidth&&(n.h=!0),n):((0,J.debugMessage)(J.DebugMessageType.ERROR,{hook:"useDragStaticElement",desc:"padding.checkScrollSelector (="+e+") is invalid"}),n)}var Xi={key:"calls_collapsed_call_position",getPosition:function(){var e=sessionStorage.getItem(Xi.key);return(0,s.isString)(e)?JSON.parse(e):void 0},setPosition:function(e){sessionStorage.setItem(Xi.key,JSON.stringify(e))}},qi=function(e){var n=e.children,t=(0,l.useContext)(y.ConfigContext).withAnimation,a=(0,s.classNames)("CollapsedCall",{"CollapsedCall--withAnimation":t});return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},$i=function(e){var n=e.children,t=function(e){var n=(0,i.__read)((0,l.useState)({h:!1,v:!1}),2),t=n[0],a=n[1],o=(0,l.useRef)();return(0,l.useLayoutEffect)((function(){a(Ji(e))}),[e]),(0,l.useEffect)((function(){var n=function(){o.current&&clearTimeout(o.current),o.current=setTimeout((function(){a(Ji(e))}),300)};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[e]),t}("body"),a=(0,l.useMemo)((function(){return{bottom:t.h?30:15,left:15,right:t.v?30:15,top:15}}),[t]),r=(0,l.useMemo)((function(){return Xi.getPosition()||[15,-15]}),[]),c=(0,l.useMemo)((function(){return[".CallVideoWidget__buttons"]}),[]),d=(0,l.useCallback)((function(e){Xi.setPosition(e)}),[]),u=(0,l.useContext)(y.ConfigContext).withAnimation,_=(0,s.classNames)("CollapsedCall","CollapsedCall--draggable",{"CollapsedCall--withAnimation":u});return(0,o.jsx)(Zi,(0,i.__assign)({className:_,padding:a,startCoords:r,onUpdateStartCoords:d,ignoredSelectors:c},{children:n}),void 0)},eo=function(e){var n=e.id,t=e.photo,a=e.title,r=e.status,s=e.isIncoming,l=e.onClick,c=e.children;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallWidget",onClick:l},{children:[(0,o.jsx)(A,{id:n,className:"CallWidget__background"},void 0),(0,o.jsx)(g.CallPhoto,{id:n,photo:t,waves:s,alt:a||"",className:"CallWidget__photo"},void 0),(0,o.jsx)("h1",(0,i.__assign)({className:"CallWidget__name"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallWidget__status"},{children:r}),void 0),c]}),void 0)},no=function(e){var n=e.localVideoStream,t=e.isLocalAudioEnabled,a=e.isLocalAudioAllowed,r=e.isLocalScreenSharing,s=e.participantId,c=e.isMe,u=void 0!==c&&c,_=e.isWithVideo,v=e.isWithAudio,p=e.isScreenSharing,f=e.stream,A=e.photo,g=e.name,h=e.status,S=void 0===h?J.ParticipantStatus.CONNECTED:h,T=e.networkStatus,I=e.onRestoreCall,N=e.onToggleAudio,x=e.children,y=e.isRecord,b=(0,l.useContext)(E.LangContext).getLang,O=(0,i.__read)((0,l.useState)(!1),2),w=O[0],L=O[1],k=le().storedVideoOptions;(0,l.useEffect)((function(){n||L(!1)}),[n,w]);var M=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),I()}),[I]),D=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),N&&N()}),[N]),j=(0,l.useCallback)((function(e){var n,t;(null===(t=(n=e.target).closest)||void 0===t?void 0:t.call(n,".CallVideoWidget__buttons"))||I()}),[I]);return(0,o.jsxs)("div",(0,i.__assign)({className:"CallVideoWidget",onDoubleClick:j},{children:[n&&(0,o.jsx)(B,{className:"CallVideoWidget__local",participantId:(0,P.externalIdToString)(s),stream:n,isMirrored:!r&&k[d.EVideoOptionType.IS_VIDEO_MIRRORED],isLocalSchreenShare:r,isContained:!1,isStartWithVisible:!0},void 0),y&&(0,o.jsx)(en,{className:"CallVideoWidget__is-record-icon",fill:"#FF3347",width:16,height:16},void 0),(0,o.jsx)(ce,{externalId:s,hasVideo:_,hasAudio:v,isSharingScreen:p,isMe:u,stream:f,photo:A,name:g,status:S,allowContain:!1,networkStatus:T},void 0),x,(0,o.jsx)(ve,(0,i.__assign)({alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"left",marginTop:6,text:b(t?"calls_mute":"calls_unmute")},{children:(0,o.jsx)(m,{type:t?"mute":"unmute",onClick:D,disabled:!a},void 0)}),void 0)}),void 0),(0,o.jsx)(ve,(0,i.__assign)({alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"right",text:b("calls_restore"),marginTop:6},{children:(0,o.jsx)(m,{type:"restore",onClick:M},void 0)}),void 0)}),void 0)]}),void 0)},to=function(e){var n,t,a,r,s=e.SDK,c=k((function(e){return e})),_=u(),v=(0,l.useContext)(E.LangContext).getLang,p=c.peer,f=(0,Ve.isAnyoneWithVideo)(c),A=(0,O.isGroupCallByPeer)(p)?c.callData.conversation:c.participants[c.peer],g=c.localDevice,h=(0,P.getCallVisibleParticipant)(c,f),m=(0,P.isParticipantWithVideo)(g)&&h&&!(0,P.isSameExternalId)(h.externalId,c.externalId),C=k((function(e){return e.translation.isOn&&!!e.translation.isRecord})),S=(0,l.useCallback)((function(){_({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),ki(!1)}),[]),T=(null===(n=null==g?void 0:g.mediaSettings)||void 0===n?void 0:n.isAudioEnabled)||(null===(t=g.permissions)||void 0===t?void 0:t.audio)>0,I=(0,l.useCallback)((function(){var e;s.toggleLocalAudio(!(null===(e=g.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[c]);return(0,o.jsxs)(o.Fragment,{children:[c.mode===d.Mode.INCOMING&&(0,o.jsx)(qi,{children:(0,o.jsx)(eo,{id:p,title:(null==A?void 0:A.tab)||"",photo:(null==A?void 0:A.photo)||"",status:v("calls_incoming_collapsed"),isIncoming:!0,onClick:S},void 0)},void 0),c.mode!==d.Mode.INCOMING&&(0,o.jsx)($i,{children:(0,o.jsx)(no,(0,i.__assign)({localVideoStream:m?(0,P.getStream)(g):void 0,isLocalAudioEnabled:!!(null===(a=g.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isLocalAudioAllowed:T,isLocalScreenSharing:!!(null===(r=g.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)},ao(c,h,A),{onRestoreCall:S,onToggleAudio:I,isRecord:C}),void 0)},void 0)]},void 0)};function ao(e,n,t){var a,i,o=n&&e.participants[n.externalId.id];return n&&o?{participantId:n.externalId,isMe:+n.externalId.id===e.me,isWithVideo:(0,P.isParticipantWithVideo)(n),isWithAudio:!!(null===(a=n.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isScreenSharing:!!(null===(i=n.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled),stream:(0,P.getStream)(n),photo:o.photo,name:o.name,status:n.status,networkStatus:n.networkStatus||1}:{participantId:(0,P.getDefaultExternalId)(),isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:(null==t?void 0:t.photo)||"",name:(null==t?void 0:t.tab)||"",status:(null==t?void 0:t.status)||J.ParticipantStatus.CONNECTED,networkStatus:1}}var io="incoming",oo="outgoing",ro="connecting",so="connected",lo="end";function co(e){var n,t=e.onBeforeCallStart,a=e.onAfterCallFinish,r=e.callSounds,s=(0,c.useSelector)((function(e){return e})),u=(0,l.useRef)(),_=((n={}).incoming=(0,l.useRef)(null),n.outgoing=(0,l.useRef)(null),n.connecting=(0,l.useRef)(null),n.connected=(0,l.useRef)(null),n.end=(0,l.useRef)(null),n),v={controls:!1,preload:"auto"},p=(0,l.useCallback)((function(e){var n=_[e].current;n&&n.paused&&n.play().catch((function(){}))}),[]),f=(0,l.useCallback)((function(e){var n=_[e].current;n&&!n.paused&&(n.pause(),n.currentTime=0)}),[]),A=(0,l.useCallback)((function(){Object.keys(_).forEach(f)}),[]),g=(0,l.useCallback)((function(e){var n=_[e].current;if(n){var t=n.volume;n.volume=0,n.play().catch((function(){})),n.pause(),n.currentTime=0,n.volume=t}}),[]),h=(0,l.useCallback)((function(){t&&t()}),[t]),m=(0,l.useCallback)((function(){a&&a()}),[a]);return(0,l.useEffect)((function(){return xi.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(_).forEach(g),document.body.removeEventListener("mousedown",e)})),function(){A(),m()}}),[]),(0,l.useEffect)((function(){var e=u.current||s,n=s;e.mode!==n.mode&&(e.mode!==d.Mode.READY||n.mode!==d.Mode.INCOMING&&n.mode!==d.Mode.CALL||h(),e.mode===d.Mode.INCOMING&&f(io),n.mode===d.Mode.INCOMING&&p(io),n.mode!==d.Mode.READY||e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL||(A(),p(lo),m()));var t=n.me,a=e.participants,o=n.participants,r=e.localDevice.status,l=n.localDevice.status,c=e.devices,_=n.devices;r!==l&&(r===J.ParticipantStatus.CONNECTING&&f(ro),l===J.ParticipantStatus.CONNECTING&&p(ro));var v=(0,Ve.objectSome)(o,(function(e){var n=e.peerId;return!!a[n]&&(0,P.someDeviceByParticipant)(a[n],(function(e){return e.status===J.ParticipantStatus.CONNECTED}))})),g=(0,Ve.objectSome)(o,(function(e){var n=e.peerId,t=c[n],a=_[n];return t&&a&&t.status!==a.status&&a.status===J.ParticipantStatus.CONNECTED}));!v&&g&&p(so),n.mode===d.Mode.CALL&&(!function(e,n,t,a){var o,r,s=!1;try{for(var l=(0,i.__values)(Object.values(e)),c=l.next();!c.done;c=l.next()){var d=c.value;if(d.peerId!==n){if((0,P.someDeviceByParticipant)(d,(function(e){return e.status===J.ParticipantStatus.CONNECTED})))return!1;(0,P.someDeviceByParticipant)(d,(function(e){return e.status===J.ParticipantStatus.WAITING}))&&(!a||t.has(d.peerId))&&(s=!0)}}}catch(e){o={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return s}(o,t,n.participantsAddedByMe,(0,O.isGroupCallByPeer)(s.peer))?f(oo):p(oo)),u.current=s}),[s]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("audio",(0,i.__assign)({src:r.incoming,ref:_.incoming,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.outgoing,ref:_.outgoing,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connected,ref:_.connected,loop:!1},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connecting,ref:_.connecting,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.end,ref:_.end,loop:!1},v),void 0)]},void 0)}var uo=t(56589),_o=t(79806),vo=t(74041);function po(e){var n=e.cameras,t=e.mics,a=e.noiseCancellationOptions,r=e.videoResolutionOptions,c=e.currentCamId,u=e.currentMicId,_=e.currentNoiseCancellation,v=e.currentVideoResolution,p=e.isCamAvailable,f=void 0!==p&&p,A=e.isMicAvailable,g=void 0!==A&&A,h=e.onCameraChange,m=e.onMicChange,S=e.onNoiseCancellationChange,T=e.onVideoResolutionChange,I=e.pushToTalkEnabled,N=e.onPushToTalkChange,x=(0,l.useContext)(E.LangContext).getLang,b=(0,l.useContext)(y.ConfigContext).allowPushToTalk,O=(0,l.useRef)(null);!function(e){var n=e.kind,t=e.resolution,a=e.mediaElRef,i=e.streamRef,o=e.deviceId,r=e.isActive,s={deviceId:o};"video"===n&&t&&(s.width={min:428,max:d.VideoWidth[t]||d.VideoWidth.SD,ideal:d.VideoWidth[t]||d.VideoWidth.SD},s.height={min:240,max:d.VideoHeight[t]||d.VideoHeight.SD,ideal:d.VideoHeight[t]||d.VideoHeight.SD});(0,l.useEffect)((function(){r&&Ao(n,s).then((function(e){var n;null===(n=i.current)||void 0===n||n.getTracks().forEach((function(e){return e.stop()}));var t=a.current;t&&(i.current=e,t.srcObject=e,t.volume=0,t.play())})).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,{err:e,deviceId:o,kind:n,kindParams:s})}))}),[o,r,t]),(0,l.useEffect)((function(){return function(){var e=i.current;e&&e.getTracks().forEach((function(e){return e.stop()}));var n=a.current;n&&(n.srcObject=null)}}),[])}({kind:"video",resolution:v,mediaElRef:O,streamRef:(0,l.useRef)(null),deviceId:c,isActive:f});var w=le().storedVideoOptions;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__camera"},{children:f?(0,o.jsx)("video",(0,i.__assign)({ref:O},{controls:!1,crossOrigin:"anonymous",playsInline:!0},{className:(0,s.classNames)({CallSettings__cameraStream:w[d.EVideoOptionType.IS_VIDEO_MIRRORED]},"CallSettings__cameraContent")}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallSettings__cameraStub","CallSettings__cameraContent")},{children:x("calls_no_camera")}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:x("calls_settings_camera")}),void 0),f?(0,o.jsx)(uo.default,{options:n.map(fo),value:c,onChange:function(e){var n=e.selected;return h(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallSettings__field"},{children:x("calls_settings_no_camera")}),void 0)]}),void 0),f&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:x("calls_settings_video_resolution")}),void 0),(0,o.jsx)(uo.default,{options:r,value:v,onChange:function(e){var n=e.selected;return T(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:x("calls_settings_mic")}),void 0),g?(0,o.jsx)(uo.default,{options:t.map(fo),value:u,onChange:function(e){var n=e.selected;return m(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallSettings__field"},{children:x("calls_settings_no_mic")}),void 0)]}),void 0),b&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",{className:"CallSettings__label"},void 0),(0,o.jsx)(vo.default,(0,i.__assign)({className:"CallSettings__field",onChange:N,checked:I},{children:x("calls_settings_push_to_talk_mode_description")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:x("calls_settings_push_to_talk_mode_hint"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(_o.default,{className:"CallSettings__hint","aria-label":x("calls_settings_push_to_talk_mode_hint")},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:x("calls_settings_noise")}},void 0)}),void 0),g?(0,o.jsx)(uo.default,{options:a,value:_,onChange:function(e){var n=e.selected;return S(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(Ln.default,(0,i.__assign)({className:"CallSettings__field"},{children:x("calls_settings_no_mic")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:x("calls_settings_noise_description"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(_o.default,{className:"CallSettings__hint","aria-label":x("calls_settings_noise_description")},void 0)}),void 0)]}),void 0)]}),void 0)}function fo(e){return{value:e.deviceId,label:e.label}}function Ao(e,n){return(0,i.__awaiter)(this,void 0,Promise,(function(){var t,a;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia((a={video:!1,audio:!1},a[e]=n,a))];case 1:return[2,i.sent()];case 2:if(t=i.sent(),(0,J.debugMessage)(J.DebugMessageType.ERROR,{src:"[CallSettings][useDeviceOutput][getUserMedia]",err:t,kind:e,kindParams:n}),"OverconstrainedError"===(null==t?void 0:t.name)&&"video"===e&&Object.keys(n).length>1&&"deviceId"in n)return[2,Ao(e,{deviceId:n.deviceId})];throw t;case 3:return[2]}}))}))}function go(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:r("calls_settings"),appearance:"blue",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:t},{children:r("calls_save")}),void 0)]},void 0),className:"CallSettingsModal"},{children:a}),void 0)}function ho(e){var n,t,a=e.SDK,r=(0,ue.useLang)().getLang,c=k((function(e){return e})),_=u(),v=c.config.fullHD,p=c.mode,f=!!(null===(n=c.localDevice.mediaSettings)||void 0===n?void 0:n.isVideoEnabled),A=!!(null===(t=c.localDevice.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),g=(0,l.useMemo)((function(){return[{label:r("calls_noise_neural"),value:d.NoiseCancellationTypes.NEURAL,data:{denoise:!0,denoiseAnn:!0}},{label:r("calls_noise_simple"),value:d.NoiseCancellationTypes.SIMPLE,data:{denoise:!0,denoiseAnn:!1}},{label:r("calls_noise_none"),value:d.NoiseCancellationTypes.NONE,data:{denoise:!1,denoiseAnn:!1}}]}),[r]),h=(0,l.useMemo)((function(){var e=[{label:r("calls_video_resolution_sd"),value:d.VideoResolutionTypes.SD},{label:r("calls_video_resolution_hd"),value:d.VideoResolutionTypes.HD}];return v&&e.push({label:r("calls_video_resolution_fhd"),value:d.VideoResolutionTypes.FHD}),e}),[r,v]),m=a.browser.getCameras(),C=a.browser.getMicrophones(),E=a.browser.hasCamera()&&a.browser.hasCameraPermission(),S=a.browser.hasMicrophone()&&a.browser.hasMicrophonePermission(),T=a.browser.getSavedCamera(),I=a.browser.getSavedMicrophone(),N=E&&(T&&T.deviceId||m[0].deviceId),x=S&&(I&&I.deviceId||C[0].deviceId),y=(0,i.__read)((0,l.useState)(!1===N?void 0:N),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)(!1===x?void 0:x),2),L=w[0],P=w[1],M=(0,i.__read)((0,l.useState)(c.noiseCancellation),2),D=M[0],j=M[1],R=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY),B=(0,i.__read)((0,l.useState)(R===d.VideoResolutionTypes.FHD?d.VideoResolutionTypes.FHD:R===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD),2),U=B[0],H=B[1],G=(0,i.__read)((0,l.useState)(c.pushToTalkEnabled),2),V=G[0],F=G[1];return(0,o.jsx)(go,(0,i.__assign)({onClose:function(){_({type:d.E_ACTION.TOGGLE_POPUP})},onSubmit:function(){var e,n=[Promise.resolve()];!T&&N===b&&p!==d.Mode.READY&&!f||!b||T&&T.deviceId===b||(f?n.push(a.changeDevice("videoinput",b)):n.push(a.browser.saveDeviceId("videoinput",b))),!L||I&&I.deviceId===L||(A?n.push(a.changeDevice("audioinput",L)):n.push(a.browser.saveDeviceId("audioinput",L))),c.noiseCancellation!==D&&n.push(a.setMediaModifiers((null===(e=g.find((function(e){return e.value===D})))||void 0===e?void 0:e.data)||{denoise:!0,denoiseAnn:!0}).then((function(){_({type:d.E_ACTION.SET_NOISE_CANCELLATION,data:D})})));var t=function(){return Promise.resolve()};c.localVideoResolution!==U&&(console.debug("set resolution from -> to: ",c.localVideoResolution,U,d.VideoWidth[U],d.VideoHeight[U]),t=function(){return a.setLocalResolution(d.VideoWidth[U],d.VideoHeight[U],{effect:{width:d.VideoWidth[U],height:d.VideoHeight[U]}}).catch((function(e){console.error(e)})).finally((function(){s.localStorage.setItem(d.VIDEO_RESOLUTION_STORAGE_KEY,U),_({type:d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION,data:U})}))}),c.pushToTalkEnabled!==V&&(c.localDevice.permissions.audio>0&&Pi(V,c.localDevice.mediaSettings),_({type:d.E_ACTION.SET_PUSH_TO_TALK_ENABLE,data:V})),Promise.all(n).then(t).then((function(){_({type:d.E_ACTION.TOGGLE_POPUP})})).catch((function(e){console.error("Device change failed",e),_({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:(0,o.jsx)(po,{mics:C,cameras:m,noiseCancellationOptions:g,videoResolutionOptions:h,currentCamId:b,currentMicId:L,currentNoiseCancellation:D,currentVideoResolution:U,isCamAvailable:E,isMicAvailable:S,onCameraChange:O,onMicChange:P,onNoiseCancellationChange:function(e){return j(e)},onVideoResolutionChange:function(e){return H(e)},pushToTalkEnabled:V,onPushToTalkChange:function(){F(!V)}},void 0)}),void 0)}var mo=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e){switch(this.props.mode){case d.Mode.CALL:this.props.SDK.hangup();break;case d.Mode.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)},n.prototype.render=function(){return this.state.hasError?null:this.props.children},n}(l.Component),Co=function(e){var n=e.children;return(0,o.jsx)("h2",(0,i.__assign)({className:"JoinHeader"},{children:n}),void 0)},Eo=t(11541),So=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"},void 0)}),void 0)};const To=(0,X.makeIcon)("Icon28LaptopOutline","laptop_outline_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="laptop_outline_28"><path clip-rule="evenodd" d="M8 5h-.151c-.781 0-1.4-.001-1.93.171A3.5 3.5 0 0 0 3.67 7.418C3.5 7.95 3.5 8.568 3.5 9.348V19H2.162a1.162 1.162 0 0 0-.367 2.265l1.466.489c.276.092.415.138.556.17.125.029.253.05.38.062.145.014.29.014.582.014H23.22c.291 0 .437 0 .581-.014.128-.012.256-.033.381-.062.141-.032.28-.078.556-.17l1.466-.49A1.162 1.162 0 0 0 25.838 19H24.5V9.349c0-.781.001-1.4-.171-1.93a3.5 3.5 0 0 0-2.247-2.248C21.55 5 20.932 5 20.152 5H20zM6.536 7.073C6.724 7.013 6.992 7 8 7h12c1.008 0 1.276.012 1.464.073a1.5 1.5 0 0 1 .963.963c.06.188.073.456.073 1.464V19h-17V9.5c0-1.008.012-1.276.073-1.464a1.5 1.5 0 0 1 .963-.963z" fill="currentColor" fill-rule="evenodd" /></symbol>',28,28,!1,void 0),Io=(0,X.makeIcon)("Icon28UserOutline","user_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="user_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M17.5 8.5C17.5 6.566 15.934 5 14 5a3.499 3.499 0 0 0-3.5 3.5c0 1.934 1.566 3.5 3.5 3.5s3.5-1.566 3.5-3.5Zm2 0c0 3.039-2.461 5.5-5.5 5.5a5.499 5.499 0 0 1-5.5-5.5C8.5 5.461 10.961 3 14 3s5.5 2.461 5.5 5.5ZM7 20.643c0 .943-.08.857.456.857h13.588c.536 0 .456.086.456-.857 0-2.288-3.304-3.643-7.25-3.643S7 18.355 7 20.643Zm-2 0C5 16.763 9.299 15 14.25 15s9.25 1.763 9.25 5.643c0 2.016-.781 2.857-2.456 2.857H7.456C5.78 23.5 5 22.66 5 20.643Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0);var No=function(e){var n=e.isAnonym,t=e.title,a=e.label,r=e.items,l=e.onChangeName,c=e.name,d=e.namePlaceholder,u=e.joinWithVideoText,_=e.joinWithAudioText,v=e.onJoinWithVideo,p=e.onJoinWithAudio,f=e.disabled,A=e.inputDisabled,g=e.callByNameShow,h=e.onCallByNameClick,m=e.onCallViaNativeAppClick,C=e.callViaNativeAppShow,E=e.callByNameTitle,S=e.callViaNativeAppTitle;return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("JoinScreen",{"JoinScreen--anonym":n})},{children:[(0,o.jsx)(Co,{children:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"JoinScreen__members"},{children:[(0,o.jsx)(Eo.AvatarsStack,{items:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"JoinScreen__membersLabel"},{children:a}),void 0)]}),void 0),(0,o.jsxs)("footer",(0,i.__assign)({className:"JoinScreen__footer"},{children:[n&&(0,o.jsx)(On.default,{onChange:l,className:"JoinScreen__input",value:c,placeholder:d,disabled:A,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&v()}},void 0),(0,o.jsxs)(Un.default,(0,i.__assign)({appearance:"primary",onClick:v,disabled:f,type:"submit"},{children:[(0,o.jsx)(So,{className:"JoinScreen__icon"},void 0),(0,o.jsx)("span",{children:u},void 0)]}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"primary",title:_,"aria-label":_,onClick:p,disabled:f},{children:(0,o.jsx)(Ga,{className:"JoinScreen__icon"},void 0)}),void 0)]}),void 0),(g||C)&&(0,o.jsxs)(Tn.default,(0,i.__assign)({border:!1,className:"JoinScreen__options"},{children:[C&&(0,o.jsx)(In.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:m,icon:(0,o.jsx)(To,{className:"JoinScreen__optionIcon"},void 0)},{children:S}),void 0),g&&(0,o.jsx)(In.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:h,icon:(0,o.jsx)(Io,{className:"JoinScreen__optionIcon"},void 0)},{children:E}),void 0)]}),void 0)]}),void 0)},xo=t(73479),yo=t(71154);function bo(e){var n=e.onVolumeLevelReached,t=e.needCheckMicEnabled,a=e.vectorLength,o=e.volumeLevelDetection,r=e.callbackFactorStep,s=e.sensitivityCoefficient,l=e.onVolumeLevelUpdated,c=e.debugCallback,d=function(e){var n=[],t=0;return function(a){if(n.push(a),t+=a,n.length>e){var i=n.shift();t-=i||0}return t/n.length}}(a),u=0,_=!1;return function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];c&&c(e);var v=(0,i.__read)(e,2),p=v[0],f=v[1],A=p>o;_!==A&&l&&l(A),_=A,0!==u&&f&&(u=0);var g=d(p);t&&f||p/g>(1+u)/s&&p>o&&(u+=r,n())}}function Oo(e,n){var t=Object.keys(e),a=Object.keys(n);return t.length===a.length&&t.every((function(e){return n[e]}))}function wo(e,n){return e.length===n.length&&e.every((function(e,t){return e===n[t]}))}var Lo="calls_token";function ko(e){s.localStorage.setItem(Lo,e)}function Po(e){var n=s.localStorage.getItem(Lo);return n?Promise.resolve(n):(0,sn.getCallAuthToken)(e).then((function(e){return e.token}))}var Mo={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function Do(e){switch(e){case J.ParticipantStatus.WAITING:return 1;case J.ParticipantStatus.CONNECTING:return 2;case J.ParticipantStatus.CONNECTED:return 3;default:return 0}}var jo,Ro=function(){return Mo},Bo=function(e){var n,t;Mo=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},Mo),e),{connectionStep:(n=e.connectionStep,t=Mo.connectionStep,n&&Do(n)&&Do(n)>Do(t)?n:t)})},Uo=function(){Mo={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}};function Ho(e){jo=e}function Go(e,n,t,a){var i,o,r,s=Ro(),l=s.startType,c=s.entryPoint,u=s.timeStart,_=s.isGroupCall,v=s.hadVideoEnabled,p=s.isOutgoingCall,f=!e||e===d.HANGUP_TYPE_HUNGUP&&!t,A=l&&function(e,n,t){var a;a=e===d.CallType.VIDEO?n?d.CallStatReachedType.GROUP_VIDEO:d.CallStatReachedType.VIDEO:t?n?d.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:d.CallStatReachedType.AUDIO_TO_VIDEO:n?d.CallStatReachedType.GROUP_AUDIO:d.CallStatReachedType.AUDIO;return a}(l,_,v),g={type:A,result:f?d.CallStatResult.SUCCESS:d.CallStatResult.FAIL,failReason:f?null:Vo(e,t),callSource:c,totalDuration:u?Date.now()-u:0};p&&(a&&console.log(g),i=n,r=[(o=g).type||"",o.result,o.failReason||"",o.callSource||"",o.totalDuration],jo&&jo({name:"call_stats",value:i,keys:r}))}function Vo(e,n){var t=Ro().isOutgoingCall,a=Ro().connectionStep;switch(!0){case n:return d.CallStatFailReason.CONNECTION_LOST;case e===d.HANGUP_TYPE_CANCELED:return d.CallStatFailReason.LOCAL_DECLINE;case e===d.HANGUP_TYPE_REJECTED:return d.CallStatFailReason.REMOTE_DECLINE;case e===d.HANGUP_TYPE_BUSY:return d.CallStatFailReason.REMOTE_BUSY;case e===d.HANGUP_TYPE_MISSED:return t?d.CallStatFailReason.REMOTE_TIMEOUT:null;case a===J.ParticipantStatus.CONNECTING:return d.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!a:return d.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}function Fo(e,n,t){void 0===n&&(n=!0);var a="";return e&&n?a=t("calls_error_no_cam_and_mic"):e?a=t("calls_error_no_cam"):n&&(a=t("calls_error_no_mic")),a}function Wo(e,n){var t;return((t={})[d.MediaError.CAMERA_PERMISSION]=n("calls_error_no_cam"),t[d.MediaError.MIC_PERMISSION]=n("calls_error_no_mic"),t[d.MediaError.CAMERA_ACCESS]=n("calls_error_cameralock"),t[d.MediaError.MIC_ACCESS]=n("calls_error_miclock"),t[d.MediaError.MIC_NOT_FOUND]=n("calls_error_nomic"),t[d.MediaError.SCREEN_PERMISSION]=n("calls_error_screenpermission"),t[d.MediaError.SCREEN_ACCESS]=n("calls_error_screenlock"),t)[e]}function zo(e,n){return function(t){e&&e({msg:t}),(null==n?void 0:n.onError)&&n.onError(new Error(t)),console.error(t)}}var Ko=t(62090);function Yo(e,n,t,a,o,r){var l,c,u,_,v,p,f,A,g,h=a.dispatch,m=a.getState(),C=m.me,E=(0,Ve.compose)(qo,Ve.startCallRetryWrapper.bind(null,Zo.bind(null,n,e,a))),S=(0,Ve.compose)(n.joinCallByLink,Ve.startCallRetryWrapper.bind(null,Zo.bind(null,n,e,a))),T=m.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoHeight.SD:d.VideoHeight.HD,I=m.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoWidth.SD:d.VideoWidth.HD,N=function(){switch(!0){case m.config.enableDomainBender:return"bender";case r:return"vk_corp";default:return}}(),x=function(){if(m.config.enableCustomScreenSharePacketSize&&(0,s.isNumber)(m.config.customScreenSharePacketSize))return m.config.customScreenSharePacketSize}(),y={apiKey:t.key,apiEnv:t.is_dev?"VIDEOTEST":"PROD",anonymToken:t.is_anonym?t.token:"",filteredMessages:!0,batchParticipantsOnStart:!0,serverAudioRed:m.config.enableServerAudioRed,p2pAudioRed:m.config.enableP2PAudioRed,useParticipantListChunk:Mt(m),participantListChunkInitCount:(g=window.innerHeight,Pt(Math.max(Math.ceil(g/140),8))),voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},domain:N,videoTracksCount:m.config.enableVideoSlots?m.config.videoSlotsCount:void 0,videoMaxHeight:T,videoMaxWidth:I,videoEffectMaxHeight:T,videoEffectMaxWidth:I,debugLog:m.config.debugLog,consumerScreenTrack:m.config.enableScreenTrack,producerScreenTrack:m.config.enableProducerScreenTrack,callStatReportEnabled:!0,joinFromMultipleDevices:m.config.enableMultipleDevices,consumerScreenDataChannelPacketSize:x,onLocalStream:function(n,t){e.debug&&console.warn("onLocalStream",n,t),h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{stream:n,mediaSettings:t}}),Bo({hadVideoEnabled:t.isVideoEnabled})},onLocalStreamUpdate:function(n,t){e.debug&&console.warn("onLocalStreamUpdate",n,t);var o=a.getState(),r=o.localDevice,s=r.mediaSettings,l=r.permissions,c={mediaSettings:n};l.audio!==d.MediaPermissionType.ONCE&&l.video!==d.MediaPermissionType.ONCE&&l.screenSharing!==d.MediaPermissionType.ONCE||(c.permissions={audio:l.audio,video:l.video,screenSharing:l.screenSharing},l.audio===d.MediaPermissionType.ONCE&&(null==s?void 0:s.isAudioEnabled)&&!n.isAudioEnabled&&(c.permissions.audio=d.MediaPermissionType.DENY),l.video===d.MediaPermissionType.ONCE&&(null==s?void 0:s.isVideoEnabled)&&!n.isVideoEnabled&&(c.permissions.video=d.MediaPermissionType.DENY),l.screenSharing===d.MediaPermissionType.ONCE&&(null==s?void 0:s.isScreenSharingEnabled)&&!n.isScreenSharingEnabled&&(c.permissions.screenSharing=d.MediaPermissionType.DENY)),h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:(0,i.__assign)({},c)}),n.isScreenSharingEnabled!==(null==s?void 0:s.isScreenSharingEnabled)&&o.externalId&&((0,P.toggleScreenSharing)(o,h,n.isScreenSharingEnabled,o.externalId),n.isScreenSharingEnabled?e.eventHandlers.onScreenSharingEnabled&&e.eventHandlers.onScreenSharingEnabled():e.eventHandlers.onScreenSharingDisabled&&e.eventHandlers.onScreenSharingDisabled()),Bo({hadVideoEnabled:n.isVideoEnabled})},onRemoteStream:function(n,t){e.debug&&console.warn("onRemoteStream",n.id,t),Mt(m)?function(e,n,t){ca(e,n,t.externalId,{stream:t.stream})}(a.getState(),h,{externalId:n,stream:t}):ot(h,n,{stream:t})},onScreenStream:function(n,t){e.debug&&console.warn("onScreenStream",n,t),h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{screenSharingStream:n,mediaSettings:t}})},onRemoteScreenStream:function(n,t){e.debug&&console.warn("onRemoteScreenStream",n.id,t),Mt(m)?function(e,n,t){ca(e,n,t.externalId,{screenSharingStream:t.stream})}(a.getState(),h,{externalId:n,stream:t}):ot(h,n,{screenSharingStream:t})},onConversation:function(t,i,o,r){if(e.debug&&((0,J.debugMessage)(J.DebugMessageType.LOG,{type:"start call info",os:_i.Platform.OS,arch:_i.Platform.ARCH,isMobile:_i.Platform.isMobile,browser:(0,_i.getBrowserInfo)(),config:a.getState().config,cameras:n.browser.getCameras(),microphones:n.browser.getMicrophones(),hasMicrophonePermission:n.browser.hasMicrophonePermission(),hasCameraPermission:n.browser.hasCameraPermission(),screenHeight:window.screen.availHeight,screenWidth:window.screen.availWidth,windowHeight:window.screen.height,windowWidth:window.screen.width}),console.warn("onConversation",t,i,r)),!a.getState().callData.ts){var s=Date.now();h({type:d.E_ACTION.TIME_START,data:s})}var l=a.getState().peer;0!==l&&pt(0,h,l),rt(m,h,r)},onConversationParticipantListChunk:function(n){!function(e,n,t,a){var i=[];a.participants.forEach((function(e){i.push(e.uid);var t=e.participantState;if(t){var a=(0,P.convertParticipantStateFromSDK)(t);Jt(n,e.uid,a)}})),na(e,n,t,i),Kt(e,n,a)}(m,h,e,n)},onParticipantJoined:function(t,i){!function(e,n,t,a,i){var o=i.externalId,r=i.markers;if(Mt(e)){var s=Yt(r),l=e.participantsChunk;if(l&&s){var c=ua(e),d=l.ids||[],u=Sa(s,e),_=0===c&&0===l.countBefore;if(!(u<0)){if(0===u&&!_)return la(n,{countBefore:l.countBefore+1}),void Ea(e,n,t);var v=ha(l,e);u>=d.length&&v?la(n,{countAfter:l.countAfter+1}):ga(e,n,a,{externalId:o,markers:r})}}}}(a.getState(),h,n,e,{externalId:t,markers:i})},onRemoteMediaSettings:function(t,i,o){var r,s=(0,P.externalIdToString)(t),l=a.getState(),c=l.devices[s],d=null==c?void 0:c.mediaSettings;if((null==d?void 0:d.isVideoEnabled)!==i.isVideoEnabled||(null==d?void 0:d.isAudioEnabled)!==i.isAudioEnabled||(null==d?void 0:d.isScreenSharingEnabled)!==i.isScreenSharingEnabled){e.debug&&console.warn("onRemoteMediaSettings",t,i);var u=!!(null===(r=null==c?void 0:c.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled),_=i.isScreenSharingEnabled;_!==u&&(0,P.toggleScreenSharing)(l,h,_,t,!0),Mt(l)?Rt(l,h,n,e,{externalId:t,markers:o,mediaSettings:i}):ot(h,t,{mediaSettings:i}),Bo({hadVideoEnabled:i.isVideoEnabled})}},onRemoteStatus:function(n,t,o){var r,s,l=a.getState();e.debug&&console.warn("onRemoteStatus",n,t,o);var c=[];try{for(var u=(0,i.__values)(n),_=u.next();!_.done;_=u.next()){var v=_.value,p=+v.id,f=l.participants[p];f&&f.shortName||c.push(p);var A={status:t};o&&(A.statusData=o),ot(h,v,A)}}catch(e){r={error:e}}finally{try{_&&!_.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}if(e&&c.length>0){var g=l.callData.callId||"",m={withConversation:!l.callData.conversation,awaitImages:!1};gt(l,h,e,g,c,m)}Bo({connectionStep:t});var C=+(null==n?void 0:n[0].id);if(C===l.peer){var E=(0,P.getPeerIdDeviceInfo)(C,Zn.GlobalStore.getCallsState().devices),S=function(e,n){var t={call_event_type:e,session_id:l.callData.callId,peer_id:l.peer,is_group_call:!1};n&&(t.reason=n),w.callStats.logEvent(t)};if(t===J.ParticipantStatus.CONNECTED){if(S(d.CallActionEventType.CALL_CONNECTED),Ko.mailRuCounter.push(Ko.EMailRuGoals.JoinCall),!(null==E?void 0:E.wasConnected)&&(0,P.isCreator)(l.localDevice)){var T=Ro().startType;S(d.CallActionEventType.OUTGOING_CALL_ACCEPTED_REMOTELY,null==T?void 0:T.toString())}}else t===J.ParticipantStatus.WAITING&&S(d.CallActionEventType.OUTGOING_CALL_REMOTE_RINGING)}},onPermissionsError:function(t){if(e.debug&&console.warn("onPermissionsError",t),a.getState().mode===d.Mode.CALL){switch(t){case d.MediaError.CAMERA_PERMISSION:case d.MediaError.CAMERA_ACCESS:n.toggleLocalVideo(!1);break;case d.MediaError.MIC_ACCESS:case d.MediaError.MIC_NOT_FOUND:n.toggleLocalAudio(!1);break;case d.MediaError.SCREEN_PERMISSION:case d.MediaError.SCREEN_ACCESS:n.captureScreen(!1)}h({type:d.E_ACTION.ERROR,text:Wo(t,o)})}},onPermissionsRequested:function(){e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:function(t,i){e.debug&&console.warn("onRemoteRemoved",t);var o=a.getState();Mt(o)&&Dt(o,h,n,{externalId:t,markers:i}),h({type:d.E_ACTION.REMOVE_USER,participantId:t})},onCallState:function(n,t,i){var o,r,s;e.debug&&console.warn("onCallState",n,t,i);var l=i.id,c=i.direction,u=i.joinLink,_=i.externalId,v=i.options;if(!l||!a.getState().callData.callId){h({type:d.E_ACTION.CALL_STATE,callData:{callId:l},joinLink:u,externalId:_}),h({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:v});var p=a.getState(),f=p.peer,A=p.participants,g=p.entryPoint;if(!f){var C=[];(0,Ve.objectForEach)(A,(function(e){C.push(e.peerId)})),C.length&&gt(m,h,e,l,C,{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!1})}var E=a.getState().peer||0;(0,O.isGroupCallByPeer)(E)&&[J.CallDirection.JOINING,J.CallDirection.OUTGOING].includes(c)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:l,peer_id:E,is_group_call:!0,source:g}),Ko.mailRuCounter.push(Ko.EMailRuGoals.JoinCall)),(null===(o=a.getState())||void 0===o?void 0:o.startOptions)&&(null===(s=null===(r=a.getState())||void 0===r?void 0:r.startOptions)||void 0===s?void 0:s.createLink)&&Et(h,l,a.getState().groupId)}},onRateNeeded:function(){e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:function(n){e.debug&&console.warn("onSpeakerChanged",n),h({type:d.E_ACTION.SET_ORATOR,orator:n})},onJoinStatus:function(n,t){e.debug&&console.warn("onJoinStatus",n,t)},onHangup:function(t,i){var o,r=t.hangup;e.debug&&console.warn("onHangup",r,i);var s=r&&![d.HANGUP_TYPE_CANCELED,d.HANGUP_TYPE_MISSED,d.HANGUP_TYPE_HUNGUP].includes(r),l=a.getState(),c=r&&r===d.HANGUP_TYPE_HUNGUP,u=(0,O.isGroupCallByPeer)(l.peer);if(l.mode===d.Mode.CALL&&s||l.localDevice.status===J.ParticipantStatus.WAITING_HALL&&r===d.HANGUP_TYPE_REMOVED){var _=d.CALL_HANGUP_MODAP_MAP[r],v=!!(null===(o=l.lastCallData)||void 0===o?void 0:o.isMeEndedCallForAll)&&(r===J.HangupType.KILLED||r===J.HangupType.KILLED_WITHOUT_DELETE);h({type:d.E_ACTION.HANGUP,data:r}),(0,Ve.conditionalPausedPromise)(v||d.HANGUP_DELAY).finally((function(){h({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),_&&h({type:d.E_ACTION.TOGGLE_POPUP,data:_})}))}else if(m.config.showFeedbackScreen&&c){var p=l.callData.ts,f=(p?Math.floor((Date.now()-p)/1e3):0)>10&&0===Math.floor(3*Math.random()),A=0===Math.floor(5*Math.random());u&&f||A?(h({type:d.E_ACTION.MANAGEMENT,isOpen:!1}),h({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.FEEDBACK})):l.mode!==d.Mode.ERROR&&h({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}else l.mode!==d.Mode.ERROR&&h({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY});e.isInActiveCall=!1;var g=(0,Ve.isInReconnect)(l);if(Go(r,i=i||"",g,e.debug),!g&&!u){var C="none";r===J.HangupType.MISSED?C="timeout":r===J.HangupType.BUSY&&(C="busy");var E=l.callData.conversation,S={call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_REMOTELY,session_id:i,peer_id:(null==E?void 0:E.peerId)||0,is_group_call:!1,reason:C};w.callStats.logEvent(S)}e.authorizedGroupId&&function(e,n,t,a){Xo(e,n,t,0,a)}(n,e,a,h),Uo(),qa(l)},onCallAccepted:function(){e.debug&&console.warn("onCallAccepted"),(0,O.isGroupCallByPeer)(a.getState().peer)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:a.getState().callData.callId,peer_id:a.getState().peer,is_group_call:(0,O.isGroupCallByPeer)(a.getState().peer)}),Ko.mailRuCounter.push(Ko.EMailRuGoals.JoinCall))},onTokenExpired:function(){e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(Zo(n,e,a),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:function(){e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:function(){e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:function(n){e.debug&&console.warn("onFingerprintChange",n)},onVolumesDetected:(l={onUpdate:function(e){h({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:e.speakers,speakersInHeader:e.speakersInHeader}})},volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,debugCallback:function(){e.debug}},c=l.onUpdate,u=l.volumeLevelDetection,_=l.debugCallback,v={},p=[],f={},A=[],function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];_&&_(e);var t=(0,i.__read)(e,1),a=t[0];f=Object.keys(f).reduce((function(e,n){return f[n]-1>0&&(e[n]=f[n]-1),e}),{});var o=a.reduce((function(e,n){var t=n.uid,a=n.volume,i=(0,P.externalIdToString)(t);return a>u&&(e[i]=!0,f[i]=3),e}),{});A=Object.keys(f);var r=!1,s={speakers:v,speakersInHeader:p};Oo(v,o)||(s.speakers=o,v=o,r=!0),wo(p,A)||(s.speakersInHeader=A,p=A,r=!0),r&&c(s)}),onLocalVolume:bo({onVolumeLevelReached:function(){var e=a.getState();h({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.SPEAKING_ON_MUTE}}),w.callStats.logEvent({call_event_type:d.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,O.isGroupCallByPeer)(e.peer)})},onVolumeLevelUpdated:function(e){var n,t=null===(n=a.getState().localDevice.mediaSettings)||void 0===n?void 0:n.isAudioEnabled,o=a.getState().speakers,r=(0,i.__assign)({},o),s=a.getState().externalId,l=s?(0,P.externalIdToString)(s):C;e&&t&&s?r[l]=!0:!e&&s&&delete r[l],r[l]!==o[l]&&h({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:r}})},needCheckMicEnabled:!0,volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:function(){e.debug}}),onChatMessage:function(n,t,a){e.debug&&console.warn("onChatMessage",n,t,a)},onCustomData:function(n,t){e.debug&&console.warn("onCustomData",n,t)},onNetworkStatusChanged:function(n){var t,a;if(e.debug&&console.warn("onNetworkStatusChanged",n),(0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetwork||!(0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetworkP2P)try{for(var o=(0,i.__values)(n),r=o.next();!r.done;r=o.next()){var s=r.value;ot(h,s.uid,{networkStatus:s.rating})}}catch(e){t={error:e}}finally{try{r&&!r.done&&(a=o.return)&&a.call(o)}finally{if(t)throw t.error}}},onLocalNetworkStatusChanged:function(n){e.debug&&console.warn("onLocalNetworkStatusChanged",n),((0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetwork||!(0,O.isGroupCallByPeer)(m.peer)&&m.config.badNetworkP2P)&&h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{networkStatus:n}})},onDebugMessage:function(n){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];e.debug&&console.warn.apply(console,(0,i.__spreadArray)(["onDebugMessage",n],(0,i.__read)(t),!1))},onRemoteParticipantState:function(t,i,o){var r,s,l,c,u,_,v,p;i=(0,P.convertParticipantStateFromSDK)(i);var f=(0,P.externalIdToString)(t),A=+t.id,g=a.getState(),m=!!(null!==(c=null===(l=null===(s=null===(r=g.devices[f])||void 0===r?void 0:r.statusData)||void 0===s?void 0:s.hand)||void 0===l?void 0:l.state)&&void 0!==c?c:null===(u=g.handState)||void 0===u?void 0:u[f]);if(m!==!!(null===(_=null==i?void 0:i.hand)||void 0===_?void 0:_.state)){e.debug&&console.warn("onRemoteParticipantState",t,i);var C=!!(null===(v=a.getState().participants[+t.id])||void 0===v?void 0:v.name);Mt(g)?function(e,n,t,a,i){var o=i.externalId,r=i.markers,s=i.participantState;Jt(n,o,s);var l=ia(e,r);oa(e.participantsChunk,l)?Gt(e,n,a,o,{markers:r,statusData:s}):qt(e,n,(0,P.externalIdToString)(o)),Zt(e,n,t,a,{externalId:o,markers:r})}(g,h,n,e,{externalId:t,markers:o,participantState:i}):ot(h,t,{statusData:i}),(null===(p=null==i?void 0:i.hand)||void 0===p?void 0:p.state)&&!m&&C&&A!==g.me&&h({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.RAISED_HAND,data:A}})}},onRolesChanged:function(n,t){e.debug&&console.warn("onRolesChanged",n,t);var i=a.getState().participants[n.id];t.includes(J.UserRole.ADMIN)&&i&&i.peerId!==m.me&&h({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE,data:n.id}}),h({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:+n.id,data:t})},onLocalRolesChanged:function(n){e.debug&&console.warn("onLocalRolesChanged",n),(n.includes(J.UserRole.ADMIN)||n.includes(J.UserRole.CREATOR))&&h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:{audio:d.MediaPermissionType.ALLOW,video:d.MediaPermissionType.ALLOW,screenSharing:d.MediaPermissionType.ALLOW}}}),n.includes(J.UserRole.ADMIN)&&h({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.ADMIN_ROLE_GRANTED}}),n.includes(J.UserRole.ADMIN)||n.includes(J.UserRole.CREATOR)?m.config.allowWaitingHall&&(0,O.isWaitingHallEnabled)(a.getState())&&function(e,n){(0,J.getWaitingHall)(null,void 0).then((function(t){return zn(t.totalCount,t.participants,e,n)}))}(a.getState(),h):a.getState().waitingHall&&function(e){e({type:d.E_ACTION.SET_WAITING_HALL,data:void 0})}(h),h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{roles:n}})},onDeviceSwitched:function(n,t){e.debug&&console.warn("onDeviceSwitched",n,t)},onMuteStates:function(t,o,r,s,l,c){var u,_;e.debug&&console.warn("onMuteStates",t,o,r,s,l,c);var v=a.getState(),p=v.localDevice,f=p.permissions,A=f.audio,g=f.video,m=f.screenSharing,C=!!(null===(_=null===(u=p.statusData)||void 0===u?void 0:u.hand)||void 0===_?void 0:_.state),E=(0,P.isSameExternalId)(c,v.externalId);if(l&&(E||null===c)){if(C&&n.changeParticipantState({hand:d.SdkHandType.LOWERED}).catch(console.log),h({type:d.E_ACTION.TOGGLE_POPUP,data:r.includes(J.MediaOption.VIDEO)?d.POPUP_UNMUTE_REQUEST:d.POPUP_UNMUTE_AUDIO_REQUEST}),(0,P.isAdmin)(p)||(0,P.isCreator)(p))return;var S=!s;h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:(0,i.__assign)({permissions:{audio:r.includes(J.MediaOption.AUDIO)?S?d.MediaPermissionType.ONCE:d.MediaPermissionType.ALLOW:A,video:r.includes(J.MediaOption.VIDEO)?S?d.MediaPermissionType.ONCE:d.MediaPermissionType.ALLOW:g,screenSharing:r.includes(J.MediaOption.SCREEN_SHARING)?S?d.MediaPermissionType.ONCE:d.MediaPermissionType.ALLOW:m}},C&&{statusData:(0,i.__assign)((0,i.__assign)({},p.statusData),{hand:{ts:Date.now(),state:!1}})})})}else{null===c&&h({type:d.E_ACTION.SET_CALL_PERMISSIONS,data:t}),v.popup!==d.POPUP_UNMUTE_REQUEST&&v.popup!==d.POPUP_UNMUTE_AUDIO_REQUEST||h({type:d.E_ACTION.TOGGLE_POPUP});var T=(0,P.isAdmin)(p)||(0,P.isCreator)(p),I=d.NotificationType.ADMIN_MUTE,N=t[J.MediaOption.AUDIO]===J.MuteState.MUTE?d.MediaPermissionType.ALLOW:t[J.MediaOption.AUDIO]===J.MuteState.MUTE_PERMANENT?d.MediaPermissionType.DENY:A,x=t[J.MediaOption.VIDEO]===J.MuteState.MUTE?d.MediaPermissionType.ALLOW:t[J.MediaOption.VIDEO]===J.MuteState.MUTE_PERMANENT?d.MediaPermissionType.DENY:g,y=t[J.MediaOption.SCREEN_SHARING]===J.MuteState.MUTE?d.MediaPermissionType.ALLOW:t[J.MediaOption.SCREEN_SHARING]===J.MuteState.MUTE_PERMANENT?d.MediaPermissionType.DENY:m;if(A!==N&&N===d.MediaPermissionType.DENY&&g!==x&&x===d.MediaPermissionType.DENY?I=T?d.NotificationType.ADMIN_MUTE:d.NotificationType.ADMIN_MUTE_PERMANENT:A!==N&&N===d.MediaPermissionType.DENY&&g===x?I=T?d.NotificationType.ADMIN_MUTE_AUDIO:d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:A===N&&g!==x&&x===d.MediaPermissionType.DENY?I=T?d.NotificationType.ADMIN_MUTE_VIDEO:d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:A!==N&&N===d.MediaPermissionType.ALLOW&&g!==x&&x===d.MediaPermissionType.ALLOW?I=T?null:d.NotificationType.ADMIN_UNMUTE_PERMANENT:A!==N&&N===d.MediaPermissionType.ALLOW&&g===x?I=T?null:d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:A===N&&g!==x&&x===d.MediaPermissionType.ALLOW?I=T?null:d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:r.includes(J.MediaOption.AUDIO)&&A===N&&N===d.MediaPermissionType.ALLOW&&r.includes(J.MediaOption.VIDEO)&&g===x&&x===d.MediaPermissionType.ALLOW?I=d.NotificationType.ADMIN_MUTE:r.includes(J.MediaOption.AUDIO)&&A===N&&N===d.MediaPermissionType.ALLOW&&g===x?I=d.NotificationType.ADMIN_MUTE_AUDIO:A===N&&r.includes(J.MediaOption.VIDEO)&&g===x&&x===d.MediaPermissionType.ALLOW&&(I=d.NotificationType.ADMIN_MUTE_VIDEO),null===I||!(0,P.isSameExternalId)(c,v.externalId)&&null!==c||h({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:I}}),(0,P.isAdmin)(p)||(0,P.isCreator)(p))return;h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:{audio:N,video:x,screenSharing:y}}})}},onRecordStarted:function(n,t,a,i,o,r){e.debug&&console.warn("onRecordStarted",n,t,a,i);var s={isOn:!0,videoId:o?+o:void 0,ownerId:r?+r:void 0,host:n,startTime:a,link:r&&o?"https://"+bi()+D(r,o):void 0,startStreamParams:void 0,isRecord:"RECORD"===i};h({type:d.E_ACTION.SET_TRANSLATION,data:s})},onRecordStopped:function(){e.debug&&console.warn("onRecordStopped"),h({type:d.E_ACTION.SET_TRANSLATION,data:{isOn:!1,hasPermission:!1}}),h({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION,data:!0})},onLocalPin:function(n){var t;e.debug&&console.warn("onLocalPin",{unpin:n});var i=a.getState(),o=i.localDevice;n||h({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.PINNED_BY_ADMIN}}),!n&&(0,P.isMutedPermanently)(o)&&h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:{audio:d.MediaPermissionType.ONCE,video:d.MediaPermissionType.ONCE,screenSharing:d.MediaPermissionType.ONCE}}}),n||(null===(t=o.mediaSettings)||void 0===t?void 0:t.isAudioEnabled)||h({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_ADMIN_PIN_UNMUTE_REQUEST}),n||i.isOratorMode||h({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),i.externalId&&h({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:n?null:i.externalId})},onPinnedParticipant:function(t,o,r){e.debug&&console.warn("onPinnedParticipant",t,o);var s=a.getState(),l=s.participants[t.id];!o&&l&&((null==l?void 0:l.shortName)||(null==l?void 0:l.name))&&h({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_PINNED_BY_ADMIN,data:t.id}}),s.isOratorMode||h({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),function(e,n,t,a,o){var r=o.externalId,s=o.pin,l=o.markers;(0,i.__awaiter)(this,void 0,void 0,(function(){var o,c,d,u,_,v,p;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return o=Yt(l),Mt(e)&&o?(c=(0,P.externalIdToString)(r),d=$t(e,c),u=aa(e,r),_=u>-1,v=ia(e,l),p=oa(e.participantsChunk,v),Zt(e,n,t,a,{externalId:r,markers:l}),p&&ta(n,r,{markers:l}),s&&d?[2]:s&&!d||p&&!_?[4,ra(e,n,t,a,{externalId:r,marker:o})]:[3,2]):[2];case 1:return i.sent(),[2];case 2:return!d||p||s||qt(e,n,c),[2]}}))}))}(s,h,n,e,{externalId:t,pin:!o,markers:r}),h({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:o?null:t})},onOptionsChanged:function(n){e.debug&&console.warn("onOptionsChanged",n),h({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:n})},onLocalStatus:function(n){e.debug&&console.warn("onLocalStatus",n);var t=a.getState(),o=t.callData,r=t.me,s=t.localDevice.status===J.ParticipantStatus.WAITING_HALL&&n===J.ParticipantStatus.WAITING,l=n===J.ParticipantStatus.CONNECTED&&!t.peer;o.callId&&!(0,P.isParticipantAnonym)(r)&&(l||s)&&(0,sn.getConversationsByCall)([o.callId]).then((function(e){var n=e.items,t=(0,i.__read)(n,1)[0].peer.id;return $o(a,t,void 0)})).catch((function(e){var n;if(951===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;throw e})).catch(yo.handlePromiseError),h({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{status:n,wasConnected:!0}})},onChatRoomUpdated:function(n,t,i){e.debug&&console.warn("onChatRoomUpdated",n,t,i),n===J.ChatRoomEventType.ATTENDEE&&zn(t,i,a.getState(),h)},onJoinLinkChanged:function(n){e.debug&&console.warn("onJoinLinkChanged",n);var t=a.getState(),i=t.callData.callId||"",o=(0,O.isAuthedByGroupId)(t)?t.groupId:0;ht(a.dispatch,i,!1,o)}};e.authorized=!1,e.authorizedGroupId=0,e.debugMessage=J.debugMessage,e.call=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v){void 0===u&&(u=0),void 0===v&&(v={});var p=(0,O.getMediaOptions)({video:s,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qo):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jo(e)})).then((function(){return Xo(n,e,a,u,o)})).then((function(){return Be(n,p)})).then((function(){return $o(a,r,l)})).then((function(t){return Promise.all([lt(t),i(e,n,a,p,r)])})).then((function(){return ir(n,v)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),Bo({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:c,startType:s?d.CallType.VIDEO:d.CallType.AUDIO}),w.callStats.logEvent({call_event_type:s?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!1,source:c,group_call_users_count:2}),Ko.mailRuCounter.push(Ko.EMailRuGoals.StartP2PCall),er(a,r,l)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),tr(a,n,e,(0,O.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startGroupCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v,p){void 0===_&&(_=!0),void 0===v&&(v=null),void 0===p&&(p={});var f=(0,O.getMediaOptions)({video:c,audio:!0}),A=l?l.filter(La.isUserPeer):[];return e.debug&&l&&l.length!==A.length&&console.warn("Some ids cannot get into the call.",l.filter((function(e){return!(0,La.isUserPeer)(e)}))),e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qo):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jo(e)})).then((function(){return Xo(n,e,a,0,o)})).then((function(){return Be(n,f)})).then((function(){return $o(a,r,s)})).then((function(e){return dt(a.getState(),o,r,e[0])})).then((function(){return i(e,n,a,f,r)})).then((function(){return ir(n,p)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),_&&(A&&A.length?o({type:d.E_ACTION.GROUP_CALL_SETUP,open:!0,peerId:r,preselectedIds:A}):o({type:d.E_ACTION.MANAGEMENT,isOpen:!0})),v&&o({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),er(a,r,s),Bo({timeStart:Date.now(),isOutgoingCall:!0,startType:c?d.CallType.VIDEO:d.CallType.AUDIO,entryPoint:u,isGroupCall:!0}),w.callStats.logEvent({call_event_type:c?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!0,source:u,group_call_users_count:1}),Ko.mailRuCounter.push(Ko.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),tr(a,n,e,(0,O.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u){void 0===l&&(l=!0),void 0===c&&(c=0),void 0===u&&(u={});var _=(0,O.getMediaOptions)({video:r,audio:!0});if(e.isInActiveCall)return Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qo);e.isInActiveCall=!0;var v=(0,O.getDefaultConversation)(t);return Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jo(e)})).then((function(){return Xo(n,e,a,c,o)})).then((function(){return Be(n,_)})).then((function(){return Promise.all([i(e,n,a,_),lt([v])])})).then((function(){return ir(n,u)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.LOAD_PEERS,conversation:v,members:[],peerId:0}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL}),l&&o({type:d.E_ACTION.MANAGEMENT,isOpen:!0});var e=a.getState().callData.callId;(null==u?void 0:u.createLink)&&(e?Et(o,e,c):o({type:d.E_ACTION.SET_START_OPTIONS,data:u})),Bo({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:s,startType:r?d.CallType.VIDEO:d.CallType.AUDIO,isGroupCall:!0}),w.callStats.logEvent({call_event_type:r?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:e,peer_id:0,is_group_call:!0,source:s,group_call_users_count:1}),Ko.mailRuCounter.push(Ko.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),tr(a,n,e,!0,t,o)}))}}(e,n,o,a,E),e.joinCallByLink=function(e,n,t,a,o){var r=a.dispatch;return function(s,l,c,u,_,v,p){void 0===c&&(c=!1),void 0===_&&(_=0),void 0===v&&(v=void 0);var f=(0,O.getMediaOptions)({video:c,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qo):(e.isInActiveCall=!0,r({type:d.E_ACTION.SET_ENTRYPOINT,entryPoint:u}),(0,P.isParticipantAnonym)(a.getState().me)?Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jo(e)})).then((function(){return Be(n,f)})).then((function(){return o(s,f).then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,joinLink:s,vkJoinLink:p})}))})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),tr(a,n,e,!0,t,r)})):Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jo(e)})).then((function(){return Xo(n,e,a,_,r)})).then((function(){return Be(n,f)})).then((function(){return o(s,f)})).then((function(e){var n=e.id;return(0,sn.getConversationsByCall)([n])})).then((function(e){var n=e.items;if(!(null==n?void 0:n.length))return 0;var t=(0,i.__read)(n,1)[0].peer.id;return $o(a,t,l).then((function(e){return lt(e)})),t})).catch((function(e){var n,t;if(8===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;if((0,Ve.hasIn)(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.error_code,951,1007))return 0;throw e})).then((function(e){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:e,joinLink:s}),v&&r({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),e&&er(a,e,l),w.callStats.logEvent({call_event_type:d.CallActionEventType.GROUP_CALL_JOINED,session_id:a.getState().callData.callId,peer_id:null!=e?e:0,is_group_call:!0,source:u,group_call_users_count:(0,P.getActiveParticipantsCount)(a.getState())})})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),tr(a,n,e,!0,t,r)})))}}(e,n,o,a,S),e.showJoinPopup=function(e,n,t){var a=t.dispatch;return function(o,r){var s=t.getState().mode;return s===d.Mode.CALL||s===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){a({type:d.E_ACTION.ERROR,text:n("calls_already_in_call_error")})})):(a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),(0,sn.getJoinLinkDetails)(o).then(Ve.normalizePreviewData.bind(null,n)).then((function(e){a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.JOIN,data:(0,i.__assign)((0,i.__assign)({},e),{entryPoint:r})})})).catch((function(t){var i;e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug&&console.warn("getJoinLinkDetails",t);var o=(0,Ve.getTextForApiErrorByCode)(null===(i=null==t?void 0:t.error)||void 0===i?void 0:i.error_code,!0,n);console.error(o),a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.ERROR,text:o,handleType:d.ErrorHandleType.FATAL})})))}}(e,o,a),e.acceptCall=function(e,n,t,a){var i=a.dispatch;return function(o,r){var s=a.getState(),l=s.peer,c=s.callData,u=(0,O.getMediaOptions)({video:o,audio:r});return Be(n,u).then((function(){return n.acceptCall(u)})).then((function(n){var t=n.acceptTime;i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,ts:t}),e.isInActiveCall=!0,w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:c.callId,peer_id:l,is_group_call:(0,O.isGroupCallByPeer)(l),reason:o?d.CallType.VIDEO:d.CallType.AUDIO}),Ko.mailRuCounter.push(Ko.EMailRuGoals.AcceptCall)})).catch((function(n){i({type:d.E_ACTION.ERROR,text:Fo(o,!0,t),handleType:d.ErrorHandleType.DECLINE}),e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),(0,J.debugMessage)(J.DebugMessageType.ERROR,n),console.error(n)}))}}(e,n,o,a),e.showCallByNamePopup=function(e,n,t,a){var i=a.dispatch;return function(e,n,o){var r=a.getState().mode;return r===d.Mode.CALL||r===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){i({type:d.E_ACTION.ERROR,text:t("calls_already_in_call_error")})})):Promise.resolve().then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),i({type:d.E_ACTION.CALL_BY_NAME,data:{peerId:e,joinLink:o,entryPoint:n}})})).catch((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}}(0,0,o,a),e.showCreateCallByLinkPopup=function(e,n,t,a){var i=a.dispatch;return function(e){var n=a.getState().mode;return n===d.Mode.CALL||n===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qo):Promise.resolve().then((function(){i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CREATE_CALL,entryPoint:e})}))}}(0,0,0,a),e.showPlanCalendarEventPopup=function(e){var n=e.dispatch;return function(){return e.getState().mode===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qo):Promise.resolve().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_PLAN_CALENDAR_EVENT})}))}}(a),e.store=a;var b=yi(m.config.browserWarnings);if(null==b?void 0:b.block){var L=function(){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START})};e.call=L,e.startGroupCall=L,e.startCall=L,e.acceptCall=L,e.joinCallByLink=function(e){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,joinLink:e})},e.showJoinPopup=L,e.showCallByNamePopup=L,e.showCreateCallByLinkPopup=L,e.showPlanCalendarEventPopup=L}var k=t.token?Promise.resolve(t.token):Po(t.is_dev),M=function(t){return Promise.resolve().then((function(){return(0,P.isParticipantAnonym)(a.getState().me)?Promise.resolve():n.authorize(t).then((function(){return ko(t)})).then((function(){return e.authorized=!0})).catch((function(e){throw s.localStorage.removeItem(Lo),e}))}))};return k.then((function(t){return n.init(y).then((function(){m.config.debugLog&&e.setDebug(!0)})).then((function(){return M(t)}))}))}function Qo(e){if(e===d.CallErrorType.ALREADY_IN_CALL)console.log("Already in call");else console.log(e)}function Zo(e,n,t){return function(e,n,t){return(0,sn.getCallAuthToken)(t.getState().isDev).then((function(t){var a=t.token;return e.authorize(a).then((function(){return ko(a)})).then((function(){return n.authorized=!0}))}))}(e,n,t).catch((function(e){n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),console.error("Could not authorize with token request",e)}))}function Jo(e){return new Promise((function(n){e.initializing.finally((function(){n()}))}))}function Xo(e,n,t,a,i,o){return void 0===o&&(o=!1),new Promise((function(r,s){a||n.authorizedGroupId||r(),a&&n.authorizedGroupId===a&&r(),o||(w.callStats.setEventCommonData(),i({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:0,groupMembers:[],unableToCallGroupMembersIds:[]})),(0,sn.getCallAuthToken)(t.getState().isDev,a).then((function(t){var l=t.token;e.authorize(l).then((function(){n.authorizedGroupId=a,o?r():a?(0,sn.getGroupById)(-a).then((function(e){if(e.groups){var n=e.groups[0];i({type:d.E_ACTION.SET_GROUP,groupId:a,meGroup:(0,Vn.normalizeGroup)(n)}),w.callStats.setEventCommonData({group_id:a}),r()}})).catch((function(e){s(e)})):r()}))}))}))}function qo(e,n,t,a,i,o){void 0===i&&(i=0),void 0===o&&(o=[]);var r=e.authorizedGroupId?e.id:0,s=(0,Ve.createPayload)(i,a,r);if(!i)return n.callTo(void 0,a,s,!0);if(!(0,O.isGroupCallByPeer)(i))return ar(e,t,i).then((function(e){return n.forceRelayPolicy(e),n.callTo(i.toString(),a,s)}));var l=o.filter((function(e){return e=Number(e),(0,La.isUserPeer)(e)&&e!==t.getState().me}));return n.callTo(l,a,s,!0)}function $o(e,n,t){var a=e.dispatch;return!!t||n?(t?Promise.resolve((0,Ve.convertClientData)(t)):(0,sn.retryLoadCallPeers)(n).then(Ve.convertServerData)).then((function(e){var t=(0,i.__read)(e,3),o=t[0],r=t[1],s=t[2];return mt(a,s||o),a({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r,peerId:n}),e})):Promise.reject("Cannot load data")}function er(e,n,t){var a=e.dispatch;return!!t&&n?(0,sn.retryLoadCallPeers)(n).then((function(e){var n=(0,i.__read)((0,Ve.convertServerData)(e),2),t=n[0],o=n[1];return mt(a,e.items[0]),lt([t,o])})).then((function(e){var n=(0,i.__read)(e,2),t=n[0],o=n[1];a({type:d.E_ACTION.LOAD_PEERS,conversation:t,members:o})})):Promise.resolve()}function nr(e,n,t){switch(!0){case function(e){var n=e||{},t=n.hangup,a=n.message;return!(!t||!a)}(e):case function(e){var n=e||{},t=n.hangup;return n.message&&void 0===t}(e):return(0,Ve.getTextForServerError)(e.message,n,t);case function(e){var n;return["TypeError","SyntaxError","RangeError","EvalError","URIError"].includes(null===(n=null==e?void 0:e.__proto__)||void 0===n?void 0:n.name)}(e):return t("calls_error");case function(e){return!!e.error_msg}(e):return(0,Ve.getTextForServerError)(e.error_msg,n,t);case function(e){return"number"==typeof e}(e):return(0,Ve.getTextForClientError)(e,n,t);case function(e){return!!e}(e):default:return t("calls_sorry_error")}}function tr(e,n,t,a,i,o){var r,s;try{var l=nr(e,a,i);n.hangup(),t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e),o({type:d.E_ACTION.ERROR,text:l,handleType:d.ErrorHandleType.FATAL}),(null===(r=t.eventHandlers)||void 0===r?void 0:r.onErrorStartCall)&&(null===(s=t.eventHandlers)||void 0===s||s.onErrorStartCall())}catch(t){throw(0,J.debugMessage)(J.DebugMessageType.ERROR,t),console.error(t),n.hangup(),e}}function ar(e,n,t){var a=n.getState();return a.ipSettingEnabled&&"all"!==a.privacySettings.callsIp?(0,La.isChatPeer)(t)?Promise.resolve(!0):e.isFriend?Promise.resolve(!e.isFriend(t)):Object.keys(a.friendsCache).length>0?Promise.resolve(!a.friendsCache[t]):(0,Ve.exponentialRetry)(ct)(e,a,n.dispatch).then((function(){return ar(e,n,t)})):Promise.resolve(!1)}function ir(e,n){void 0===n&&(n={}),n&&(n.conversationOptions&&Object.keys(n.conversationOptions).length>0&&e.changeConversationOptions(n.conversationOptions),n.mediaOptions&&Object.keys(n.mediaOptions).length>0&&e.muteParticipant(null,n.mediaOptions))}var or=function(e){var n=e.isAnonym,t=e.joinLink,a=e.vkJoinLink,r=e.title,s=e.members,c=e.membersCount,u=e.conversationData,_=e.withPopup,v=e.onBeforeCallStart,p=e.onAfterCallFinish,f=e.onClose,A=e.bridge,g=e.entryPoint,h=e.tabIsMaster,m=e.tabIsIdle,C=e.onError,S=e.isDev,I=e.okPublicKey,N=(0,l.useContext)(E.LangContext),x=N.getLang,b=N.langNumeric,O=(0,i.__read)((0,l.useState)(""),2),w=O[0],L=O[1],k=(0,i.__read)((0,l.useState)(null),2),M=k[0],D=k[1],j=(0,i.__read)((0,l.useState)(!1),2),R=j[0],B=j[1],U=!1,H=(0,l.useContext)(y.ConfigContext).allowCallByName,G=s?s.slice(0,3).map((function(e){var n=e.firstName||e.shortName||e.name||"";return e.photo_100?{src:e.photo_100,alt:n,key:e.peerId}:{id:e.peerId,text:n.slice(0,1)}})):[],V=(0,l.useCallback)((function(e){L(e.target.value)}),[]),F=(0,l.useCallback)((function(e){if(n)return U?Promise.resolve():(U=!0,function(e,n,t,a,i,o){if(e)return Promise.resolve(e);return(0,sn.getJoinLinkDetails)(t,!0).then((function(e){var r=e.secret,s=void 0===r?"":r,l=e.user_id,c=void 0===l?0:l,u=e.preview;return(0,sn.getAnonymCallToken)(t,c,a,s).then((function(e){var t,r=e.token,s=e.secret,l=void 0===s?"":s,_={is_dev:rr(o),key:i,token:r,ok_user:c,secret:l,is_anonym:!0,me:{canAddMembers:!1,firstName:a,peerId:c,id:c,sex:"0",shortName:a,name:a,lastName:"",link:"",photo:"",photo_100:"",shortNameGen:""}},v={callPreview:{tab:null==u?void 0:u.title,photo:null===(t=null==u?void 0:u.photo)||void 0===t?void 0:t.photo_200},callsCredentials:_,callsOkStaging:rr(o),callsLogging:!1,CallsIncomingCall:!1,callsAllowBanParticipant:!1,callsFeedbackScreenEnabled:!1,callsVideoSlotsEnabled:!0,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:[{browser:"safari"},{browser:"firefox"}],callsAllowCallByName:!1,callsEnableScreenTrack:!0,callsEnableProducerScreenTrack:!0,callsAllowWaitingHall:!1,callsAllowPushToTalk:!1,callsBadNetwork:!1,callsBadNetworkP2P:!1,callsDesktopAppNotification:!1,callsLazyLoading:!1,callsEnableDomainBender:!1,callsEnableMultipleDevices:!1,callsEnableTranslationSplit:!1,callsEnableNavChangeCallCollapse:!0};return n(v),v}))}))}(M,D,a,w,I,S).then((function(e){return function(e){var n=e.bridge,t=e.inited,a=e.setInited,o=e.data,r=e.onBeforeCallStart,s=e.onAfterCallFinish,l=e.tabIsMaster,c=e.tabIsIdle,d=e.langUtils;return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,u,_,v,p,f,A,g,h,m,C,E,S,T,I,N,x,y,b,O,w,L,k,P,M;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return t?[2,Promise.resolve()]:(e=o.callPreview,u=o.callsCredentials,_=o.callsOkStaging,v=o.callsLogging,p=o.CallsIncomingCall,f=o.callsAllowBanParticipant,A=o.callsFeedbackScreenEnabled,g=o.callsVideoSlotsEnabled,h=o.videoSlotsCount,m=o.browserWarnings,C=o.callsAllowCallByName,E=o.callsEnableScreenTrack,S=o.callsEnableProducerScreenTrack,T=o.callsAllowWaitingHall,I=o.callsAllowPushToTalk,N=o.callsBadNetwork,x=o.callsBadNetworkP2P,y=o.callsDesktopAppNotification,b=o.callsLazyLoading,O=o.callsEnableDomainBender,w=o.callsEnableMultipleDevices,L=o.callsEnableTranslationSplit,k=o.callsEnableNavChangeCallCollapse,P=o.callsCustomScreenSharePacketSize,M=o.callsEnableCustomScreenSharePacketSize,[4,n.init({callPreview:e,callsCredentials:u,imHash:"",callsOkStaging:_,onBeforeCallStart:r,onAfterCallFinish:s,tabIsMaster:l,tabIsIdle:c,langUtils:d,toggles:{debugLog:v,incomingCall:p,allowBanParticipant:f,showFeedbackScreen:A,enableVideoSlots:g,videoSlotsCount:h,browserWarnings:m,allowCallByName:C,enableScreenTrack:E,enableProducerScreenTrack:S,allowWaitingHall:T,allowPushToTalk:I,badNetwork:N,badNetworkP2P:x,desktopAppNotification:y,lazyLoading:b,enableDomainBender:O,enableMultipleDevices:w,enableTranslationSplit:L,enableNavChangeCallCollapse:k,enableCustomScreenSharePacketSize:M,customScreenSharePacketSize:P}})]);case 1:return i.sent(),a(!0),[2]}}))}))}({bridge:A,inited:R,setInited:B,data:e,onBeforeCallStart:v,onAfterCallFinish:p,tabIsMaster:h,tabIsIdle:m,langUtils:N})})).then((function(){return A.joinCallByLink(t,null,e,g,void 0,void 0,a)})).catch((function(e){A.eventHandlers.onError&&e&&A.eventHandlers.onError(e);var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Ve.getTextForApiErrorByCode)(e.error.error_code,!0,x):nr(e,!0,x)||x("calls_unknown_error"),C&&C(n)})).finally((function(){U=!1})));if(f&&f(),!u)throw Error("no peer_id to join");return A.joinCallByLink(t,[u,s],e,g,void 0,void 0,a).catch((function(e){var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Ve.getTextForApiErrorByCode)(e.error.error_code,!0,x):x("calls_unknown_error"),C&&C(n)})),Promise.resolve()}),[t,f,w,M,R,I]),W=(0,l.useCallback)((function(){f&&f()}),[f]),z=(0,l.useMemo)((function(){return(0,wa.escape)((0,wa.decodeHTMLEntities)(r||""))}),[r]),K=(0,l.useCallback)((function(){A.showCallByNamePopup(null,g,t)}),[]),Y=(0,l.useCallback)((function(){A.showStartCallModal(null,t)}),[]),Q=(0,o.jsx)(No,{isAnonym:!!n,name:w,onChangeName:V,namePlaceholder:x("calls_name_placeholder"),title:z,label:(0,Ve.getParticipantsListLabel)(s||[],G,(function(e){return(0,P.isParticipantGroup)(e.peerId)?e.name:e.firstName}),x,b,c),items:G,joinWithVideoText:x("calls_join_with_video"),joinWithAudioText:x("calls_join_with_audio"),onJoinWithVideo:function(){return F(!0)},onJoinWithAudio:function(){return F(!1)},disabled:!!n&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(w),inputDisabled:!!M,callByNameShow:H&&!n,callByNameTitle:x("calls_call_by_name_join_by"),callByNameDescription:"",onCallByNameClick:K,callViaNativeAppShow:!n,callViaNativeAppTitle:x("calls_call_via_native_app_join"),onCallViaNativeAppClick:Y},void 0);return _?(0,o.jsxs)(T.default,(0,i.__assign)({onClose:W},{children:[(0,o.jsx)(xo.ModalHeader,{title:x("calls_invite"),onClose:W},void 0),Q]}),void 0):Q},rr=function(e){return void 0!==e?e:!(!window.vk||void 0===window.vk.isCallsDevEnv)&&window.vk.isCallsDevEnv};var sr=function(e){var n=e.children;return(0,o.jsx)("div",(0,i.__assign)({className:"ErrorPopupText"},{children:n}),void 0)},lr=function(e){var n=e.title,t=e.onClose,a=e.actionButtons,r=e.text;return(0,o.jsx)(En.default,(0,i.__assign)({appearance:"blue",title:n,onClose:t,actionButtons:a,className:"CallError"},{children:(0,o.jsx)(sr,{children:r},void 0)}),void 0)},cr=function(e){var n=e.title,t=e.text,a=e.onCloseFatal,r=e.handleType,s=e.callId,c=e.bridge,_=u(),v=(0,l.useContext)(E.LangContext).getLang,p=function(){switch(_({type:d.E_ACTION.ERROR,isClosed:!0}),r){case d.ErrorHandleType.FATAL:a();break;case d.ErrorHandleType.DECLINE:(0,J.declineCall)().catch((function(){}));break;case d.ErrorHandleType.PROCESS:(0,J.processPush)(s||"").then((function(){(0,J.declineCall)().catch((function(){}))})).catch((function(e){c.debug&&console.error("Delayed by error push process error",e)}))}},f=t||v("calls_error"),A=f.match(/<\s?[a-zA-Z0-9]+\s?\/?>/)?(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:f}},void 0):f;return(0,o.jsx)(lr,{title:n||v("calls_oops"),onClose:p,actionButtons:(0,o.jsx)(Un.default,(0,i.__assign)({onClick:p},{children:v("calls_close")}),void 0),text:A},void 0)},dr=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.title;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:r,appearance:"blue",actionButtons:t,className:"CallExitModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallExitModal__text"},{children:a}),void 0)}),void 0)},ur=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=t.conversationOptions.find((function(e){return"RECURRING"===e})),_=function(){w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:t.callData.callId,peer_id:t.peer,is_group_call:(0,O.isGroupCallByPeer)(t.peer),reason:"none",group_call_users_count:(0,P.getActiveParticipantsCount)(t)})},v=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP})}),[]),p=r(s?"calls_exit_call_disconnect_all":"calls_force_call_finish_v2"),f=r(s?"calls_exit_call_desc":"calls_sure_leave_call_v2");return(0,o.jsx)(dr,{onClose:v,actionButtons:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){a({type:d.E_ACTION.TOGGLE_POPUP}),_(),$a(0,t,a,r)},appearance:"secondary"},{children:p}),"forceCallFinish"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return a({type:d.E_ACTION.TOGGLE_POPUP}),_(),n.hangup()}},{children:r("calls_exit")}),"leave")],description:f,title:r("calls_exit_call")},void 0)},_r=function(e,n){var t=(0,i.__read)((0,l.useState)([0,0]),2),a=(0,i.__read)(t[0],2),o=a[0],r=a[1],s=t[1],c=(0,l.useRef)(new Map);(0,l.useEffect)((function(){var e=function(){return s([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]);var u=Mt(n);(0,l.useEffect)((function(){if(n.mode===d.Mode.CALL){var t=u?function(e,n,t,a){var i=Tt(e,n,t);return i.forEach((function(e,n){var t=a.get(n);!e.stopStream||t&&!t.stopStream||i.delete(n)})),a.forEach((function(e,n){if(!i.has(n)&&!e.stopStream){var t=Nt({externalId:e.uid},e.mediaType);i.set(n,t)}})),i}(n,o,r,c.current):Tt(n,o,r),a=function(e,n){var t=[];return n.forEach((function(n,a){var i=e.get(a);(It(i)||It(n))&&(i&&function(e,n){var t=e,a=n;if(!0===t.stopStream&&!0===a.stopStream)return!0;if(!0===t.stopStream||!0===a.stopStream)return!1;var i=e,o=n;return i.fit===o.fit&&i.width===o.width&&i.height===o.height&&i.priority===o.priority}(i,n)||t.push(n))})),t}(c.current,t);a.length>0&&(c.current=t,e.updateDisplayLayout(a))}else c.current=new Map}),[o,r,n.peer,n.participants,n.devices,n.mode,n.uiMode,n.isOratorMode,n.orator,n.pinnedParticipant,n.adminPinnedParticipant,n.screenSharingPinnedParticipant,n.translation,u])};var vr=function(e){var n=e.isIncoming,t=void 0!==n&&n,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=s(t?"calls_reject_title":"calls_hangup_description"),v=s(t?"calls_reject_description":"calls_hangup_description"),p=(0,l.useCallback)((function(){r({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!1})}),[]),f=function(){p(),t?(0,J.declineCall)().catch((function(){})):((0,J.hangup)().catch((function(){})),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:(0,P.getActiveParticipantsCount)(a)}))},A=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"secondary",onClick:p},{children:s("calls_cancel_reject")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:f},{children:s("calls_reject")}),void 0)]},void 0),g=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:f},{children:s("calls_yes")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:p},{children:s("calls_no")}),void 0)]},void 0);return(0,o.jsx)(lr,{title:_,onClose:p,actionButtons:t?A:g,text:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:v}},void 0)},void 0)},pr=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(En.default,(0,i.__assign)({className:"MuteParticipantModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:t&&(0,o.jsx)("div",(0,i.__assign)({className:"MuteParticipantModal__content"},{children:t}),void 0)}),void 0)};var fr=function(){var e,n,t,a,r=(0,c.useSelector)((function(e){return e})),s=null===(e=r.participantsManagement)||void 0===e?void 0:e.device,_=s&&r.participants[s.externalId.id],v=null!==(t=null===(n=r.participantsManagement)||void 0===n?void 0:n.mode)&&void 0!==t?t:d.ParticipantsManagementMode.SINGLE,p=[d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.ALL_AUDIO].includes(v),f=[d.ParticipantsManagementMode.SINGLE,d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.SINGLE_VIDEO].includes(v),A=(0,P.isSameExternalId)(null==s?void 0:s.externalId,r.externalId)?r.localDevice:_,g=f&&((0,P.isAdmin)(A)||(0,P.isCreator)(A)),h=(0,i.__read)((0,l.useState)(!0),2),m=h[0],C=h[1],S=(0,i.__read)((0,l.useState)(null!==(a=null==_?void 0:_.name)&&void 0!==a?a:""),2),T=S[0],I=S[1],N=u(),x=(0,l.useContext)(E.LangContext).getLang;(0,l.useEffect)((function(){f&&!(0,P.isParticipantAnonym)((null==_?void 0:_.peerId)||0)?(N({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){_&&_.peerId<0?(0,sn.getGroupById)(-_.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch(n):(0,sn.loadUsers)({user_ids:_&&String(_.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)||"")})).catch(n)})).then((function(e){I(e),C(!1),N({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)):C(!1)}),[r.participantsManagement]);var y=function(e){var n=e.callEventType,t=e.sessionId,a=e.peerId,i=e.isGroupCall;return function(e){return w.callStats.logEvent({call_event_type:n,session_id:t,peer_id:a,is_group_call:i,mute_permanent:e})}}({callEventType:f?d.CallActionEventType.USER_MICS_AND_VIDEO_DISABLED:d.CallActionEventType.ALL_MICS_AND_VIDEO_DISABLED,sessionId:r.callData.callId,peerId:r.peer,isGroupCall:(0,O.isGroupCallByPeer)(r.peer)}),b=(0,l.useCallback)((function(){N({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT})}),[]),L=(0,l.useCallback)((function(e,n){!function(e){var n,t,a=e.isAudio,i=e.isSingle,o=e.isPermanent,r=e.participantExternalId,s=e.logEvent,l=e.closeDialog,c=o?J.MuteState.MUTE_PERMANENT:J.MuteState.MUTE,d=a?((n={})[J.MediaOption.AUDIO]=c,n):((t={})[J.MediaOption.VIDEO]=c,t[J.MediaOption.SCREEN_SHARING]=c,t);(0,J.muteParticipant)(i?r:null,d).catch(console.log).finally(l),s(o?Ja.CallStatMuteType.ONCE:Ja.CallStatMuteType.PERMANENT)}({isAudio:p,isSingle:f,isPermanent:e,participantExternalId:n,logEvent:y,closeDialog:b})}),[p,f,y,b]),k=(0,l.useCallback)((function(){L(!0,f&&s?s.externalId:null)}),[L]),M=(0,l.useCallback)((function(){L(!1,f&&s?s.externalId:null)}),[L]),D=(0,l.useMemo)((function(){switch(v){case d.ParticipantsManagementMode.SINGLE_AUDIO:return x("calls_mute_participant_dialog_title_audio").replace("{name}",T);case d.ParticipantsManagementMode.SINGLE_VIDEO:return x("calls_mute_participant_dialog_title_video").replace("{name}",T);case d.ParticipantsManagementMode.ALL_AUDIO:return x("calls_mute_all_participants_dialog_title_audio");case d.ParticipantsManagementMode.ALL_VIDEO:return x("calls_mute_all_participants_dialog_title_video");default:return""}}),[v,T]);return f&&m?null:(0,o.jsx)(pr,{title:D,onClose:b,actionButtons:(0,o.jsxs)(o.Fragment,{children:[!g&&(0,o.jsx)(Un.default,(0,i.__assign)({onClick:k,appearance:"secondary"},{children:x("calls_mute_participant_permanent_dialog_action")}),"mute_permanent"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:M},{children:x("calls_mute_participant_dialog_action")}),"mute")]},void 0)},void 0)};var Ar,gr=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(En.default,(0,i.__assign)({className:"UnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},hr=function(e){var n=e.SDK,t=e.withVideo,a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=(0,c.useSelector)((function(e){return e})),_=s.localDevice,v=_.mediaSettings,p=function(){a({type:d.E_ACTION.TOGGLE_POPUP})},f=function(){var e=_.mediaSettings;(null==e?void 0:e.isAudioEnabled)||(v.isAudioEnabled?Promise.resolve():Be(n,[J.MediaOption.AUDIO])).then((function(){var e;(null===(e=s.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&a({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)}))},A=function(){f(),p()},g=function(){var e;f(),(null==(e=_.mediaSettings)?void 0:e.isVideoEnabled)||(null==e?void 0:e.isScreenSharingEnabled)||(!v.isVideoEnabled||v.isScreenSharingEnabled?Be(n,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){n.toggleLocalVideo(!0).catch(console.log)})),p()},h=(0,l.useMemo)((function(){return t?[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:A,appearance:"secondary"},{children:r("calls_dialog_unmute_request_mic_only_action")}),"mic"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:g},{children:r("calls_dialog_unmute_request_action")}),"all")]:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:A},{children:r("calls_dialog_unmute_request_mic_action")}),"mic")]}),[t]);return(0,o.jsx)(gr,{onClose:p,title:r(t?"calls_dialog_unmute_request_audio_and_video_title":"calls_dialog_unmute_request_audio_title"),description:r(t?"calls_dialog_unmute_request_audio_and_video_description":"calls_dialog_unmute_request_audio_description"),actionButtons:h},void 0)},mr=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(En.default,(0,i.__assign)({className:"AssignAdminModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AssignAdminModal__content"},{children:t}),void 0)}),void 0)},Cr=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e.adminAssignment?e.participants[e.adminAssignment.participant.peerId]:void 0})),a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,i.__read)((0,l.useState)(!0),2),_=s[0],v=s[1],p=(0,i.__read)((0,l.useState)(""),2),f=p[0],A=p[1],g=(0,l.useContext)(E.LangContext).getLang;(0,l.useEffect)((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){t&&t.peerId<0?(0,sn.getGroupById)(-t.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch((function(e){return n(e)})):(0,sn.loadUsers)({user_ids:t&&String(t.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)+" "+(null==t?void 0:t.last_name))})).catch((function(e){return n(e)}))})).then((function(e){A(e),v(!1),r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)}),[t]);var h=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT})}),[]),m=(0,l.useCallback)((function(){var e=(0,P.getParticipantExternalId)(t);e?(n.grantRoles(e,[J.UserRole.ADMIN],!1).then((function(){t&&r({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:t.peerId,data:t.roles?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.roles),!1),[J.UserRole.ADMIN],!1):[J.UserRole.ADMIN]})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASSIGN_ADMIN,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer)}),h()):h()}),[]);return _?null:(0,o.jsx)(mr,{onClose:h,title:g("calls_dialog_assign_admin_role_title"),description:g("calls_dialog_assign_admin_role_description").replace("{name}",f),actionButtons:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:h,appearance:"secondary"},{children:g("calls_dialog_assign_admin_role_action_later")}),"cancel"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:m},{children:g("calls_dialog_assign_admin_role_action_primary")}),"primary")]},void 0)},Er=t(92110),Sr="wakeLock"in navigator&&!0,Tr=null,Ir=!1,Nr=function(){null!==Tr&&"visible"===document.visibilityState&&yr()},xr=function(){var e,n,t,a;Ar||((Ar=document.createElement("video")).setAttribute("title","Wake lock"),Ar.setAttribute("playsinline",""),e=Ar,n="mp4",t="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA=",(a=document.createElement("source")).src=t,a.type="video/"+n,e.appendChild(a),Ar.addEventListener("loadedmetadata",(function(){Ar&&Ar.addEventListener("timeupdate",(function(){Ar&&Ar.currentTime>.5&&(Ar.currentTime=Math.random())}))}))),Ar.play().catch((function(){}))};function yr(){if(!Sr)return xr();Ir||(Ir=!0,document.addEventListener("visibilitychange",Nr));try{navigator.wakeLock.request("screen").then((function(e){(Tr=e).addEventListener("release",(function(){}))}))}catch(e){console.error(e.name+", "+e.message)}}function br(){Sr?Tr&&Tr.release().then((function(){Tr=null})):Ar&&Ar.pause()}var Or=t(73947);function wr(e){var n=e.onClose,t=e.onSubmit,a=e.title,r=e.children,s=e.isWithBackButton,c=e.onBackClick,d=e.contentClassName,u=void 0===d?"TranslationCreateModal__content":d,_=e.isRecord,v=(0,l.useContext)(E.LangContext).getLang,p=n&&t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:v("calls_cancel")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:t},{children:v(_?"calls_record_start":"calls_translation_start")}),void 0)]},void 0);return(0,o.jsx)(En.default,(0,i.__assign)({className:"TranslationCreateModal",title:a,onClose:n,backText:s?v("calls_back"):void 0,onBack:c,actionButtons:p},{children:(0,o.jsx)("div",(0,i.__assign)({className:u},{children:l.Children.toArray(r).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)}var Lr,kr,Pr=t(28581),Mr=t(21086),Dr=t(31897);function jr(e){var n=e.onSubmit,t=e.onClose,a=e.isRecord,r=(0,l.useContext)(E.LangContext),s=r.getLang,d=r.langShortDateTime,u=(0,c.useSelector)((function(e){return e})),_=function(){var e=(new Date).toISOString().split("T")[0];return s("calls_translation_title_default_value").replace("%s",e)},v=function(e,n,t){return void 0===n&&(n=""),void 0===t&&(t=""),{id:e,name:n,photo:t,isGroup:e<0}},p=function(e){var n=[{value:Lr.ONLY_ME,label:s("calls_translation_privacy_only_me_and_chat")},{value:Lr.FRIENDS,label:s("calls_translation_privacy_friends_and_chat")}];return e&&n.push({value:Lr.ALL,label:s("calls_translation_privacy_all_users")}),n},f=u.participants[u.me],A=u.config,g=(0,i.__read)((0,l.useState)(_()),2),h=g[0],m=g[1],C=(0,i.__read)((0,l.useState)(""),2),S=C[0],T=C[1],I=(0,i.__read)((0,l.useState)(u.groupId?Lr.ALL:Lr.ONLY_ME),2),N=I[0],x=I[1],y=(0,i.__read)((0,l.useState)((function(){return p(!f.isClosed||!!u.groupId)})),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)((function(){var e,n;return u.groupId?v(u.groupId,null===(e=u.meGroup)||void 0===e?void 0:e.name,null===(n=u.meGroup)||void 0===n?void 0:n.photo):v(f.peerId,f.name,f.photo)})),2),L=w[0],k=w[1],P=(0,i.__read)((0,l.useState)(kr.MAIN),2),M=P[0],D=P[1],j=(0,i.__read)((0,l.useState)({}),2),R=j[0],B=j[1],U=(0,i.__read)((0,l.useState)((function(){return u.groupId&&u.meGroup?[{value:u.meGroup.peerId,label:u.meGroup.name}]:[{value:f.peerId,label:f.name}]})),2),H=U[0],G=U[1],V=(0,i.__read)((0,l.useState)([]),2),F=V[0],W=V[1],z=(0,i.__read)((0,l.useState)(!1),2),K=z[0],Y=z[1],Q=(0,i.__read)((0,l.useState)([]),2),Z=Q[0],J=Q[1],X=(0,i.__read)((0,l.useState)([]),2),q=X[0],$=X[1],ee=(0,l.useCallback)((function(){var e=h.trim(),t=S.trim(),a={};if(Object.keys(R).length>0){e||(e=R.title),t||(t=R.description);var i=t!=R.title||e!=R.description;i||(i=L.id>0&&R.privacy_view.category!=N),i&&(0,sn.sendVideoEdit)(L.id,R.id,e,t,N).catch((function(e){return console.error(e)}));var o={ovId:R.ov_id};R.live_start_time&&(o.startTime=R.live_start_time),a.upcomingStreamParams=o}else a.streamParams={name:e||_(),description:t,privacy_view:N,group_id:L.id<0?-L.id:0,call:1};n(a)}),[h,S,N,L,R]);(0,l.useEffect)((function(){if(!u.groupId)try{(0,sn.getGroupsForStreaming)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(H),!1);e.length>0&&(e.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),G(n),W(e))})).catch(console.error)}catch(e){console.log(e)}}),[]),(0,l.useEffect)((function(){B({}),Y(!1),J([]),(0,sn.getUpcomingLives)([L.id]).then((function(e){var n=[];e.count>0&&(n=e.items.filter((function(e){return""!==e.ov_id})));var t=n.length>0;if(Y(t),J(n),t){var a=[];n.forEach((function(e){e.owner_id&&e.owner_id>0&&a.push(e.owner_id.toString())})),a&&(0,sn.loadUsers)({user_ids:a.join(",")}).then((function(e){var n=[];e.forEach((function(e){n.push({id:e.id,name:e.first_name+" "+e.last_name})})),$(n)})).catch((function(e){return console.error(e)}))}})).catch((function(e){return console.error(e)}))}),[L]);var ne=function(e){var n=e.date;e.live_start_time&&(n=e.live_start_time);var t=n-Date.now()/1e3;return t>0&&t<rn.WEEK?s("calls_translation_date_label_soon"):""},te=function(e){if(!(e>0))return L.name;var n=q.filter((function(n){return n.id==e}));if(n.length>0){var t=n[0];if(t)return t.name}return""};return(0,o.jsxs)(o.Fragment,{children:[M===kr.MAIN&&(0,o.jsxs)(wr,(0,i.__assign)({onClose:t,onSubmit:ee,title:s(a?"calls_record_box_title":"calls_translation_box_title"),isRecord:a},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__link"},{children:[(0,o.jsxs)(Tn.default,{children:[!!H.length&&(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(Nn.ListIcon,{icon:(0,o.jsx)("img",{className:"TranslationCreateForm__ownerIcon",src:L.photo,alt:L.name},void 0),color:Nn.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(uo.default,{className:"TranslationCreateFormOptions__longselect",options:H,value:L.id,onChange:function(e){var n=e.selected.value;n<0?F.forEach((function(e){e.id==-n&&(x(Lr.ALL),O(p(!0)),k(v(-e.id,e.name,e.photo_100)))})):(O(p(!f.isClosed)),x(Lr.ONLY_ME),k(v(f.peerId,f.name,f.photo)))},disabled:H.length<=1},void 0)},{children:s(a?"calls_record_owner_title":"calls_translation_owner_title")}),void 0),K&&!a&&(0,o.jsxs)(In.default,(0,i.__assign)({onClick:function(){K&&D(kr.SELECT_POSTPONE)},chevron:!0,border:!0,icon:(0,o.jsx)(Nn.ListIcon,{icon:(0,o.jsx)(Mr.TimeIcon,{},void 0),color:Nn.ListIconColors.GREEN},void 0)},{children:[s("calls_translation_postponed_title"),Object.keys(R).length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__copyControl"},{children:(0,o.jsx)(Dr.default,(0,i.__assign)({className:"TranslationCreateForm__copyButton",onClick:function(e){e.preventDefault(),e.stopPropagation(),B({}),m(_()),T("")}},{children:s("calls_translation_postponed_reset")}),void 0)}),void 0)]}),void 0),!A.sferum&&(0,o.jsx)(In.default,(0,i.__assign)({border:!1,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(Nn.ListIcon,{icon:(0,o.jsx)(Pr.PrivacyIcon,{},void 0),color:Nn.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(uo.default,{className:"TranslationCreateForm__privacySelector TranslationCreateFormOptions__longselect",disabled:L.isGroup,options:b,value:N,onChange:function(e){x(e.selected.value)}},void 0)},{children:s("calls_translation_who_can_see_video_privacy")}),void 0)]},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__privacyHint"},{children:s(a?"calls_record_who_can_see_video_privacy_hint":"calls_translation_who_can_see_video_privacy_hint")}),void 0)]}),void 0),(0,o.jsxs)("form",(0,i.__assign)({className:"TranslationCreateForm__main",onSubmit:ee},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__section"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_title"),(0,o.jsx)(On.default,{className:"TranslationCreateForm__field",value:h,onChange:function(e){var n=e.target;m(n.value)},placeholder:s("calls_translation_name_placeholder")},void 0)]}),void 0)}),void 0),!a&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_description"),(0,o.jsx)(Or.default,{className:"TranslationCreateForm__field",placeholder:s("calls_translation_description_placeholder"),value:S,onChange:function(e){var n=e.target;T(n.value)}},void 0)]}),void 0)}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__tabSection"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__warning"},{children:s(a?"calls_record_notification_warning":"calls_translation_notification_warning")}),void 0)}),void 0)]}),void 0)]}),void 0),M===kr.SELECT_POSTPONE&&(0,o.jsx)(wr,(0,i.__assign)({title:s("calls_translation_select_upcoming_box_title"),isWithBackButton:!0,onBackClick:function(){return D(kr.MAIN)},onClose:t,contentClassName:"TranslationCreateForm__modalVideo"},{children:(0,o.jsx)("div",{children:Z.length>0&&(0,o.jsx)(Tn.default,(0,i.__assign)({className:"TranslationCreateForm__VideoList"},{children:Z.map((function(e,n){return(0,o.jsxs)(In.default,(0,i.__assign)({className:"TranslationCreateForm__videoItem",active:e.id===R,border:!0,canBeHovered:!0,selectable:!0,onClick:function(){return(n=e).owner_id>0&&(0,sn.getVideos)(n.owner_id,[n.owner_id+"_"+n.id],!0).then((function(e){if(e.count>0){var t=e.items.filter((function(e){return e.id==n.id}));t.length>0&&(n.privacy_view=t[0].privacy_view,B(n),n.privacy_view&&x(n.privacy_view.category))}})),B(n),D(kr.MAIN),m(n.title),void T(n.description);var n},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoLink"},{children:s("calls_translation_select_video_link")}),void 0)},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoImagePreview"},{children:[(0,o.jsx)("img",{className:"TranslationCreateForm__videoImage",src:e.image&&e.image[0]&&e.image[0].url?e.image[0].url:"",alt:e.title},void 0),ne(e)&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoImageLabel"},{children:ne(e)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDescription"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoTitle"},{children:e.title}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoOwner"},{children:te(e.owner_id)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDate"},{children:(t=e,a=t.date,t.live_start_time&&(a=t.live_start_time),d(1e3*a))}),void 0)]}),void 0)]}),n);var t,a}))}),void 0)},void 0)}),void 0)]},void 0)}!function(e){e.ONLY_ME="only_me",e.FRIENDS="friends",e.ALL="all"}(Lr||(Lr={})),function(e){e[e.MAIN=0]="MAIN",e[e.SELECT_POSTPONE=1]="SELECT_POSTPONE"}(kr||(kr={}));var Rr=function(e){var n,t=e.isRecord,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP})}),[]),v=ln(a),p=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]),f=(0,l.useCallback)((function(e){var n,a;if(null==e?void 0:e.upcomingStreamParams){var i=e.upcomingStreamParams,o=i.startTime,s=i.ovId;if(o&&o>Date.now()/1e3+4)return Ct(s,t).finally(_)}var l={isOn:!1,startStreamParams:e,isRecord:t,name:null===(n=e.streamParams)||void 0===n?void 0:n.name};return t&&(null===(a=l.startStreamParams)||void 0===a?void 0:a.streamParams)&&(l.startStreamParams.streamParams.is_call_record=1),r({type:d.E_ACTION.SET_TRANSLATION,data:l}),r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN}),Promise.resolve()}),[t]),A=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}),[]);return(null===(n=a.translation)||void 0===n?void 0:n.isOn)?(0,o.jsx)(Sn,(0,i.__assign)({title:s("calls_translation_menu_title"),actionButtons:v?[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:p,appearance:"negative"},{children:s("calls_translation_menu_stop")}),"stop")]:[],onCloseModal:_},{children:(0,o.jsx)(bn,{isLinkBlockShown:!0,linkBlockTitle:s("calls_translation_menu_link"),onLinkBlockClick:A,callUrlLink:a.translation.link},void 0)}),void 0):(0,o.jsx)(jr,{onSubmit:f,onClose:_,isRecord:t},void 0)},Br=function(e){var n=e.onClose,t=e.actionButtons,a=e.isRecord,r=(0,ue.useLang)().getLang,s=r(a?"calls_record_stop_confirmation":"calls_translation_stop_confirmation"),l=r(a?"calls_record_stop_sure":"calls_translation_stop_sure");return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:s,appearance:"blue",actionButtons:t,className:"TranslationStopModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStopModal__text"},{children:l}),void 0)}),void 0)},Ur=function(){var e=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=k((function(e){return e.translation.isRecord})),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return{dispatch:e,getLang:n,isRecord:t,onClose:a}}(),n=e.dispatch,t=e.getLang,a=e.isRecord,r=e.onClose;return(0,o.jsx)(Br,{onClose:r,actionButtons:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:r,appearance:"secondary"},{children:t("calls_cancel")}),"cancel"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){(0,sn.stopVideoStream)().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:t("calls_translation_stop")}),"stop")],isRecord:a},void 0)};var Hr=function(e){var n=e.link,t=(0,l.useContext)(E.LangContext).getLang,a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=(0,l.useCallback)((function(){return s(!0)}),[]),d=(0,l.useCallback)((function(){return s(!1)}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"TranslationLink__info"},{children:t("calls_translation_link_info")}),void 0),(0,o.jsx)(On.default,{readOnly:"readonly",className:"TranslationLink__input",value:n},void 0),n&&(0,o.jsx)(oi.CopyText,(0,i.__assign)({text:n,onCopyDone:c},{children:(0,o.jsx)(Un.default,{children:t("calls_translation_link_copy")},void 0)}),void 0),(0,o.jsx)(wn.default,(0,i.__assign)({className:"TranslationLink__copied",shown:r,callback:d},{children:t("calls_translation_link_copied")}),void 0)]}),void 0)},Gr=function(e){var n,t=e.onBack,a=e.link,r=e.linkExtractor,s=u(),_=(0,l.useContext)(E.LangContext).getLang,v=(0,c.useSelector)((function(e){return e.translation})),p=(0,l.useCallback)((function(){s({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return(0,o.jsx)(Sn,(0,i.__assign)({title:_("calls_translation_link"),onCloseModal:p,isWithBackButton:!!t,onBackClick:t},{children:(0,o.jsx)(Hr,{link:null!==(n=null==r?void 0:r(v))&&void 0!==n?n:a},void 0)}),void 0)},Vr=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(En.default,(0,i.__assign)({className:"AdminPinUnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AdminPinUnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},Fr=function(e){var n=e.SDK,t=u(),a=(0,l.useContext)(E.LangContext).getLang,r=(0,c.useSelector)((function(e){return e})),s=r.localDevice.mediaSettings,_=function(){t({type:d.E_ACTION.TOGGLE_POPUP})};return(0,o.jsx)(Vr,{onClose:_,title:a("calls_admin_pin_dialog_title"),description:a("calls_admin_pin_dialog_description"),actionButtons:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:_,appearance:"secondary"},{children:a("calls_admin_pin_dialog_cancel")}),"cancel"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){(s.isAudioEnabled?Promise.resolve():Be(n,[J.MediaOption.AUDIO])).then((function(){var e;(null===(e=r.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&t({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)})).then((function(){return _()}))}},{children:a("calls_admin_pin_dialog_action")}),"mic")]},void 0)},Wr=function(e){var n=e.participants,t=e.selected,a=e.onSelect,r=e.onClose,s=e.onCallForceFinish,c=e.onRightsTransfer,d=e.onSearch,u=e.isCreator,_=(0,ue.useLang)().getLang,v=k((function(e){return e.me})),p=(0,l.useMemo)((function(){return n.filter((function(e){return e.peerId!==v}))}),[n,v]);return(0,o.jsx)(Sn,(0,i.__assign)({title:_("calls_dialog_creator_exit_title"),onCloseModal:r,actionButtons:(0,o.jsxs)(o.Fragment,{children:[u&&(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"secondary",onClick:s},{children:_("calls_force_call_finish")}),"force"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:c},{children:_(null===t?"calls_leave_call":"calls_dialog_creator_exit_action")}),"action")]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TransferAdminRightsModal__content"},{children:[(0,o.jsx)(On.default,{onChange:function(e){return d(e.target.value)},placeholder:_("calls_search_participants_placeholder"),className:"TransferAdminRightsModal__searchInput"},void 0),(0,o.jsxs)(Tn.default,(0,i.__assign)({border:!1},{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:p.length},{children:_("calls_call_participants")}),void 0),!p.length&&(0,o.jsx)(Re.default,{children:_("calls_participants_not_found")},void 0),p.map((function(e){return(0,o.jsx)(In.default,(0,i.__assign)({className:"TransferAdminRightsModal__item",onClick:function(){return a(t!==e.peerId?e:null)},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TransferAdminRightsModal__label","aria-selected":t===e.peerId},{children:t===e.peerId?_("calls_dialog_creator_exit_selected"):_("calls_dialog_creator_exit_select")}),void 0)},{children:(0,o.jsx)(Bn.default,{size:"34",title:e.name,photo:e.photo},void 0)}),e.peerId)}))]}),void 0)]}),void 0)}),void 0)},zr=function(e){var n=e.SDK,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,s=(0,i.__read)((0,l.useState)((function(){var e=(0,Ve.objectFilter)(a.participants,(function(e){return e.peerId===a.me||!(0,P.isParticipantAnonym)(e.peerId)&&(0,P.someDeviceByParticipant)(e,(function(e){return e.status===J.ParticipantStatus.CONNECTED}))}));return e})),2),_=s[0],v=s[1],p=(0,i.__read)((0,l.useState)(null),2),f=p[0],A=p[1],g=(0,l.useCallback)((function(e){return e.name}),[]),h=(0,l.useCallback)((function(e){return e.peerId}),[]),m=x(_,g,h),C=(0,l.useMemo)((function(){return(0,P.getActiveParticipantsCount)(a)}),[a.participants]),S=function(){return w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,O.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:C})},T=(0,l.useMemo)((function(){return(0,P.isCreator)(a.localDevice)}),[a.localDevice]),I=(0,l.useCallback)((function(e){v(e?m.search(e):m.list),A(null)}),[a]),N=function(){t({type:d.E_ACTION.TOGGLE_POPUP})},y=function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup().catch(console.log)},b=(0,l.useCallback)((function(e){A(null===e?null:e.peerId)}),[]);return(0,l.useEffect)((function(){f&&!_.find((function(e){return e.peerId===f}))&&A(null)}),[f]),(0,o.jsx)(Wr,{participants:_,onClose:N,onSelect:b,selected:f,onCallForceFinish:function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup(),$a(0,a,t,r)},onRightsTransfer:function(){if(null!==f){var e=(0,P.getParticipantExternalId)(a.participants[f]);e&&(n.grantRoles(e,[J.UserRole.ADMIN],!1).then((function(){return y()})).catch(console.log),N())}else y()},onSearch:I,isCreator:T},void 0)},Kr=function(e){var n=e.onCloseModal,t=e.counter,a=e.onStopTranslation,r=e.isRecord,s=(0,l.useContext)(E.LangContext).getLang,c=s(r?"calls_record_cancel_button":"calls_translation_cancel_button");return(0,o.jsx)(T.default,(0,i.__assign)({disableBackdropClick:!0,disableEscapeClose:!0,className:"TranslationStartCountdownModal",onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__counter"},{children:t}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({className:"TranslationStartCountdownModal__stop",onClick:a,appearance:"overlay_secondary"},{children:c}),void 0)]}),void 0)}),void 0)};function Yr(){var e=u(),n=k((function(e){return e})),t=(0,i.__read)((0,l.useState)(3),2),a=t[0],r=t[1],s=k((function(e){return e.translation.isRecord})),c=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]),_=(0,l.useCallback)((function(){var e,t=null===(e=n.translation)||void 0===e?void 0:e.startTime;t&&t>=Date.now()&&(0,sn.stopVideoStream)(),c()}),[]);return(0,l.useEffect)((function(){var e=setInterval((function(){return r(a-1)}),rn.SECOND_JS);return function(){return clearInterval(e)}}),[a]),(0,l.useEffect)((function(){var e,t;if(a<=0){var i=null===(e=n.translation)||void 0===e?void 0:e.startStreamParams;(null==i?void 0:i.streamParams)?(t=i.streamParams,(0,sn.videoStartStreaming)(t).then((function(e){return(0,J.startStream)(!!t.is_call_record,null,String(e.stream.ov_id))})).catch((function(e){(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)}))):(null==i?void 0:i.upcomingStreamParams)&&Ct(i.upcomingStreamParams.ovId),c()}}),[a]),(0,o.jsx)(Kr,{onCloseModal:c,counter:a,onStopTranslation:_,isRecord:s},void 0)}var Qr,Zr=function(e){var n=e.onClose,t=e.actionButtons,a=e.onAllowReconnectChange,r=e.description,s=e.allowBan,c=e.banText,d=(0,l.useContext)(E.LangContext).getLang,u=(0,l.useContext)(y.ConfigContext).allowBanParticipant,_=(0,i.__read)((0,l.useState)(!0),2),v=_[0],p=_[1],f=(0,l.useCallback)((function(e,n){a&&a(n),p(n)}),[]);return(0,o.jsx)(En.default,(0,i.__assign)({className:"KickParticipantModal",appearance:"blue",title:d("calls_kick_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"KickParticipantModal__content"},{children:[r,u&&s&&(0,o.jsx)("div",{children:(0,o.jsx)(vo.default,(0,i.__assign)({className:"KickParticipantModal__checkbox",onChange:f,checked:v},{children:c}),void 0)},void 0)]}),void 0)}),void 0)},Jr=function(){var e,n=u(),t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langSex,s=k((function(e){return e.waitingHall})),c=k((function(e){var n;return null===(n=e.participantKick)||void 0===n?void 0:n.participant})),_=k((function(e){var n;return(null===(n=e.participantKick)||void 0===n?void 0:n.type)===d.KickParticipantType.CALL})),v=k((function(e){return e.callData.conversation})),p=(0,i.__read)((0,l.useState)(!0),2),f=p[0],A=p[1],g=!!c&&(!(0,P.participantIsAdmin)(c)&&!(0,P.participantIsChatAdmin)(c,v)),h=(0,l.useCallback)((function(){n({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK})}),[]),m=(0,l.useCallback)((function(){(0,P.kickParticipant)(c,!f).then((function(){!_&&s&&(null==c?void 0:c.peerId)&&Wn(null==c?void 0:c.peerId,s,n)})),h()}),[c,f,s]),C=(0,l.useCallback)((function(e){A(e)}),[]),S=_?"calls_kick_participant_text":"calls_kick_participant_from_waiting_hall_text",T=r(null==c?void 0:c.sex,S,a(S,!0)).replace("{user}",null!==(e=null==c?void 0:c.name)&&void 0!==e?e:""),I=a(_?"calls_kick_participant_kick_button_text":"calls_kick_participant_from_waiting_hall_button_text"),N=a(_?"calls_kick_participant_with_ban_setting":"calls_kick_participant_from_waiting_hall_with_ban_setting");return(0,o.jsx)(Zr,{onClose:h,onAllowReconnectChange:C,description:T,allowBan:g,banText:N,actionButtons:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:h,appearance:"secondary"},{children:a("calls_cancel")}),"cancel"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:m},{children:I}),"stop")]},void 0)},Xr=function(e){var n=e.title,t=e.children,a=e.sendButtonClick,r=e.skipButtonClick,s=e.sendButtonDisabled,c=void 0===s||s,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen"},{children:[(0,o.jsx)("div",{className:"FeedbackScreen__close",onClick:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__title"},{children:n}),void 0),t,(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__actions"},{children:[(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"overlay_secondary",onClick:r},{children:d("calls_feedback_skip")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"overlay_primary",onClick:a,disabled:c},{children:d("calls_feedback_send")}),void 0)]}),void 0)]}),void 0)},qr=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 19.2l5.7 3.5a.2.2 0 00.3-.3L18.4 16l5.1-4.3a.2.2 0 00-.1-.4l-6.7-.5-2.5-6.1a.2.2 0 00-.4 0l-2.5 6.1-6.7.5a.2.2 0 00-.1.4l5 4.3L8 22.4a.2.2 0 00.3.3zm0 2.3l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4z"},void 0)}),void 0)},$r=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 21.5l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4L14 21.5z"},void 0)}),void 0)};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADVANCE=1]="ADVANCE"}(Qr||(Qr={}));var es=function(e){var n=e.onSuccessFeedback,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,_=(0,i.__read)((0,l.useState)(Qr.DEFAULT),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(!0),2),A=f[0],g=f[1],h=(0,i.__read)((0,l.useState)(!1),2),m=h[0],C=h[1],S=new Map([["DID_NOT_HEAR_INTERLOCUTOR",r("calls_feedback_reason_did_not_hear_interlocutor")],["DID_NOT_SEE_INTERLOCUTOR",r("calls_feedback_reason_did_not_see_interlocutor")],["BAD_VIDEO_QUALITY",r("calls_feedback_reason_bad_video_quality")],["VIDEO_FREEZES",r("calls_feedback_reason_video_freezes")],["VERY_QUIET_SOUND",r("calls_feedback_reason_very_quiet_sound")],["BAD_SOUND_QUALITY",r("calls_feedback_reason_bad_sound_quality")],["SOUND_DID_NOT_MATCH_THE_VIDEO",r("calls_feedback_reason_sound_did_not_match_the_video")],["FAILED_TO_TURN_ON_CAMERA_OR_MICROPHONE",r("calls_feedback_reason_failed_to_turn_on_camera_or_microphone")]]),T=(0,i.__read)((0,l.useState)({user_response:0,feedback:[],custom_feedback:void 0}),2),I=T[0],N=T[1],x=(0,i.__read)((0,l.useState)(Array.from(S,(function(e){return{name:(0,i.__read)(e,1)[0],checked:!1}}))),1),y=x[0],L=function(){t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},k=function(e){var n=e.target.getAttribute("data-response");if(n){var t=parseInt(n,10);t<=3&&p(Qr.ADVANCE),N((0,i.__assign)((0,i.__assign)({},I),{user_response:t})),g(!1)}},P=function(e,n){y.forEach((function(t){t.name===e&&(t.checked=n)})),N((function(e){return(0,i.__assign)((0,i.__assign)({},e),{feedback:y.filter((function(e){return e.checked})).map((function(e){return e.name}))})}))},M=function(e,n){C(n)},D=function(e){N((0,i.__assign)((0,i.__assign)({},I),{custom_feedback:e.currentTarget.value}))};return(0,o.jsx)(b,(0,i.__assign)({onClose:L,onBackdropClick:L},{children:(0,o.jsx)("section",(0,i.__assign)({className:"Call"},{children:(0,o.jsx)(Xr,(0,i.__assign)({title:v===Qr.DEFAULT?r("calls_feedback_default_title"):r("calls_feedback_advance_title"),sendButtonClick:function(){var e=(a.lastCallData?a.lastCallData.peerId:0)||0;w.callStats.logEvent({call_event_type:d.CallActionEventType.USER_FEEDBACK_RECEIVED,session_id:a.lastCallData?a.lastCallData.callId:"",peer_id:e,is_group_call:(0,O.isGroupCallByPeer)(e),user_response:I.user_response,feedback:I.feedback,custom_feedback:m&&I.custom_feedback?I.custom_feedback:void 0}),t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),n&&n()},skipButtonClick:L,sendButtonDisabled:A},{children:v===Qr.DEFAULT?(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__stars",onClick:k},{children:[1,2,3,4,5].map((function(e,n){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("FeedbackScreen__star",{"FeedbackScreen__star--active":e<=I.user_response}),"data-response":e},{children:[(0,o.jsx)(qr,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--outline"},void 0),(0,o.jsx)($r,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--filled"},void 0)]}),n)}))}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__voting"},{children:[Array.from(S,(function(e){var n=(0,i.__read)(e,2),t=n[0],a=n[1];return(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem"},{children:(0,o.jsx)(vo.default,(0,i.__assign)({name:t,className:"FeedbackScreen__votingItemCheckbox",onChange:P},{children:a}),void 0)}),t)})),(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem FeedbackScreen__votingItem--custom"},{children:[(0,o.jsx)(vo.default,{name:"CUSTOM_FEEDBACK",className:"FeedbackScreen__votingItemCheckbox",onChange:M},void 0),(0,o.jsx)(Or.default,{className:"FeedbackScreen__votingItemTextArea",placeholder:r("calls_feedback_custom_reason_placeholder"),grow:!1,disabled:!m,onChange:D},void 0)]}),void 0)]}),void 0)}),void 0)}),void 0)}),void 0)},ns=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.subDescription,s=e.avatarsItems,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({className:"UnbanMembersModal",appearance:"blue",title:c("calls_unban_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"UnbanMembersModal__content"},{children:[(0,o.jsx)(Eo.AvatarsStack,{items:s},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__description"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__subDescription"},{children:r}),void 0)]}),void 0)}),void 0)},ts=function(e){var n,t=e.SDK,a=u(),r=(0,l.useContext)(E.LangContext),s=r.getLang,_=r.langNumeric,v=r.langSex,p=(0,c.useSelector)((function(e){return e})),f=(0,P.participantIsAdmin)(p.localDevice),A=null===(n=p.membersUnban)||void 0===n?void 0:n.members,g=(0,l.useCallback)((function(){a({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:null})}),[]),h=(0,l.useCallback)((function(){null==A||A.forEach((function(e){t.addParticipant(String(e.id),{unban:!0})})),g()}),[p.membersUnban]);if(!A||0===A.length)return(0,o.jsx)(o.Fragment,{},void 0);var m=null==A?void 0:A.length,C=_(m,"calls_unban_participant_text",s("calls_unban_participant_text",!0)),S="",T=[];if(1===m){var I=A[0];S=v(I.sex,"calls_unban_participant_description_text_one_person",s("calls_unban_participant_description_text_one_person",!0)).replace("{user}",I.name),T.push((0,Vn.getMemberForUserStack)(I))}else{var N=[A[0].name,A[1].name];T=A.slice(0,2).map((function(e){return(0,Vn.getMemberForUserStack)(e)}));if(m<=3)3===m&&(N.push(A[2].name),T.push((0,Vn.getMemberForUserStack)(A[2]))),S=s("calls_unban_participant_description_text_two_persons").replace("{users}",N.join(", "));else{var x=m-2;S=_(x,"calls_unban_participant_description_text_more_persons",s("calls_unban_participant_description_text_more_persons",!0)).replace("{users}",N.join(", ")).replace("{users_count}",x),T.push({id:x,text:"+"+x})}}var y=f?[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:g,appearance:"secondary"},{children:s("calls_unban_participant_cancel_button_text")}),"cancel"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:h},{children:s("calls_unban_participant_ok_button_text")}),"stop")]:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:g},{children:s("calls_unban_participant_disallowed_button_text")}),"cancel")];return(0,o.jsx)(ns,{onClose:g,description:C,subDescription:S,actionButtons:y,avatarsItems:T},void 0)};const as=(0,X.makeIcon)("Icon28DownloadOutline","download_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="download_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M21 22a1 1 0 1 1 0 2H7a1 1 0 0 1 0-2h14ZM14 2a1 1 0 0 1 1 1v13.585l5.293-5.292a1 1 0 0 1 1.414 1.414l-7 7a1 1 0 0 1-1.414 0l-7-7a1 1 0 0 1 1.414-1.414L13 16.585V3a1 1 0 0 1 1-1Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),is=(0,X.makeIcon)("Icon28VideocamOutline","videocam_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="videocam_outline_28"><path fill-rule="evenodd" d="M9.357 5h4.286c1.084 0 1.958 0 2.666.058.729.06 1.369.185 1.961.487a5 5 0 0 1 2.185 2.185c.231.454.36.936.433 1.464l.437-.284.903-.585c.239-.155.52-.338.773-.471.255-.134.794-.395 1.482-.348a2.7 2.7 0 0 1 1.975 1.07c.415.552.49 1.148.516 1.434.026.285.026.62.026.904v6.172c0 .284 0 .619-.026.904-.026.286-.1.882-.516 1.434a2.7 2.7 0 0 1-1.975 1.07c-.688.047-1.227-.214-1.482-.348a10.407 10.407 0 0 1-.773-.47l-.905-.588-.435-.282c-.074.528-.202 1.01-.433 1.464a5 5 0 0 1-2.185 2.185c-.592.302-1.232.428-1.961.487C15.6 23 14.727 23 13.643 23H9.357c-1.084 0-1.958 0-2.666-.058-.728-.06-1.369-.185-1.96-.487a5 5 0 0 1-2.186-2.185c-.302-.592-.428-1.232-.487-1.961C2 17.6 2 16.727 2 15.643v-3.286c0-1.084 0-1.958.058-2.666.06-.728.185-1.369.487-1.961A5 5 0 0 1 4.73 5.545c.592-.302 1.233-.428 1.961-.487C7.4 5 8.273 5 9.357 5ZM21 15.643v-4.138l2.27-1.472c.563-.365.844-.548 1.077-.532a.7.7 0 0 1 .513.277c.14.187.14.522.14 1.192v6.06c0 .67 0 1.005-.14 1.192a.7.7 0 0 1-.513.277c-.233.016-.514-.167-1.077-.532L21 16.495v-.852ZM6.854 7.05c-.605.05-.953.142-1.216.276a3 3 0 0 0-1.311 1.311c-.134.263-.226.611-.276 1.216-.05.617-.051 1.41-.051 2.546v3.2c0 1.137 0 1.929.051 2.546.05.605.142.953.276 1.216a3 3 0 0 0 1.311 1.311c.263.134.611.226 1.216.276.617.05 1.41.051 2.546.051h4.2c1.137 0 1.929 0 2.546-.051.605-.05.953-.142 1.216-.276a3 3 0 0 0 1.311-1.311c.134-.263.226-.611.276-1.216.05-.617.051-1.41.051-2.546v-3.2c0-1.137 0-1.929-.051-2.546-.05-.605-.142-.953-.276-1.216a3 3 0 0 0-1.311-1.311c-.263-.134-.611-.226-1.216-.276-.617-.049-1.41-.05-2.546-.05H9.4c-1.137 0-1.929 0-2.546.051Z" clip-rule="evenodd" /></symbol>',28,28,!1,void 0);function os(){var e,n,t,a=(0,c.useSelector)((function(e){return e})),r=u(),_=(0,l.useContext)(E.LangContext).getLang,v=!(null===(e=a.join)||void 0===e?void 0:e.joinLink),p=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),f=p[0],A=p[1],g=(0,i.__read)((0,l.useState)(!f),2),h=g[0],m=g[1],C=(0,l.useRef)(pi()),S=null!==C.current,T=(0,i.__read)((0,l.useState)(!f),2),I=T[0],N=T[1],x=function(){var e,n,t,i;return(null===(e=a.join)||void 0===e?void 0:e.joinLink)?Ti(Ii({joinLink:null===(n=a.join)||void 0===n?void 0:n.joinLink,userId:null===(t=window.vk)||void 0===t?void 0:t.id})):Ti(function(e){var n=e.peerId,t=e.userId,a=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?peerId="+n+"&userId="+t;return console.log("deeplink: ",a),a}({peerId:a.peer,userId:null===(i=window.vk)||void 0===i?void 0:i.id}))};(0,l.useEffect)((function(){x().then((function(){m(!1)})).catch((function(){m(!1)}))}),[f]);var y=function(){r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},O=null!==(t=null===(n=yi(a.config.browserWarnings))||void 0===n?void 0:n.block)&&void 0!==t&&t;return(0,o.jsx)(b,(0,i.__assign)({onClose:y,onBackdropClick:y},{children:(0,o.jsxs)(ba.ModalCard,(0,i.__assign)({nav:"StartCallModal",header:(0,o.jsx)(V.default,{children:_(h&&S?"calls_download_started":f?"calls_app_title":v?"calls_start_call_after_install_app":"calls_join_call_after_install_app")},void 0),subheader:I?_("calls_download_and_install_app_for_pc"):f?_(v?"calls_try_manual_start_lesson":"calls_try_manual_join_lesson"):h?_("calls_wait_until_app_downloaded"):"",className:"StartCallModal"},{children:[h&&S&&C.current?(0,o.jsxs)(l.Fragment,{children:[(0,o.jsx)(ba.Spinner,{size:"large",className:"StartCallModal__action"},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"StartCallModal__text"},{children:_("calls_downloading_file").replace("{file}",C.current.filename)}),void 0)]},void 0):I?C.current&&S?(0,o.jsx)(ba.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(as,{},void 0),onClick:function(){return e=C.current.url,n=C.current.filename,fi(),vi(e,n),m(!0),void setTimeout((function(){A(!0),m(!1),N(!1)}),3e3);var e,n},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(ba.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(as,{},void 0),href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank",onClick:function(){fi(),N(!1)},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(ba.Button,(0,i.__assign)({mode:"secondary",size:"l",before:(0,o.jsx)(is,{},void 0),onClick:x,className:"StartCallModal__action"},{children:_(v?"calls_start_in_app":"calls_join_call_in_app")}),void 0),!I&&(0,o.jsxs)(ba.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[(0,o.jsx)("div",{children:_("calls_apps_for_all_platform")},void 0),(0,o.jsx)(ba.Link,(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank"},{children:_("calls_open_app_list")}),void 0)]}),void 0),!O&&(0,o.jsxs)(ba.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[_("calls_calls_troubles_with_app"),(0,o.jsx)("br",{},void 0),(0,o.jsx)(ba.Link,(0,i.__assign)({onClick:function(){var e,n,t,i,o=a.peer;if(window.Calls)if(null===(e=a.join)||void 0===e?void 0:e.joinLink){var r=null!==(n=a.entryPoint)&&void 0!==n?n:d.CallStatSource.CONVO_JOIN_SNIPPET;window.Calls.joinCallByLink(null===(t=a.join)||void 0===t?void 0:t.joinLink,void 0,!1,r)}else{var s=null!==(i=a.entryPoint)&&void 0!==i?i:d.CallStatSource.CONVO_LIST;if(o)o>2e9?window.Calls.startGroupCall(o,void 0,null,!1,s):window.Calls.call(o,!1,void 0,s);else window.Calls.startCall(!1,s)}}},{children:_(v?"calls_calls_start_lesson_in_browser":"calls_join_call_in_browser")}),void 0)]}),void 0),O&&(0,o.jsx)(ba.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:_("calls_warning_native_app_description")}),void 0)]}),void 0)}),void 0)}var rs=t(98037),ss=function(e){var n=e.items,t=e.actionButtons,a=e.onListItemClick,r=e.selectedId,s=e.onClose,c=e.onSearchChange,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)(T.default,(0,i.__assign)({className:"CallByNameModal",onClose:s},{children:[(0,o.jsx)(xo.ModalHeader,{title:d("calls_call_by_name_title"),onClose:s},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallByNameModal__content"},{children:[(0,o.jsx)(Mn.BlockSearchInput,{className:"CallByNameModalList__input",placeholder:d("calls_call_by_name_search_placeholder"),onChange:c,onInput:c,onPaste:c},void 0),(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({extra:n.length||""},{children:d("calls_call_by_name_list_header")}),void 0),0!==n.length&&(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1,className:"CallByNameModalList__list"},{children:n.map((function(e){return function(e,n){var t=null;return t=n===e.id?(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__selected"},{children:d("calls_call_by_name_selected")}),void 0):(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__select"},{children:d("calls_call_by_name_select")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({onClick:function(){return a(e.id)},className:"CallByNameModalList__listItem",aside:t},{children:(0,o.jsx)(Bn.default,{photo:(0,o.jsx)(g.CallPhoto,{id:e.id,photo:e.photo,alt:e.name||"",className:"CallByNameModalList__photo"},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.id)}(e,r)}))}),void 0),0===n.length&&(0,o.jsx)(Re.default,{children:d("calls_call_by_name_not_found")},void 0)]}),void 0),(0,o.jsx)(rs.ModalFooter,{actionButtons:t},void 0)]}),void 0)},ls=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,i.__read)((0,l.useState)([]),2),s=r[0],_=r[1],v=(0,i.__read)((0,l.useState)(t.me),2),p=v[0],f=v[1],A=(0,l.useContext)(E.LangContext).getLang,g=(0,i.__read)((0,l.useState)(""),2),h=g[0],m=g[1],C=(0,l.useCallback)((function(e){return e.name}),[]),S=(0,l.useCallback)((function(e){return e.id}),[]),T=x([],C,S),I=t.participants[t.me],N=h?T.search(h):s,y=(0,l.useCallback)((function(e){m(e.target.value)}),[]),b=function(e,n){void 0===n&&(n=!1);var t="id"in e?e.id:e.peerId,a="screen_name"in e?"/"+e.screen_name:e.link,i="photo_100"in e?e.photo_100:e.photo;return{id:n?t:-t,name:(0,wa.escape)(e.name),link:a,photo:i}};(0,l.useEffect)((function(){var e=[b(I,!0)];(0,sn.getGroupsForCall)().then((function(n){n.count>0&&n.items.forEach((function(n){e.push(b(n))}))})).finally((function(){_(e),e.forEach((function(e){return T.add(e)}))}))}),[]);var O=(0,l.useCallback)((function(e){if(t.callByName){var a=t.callByName,i=a.peerId,o=a.entryPoint,r=a.joinLink;r?n.joinCallByLink(r,void 0,e,o,p>0?0:p):i?n.call(i,e,void 0,o,p>0?0:p):n.startCall(e,o,!0,p>0?0:p)}}),[p]);if(!s.length)return(0,o.jsx)(Er.default,{},void 0);var w=[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return O(!1)},appearance:"secondary"},{children:A("calls_call_by_name_audio_button")}),"callByNameByAudio"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){return O(!0)}},{children:A("calls_call_by_name_video_button")}),"callByNameByVideo")];return(0,o.jsx)(ss,{items:N,actionButtons:w,selectedId:p,onListItemClick:function(e){f(e)},onClose:function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},participantMe:I,onSearchChange:y},void 0)},cs=function(e){var n,t,a,i=e.SDK,r=(0,c.useSelector)((function(e){return e})),s=u(),_=r.localDevice,v=r.externalId,p=r.participants[r.me],f=(0,l.useCallback)((function(){s({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})}),[]),A=(0,l.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=r.localDevice.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[r.localDevice.mediaSettings]);return(0,o.jsx)(qi,{children:v&&(0,o.jsx)(no,{onRestoreCall:f,isMe:!0,isLocalAudioEnabled:!!(null===(n=_.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalAudioAllowed:!0,isLocalScreenSharing:!1,onToggleAudio:A,photo:p.photo,name:p.name,participantId:v,isWithVideo:(0,P.isParticipantWithVideo)(_),isWithAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isScreenSharing:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:(0,P.getStream)(_),status:_.status,networkStatus:_.networkStatus},void 0)},void 0)},ds=function(e){var n=e.name,t=e.letter,a=e.hasAudio,r=e.hasVideo,s=e.stream,l=e.wasConnected,c=e.externalId;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHall"},{children:(0,o.jsx)("main",(0,i.__assign)({className:"WaitingHall__main"},{children:(0,o.jsx)(ce,{externalId:c,hasVideo:r,hasAudio:a,isSharingScreen:!1,stream:s,isMe:!0,name:n,letter:t,allowContain:!0,wasConnected:l,networkStatus:1},void 0)}),void 0)}),void 0)},us=function(e){var n=e.text;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo__text"},{children:n}),void 0)}),void 0)};function _s(e){var n,t,a,r=e.SDK,s=e.navigateToConvo,_=(0,c.useSelector)((function(e){return e})),v=u(),p=(0,l.useContext)(E.LangContext).getLang,f=(0,l.useContext)(y.ConfigContext),A=f.isModalView,g=f.enableScreenTrack,h=_.peer,m=_.localDevice.mediaSettings,C=_.uiMode===d.UIMode.FULLSCREEN,S=(0,i.__read)((0,l.useState)(!1),2),T=S[0],I=S[1],N=(0,i.__read)((0,l.useState)(!1),2),x=N[0],O=N[1],w=function(e){return v({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},L=(0,l.useCallback)((function(){A&&(_.uiMode===d.UIMode.FULLSCREEN?((0,Cn.pause)(.3,null).then((function(){w(d.UIMode.COLLAPSED)})),w(d.UIMode.DEFAULT)):w(d.UIMode.COLLAPSED))}),[_.uiMode]),k=(0,l.useCallback)((function(){if(!T){var e=!m.isAudioEnabled;(e?Be(r,[J.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;I(!0),(null===(n=_.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&v({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),r.toggleLocalAudio(e).finally((function(){I(!1)}))}))}}),[m,T]),M=(0,l.useCallback)((function(){if(!x){var e=!m.isVideoEnabled||!!m.isScreenSharingEnabled&&!g;(e?Be(r,[J.MediaOption.VIDEO]):Promise.resolve()).then((function(){O(!0),g||m.isScreenSharingEnabled&&r.captureScreen(!1),r.toggleLocalVideo(e).finally((function(){O(!1)}))}))}}),[m,x]),D=(0,l.useCallback)((function(){L(),s(_.peer)}),[_.peer,_.uiMode]),j=(0,l.useCallback)((function(){r.hangup()}),[]),R=(0,l.useCallback)((function(){v({type:d.E_ACTION.CHANGE_UI_MODE,mode:C?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[_.uiMode]),B=(0,l.useCallback)((function(e,n){var t;v({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),U=(0,l.useCallback)((function(){v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){return function(){v({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var H=(0,l.useMemo)((function(){var e;return(0,o.jsx)(Qe,{dispatch:v,notification:_.notification,participant:_.participants[null===(e=_.notification)||void 0===e?void 0:e.data]},void 0)}),[_.notification,_.participants[null===(n=_.notification)||void 0===n?void 0:n.data]]),G=_.hangupType===d.HANGUP_TYPE_REMOVED?p("calls_waiting_hall_removed"):p("calls_waiting_hall_info");return(0,o.jsx)(b,(0,i.__assign)({onClose:j,onBackdropClick:L},{children:(0,o.jsx)(Pe,(0,i.__assign)({info:null,isVideoAllowed:!0,isAudioAllowed:!0,isVideoEnabled:!!m.isVideoEnabled,isAudioEnabled:!!m.isAudioEnabled,isFullScreen:C,onToggleAudio:k,onToggleVideo:M,onLeaveCall:j,onCollapseCall:A?L:null,onFullScreenToggle:R,onTooltipChange:B,onHidePanel:U,onChat:D,isChatControlShown:!!h&&!_.groupId,chatUnreadCount:_.chatUnreadCount,notification:H,tooltips:_.tooltips,notificationWithButton:null,withoutPadding:!0},{children:(0,o.jsxs)(o.Fragment,{children:[!!m.isVideoEnabled&&_.externalId&&(0,o.jsx)(ds,{name:"",letter:null===(t=_.participants[_.me].name)||void 0===t?void 0:t.slice(0,1),hasAudio:!!(null===(a=_.localDevice.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),externalId:_.externalId,stream:(0,P.getStream)(_.localDevice),hasVideo:(0,P.isParticipantWithVideo)(_.localDevice),wasConnected:!!_.localDevice.wasConnected},void 0),(0,o.jsx)(us,{text:G},void 0)]},void 0)}),void 0)}),void 0)}var vs=function(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=e.onChangeVideoOption,s=e.videoOptions,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:n,title:c("calls_virtual_background"),appearance:"blue",disableEscapeClose:!0,actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__options"},{children:(0,o.jsx)(vo.default,(0,i.__assign)({checked:!!s[d.EVideoOptionType.IS_VIDEO_MIRRORED],name:d.EVideoOptionType.IS_VIDEO_MIRRORED,onChange:r},{children:c("calls_mirror_display_view")}),void 0)}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:c("calls_cancel")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:t},{children:c("calls_save")}),void 0)]},void 0),className:"VirtualBackgroundSettingsModal"},{children:a}),void 0)},ps=function(e,n){return ps=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},ps(e,n)};function fs(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}ps(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}function As(e,n,t,a){return new(t||(t=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,s)}l((a=a.apply(e,n||[])).next())}))}function gs(e,n){var t,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=n.call(e,r)}catch(e){o=[6,e],a=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var hs,ms=function(e,n){void 0===n&&(n=[]);var t=n.join(","),a=new Blob(["("+e+")("+t+");"],{type:"application/javascript; charset=utf-8"});return window.URL.createObjectURL(a)};!function(e){e.IE="IE",e.Safari="Safari",e.Chrome="Chrome",e.Edge="Edge",e.Firefox="Firefox",e.Yandex="Yandex",e.Opera="Opera",e.Sferum="Sferum"}(hs||(hs={}));var Cs,Es,Ss,Ts,Is,Ns,xs,ys=(Cs=navigator.appVersion,Es=navigator.appName,Ss=navigator.userAgent,Ts=[],function(){return Ts.length?Ts:Ts=function(){var e,n=!1,t=0,a=Ss.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1]))return e=/\brv[ :]+(\d+)/g.exec(Ss),[hs.IE,e&&e[1]||"Unknown",n,t];if("Safari"===a[1]){if(e=Ss.match(/\bEdge\/(\d+)/))return[hs.Edge,e[1]||"Unknown",n,t];if(e=Ss.match(/\bCriOS\/(\d+)/))return[hs.Chrome,e[1],!0,+e[1]];if(e=Ss.match(/\bFxiOS\/(\d+)/))return[hs.Firefox,e[1],!1,t];if(e=Ss.match(/\bYaBrowser\/(\d+)/))return[hs.Yandex,e[1],!1,t];if(e=Ss.match(/\bOPT\/(\d+)/))return[hs.Opera,e[1],!1,t]}if(a[1]===hs.Chrome){if(n=!0,t=Number(a[2]),e=Ss.match(/\bOPR\/(\d+)/))return[hs.Opera,e[1]||"Unknown",n,t];if(e=Ss.match(/\bYaBrowser\/(\d+)/))return[hs.Yandex,e[1]||"Unknown",n,t];if(e=Ss.match(/\bSferum\/((\d+)(?:\.\d+)*)/))return[hs.Sferum,e[1]||"Unknown",n,t];if(e=Ss.match(/\bEdge?\/(\d+)/))return[hs.Edge,e[1]||"Unknown",n,t];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return[hs.Opera,"Hidden",n,t]}return e=Ss.match(/version\/(\d+)/i),[a[2]?a[1]:Es,e&&e[1]||a[2]||Cs,n,t]}()}),bs=function(e){return As(void 0,void 0,void 0,(function(){return gs(this,(function(n){return[2,new Promise((function(n,t){var a=document.createElement("img");a.crossOrigin="anonymous",a.onerror=function(e){t("Failed image loading: "+e)},a.onload=function(){return n(a)},a.src=e}))]}))}))},Os=function(){function e(){this._backgroundCanvas=document.createElement("canvas")}return e.prototype.resize=function(e,n,t,a){var i,o,r=(void 0===a?{}:a).ctxOptions,s=(o={width:0,height:0},"number"==typeof(i=e).width&&"number"==typeof i.height&&(o.height=i.height,o.width=i.width),o),l=s.height,c=s.width,d=this._backgroundCanvas,u=d.getContext("2d",r);if(!u)throw new Error("ctx did not initialized");d.width=n,d.height=t;var _=Math.max(d.width/c,d.height/l),v=d.width/2-c/2*_,p=d.height/2-l/2*_;return u.drawImage(e,v,p,c*_,l*_),d},e}(),ws=(Is=function(e,n){e.exports=function(e){var n,t,a="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,a){n=e,t=a}));var o,r={};for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);var s="./this.program",l=function(e,n){throw n},c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),void 0!==a&&a&&(c=a),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"";var d,u=i.print||console.log.bind(console),_=i.printErr||console.warn.bind(console);for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);r=null,i.arguments,i.thisProgram&&(s=i.thisProgram),i.quit&&(l=i.quit),i.wasmBinary&&(d=i.wasmBinary);var v,p=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&k("no native wasm support detected");var f,A,g,h,m,C=!1,E="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function S(e,n,t){for(var a=n+t,i=n;e[i]&&!(i>=a);)++i;if(i-n>16&&e.subarray&&E)return E.decode(e.subarray(n,i));for(var o="";n<i;){var r=e[n++];if(128&r){var s=63&e[n++];if(192!=(224&r)){var l=63&e[n++];if((r=224==(240&r)?(15&r)<<12|s<<6|l:(7&r)<<18|s<<12|l<<6|63&e[n++])<65536)o+=String.fromCharCode(r);else{var c=r-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&r)<<6|s)}else o+=String.fromCharCode(r)}return o}function T(e){f=e,i.HEAP8=A=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=h=new Int32Array(e),i.HEAPU8=g=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var I,N,x,y=[],b=[],O=[],w=0,L=null;function k(e){i.onAbort&&i.onAbort(e),_(e+=""),C=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var n=new WebAssembly.RuntimeError(e);throw t(n),n}function P(e){return e.startsWith("data:application/octet-stream;base64,")}function M(e){try{if(e==I&&d)return new Uint8Array(d);throw"both async and sync fetching of the wasm failed"}catch(e){k(e)}}function D(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var t=n.func;"number"==typeof t?void 0===n.arg?m.get(t)():m.get(t)(n.arg):t(void 0===n.arg?null:n.arg)}else n(i)}}function j(e){try{return v.grow(e-f.byteLength+65535>>>16),T(v.buffer),1}catch(e){}}i.preloadedImages={},i.preloadedAudios={},P(I="https://st.mycdn.me/static/callseffects/0-0-3/tflite-simd.wasm")||(N=I,I=i.locateFile?i.locateFile(N,c):c+N),x=function(){return performance.now()};var R={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var n in R)void 0===R[n]?delete e[n]:e[n]=R[n];var t=[];for(var n in e)t.push(n+"="+e[n]);B.strings=t}return B.strings}var U={mappings:{},buffers:[null,[],[]],printChar:function(e,n){var t=U.buffers[e];0===n||10===n?((1===e?u:_)(S(t,0)),t.length=0):t.push(n)},varargs:void 0,get:function(){return U.varargs+=4,h[U.varargs-4>>2]},getStr:function(e){var n=function(e,n){return e?S(g,e,void 0):""}(e);return n},get64:function(e,n){return e}},H={a:function(){k()},m:function(e,n){var t;if(0===e)t=Date.now();else{if(1!==e&&4!==e)return 28,h[V()>>2]=28,-1;t=x()}return h[n>>2]=t/1e3|0,h[n+4>>2]=t%1e3*1e3*1e3|0,0},i:function(e,n){k("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},c:function(e,n){k("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},g:function(){return 2147483648},k:function(e,n,t){g.copyWithin(e,n,n+t)},l:function(e){var n,t=g.length,a=2147483648;if((e>>>=0)>a)return!1;for(var i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),j(Math.min(a,((n=Math.max(e,o))%65536>0&&(n+=65536-n%65536),n))))return!0}return!1},d:function(e){for(var n=x();x()-n<e;);},e:function(e,n){var t=0;return B().forEach((function(a,i){var o=n+t;h[e+4*i>>2]=o,function(e,n,t){for(var a=0;a<e.length;++a)A[n++>>0]=e.charCodeAt(a);A[n>>0]=0}(a,o),t+=a.length+1})),0},f:function(e,n){var t=B();h[e>>2]=t.length;var a=0;return t.forEach((function(e){a+=e.length+1})),h[n>>2]=a,0},o:function(e){!function(e,n){var t;t=e,p||(i.onExit&&i.onExit(t),C=!0),l(t,new F(t))}(e)},h:function(e){return 0},j:function(e,n,t,a,i){},b:function(e,n,t,a){for(var i=0,o=0;o<t;o++){for(var r=h[n+8*o>>2],s=h[n+(8*o+4)>>2],l=0;l<s;l++)U.printChar(e,g[r+l]);i+=s}return h[a>>2]=i,0},n:function e(n,t){e.randomDevice||(e.randomDevice=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){k("randomDevice")}}());for(var a=0;a<t;a++)A[n+a>>0]=e.randomDevice();return 0}};!function(){var e={a:H};function n(e,n){var t,a=e.exports;i.asm=a,T((v=i.asm.p).buffer),m=i.asm.A,t=i.asm.q,b.unshift(t),function(e){if(w--,i.monitorRunDependencies&&i.monitorRunDependencies(w),0==w&&L){var n=L;L=null,n()}}()}function a(e){n(e.instance)}function o(n){return(d||"function"!=typeof fetch?Promise.resolve().then((function(){return M(I)})):fetch(I,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+I+"'";return e.arrayBuffer()})).catch((function(){return M(I)}))).then((function(n){return WebAssembly.instantiate(n,e)})).then((function(e){return e})).then(n,(function(e){_("failed to asynchronously prepare wasm: "+e),k(e)}))}if(w++,i.monitorRunDependencies&&i.monitorRunDependencies(w),i.instantiateWasm)try{return i.instantiateWasm(e,n)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}(d||"function"!=typeof WebAssembly.instantiateStreaming||P(I)||"function"!=typeof fetch?o(a):fetch(I,{credentials:"same-origin"}).then((function(n){return WebAssembly.instantiateStreaming(n,e).then(a,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),o(a)}))}))).catch(t)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.q).apply(null,arguments)},i._setNumThreads=function(){return(i._setNumThreads=i.asm.r).apply(null,arguments)},i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.u).apply(null,arguments)},i._getInputDim=function(){return(i._getInputDim=i.asm.v).apply(null,arguments)},i._getOutputDim=function(){return(i._getOutputDim=i.asm.w).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.x).apply(null,arguments)},i._updateRecurrentState=function(){return(i._updateRecurrentState=i.asm.y).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.z).apply(null,arguments)};var G,V=i.___errno_location=function(){return(V=i.___errno_location=i.asm.B).apply(null,arguments)};function F(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function W(e){function t(){G||(G=!0,i.calledRun=!0,C||(D(b),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),O.unshift(e);var e;D(O)}()))}w>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),y.unshift(e);var e;D(y)}(),w>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(L=function e(){G||W(),G||(L=e)},i.run=W,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return W(),e.ready}},Is(Ns={exports:{}}),Ns.exports),Ls="https://st.mycdn.me/static/callseffects",ks=Ls+"/0-0-3",Ps=Ls+"/0-0-5",Ms=Ls+"/0-0-6",Ds=Ls+"/0-0-8",js=Ls+"/0-0-9",Rs={segmentation:{models:{"192x256":ks+"/segmentation-model.tflite"},wasm:{tfliteSimd:ks+"/tflite-simd.wasm"}},backgrounds:[{id:3012,preview:Ps+"/3012-preview.png",original:Ps+"/3012-original.jpg",description:"elephant in the white room",tags:["default"]},{id:3013,preview:Ps+"/3013-preview.png",original:Ps+"/3013-original.jpg",description:"old native stove in russian historic house",tags:["default"]},{id:3014,preview:Ps+"/3014-preview.png",original:Ps+"/3014-original.jpg",description:"flying baloons surrounded by mountains",tags:["default"]},{id:3015,preview:Ps+"/3015-preview.png",original:Ps+"/3015-original.jpg",description:"two pilots driving a plate",tags:["default"]},{id:3016,preview:Ps+"/3016-preview.png",original:Ps+"/3016-original.jpg",description:"sauna",tags:["default"]},{id:3017,preview:Ps+"/3017-preview.png",original:Ps+"/3017-original.jpg",description:"red chairs in movie theater",tags:["default"]},{id:3018,preview:Ps+"/3018-preview.png",original:Ps+"/3018-original.jpg",description:"sleeping person in train cart",tags:["default"]},{id:3019,preview:Ps+"/3019-preview.jpg",original:Ps+"/3019-original.jpg",description:"Little Big icons on pink background",tags:["star"]},{id:3020,preview:Ps+"/3020-preview.jpg",original:Ps+"/3020-original.jpg",description:"Violet wild mint (2 colors split background)",tags:["star"]},{id:3021,preview:Ps+"/3021-preview.jpg",original:Ps+"/3021-original.jpg",description:"Klava Koka left the chat and in love with MDK",tags:["star"]},{id:3022,preview:Ps+"/3022-preview.jpg",original:Ps+"/3022-original.jpg",description:"Some half-naked dude with rifle",tags:["star"]},{id:3023,preview:Ps+"/3023-preview.jpg",original:Ps+"/3023-original.jpg",description:'"Cirle" photo collage',tags:["star"]},{id:3024,preview:Ps+"/3024-preview.jpg",original:Ps+"/3024-original.jpg",description:"Gazgolder & red carpet on the wall",tags:["star"]},{id:3025,preview:Ps+"/3025-preview.jpg",original:Ps+"/3025-original.jpg",description:"Gazgolder & VK Clips collab pink-yellow-blue collage",tags:["star"]},{id:3026,preview:Ps+"/3026-preview.jpg",original:Ps+"/3026-original.jpg",description:"Crem Soda people collage",tags:["star"]},{id:3027,preview:Ps+"/3027-preview.jpg",original:Ps+"/3027-original.jpg",description:"Dmitry Glukhovsky collage",tags:["star"]},{id:3028,preview:Ms+"/3028-preview.jpeg",original:Ms+"/3028-original.jpeg",description:"Dogs in space",tags:["cosmonautics-day-2022"]},{id:3029,preview:Ds+"/3029-preview.jpg",original:Ds+"/3029-original.jpg",description:"Blackboard with e=mc2 formulas",tags:["teachers-day-2022"]},{id:3030,preview:js+"/3030-preview.jpg",original:js+"/3030-original.jpg",description:"vk 2022 birthday",tags:["vk-2022-birthday"]}],icons:{starBackground:{id:"icon-star-background",description:"Icon for indicating that virtual background is from stars",url:Ps+"/icon-star-background.svg",type:"svg"}}},Bs=function(){function e(){}return e.workerFn=function(e){console.log("here goes the worker...");var n=null,t=!1,a={"192x256":[192,256]},i={processSizeKey:"192x256",inputMemoryOffset:0,outputMemoryOffset:0,maskArray:null,numThreads:2},o=function(){c.call(null,"log",Array.from(arguments))},r=function(){c.call(null,"warn",Array.from(arguments))};function s(s,c,d){return void 0===c&&(c={}),void 0===d&&(d=!1),t=d,o("[createModel]",s,c,{debugFlag:d}),e().then((function(e){return function(e,n){return o("[loadModel][modelPath]",e,n),fetch(n).then((function(e){return e.arrayBuffer()})).then((function(n){o("Model buffer size:",n.byteLength);var t=i.numThreads,a=e._getModelBufferMemoryOffset();return o("Model buffer memory offset:",a),o("Loading model buffer..."),e.HEAPU8.set(new Uint8Array(n),a),o("_loadModel result:",e._loadModel(n.byteLength,t)),{inputMemoryOffset:e._getInputMemoryOffset(0)/4,outputMemoryOffset:e._getOutputMemoryOffset(0)/4}}))}(e,s).then((function(t){return n=e,t}))})).then((function(e){var n=c.processSizeKey||i.processSizeKey,t=a[n],o=t[0],r=t[1],s=new Float32Array(o*r);l(Object.assign({maskArray:s},e,c))})).catch((function(e){n=null,r("simd error",e),self.postMessage({type:"error",error:e})}))}function l(e){Object.assign(i,e),o("settings updated",i)}function c(e,n){if(void 0===e&&(e="log"),"function"==typeof console[e]&&t){var a=["[segmentation-worker]"].concat(n);console[e].apply(null,a)}}self.onmessage=function(e){try{switch(e.data.type){case"create":s(e.data.modelPath,e.data.settings,e.data.debug).then((function(){self.postMessage({type:"ready"})}));break;case"frame":var t=function(e){var t=i.maskArray,o=i.inputMemoryOffset,s=i.outputMemoryOffset,l=a[i.processSizeKey],c=l[0],d=l[1];if(n){if(t){for(var u=0,_=0;u<c*d;u++,_+=4)n.HEAPF32[o+_]=e.data[_]/255,n.HEAPF32[o+_+1]=e.data[_+1]/255,n.HEAPF32[o+_+2]=e.data[_+2]/255,n.HEAPF32[o+_+3]=t[u];n._runInference(),n._updateRecurrentState(1,1);var v=new ImageData(d,c);for(u=0,_=0;u<c*d;u++,_+=4)t[u]=n.HEAPF32[s+u],v.data[_+3]=255*t[u];return v}r("no maskArray created")}else r("no tfliteSIMD instance!")}(e.data.imageData);t&&self.postMessage({type:"frame",segmentationMask:t,resizedImage:e.data.imageData},[t.data.buffer,e.data.imageData.data.buffer]);break;case"params":l(e.data.params);break;default:r("unhandled event",e.data)}}catch(e){r("onmessage error",e),self.postMessage({type:"error",error:e})}}},e}(),Us=function(){function e(e){var n=this,t=e.onFrame,a=e.onReady,i=e.onError;this._settings={modelKey:"192x256",processSizeKey:"192x256"},this._processSize={"192x256":[192,256]},this._worker=null,this._worker=new Worker(ms(Bs.workerFn,[ws,JSON.stringify({})])),this._worker.onmessage=function(e){switch(e.data.type){case"ready":a(n);break;case"frame":t({image:n._canvasImageBackup,resizedImage:e.data.resizedImage,segmentationMask:e.data.segmentationMask});break;case"error":null==i||i(e.data);break;default:console.warn("unhandled event type",e.data)}},this._canvas=document.createElement("canvas"),this._canvasImageBackup=document.createElement("canvas");var o=this._canvas.getContext("2d"),r=this._canvasImageBackup.getContext("2d");if(!o||!r)throw new Error("can't get ctx for canvas");this._ctx=o,this._ctxImageBackup=r}return e.prototype.createModel=function(e){var n,t=this._settings,a=Rs.segmentation.models[t.modelKey];null===(n=this._worker)||void 0===n||n.postMessage({type:"create",modelPath:a,settings:t,debug:e})},e.prototype.setParams=function(e){var n=this._worker,t=this._settings;Object.assign(t,e),null==n||n.postMessage({type:"params",params:t})},e.prototype.requestSegmentation=function(e){var n=this,t=n._settings,a=n._canvas,i=n._ctx,o=n._worker,r=n._processSize[t.processSizeKey],s=r[0],l=r[1];this._saveImage(e),a.width=l,a.height=s,i.drawImage(e,0,0,l,s);var c=i.getImageData(0,0,l,s);null==o||o.postMessage({type:"frame",imageData:c},[c.data.buffer])},e.prototype._saveImage=function(e){var n=this._ctxImageBackup,t=this._canvasImageBackup,a=function(e){var n={height:0,width:0};return"number"==typeof e.height?n.height=e.height:n.height=e.height.baseVal.value,"number"==typeof e.width?n.width=e.width:n.width=e.width.baseVal.value,n}(e),i=a.height,o=a.width;t.height=i,t.width=o,n.clearRect(0,0,o,i),n.drawImage(e,0,0,o,i)},e.prototype.destroy=function(){this._worker&&(this._worker.terminate(),this._worker=null)},e}(),Hs=function(){function e(){}return e.updateSegmentationParams=function(n){Object.assign(e._params.segmentation,n)},e.getSegmentationParams=function(){return e._params.segmentation},e.setDebug=function(n){e._params.debug=n},e.getDebug=function(){return!!e._params.debug},e._params={segmentation:{processSizeKey:"192x256",modelKey:"192x256"}},e}(),Gs=function(){function e(){this._timeouts=new Map,this._throttles=new Map,this._worker=new Worker(ms(e.workerFn))}return e.prototype.initWorker=function(e){var n=void 0===e?{}:e,t=n.onError,a=n.onTimeout,i=n.onThrottle,o=n.onReady;return As(this,void 0,void 0,(function(){var e=this;return gs(this,(function(n){return[2,new Promise((function(n,r){e._worker.addEventListener("message",(function(s){switch(s.data.type){case"timeout":e._callTimeout(s.data.id),null==a||a(s.data);break;case"throttle":e._callThrottle(s.data.id),null==i||i(s.data);break;case"error":null==t||t(s.data),r(s.data);break;case"ready":null==o||o(s.data),n()}})),e._worker.addEventListener("error",(function(e){null==t||t(e),r(e)})),e._worker.postMessage({type:"ready"})}))]}))}))},e.workerFn=function(){var e=new Map,n=new Map;self.onmessage=function(t){switch(t.data.type){case"timeout":!function(n,t){void 0===t&&(t=5);var a=setTimeout((function(){self.postMessage({type:"timeout",id:n}),e.delete(n)}),t);e.set(n,a)}(t.data.id,t.data.ms);break;case"throttle":!function(e,t){void 0===t&&(t=5);var a=n.get(e);a&&clearTimeout(a);var i=setTimeout((function(){self.postMessage({type:"throttle",id:e}),n.delete(e)}),t);n.set(e,i)}(t.data.id,t.data.ms);break;case"ready":self.postMessage({type:"ready"});break;default:self.postMessage({type:"error",data:t.data})}},self.postMessage({type:"ready"})},e.prototype.postTimeout=function(e,n,t){void 0===t&&(t=5),this._timeouts.set(e,n),this._worker.postMessage({type:"timeout",id:e,ms:t})},e.prototype.postThrottle=function(e,n,t){void 0===t&&(t=5),this._throttles.set(e,n),this._worker.postMessage({type:"throttle",id:e,ms:t})},e.prototype._callTimeout=function(e){var n=this._timeouts.get(e);n&&(this._timeouts.delete(e),n())},e.prototype._callThrottle=function(e){var n=this._throttles.get(e);n&&(this._throttles.delete(e),n())},e.prototype.destroy=function(){this._worker.terminate(),this._throttles.clear(),this._timeouts.clear()},e}();!function(e){e.NONE="none",e.BLUR="blur",e.BACKGROUND="background"}(xs||(xs={}));var Vs=function(){function e(e){var n=void 0===e?{}:e,t=n.segmentation,a=n.debug;this._effect=null,this._net=null,this._video=null,this._canvas=null,this._stream=null,this._track=null,this._sendNextFrame=null,this._timerWorker=null,t&&Hs.updateSegmentationParams(t),a&&Hs.setDebug(a)}return e.prototype._createDom=function(e){var n=function(e){var n,t,a=e.defaults,i=e.track,o=i.getSettings(),r=i.getConstraints(),s=a;return t=["width","height"],"object"==typeof(n=o)&&(Array.isArray(t)?t.every((function(e){return e in n})):t in n)||!function(e){return"object"==typeof e?Array.isArray(e)?!e.length:!Object.keys(e).length:"string"==typeof e?!e.length:!e}(r)?(o.height?s.height=o.height:"number"==typeof r.height?s.height=r.height:"object"==typeof r.height&&(s.height=r.height.exact||r.height.ideal||r.height.max||r.height.min||s.height),o.width?s.width=o.width:"number"==typeof r.width?s.width=r.width:"object"==typeof r.width&&(s.width=r.width.exact||r.width.ideal||r.width.max||r.width.min||s.width),s):s}({track:e,defaults:{height:360,width:640}}),t=n.width,a=n.height;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.height=a,this._canvas.width=t,this._canvas.style.bottom="0",this._canvas.style.left="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas)),this._video||(this._video=document.createElement("video"),this._video.controls=!1,this._video.autoplay=!1,this._video.preload="auto",this._video.muted=!0,this._video.style.pointerEvents="none",this._video.style.visibility="hidden",this._video.style.position="absolute",this._video.style.width="160px",this._video.style.height="90px",this._video.height=a,this._video.width=t,this._video.style.bottom="0",this._video.style.right="0",this._video.style.zIndex="5000",document.body.appendChild(this._video))},e.prototype._removeDom=function(){try{this._canvas&&document.body.removeChild(this._canvas),this._video&&document.body.removeChild(this._video)}catch(e){}this._canvas=null,this._video=null},e.prototype._createStream=function(e){return As(this,void 0,void 0,(function(){var n=this;return gs(this,(function(t){if(!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._stream=this._canvas.captureStream(0),[2,new Promise((function(t,a){var i=n._video;i.srcObject=new MediaStream([e]),i.onloadeddata=function(){var e;i.width=i.videoWidth,i.height=i.videoHeight,n._track=null===(e=n._stream)||void 0===e?void 0:e.getVideoTracks()[0],t()},i.onerror=function(){return a(new Error("Video element error"))};var o=i.play(),r=function(){return a(new Error("Autoplay is disabled"))};o?o.catch(r):r()}))]}))}))},e.prototype._createNet=function(){return As(this,void 0,void 0,(function(){var e=this;return gs(this,(function(n){return[2,new Promise((function(n,t){var a=Hs.getDebug()?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];console.warn.apply(console,e),t()}:void 0;new Us({onFrame:function(n){e._drawFrame(n)},onReady:n,onError:a}).createModel(Hs.getDebug())}))]}))}))},e.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._video&&(this._video.pause(),this._video.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),this._video.srcObject=null)},e.prototype._drawFrame=function(e){var n,t=this;this._net&&this._video&&this._effect&&this._canvas&&this._video&&this._effect&&(this._effect.draw(e),this._track&&(this._track.requestFrame(),null===(n=this._timerWorker)||void 0===n||n.postTimeout(Date.now(),(function(){t._video&&t._sendNextFrame&&t._sendNextFrame(t._video)}))))},e.prototype._cleanup=function(e){var n=void 0===e?{}:e,t=n.removeWorkerNet,a=n.removeWorkerTimer;this._effect&&(this._effect.destroy(),this._effect=null),this._removeStream(),this._removeDom(),t&&this._net&&(this._net.destroy(),this._net=null),a&&this._timerWorker&&(this._timerWorker.destroy(),this._timerWorker=null)},e.prototype._setEffect=function(e,n){return As(this,void 0,void 0,(function(){var t,a=this;return gs(this,(function(i){switch(i.label){case 0:return this._timerWorker?[3,2]:(this._timerWorker=new Gs,[4,this._timerWorker.initWorker()]);case 1:i.sent(),i.label=2;case 2:return this._net?[3,4]:(t=this,[4,this._createNet()]);case 3:t._net=i.sent(),i.label=4;case 4:return this._effect&&(this._effect=null),this._sendNextFrame=function(e){var n;null===(n=a._timerWorker)||void 0===n||n.postThrottle("img-segm",(function(){var n;null===(n=a._net)||void 0===n||n.requestSegmentation(e)}),1e3/60)},this._removeStream(),this._createDom(n),[4,this._createStream(n)];case 5:if(i.sent(),!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._effect=e,this._effect.video=this._video,this._effect.canvas=this._canvas,this._sendNextFrame(this._video),[2]}}))}))},e.prototype.setEffect=function(e,n){var t;return As(this,void 0,void 0,(function(){var a;return gs(this,(function(i){switch(i.label){case 0:if(!e)return this._cleanup(),[2,n];e.effect!==(null===(t=this._effect)||void 0===t?void 0:t.effect)&&e.destroy(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._setEffect(e,n)];case 2:return i.sent(),[2,this._track||n];case 3:throw a=i.sent(),this._cleanup(),a;case 4:return[2]}}))}))},e.prototype.stopEffect=function(){this._cleanup()},Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect?this._effect.effect:xs.NONE},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._cleanup({removeWorkerNet:!0,removeWorkerTimer:!0})},e}(),Fs=function(e){var n=e.gl,t=e.fs,a=e.vs,i=n.createShader(n.VERTEX_SHADER);if(!i)throw new Error("vertex shader didn't initialized");n.shaderSource(i,a),n.compileShader(i);var o=n.createShader(n.FRAGMENT_SHADER);if(!o)throw new Error("fragment shader didn't initialized");n.shaderSource(o,t),n.compileShader(o);var r=n.createProgram();if(!r)throw new Error("shader program didn't initialized");if(n.attachShader(r,i),n.attachShader(r,o),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw n.getProgramInfoLog(r);return n.deleteShader(i),n.deleteShader(o),{program:r}},Ws=function(e){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),n},zs=function(e,n,t){var a=Ws(e);if(!a)throw new Error("texture was not created");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,null);var i=e.createFramebuffer();if(!i)throw new Error("framebuffer was not created");return e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),{framebuffer:i,texture:a}},Ks=function(e,n,t,a){e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,a,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},Ys=function(e,n){e.bindFramebuffer(e.FRAMEBUFFER,n),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null)},Qs=function(e,n){return{aTextureCoord:e.getAttribLocation(n,"aTextureCoord"),aVertexCoord:e.getAttribLocation(n,"aVertexCoord")}},Zs="attribute vec3 aVertexCoord;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexCoord, 1.0);\n  vTextureCoord = aTextureCoord;\n}",Js=function(){function e(e){var n=this;this.gl=e,this.program=Fs({fs:"precision highp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uAlphaTexture;\nuniform float uLowerBound;\nuniform float uUpperBound;\n\nvoid main(void) {\n  vec4 color = texture2D(uAlphaTexture, vTextureCoord);\n  if (color.a < uLowerBound) {\n    color.a = 0.0;\n  } else {\n    if (color.a < uUpperBound) {\n      color.a = (color.a - uLowerBound) / (uUpperBound - uLowerBound);\n    } else {\n      color.a = 1.0;\n    }\n  }\n  gl_FragColor = color;\n}",gl:e,vs:Zs}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uLowerBound:function(e){var t=n.gl.getUniformLocation(n.program,"uLowerBound");n.gl.uniform1f(t,e)},uUpperBound:function(e){var t=n.gl.getUniformLocation(n.program,"uUpperBound");n.gl.uniform1f(t,e)}},this.attributes=Qs(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),Xs=function(){function e(e){var n=this;this.gl=e,this.program=Fs({fs:"precision highp float;\n\nuniform sampler2D uCameraFrameTexture;\nuniform sampler2D uBackgroundTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  vec4 cameraFrameColor = texture2D(uCameraFrameTexture, vTextureCoord);\n  vec4 backgroundColor = texture2D(uBackgroundTexture, vTextureCoord);\n  vec4 alphaMask = texture2D(uAlphaTexture, vTextureCoord);\n  gl_FragColor = mix(backgroundColor, cameraFrameColor, alphaMask.a);\n}",gl:e,vs:Zs}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uCameraFrameTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uCameraFrameTexture");n.gl.uniform1i(t,e)},uBackgroundTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uBackgroundTexture");n.gl.uniform1i(t,e)}},this.attributes=Qs(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),qs=function(){function e(e){var n=this;this.gl=e,this.program=Fs({fs:"// https://github.com/Jam3/glsl-fast-gaussian-blur\n\nprecision highp float;\n\nuniform sampler2D texture;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3333333333333333) * direction;\n  color += texture2D(image, uv) * 0.29411764705882354;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n  return color;\n}\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor = blur13(texture, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={texture:function(e){var t=n.gl.getUniformLocation(n.program,"texture");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),$s=function(){function e(e){var n=this;this.gl=e,this.program=Fs({fs:"precision highp float;\n\nuniform sampler2D uTextureOriginal;\nuniform sampler2D uTextureMask;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur13(sampler2D image, sampler2D maskTexture, vec2 uv, vec2 resolution,\n            vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  float sumCof = 0.0;\n\n  vec4 c = texture2D(image, uv);\n  vec4 m = texture2D(maskTexture, uv);\n  color += c * 0.1964825501511404 * (1.0 - m.a);\n  sumCof += 0.1964825501511404 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off1 / resolution));\n  m = texture2D(maskTexture, uv + (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off1 / resolution));\n  m = texture2D(maskTexture, uv - (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off2 / resolution));\n  m = texture2D(maskTexture, uv + (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off2 / resolution));\n  m = texture2D(maskTexture, uv - (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off3 / resolution));\n  m = texture2D(maskTexture, uv + (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off3 / resolution));\n  m = texture2D(maskTexture, uv - (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  return sumCof > 0.0 ? color / sumCof : vec4(0.0, 0.0, 0.0, 0.0);\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor =\n      blur13(uTextureOriginal, uTextureMask, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={uTextureOriginal:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureOriginal");n.gl.uniform1i(t,e)},uTextureMask:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureMask");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),el=function(){function e(e){this.textures={background:null,image:null,resizedImage:null,segmentationMask:null},this.parameters={blurStrength:.8,fixSegmentation:!0,fixSegmentationBlurStrength:.25,fixSegmentationIterations:8,alphaCutterLowerBound:.4,alphaCutterUpperBound:.6},this.$canvas=e;var n=this.$canvas.getContext("webgl");if(!n)throw new Error("getting ctx failed");this.gl=n;var t=this.gl;this.onresize=this.onresize.bind(this),this.onresize(),this.pBlurFastWithMask=new $s(this.gl),this.pBackgroundComposer=new Xs(this.gl),this.pBlurFast=new qs(this.gl),this.pAlphaCutter=new Js(this.gl),this.vertices=[1,1,0,1,1,1,-1,0,1,0,-1,-1,0,0,0,-1,1,0,0,1],this.indices=[0,1,3,1,2,3];var a=t.createBuffer(),i=t.createBuffer();if(!a||!i)throw new Error("create buffer error");this.positionBuffer=a,this.indexBuffer=i,t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.fbs={blur:this.createTextureLayers(),segmentationFix:this.createTextureLayers()},this.textures={background:Ws(t),image:Ws(t),resizedImage:Ws(t),segmentationMask:Ws(t)},window.addEventListener("resize",this.onresize)}return e.prototype.onresize=function(){var e=this,n=e.$canvas,t=e.gl,a=e.fbs,i=n.width||n.clientWidth,o=n.height||n.clientHeight;n.width=i,n.height=o,t.viewport(0,0,i,o),a&&function(e,n){for(var t=n.height,a=n.width,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];i.forEach((function(n){n.forEach((function(n){Ys(e,n.framebuffer),Ks(e,n.texture,a,t)}))}))}(t,{width:i,height:o},a.blur,a.segmentationFix)},e.prototype.loadTextures=function(e){var n=e.image,t=e.resizedImage,a=e.segmentationMask,i=e.background,o=this.gl,r=this.textures;return o.bindTexture(o.TEXTURE_2D,r.image),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),i||(o.bindTexture(o.TEXTURE_2D,r.resizedImage),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)),o.bindTexture(o.TEXTURE_2D,r.segmentationMask),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a),i&&(o.bindTexture(o.TEXTURE_2D,r.background),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i)),o.bindTexture(o.TEXTURE_2D,null),r},e.prototype.close=function(){var e=this,n=e.gl,t=e.positionBuffer,a=e.indexBuffer,i=e.pBackgroundComposer,o=e.pBlurFast,r=e.pBlurFastWithMask,s=e.pAlphaCutter,l=e.fbs,c=e.textures;window.removeEventListener("resize",this.onresize),n.bindBuffer(n.ARRAY_BUFFER,null),n.deleteBuffer(t),n.deleteBuffer(a),n.useProgram(null),i.destroy(),o.destroy(),r.destroy(),s.destroy(),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){n.forEach((function(n){e.deleteFramebuffer(n.framebuffer),e.deleteTexture(n.texture)}))}))}(n,l.blur,l.segmentationFix),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){return e.deleteTexture(n)}))}(n,c.background,c.image,c.resizedImage,c.segmentationMask)},e.prototype.drawGeometry=function(){var e=this,n=e.gl,t=e.indexBuffer,a=e.indices;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.drawElements(n.TRIANGLES,a.length,n.UNSIGNED_SHORT,0)},e.prototype.createTextureLayers=function(){var e=this.gl,n=this.$canvas,t=n.width,a=n.height;return[zs(e,t,a),zs(e,t,a)]},e.prototype.setGeometry=function(e,n){var t=this.gl,a=this.positionBuffer;t.bindBuffer(t.ARRAY_BUFFER,a),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,3,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,0),void 0!==n&&(t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT))},e.prototype.setParameters=function(e){Object.assign(this.parameters,e)},e.prototype.draw=function(e){var n,t,a=this,i=a.gl,o=a.$canvas,r=a.parameters,s=a.pBlurFastWithMask,l=a.pBackgroundComposer,c=a.pBlurFast,d=a.pAlphaCutter,u=a.fbs,_=r.fixSegmentation,v=r.fixSegmentationBlurStrength,p=r.blurStrength,f=r.fixSegmentationIterations,A=r.alphaCutterLowerBound,g=r.alphaCutterUpperBound,h=o.width,m=o.height;i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.viewport(0,0,h,m),i.disable(i.BLEND),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var C=this.loadTextures(e),E=null,S=e.background?C.background:null;if(_){c.bind(),this.setGeometry(c.attributes.position),c.uniforms.iResolution(h,m,0),c.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,C.segmentationMask),c.uniforms.texture(0);for(var T=0,I=0;I<f;++I){var N=(f-I-1)*v,x=I%2==0?[N,0]:[0,N];(n=c.uniforms).direction.apply(n,x),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[T%2].framebuffer),this.drawGeometry(),i.bindTexture(i.TEXTURE_2D,u.segmentationFix[T%2].texture),++T}d.bind(),this.setGeometry(d.attributes.aVertexCoord,d.attributes.aTextureCoord),d.uniforms.uLowerBound(A),d.uniforms.uUpperBound(g),d.uniforms.uAlphaTexture(0),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[T%2].framebuffer),this.drawGeometry(),E=u.segmentationFix[T%2].texture}if(!S){s.bind(),this.setGeometry(s.attributes.position),s.uniforms.iResolution(h,m,0),s.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),s.uniforms.uTextureMask(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,C.resizedImage),s.uniforms.uTextureOriginal(1);var y=0;for(I=0;I<8;++I)N=(8-I-1)*p,x=I%2==0?[N,0]:[0,N],(t=s.uniforms).direction.apply(t,x),i.bindFramebuffer(i.FRAMEBUFFER,u.blur[y%2].framebuffer),this.drawGeometry(),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,u.blur[y%2].texture),++y;S=u.blur[(y-1)%2].texture}l.bind(),this.setGeometry(l.attributes.aVertexCoord,l.attributes.aTextureCoord),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),l.uniforms.uAlphaTexture(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,S),l.uniforms.uBackgroundTexture(1),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,C.image),l.uniforms.uCameraFrameTexture(2),i.bindFramebuffer(i.FRAMEBUFFER,null),this.drawGeometry()},e}(),nl=function(){function e(e){this._effect=e}return Object.defineProperty(e.prototype,"video",{set:function(e){this._video=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{set:function(e){this._canvas=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){},e}(),tl=function(e){function n(){var n=e.call(this,xs.BACKGROUND)||this;return n._imageEdit=new Os,n._WebGlBlend=null,n}return fs(n,e),n.prototype.setBackgroundImage=function(e){return As(this,void 0,void 0,(function(){var n,t;return gs(this,(function(a){switch(a.label){case 0:return n=this,e?[4,bs(e)]:[3,2];case 1:return t=a.sent(),[3,3];case 2:t=void 0,a.label=3;case 3:return n._nextBackgroundImage=t,[2]}}))}))},n.prototype._updateBackground=function(){try{if(this._nextBackgroundImage){var e=this._canvas,n=this._imageEdit,t=e.width,a=e.height;this._backgroundImage=n.resize(this._nextBackgroundImage,t,a),delete this._nextBackgroundImage}}catch(e){console.warn(e)}},n.prototype.draw=function(e){try{if(this._WebGlBlend||(this._WebGlBlend=new el(this._canvas)),this._nextBackgroundImage&&this._updateBackground(),this._WebGlBlend){var n=Object.assign({background:this._backgroundImage},e);this._WebGlBlend.draw(n)}}catch(e){console.warn(e)}},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGlBlend&&(this._WebGlBlend.close(),this._WebGlBlend=null)},n}(nl),al=function(e){function n(){var n=e.call(this,xs.BLUR)||this;return n._WebGLEffects=null,n._savedOptions=null,n}return fs(n,e),n.prototype.draw=function(e){try{this._WebGLEffects||(this._WebGLEffects=new el(this._canvas),this._savedOptions&&this._WebGLEffects.setParameters(this._savedOptions)),this._WebGLEffects.draw(e)}catch(e){console.warn(e)}},n.prototype.setEffects=function(e){this._savedOptions=e,this._WebGLEffects&&this._WebGLEffects.setParameters(e)},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGLEffects&&(this._WebGLEffects.close(),this._WebGLEffects=null)},n}(nl),il=function(){function e(e){this.params=e}return e.prototype.getMappedParams=function(){return{id:this.params.id,originalUrl:this.params.original,previewUrl:this.params.preview,isPredefined:!0,tags:this.params.tags}},e}(),ol=[{audio:!1,video:{frameRate:25,height:250,width:436}},{audio:!1,video:{frameRate:25}},{audio:!1,video:!0}],rl=function(){var e,n,t=new Map;[3030,3029,3028,3019,3026,3027,3023,3024,3025,3020,3021,3022,3015,3013,3016,3012,3014,3017,3018].forEach((function(e){return t.set(e,null)}));try{for(var a=(0,i.__values)(Rs.backgrounds),o=a.next();!o.done;o=a.next()){var r=o.value;t.has(r.id)&&t.set(r.id,new il(r))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return(0,i.__spreadArray)([],(0,i.__read)(t.values()),!1).filter(Boolean)}(),sl=function(e){var n;return null===(n=e.sizes)||void 0===n?void 0:n.reduce((function(e,n){return e[n.type]=n.url,e}),{})},ll=function(e){var n=sl(e);return(null==n?void 0:n.x)||(null==n?void 0:n.m)||(null==n?void 0:n.s)||""},cl=function(e,n){if(n){var t=n.find((function(n){return n.id===e}));if(t)return Promise.resolve({id:t.id,url:t.originalUrl})}return(0,sn.photosGetAllImages)({photo_ids:""+e}).then((function(e){try{var n=e.items[0];return n?{id:n.id,url:ll(n)}:null}catch(e){return null}}))},dl=t(71982),ul=function(e){var n=e.children,t=e.className,a=e.style,r=e.passedRef,c=(0,i.__rest)(e,["children","className","style","passedRef"]),d=(0,l.useCallback)((function(){}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)(t),style:a,ref:r},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__item--radio"},{children:(0,o.jsx)(dl.default,(0,i.__assign)({},c,{onChange:d}),void 0)}),void 0)]},void 0)},_l=(0,l.memo)((function(e){var n=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(ul,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--with-border")},{children:n("calls_virtual_background_settings_no_background")}),void 0)})),vl=(0,l.memo)((function(e){return(0,o.jsx)(ul,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--blur")}),void 0)})),pl=t(45898),fl=(0,l.memo)((function(){return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--add-image")},{children:(0,o.jsx)(pl.default,{},void 0)}),void 0)})),Al=(0,l.forwardRef)((function(e,n){var t=(0,i.__rest)(e,[]);return(0,o.jsx)("div",(0,i.__assign)({},t,{ref:n,style:{width:18,height:18}},{children:(0,o.jsxs)("svg",(0,i.__assign)({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("rect",{width:"18",height:"18",rx:"2",fill:"black",fillOpacity:"0.4"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.10202 5L5 6.10202L7.89798 9L5 11.898L6.10202 13L9 10.102L11.898 13L13 11.898L10.102 9L13 6.10202L11.898 5L9.10108 7.7969L9 7.89798L6.10202 5Z",fill:"white",fillOpacity:"0.72"},void 0)]}),void 0)}),void 0)})),gl=t(54190),hl=(0,l.memo)((function(e){var n=e.backgroundUrl,t=e.checked,a=e.onDelete,r=e.photoId,c=e.isPredefinedBackground,d=e.isStarBackground,u=(0,i.__rest)(e,["backgroundUrl","checked","onDelete","photoId","isPredefinedBackground","isStarBackground"]),_=(0,l.useContext)(E.LangContext).getLang,v=(0,l.useRef)(null),p=(0,i.__read)((0,l.useState)(!0),2),f=p[0],A=p[1],g=(0,l.useMemo)((function(){return(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:_(t?"calls_cant_remove_background":"calls_delete_background")}},void 0)}),[t]),h=(0,l.useCallback)((function(e){e.stopPropagation(),t||a(r)}),[t,r]);return(0,l.useEffect)((function(){var e,t;return v.current&&(e=new IntersectionObserver((function(a){var o,r;try{for(var s=(0,i.__values)(a),l=s.next();!l.done;l=s.next()){l.value.isIntersecting&&(e.disconnect(),(t=new Image).src=n,t.onload=function(){A(!1),t.remove()})}}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}}),{threshold:0,root:null}),e.observe(v.current)),function(){t&&(t.onload=null,t.remove()),null==e||e.disconnect()}}),[]),(0,o.jsxs)(ul,(0,i.__assign)({},u,{checked:t,className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--background",{"VirtualBackgroundSettings__item--background-star":!f&&!!d}),passedRef:v,style:{backgroundImage:f?void 0:"url("+n+")"}},{children:[f&&(0,o.jsx)(gl.DivBlockSkeleton,{classNames:"VirtualBackgroundSettings__item--background__skeleton",height:80},void 0),!c&&!f&&(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item--background__deletebtn",{"VirtualBackgroundSettings__item--background__deletebtn--disabled":t}),onClick:h},{children:(0,o.jsx)(Ee.TooltipNew,(0,i.__assign)({content:g,className:"VirtualBackgroundSettings__item__popper",position:"t",align:"center"},{children:(0,o.jsx)(Al,{},void 0)}),void 0)}),void 0)]}),void 0)})),ml=function(){var e=(0,c.useSelector)((function(e){return e.me}));return{isAnonymous:(0,P.isParticipantAnonym)(e)}},Cl=function(){function e(e){this.$c=e,this.gl=this.$c.getContext("webgl")}return e.prototype.draw=function(){var e=this.gl;null==e||e.clearColor(0,0,0,0),null==e||e.clear(e.COLOR_BUFFER_BIT)},e}(),El=function(e){var n=e.backgroundList,t=e.$srcElement,a=e.userStream,o=(0,l.useRef)(null),r=(0,l.useRef)(null),s=(0,l.useRef)(null),c=(0,l.useRef)(null);null===c.current&&(c.current=new Os);var u=(0,l.useRef)(null),_=(0,l.useRef)(d.EVideoEffectType.NONE),v=(0,l.useRef)(d.EVideoEffectType.NONE),p=(0,l.useRef)(void 0),f=(0,l.useRef)(null),A=(0,l.useRef)(null),g=(0,l.useRef)(!1),h=(0,i.__read)((0,l.useState)(!1),2),m=h[0],C=h[1],E=(0,l.useCallback)((function(e){g.current="play"===e,C("play"===e)}),[]),S=(0,l.useCallback)((function(e,n){void 0===n&&(n=!1),v.current=e,n||(_.current=e)}),[]),T=(0,l.useCallback)((function(){if(f.current&&clearTimeout(f.current),g.current)if(t.current&&r.current)try{r.current.requestSegmentation(t.current)}catch(e){console.error("[useVideoEffects][onRequestSegmentation][error]",e)}else f.current=setTimeout((function(){T()}),300)}),[]),I=(0,l.useCallback)((function(e){var t,a,r;if(null===(t=o.current)||void 0===t?void 0:t.isReady)switch(e){case d.EVideoEffectType.ADD:break;case d.EVideoEffectType.BLUR:S(e),p.current&&(p.current=void 0),g.current||(E("play"),T());break;case d.EVideoEffectType.NONE:S(e),p.current&&(p.current=void 0),null===(a=u.current)||void 0===a||a.draw(),E("stop");break;default:var s=n.find((function(n){return n.id===e}));s&&(S(e,!0),(r=s.originalUrl,(0,i.__awaiter)(void 0,void 0,Promise,(function(){return(0,i.__generator)(this,(function(e){return[2,new Promise((function(e,n){var t=document.createElement("img");t.crossOrigin="anonymous",t.onerror=function(e){n("Failed image loading: "+e)},t.onload=function(){return e(t)},t.src=r}))]}))}))).then((function(n){if(!o.current)throw new Error("output canvas is not initialized");if(!c.current)throw new Error("ImageEdit class is not initialized");if(v.current!==e)throw new Error("Settings changed during load");var t=o.current,a=t.width,i=t.height;return c.current.resize(n,a,i)})).then((function(n){if(v.current!==e)throw new Error("Settings changed during load");S(e),p.current=n,g.current||(E("play"),T())})).catch(console.warn))}else A.current=function(){I(e)}}),[n]),N=(0,l.useCallback)((function(e){switch(_.current){case d.EVideoEffectType.ADD:case d.EVideoEffectType.NONE:break;case d.EVideoEffectType.BLUR:requestAnimationFrame((function(){var n;null===(n=s.current)||void 0===n||n.draw(e),g.current&&T()}));break;default:requestAnimationFrame((function(){var n,t=Object.assign({background:p.current},e);null===(n=s.current)||void 0===n||n.draw(t),g.current&&T()}))}}),[]);return(0,l.useEffect)((function(){var e;if(a){if(o.current){var n=a.getVideoTracks()[0].getSettings(),t=n.width,l=n.height;o.current.width=t||436,o.current.height=l||250,o.current.isReady=!0,null===(e=A.current)||void 0===e||e.call(A);s.current=new el(o.current),u.current=new Cl(o.current);var c=new Promise((function(e,n){var t=new Us({onReady:e,onError:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,(0,i.__spreadArray)([],(0,i.__read)(e),!1)),n()},onFrame:N});t.createModel(!0)})).then((function(e){return r.current=e,e})).catch((function(){r.current=null}));return function(){var e,n;null===(e=s.current)||void 0===e||e.close(),null===(n=r.current)||void 0===n||n.destroy(),c.then((function(e){e&&e.destroy()})),s.current=null,r.current=null,A.current=null}}console.error("[useVideoEffects][on-userStream-update] canvas is not initialized")}}),[a]),{$canvas:o,onRequestSegmentation:T,onUpdateVideoEffectsSettings:I,isPlaying:m}},Sl=t(23326),Tl=function(e){e.getTracks().forEach((function(e){return e.stop()}))},Il=function(e){var n=e.className;return(0,o.jsx)("svg",(0,i.__assign)({className:n,width:"4",height:"4",viewBox:"0 0 4 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 4V0H0C2.20898 0 4 1.79077 4 4Z",fill:"white"},void 0)}),void 0)},Nl=(0,l.memo)((function(e){var n=e.onClick,t=e.id,a=e.content;return(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettingsCarousel__Item",onClick:function(){return null==n?void 0:n(t)}},{children:a}),void 0)})),xl=function(e){var n=e.backgroundList,t=e.onDeleteBackground,a=e.onChooseBackground,r=e.chosen,c=e.videoOptions,u=e.isSferum,_=(0,ue.useLang)().getLang,v=function(e){var n=(0,i.__read)((0,l.useState)(null),2),t=n[0],a=n[1],o=(0,i.__read)((0,l.useState)(!1),2),r=o[0],s=o[1],c=(0,l.useRef)(!1),d=(0,Sl.useIsMounted)(),u=(0,l.useRef)(0),_=(0,l.useCallback)((function(){if(!c.current){s(!1),c.current=!0;var n=function(t){return navigator.mediaDevices.getUserMedia(t).then((function(e){d()?a(e):Tl(e),c.current=!1})).catch((function(t){++u.current<e.length?n(e[u.current]):(a(null),s(t),c.current=!1)}))};n(e[u.current])}}),[e]);return(0,l.useEffect)((function(){_();var e=function(){u.current=0,_()};return navigator.mediaDevices.addEventListener("devicechange",e),function(){navigator.mediaDevices.removeEventListener("devicechange",e)}}),[_]),(0,l.useEffect)((function(){return function(){t&&Tl(t)}}),[t]),{userStream:t,error:r,updateUserMediaStream:_}}(ol),p=v.userStream,f=v.error,A=v.updateUserMediaStream,g=function(e){var n=e.userStream,t=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t.current){var e=function(e){var n=e.getVideoTracks()[0].getSettings(),t=n.width,a=void 0===t?436:t,i=n.height;return{width:a,height:void 0===i?250:i}}(n),a=e.height,i=e.width;t.current.height=a,t.current.width=i,t.current.srcObject=n}}),[n]),{$video:t}}({userStream:p}).$video,h=El({backgroundList:n,$srcElement:g,userStream:p}),m=h.$canvas,C=h.onUpdateVideoEffectsSettings,E=h.isPlaying,S=function(e){var n=e.onDeleteBackground,t=e.backgroundList,a=e.chosen,r=e.onUpdateVideoEffectsSettings,s=e.onChooseBackground,c=e.isSferum,u=ml().isAnonymous;(0,l.useEffect)((function(){a!==d.EVideoEffectType.NONE&&r(a)}),[]);var _=(0,l.useCallback)((function(e){s(e),r(e)}),[s,r]),v=(0,l.useMemo)((function(){return t.map((function(e){var t;return{id:e.id,onClick:_,content:(0,o.jsx)(hl,{checked:a===e.id,backgroundUrl:e.previewUrl,onDelete:n,photoId:e.id,isPredefinedBackground:e.isPredefined,isStarBackground:null===(t=e.tags)||void 0===t?void 0:t.includes("star")},void 0)}}))}),[a,t,_]);return{carouselItems:(0,l.useMemo)((function(){var e=[{id:d.EVideoEffectType.NONE,onClick:_,content:(0,o.jsx)(_l,{checked:a===d.EVideoEffectType.NONE},void 0)},{id:d.EVideoEffectType.BLUR,onClick:_,content:(0,o.jsx)(vl,{checked:a===d.EVideoEffectType.BLUR},void 0)}];return c||(u||e.push({id:d.EVideoEffectType.ADD,onClick:_,content:(0,o.jsx)(fl,{},void 0)}),e.push.apply(e,(0,i.__spreadArray)([],(0,i.__read)(v),!1))),e}),[a,v,_])}}({backgroundList:n,onDeleteBackground:t,onUpdateVideoEffectsSettings:C,onChooseBackground:a,chosen:r,isSferum:u}).carouselItems;return(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__userStream"},{children:[p&&(0,o.jsx)("video",(0,i.__assign)({className:(0,s.classNames)("Video",{"Video--visible":!E},"Video--contain",{"Video--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]}),ref:g,controls:!1,crossOrigin:"anonymous",playsInline:!0,muted:!0,autoPlay:!0},{children:"Video tag is not supported"}),void 0),(0,o.jsx)("canvas",{ref:m,className:(0,s.classNames)("VirtualBackgroundSettings__userCanvas",{"VirtualBackgroundSettings__userCanvas--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]},{"VirtualBackgroundSettings__userCanvas--playing":E})},void 0),f&&(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__error"},{children:[(0,o.jsx)("div",{children:_("profile_no_camera_access")},void 0),(0,o.jsx)("div",{children:(0,o.jsx)(Un.default,(0,i.__assign)({className:"VirtualBackgroundSettings__error__btn",size:"m",onClick:A},{children:_("calls_button_allow_access")}),void 0)},void 0)]}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({VirtualBackgroundSettings__carousel__modalFix:!0,"VirtualBackgroundSettings__carousel__modalFix--sferum":u})},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__carousel"},{children:S.map((function(e){return(0,o.jsx)(Nl,{id:e.id,onClick:e.onClick,content:e.content},e.id)}))}),void 0),(0,o.jsx)(Il,{className:"VirtualBackgroundSettings__carousel__cornerIcon"},void 0)]}),void 0)]}),void 0)},yl=t(99939),bl=function(){var e=(0,yl.useSendStatsData)().sendStatsData,n=(0,l.useCallback)((function(n,t,a){var i=Xa(n,t,a),o=i.disabledActionType,r=i.prevSendValue,s=i.effectDuration;null!==o&&e(o,{background_id:r,background_duration:s})}),[e]),t=(0,l.useCallback)((function(t,a){var i,o=Date.now(),r=oe();r&&n(a,o,r),i=t>4e3?yl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_SELECTED:yl.ECallActionEventType.VIRTUAL_BACKGROUND_SELECTED,e(i,{background_id:t}),re(o)}),[e,n]),a=(0,l.useCallback)((function(e){var t=oe();if(t){var a=Date.now();n(e,a,t),se()}}),[n]),i=(0,l.useCallback)((function(n){e(yl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_ADDED,{background_id:n})}),[e]);return{sendVirtualBackgroundSelected:t,sendVirtualBackgroundDisabled:a,sendVirtualBackgroundDeleted:(0,l.useCallback)((function(n){e(yl.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DELETED,{background_id:n})}),[e]),sendVirtualBackgroundAdded:i}},Ol=function(){var e=u();return{onClose:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:null})}),[]),onClosePopupCalendar:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING})}),[])}},wl=function(e){var n=e.photos,t=e.onSuccessPhotoUpload,a=e.isSferum,o=u(),r=bl(),s=r.sendVirtualBackgroundAdded,c=r.sendVirtualBackgroundDeleted,_=ml().isAnonymous,v=(0,l.useRef)([]),p=(0,i.__read)((0,l.useState)(!1),2),f=p[0],A=p[1];(0,l.useEffect)((function(){n.length||_||a||(0,sn.photosGetAllImages)().then((function(e){o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Ll(e.items||[])})}))}),[]);var g=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));t&&(v.current.push(t),o({type:d.E_ACTION.VB_REMOVE_USER_PHOTO,photoId:e}))}),[n]),h=(0,l.useCallback)((function(){var e=v.current;return v.current=[],function(e,n){var t=e.map((function(e){return(0,sn.photosDelete)({photo_id:e.id})}));return Promise.allSettled(t).then((function(t){t.forEach((function(t,a){"fulfilled"===t.status&&n(e[a].id)}))}))}(e,c)}),[c]),m=(0,l.useCallback)((function(){var e=v.current;v.current=[];var t=n.concat(e);o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Ll(t)})}),[n]),C=(0,l.useCallback)((function(e){return A(!0),(0,sn.photosSaveBackgroundPhoto)(e).then((function(e){var n=e[0];if(!n)throw new Error("Something wrong with uploaded photo");return o({type:d.E_ACTION.VB_ADD_USER_PHOTO,photo:n}),t(n),s(n.id),n})).finally((function(){A(!1)}))}),[t,s]);return{photos:n,onAddBackground:C,onDeleteBackground:g,onSaveSettings:h,onCancelSettings:m,loadingUpload:f}};function Ll(e){return e.sort((function(e,n){return e.date<n.date?1:-1}))}var kl,Pl=function(e){var n=e.children,t=e.onClose,a=e.onSubmit,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:t,title:r("calls_warning"),appearance:"blue",className:"UploadBackgroundErrorModal",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:t,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:a},{children:r("calls_retry_action")}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundErrorModal__content"},{children:n}),void 0)}),void 0)},Ml=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO})}),[]);return(0,o.jsx)(Pl,(0,i.__assign)({onClose:t,onSubmit:a},{children:n("calls_error_upload_background_image")}),void 0)},Dl=function(e){var n=e.children,t=e.onClose,a=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(En.default,(0,i.__assign)({onClose:t,title:a("calls_upload_image_for_background"),appearance:"blue",className:"UploadBackgroundPhotoModal",footerHint:a("calls_if_you_have_problems_with_upload")},{children:n}),void 0)},jl=function(e){var n=e.onSubmit,t=e.loading,a=(0,l.useContext)(E.LangContext).getLang,r=(0,l.useRef)(null),s=function(e){var n=e.$inputEl,t=e.onSubmit,a=(0,i.__read)((0,l.useState)({}),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,l.useCallback)((function(){n.current&&(n.current.onchange=function(e){var n;d(!1);var a=null===(n=e.target.files)||void 0===n?void 0:n[0];if(a){var i=new FileReader;i.onload=function(){var e=new Image;e.onload=function(){!function(e){return(e.width>=510||e.width>7e3)&&(e.height>=200||e.height>7e3)}(e)?d(!0):(r({file:a,image:e}),t&&t(a))},e.onerror=function(){return d(!0)},e.src=i.result},i.onerror=function(){return d(!0)},i.readAsDataURL(a)}},n.current.click())}),[]);return{error:c,fileData:o,onClick:u}}({$inputEl:r,onSubmit:n}),c=s.onClick,d=s.error,u=(0,l.useMemo)((function(){return(""+a("profile_oph_err_size")).replace("{sorry}","<b>"+a("global_sorry_error")+"</b>").replace("{min}","200").replace("{max}","7000")}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto"},{children:[(0,o.jsx)("input",{ref:r,type:"file",className:"UploadBackgroundPhoto__upload"},void 0),d&&(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__error"},{children:[(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__left"},void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__right",dangerouslySetInnerHTML:{__html:u}},void 0)]}),void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__description",dangerouslySetInnerHTML:{__html:a("calls_you_can_upload_description")}},void 0),!t&&(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__button"},{children:(0,o.jsx)(Un.default,(0,i.__assign)({onClick:c},{children:a("calls_choose_file")}),void 0)}),void 0),t&&(0,o.jsx)("div",{className:"UploadBackgroundPhoto__progress"},void 0)]}),void 0)},Rl=function(e){var n=e.onAddBackground,t=e.loading,a=u(),r=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),s=(0,l.useCallback)((function(e){n(e).then(r).catch((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_ERROR})}))}),[r]);return(0,o.jsx)(Dl,(0,i.__assign)({onClose:r},{children:(0,o.jsx)(jl,{loading:t,onSubmit:s},void 0)}),void 0)},Bl=(0,l.memo)((function(e){var n=e.SDK,t=(0,i.__read)((0,l.useState)(!1),2),a=t[0],r=t[1],s=k((function(e){return e.popup})),_=k((function(e){return e.virtualBackgroundSettings.photos})),v=k((function(e){return!!e.config.sferum})),p=function(e){var n=e.photos;return{backgroundList:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(n),!1),(0,i.__read)(rl),!1).map((function(e){return e instanceof il?e.getMappedParams():{id:e.id,originalUrl:ll(e),previewUrl:(n=e,t=sl(n),(null==t?void 0:t.o)||(null==t?void 0:t.p)||(null==t?void 0:t.q)||(null==t?void 0:t.x)||(null==t?void 0:t.s)||""),isPredefined:!1};var n,t}))}),[n])}}({photos:_}).backgroundList,f=Ol().onClose,A=function(){var e=(0,c.useSelector)((function(e){return e.localDevice.stream})),n=(0,c.useSelector)((function(e){return e.localDevice.mediaSettings}));return{userStream:e,isVideoEnabled:!!(null==n?void 0:n.isVideoEnabled)}}(),g=A.userStream,h=A.isVideoEnabled,m=function(e){var n=e.backgroundList,t=u(),a=(0,i.__read)((0,l.useState)(ae),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){switch(e){case d.EVideoEffectType.BLUR:r(e);break;case d.EVideoEffectType.ADD:t({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO});break;case d.EVideoEffectType.NONE:r(e);break;default:n.some((function(n){return n.id===e}))&&r(e)}}),[n]),c=(0,l.useRef)(null),_=(0,l.useCallback)((function(e){return c.current=e}),[]);return(0,l.useEffect)((function(){c.current&&(s(c.current.id),c.current=null)}),[s]),{chosen:o,setChosen:r,onClick:s,onSuccessPhotoUpload:_}}({backgroundList:p}),C=m.chosen,E=m.setChosen,S=m.onClick,T=m.onSuccessPhotoUpload,I=wl({photos:_,onSuccessPhotoUpload:T,isSferum:v}),N=I.onCancelSettings,x=I.loadingUpload,y=I.onAddBackground,b=I.onDeleteBackground,O=I.onSaveSettings,w=function(e){var n=e.SDK,t=(0,l.useMemo)((function(){return{background:new tl,blur:new al,effect:new Vs({debug:!0})}}),[]);(0,l.useEffect)((function(){return n.setVideoEffects(t.effect),function(){t.effect.destroy()}}),[]);var a=(0,l.useCallback)((function(e){switch(e.type){case d.EVideoEffectType.BACKGROUND:t.background.setBackgroundImage(e.value).then((function(){n.changeVideoEffect(t.background)}));break;case d.EVideoEffectType.BLUR:n.changeVideoEffect(t.blur);break;case d.EVideoEffectType.NONE:n.changeVideoEffect(null);case d.EVideoEffectType.ADD:}}),[]);return{onSettingsChange:a}}({SDK:n}).onSettingsChange;!function(e){var n=e.userStream,t=e.onSettingsChange,a=e.backgroundList,i=e.isVideoEnabled,o=bl(),r=o.sendVirtualBackgroundSelected,s=o.sendVirtualBackgroundDisabled;(0,l.useEffect)((function(){if(n){var e=ae();i?"number"==typeof e?cl(e,a).then((function(n){n&&(t({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r(n.id,e))})):e===d.EVideoEffectType.BLUR&&(t({type:d.EVideoEffectType.BLUR}),r(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):(t({type:d.EVideoEffectType.NONE}),s(e))}}),[n,i])}({onSettingsChange:w,userStream:g,backgroundList:p,isVideoEnabled:h});var L=function(e){var n=e.chosen,t=e.settingsOpened,a=e.onSettingsChange,i=e.setChosen,o=e.backgroundList,r=e.isVideoEnabled,s=bl(),c=s.sendVirtualBackgroundSelected,u=s.sendVirtualBackgroundDisabled,_=(0,l.useRef)(null);return(0,l.useEffect)((function(){t&&(_.current=n)}),[t]),{onApplySettings:(0,l.useCallback)((function(){if(_.current!==n){var e=ae();ie(n),"number"==typeof n?cl(n,o).then((function(n){n&&(a({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r&&c(n.id,e))})):n===d.EVideoEffectType.BLUR?(a({type:d.EVideoEffectType.BLUR}),r&&c(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):n===d.EVideoEffectType.NONE&&(a({type:d.EVideoEffectType.NONE}),r&&u(e))}}),[a,o,n,c,u,r]),onRestoreSettings:(0,l.useCallback)((function(){_.current&&i(_.current)}),[i])}}({chosen:C,onSettingsChange:w,settingsOpened:a,setChosen:E,backgroundList:p,isVideoEnabled:h}),P=L.onRestoreSettings,M=L.onApplySettings,D=le(),j=D.videoOptions,R=D.onRestoreSettings,B=D.onSaveSettings,U=D.onChangeVideoOption;(0,l.useEffect)((function(){se()}),[]),(0,l.useEffect)((function(){s!==d.POPUP_VIRUTAL_BACKGROUND||a||r(!0)}),[s]);var H=(0,l.useCallback)((function(){O(),f(),r(!1),M(),B()}),[O,f,M,B]),G=(0,l.useCallback)((function(){N(),f(),r(!1),P(),R()}),[N,f,P,R]);return(0,o.jsxs)(o.Fragment,{children:[s===d.POPUP_VIRUTAL_BACKGROUND&&(0,o.jsx)(vs,(0,i.__assign)({onClose:G,onSubmit:H,onChangeVideoOption:U,videoOptions:j},{children:(0,o.jsx)(xl,{chosen:C,backgroundList:p,onDeleteBackground:b,onChooseBackground:S,videoOptions:j,isSferum:v},void 0)}),void 0),s===d.POPUP_UPLOAD_BACKGROUND_PHOTO&&(0,o.jsx)(Rl,{onAddBackground:y,loading:x},void 0),s===d.POPUP_UPLOAD_BACKGROUND_ERROR&&(0,o.jsx)(Ml,{},void 0)]},void 0)})),Ul=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallUserIconGradient)"},void 0),(0,o.jsx)("path",{d:"M17.25 10.25a3.25 3.25 0 1 0-6.5 0 3.25 3.25 0 1 0 6.5 0ZM7.5 18.462v.7c0 .463.375.838.838.838h11.325a.838.838 0 0 0 .837-.837v-.701C20.5 15.769 16.17 15 14 15s-6.5.77-6.5 3.462Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallUserIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#70B2FF"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#5C9CE6"},void 0)]}),void 0)},void 0)]}),void 0)},Hl=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallWaitingHallIconGradient)"},void 0),(0,o.jsx)("path",{d:"M13.85 6.85h1.072c1.529 0 2.095.127 2.657.428.493.263.88.65 1.143 1.143.3.562.428 1.129.428 2.657v5.842c0 1.528-.127 2.098-.428 2.66a2.74 2.74 0 0 1-1.143 1.14c-.562.3-1.128.43-2.657.43H13.85",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round"},void 0),(0,o.jsx)("path",{d:"M10.85 10.85 14 14l-3.15 3.15M6.85 14h6.6",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round",strokeLinejoin:"round"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallWaitingHallIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#50C750"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#32B332"},void 0)]}),void 0)},void 0)]}),void 0)},Gl=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallAnonymousIconGradient)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"m9.52 10.906.503-2.328A2 2 0 0 1 11.978 7h4.044a2 2 0 0 1 1.955 1.578l.503 2.328a.916.916 0 0 1 .015.094H20a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h1.505a.902.902 0 0 1 .015-.094Zm3.447 7a2.5 2.5 0 1 1-.217-1.497 4.984 4.984 0 0 1 2.5 0 2.5 2.5 0 1 1-.217 1.498 3.488 3.488 0 0 0-2.066 0Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallAnonymousIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},Vl=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallCameraIcon)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.772 10.865C7.5 11.4 7.5 12.1 7.5 13.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092c.535.273 1.235.273 2.635.273h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092c.273-.535.273-1.235.273-2.635v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C15.6 9.5 14.9 9.5 13.5 9.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093Zm10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417v-2.464a.5.5 0 0 1 .223-.416Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallCameraIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},Fl=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallMicrophoneIcon)"},void 0),(0,o.jsx)("path",{d:"M11.498 10.5c0-1.38 1.12-2.5 2.502-2.5a2.501 2.501 0 0 1 2.503 2.5v3c0 1.38-1.12 2.5-2.503 2.5a2.501 2.501 0 0 1-2.502-2.5v-3Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M9.194 13.767a.75.75 0 0 1 .891.576 4.005 4.005 0 0 0 7.83 0 .75.75 0 0 1 1.468.314 5.508 5.508 0 0 1-4.632 4.292v1.301a.75.75 0 0 1-1.502 0v-1.3a5.508 5.508 0 0 1-4.632-4.293.75.75 0 0 1 .577-.89Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallMicrophoneIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},Wl=function(){return(0,l.useContext)(E.LangContext)},zl=function(e){var n=e.actionButtons,t=e.onClose,a=e.ownerOptions,r=e.selectedOwnerId,s=e.waitingHall,l=e.allowAnon,c=e.onGroupSelectChange,d=e.onChangeWaitingHall,u=e.onChangeAllowAnon,_=e.microphoneOptions,v=e.cameraOptions,p=e.onMicrophoneSelectChange,f=e.onCameraSelectChange,A=e.selectedMicrophoneOption,g=e.selectedCameraOption,h=Wl().getLang;return(0,o.jsxs)(T.default,(0,i.__assign)({className:"CreateCallByLinkModal",onClose:t,disableBodyScroll:!0},{children:[(0,o.jsx)(xo.ModalHeader,{title:h("calls_create_call_by_link_title"),onClose:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CreateCallByLinkModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CreateCallByLinkModal__description"},{children:h("calls_create_call_by_link_description")}),void 0),(0,o.jsxs)(Tn.default,{children:[(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(Ul,{},void 0),aside:(0,o.jsx)(uo.default,{className:"CreateCallByLinkModalOptions__longselect",options:a,value:r,onChange:c,disabled:a.length<=1},void 0)},{children:h("calls_create_call_by_link_by_name")}),void 0),(0,o.jsx)(ni,(0,i.__assign)({canBeHovered:!1,onClick:d,icon:(0,o.jsx)(Hl,{},void 0),hint:h("calls_menu_waiting_hall_description"),aside:(0,o.jsx)(F.default,{onChange:d,checked:s},void 0)},{children:h("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(ni,(0,i.__assign)({canBeHovered:!1,onClick:u,icon:(0,o.jsx)(Gl,{},void 0),hint:h("calls_create_call_by_link_anon_hint_shedule"),aside:(0,o.jsx)(F.default,{onChange:u,checked:l},void 0)},{children:h("calls_create_call_by_link_anon")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(Fl,{},void 0),aside:(0,o.jsx)(uo.default,{className:"CreateCallByLinkModalOptions__longselect",options:_,value:A,onChange:p},void 0)},{children:h("calls_create_call_by_link_microphones")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(Vl,{},void 0),aside:(0,o.jsx)(uo.default,{className:"CreateCallByLinkModalOptions__longselect",options:v,value:g,onChange:f},void 0)},{children:h("calls_create_call_by_link_cameras")}),void 0)]},void 0)]}),void 0),(0,o.jsx)(rs.ModalFooter,{actionButtons:n},void 0)]}),void 0)},Kl=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=Wl().getLang,s=t.participants[t.me],_=(0,i.__read)((0,l.useState)(s.peerId),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)([{value:s.peerId,label:s.name}]),2),A=f[0],g=f[1],h=(0,i.__read)((0,l.useState)(!1),2),m=h[0],C=h[1],E=(0,i.__read)((0,l.useState)(!0),2),S=E[0],T=E[1],I=(0,i.__read)((0,l.useState)(J.MuteState.UNMUTE),2),N=I[0],x=I[1],y=(0,i.__read)((0,l.useState)(J.MuteState.UNMUTE),2),b=y[0],O=y[1];(0,l.useEffect)((function(){(0,sn.getGroupsForCall)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(A),!1);e.count>0&&(e.items.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),g(n))}))}),[]);var w=(0,l.useCallback)((function(e){p(Number(e.selected.value))}),[]),L=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),C(!m))}),[m]),k=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),T(!S))}),[S]),P=(0,l.useCallback)((function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),M=(0,l.useCallback)((function(){var e,a={};S||(a[J.ConversationOption.REQUIRE_AUTH_TO_JOIN]=!0),m&&(a[J.ConversationOption.WAITING_HALL]=!0);var i={};N!==J.MuteState.UNMUTE&&(i[J.MediaOption.AUDIO]=N),b!==J.MuteState.UNMUTE&&(i[J.MediaOption.VIDEO]=b,i[J.MediaOption.SCREEN_SHARING]=b),n.startCall(!1,null!==(e=t.entryPoint)&&void 0!==e?e:d.CallStatSource.HISTORY_CREATE,!1,v>0?0:v,{conversationOptions:a,createLink:!0,mediaOptions:i})}),[v,m,S,N,b]),D=[(0,o.jsx)(Un.default,(0,i.__assign)({onClick:P,appearance:"tertiary"},{children:r("calls_cancel")}),"cancel"),(0,o.jsx)(Un.default,(0,i.__assign)({onClick:M},{children:r("calls_create_call_by_link")}),"call")],j=[{value:J.MuteState.UNMUTE,label:r("calls_create_call_by_link_phone_option_allow_always")},{value:J.MuteState.MUTE,label:r("calls_create_call_by_link_phone_option_disallow_entrance")},{value:J.MuteState.MUTE_PERMANENT,label:r("calls_create_call_by_link_phone_option_disallow_always")}],R=function(e){var n=J.MuteState.UNMUTE;return e==J.MuteState.MUTE?n=J.MuteState.MUTE:e==J.MuteState.MUTE_PERMANENT&&(n=J.MuteState.MUTE_PERMANENT),n},B=(0,l.useCallback)((function(e){x(R(String(e.selected.value)))}),[]),U=(0,l.useCallback)((function(e){O(R(String(e.selected.value)))}),[]);return(0,o.jsx)(zl,{actionButtons:D,onClose:P,ownerOptions:A,selectedOwnerId:v,waitingHall:m,allowAnon:S,onGroupSelectChange:w,onChangeWaitingHall:L,onChangeAllowAnon:k,microphoneOptions:j,cameraOptions:j,onMicrophoneSelectChange:B,onCameraSelectChange:U,selectedMicrophoneOption:N,selectedCameraOption:b},void 0)},Yl=function(e){var n=e.onClose,t=e.title,a=e.description,r=e.btnText;return(0,o.jsx)(En.default,(0,i.__assign)({className:"OnHangupModal",onClose:n,title:t,appearance:"blue",actionButtons:(0,o.jsx)(Un.default,(0,i.__assign)({onClick:n},{children:r}),void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"OnHangupModal__description"},{children:a}),void 0)}),void 0)},Ql=function(){var e=(0,ue.useLang)().getLang,n=Ol().onClose,t=(0,c.useSelector)((function(e){return e.popup})),a=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.opponentName})),i=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.isMeEndedCallForAll})),r=u(),s="",_="",v=e("calls_close"),p=!1;switch(t){case d.POPUP_ON_CALL_HANGUP_BUSY:s=e("calls_user_busy"),_=e("calls_user_busy_description").replace("{username}",a||e("calls_opponent"));break;case d.POPUP_ON_CALL_HANGUP_KILLED:if(i){p=!0;break}s=e("calls_join_error_not_found_conversation"),_=e("calls_admin_ended_call_for_everyone");break;case d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE:if(i){p=!0;break}s=e("calls_meeting_ended_title"),_=e("calls_meeting_ended_desc"),v=e("calls_warning_ok");break;case d.POPUP_ON_CALL_HANGUP_BANNED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_banned");break;case d.POPUP_ON_CALL_HANGUP_REMOVED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_kicked")}return(0,l.useEffect)((function(){return function(){r({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})}}),[]),(0,l.useEffect)((function(){p&&n()}),[p,n]),p?null:(0,o.jsx)(Yl,{onClose:n,title:s,description:_,btnText:v},void 0)};!function(e){e[e.Wall=0]="Wall",e[e.Community=1]="Community",e[e.History=2]="History",e[e.IM=3]="IM"}(kl||(kl={}));var Zl=function(){return(0,o.jsx)("svg",(0,i.__assign)({width:"11",height:"6",viewBox:"0 0 11 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M0.75 0.75L5.5 5.25L10.25 0.75",stroke:"#AEB7C2",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},void 0)}),void 0)},Jl=t(11798),Xl=function(e){var n=e.id,t=e.onClick,a=e.text,r=e.type,l=void 0===r?"regular":r;return(0,o.jsxs)("span",(0,i.__assign)({className:(0,s.classNames)("TokenInput__token",{"TokenInput__token--add":"add"===l}),onClick:"add"===l?function(){return t()}:void 0},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"TokenInput__label"},{children:a}),void 0),(0,o.jsx)("button",(0,i.__assign)({"data-id":n,className:"TokenInput__remove",onClick:function(){return t(n)}},{children:(0,o.jsx)(Jl.default,{},void 0)}),void 0)]}),n)},ql="https://vk.com/images/icons/im_multichat_50.png",$l=function(){},ec=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;return t&&t.photo_50||ql},nc=function(e,n){var t,a;switch(e.conversation.peer.type){case"chat":return(null===(a=null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.photo)||void 0===a?void 0:a.photo_50)||ql;case"user":return ec(n,e.conversation.peer.id);default:return ql}},tc=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;if(!t||!t.first_name)return"";var a=t.first_name;return t.last_name&&(a+=" "+t.last_name),a},ac=function(e,n){var t;switch(e.conversation.peer.type){case"chat":return(null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.title)||"";case"user":return tc(n,e.conversation.peer.id);default:return""}},ic=(0,l.forwardRef)((function(e,n){var t=e.handleAddToken,a=e.handleChange,r=e.handleRemoveToken,c=e.handleSelect,d=e.opened,u=e.tokens,_=e.value,v=e.filteredOptions,p=e.onClickAway,f=e.loading,A=(0,ue.useLang)().getLang,g=function(e){var n=e.ref,t=e.onClickAway,a=(0,l.useCallback)((function(e){var a;switch(e.code){case"Escape":n&&"function"!=typeof n&&(null===(a=n.current)||void 0===a||a.blur()),t();break;case"Tab":t()}}),[n,t]);return{handleClickAway:a}}({ref:n,onClickAway:p}).handleClickAway;return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ModalSendMessage__MultiSelect",{"ModalSendMessage__MultiSelect--hidden":!!f&&!v.length})},{children:(0,o.jsx)(ja.default,{opened:d,placeholder:A("calls_enter_recipient_or_dialog_name"),removeTokenPlaceholder:"Remove",disableEmptyList:!!f,tokens:u,hasMore:!1,onChange:a,value:_,onSelect:c,onRemoveToken:r,disableOnSelectInputFocus:!0,hideInputWithName:!0,renderInput:function(){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TokenInput","ModalSendMessage__TokenInput",{"ModalSendMessage__TokenInput--opened":d&&!f}),onClick:t},{children:[u.map((function(e){return(0,o.jsx)(Xl,(0,i.__assign)({},e,{onClick:r}),e.id)})),!(!u.length||d)&&(0,o.jsx)(Xl,{id:"token-add",text:A("calls_add"),type:"add",onClick:$l},"token-add"),(!u.length||d)&&(0,o.jsx)("input",{ref:n,className:"ModalSendMessage__input",type:"text",value:_,onChange:a,onKeyDown:g,placeholder:A("calls_enter_recipient_or_dialog_name")},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__angle-icon"},{children:(0,o.jsx)(Zl,{},void 0)}),void 0)]}),void 0)},renderSuggest:function(e){return(0,o.jsx)(Bn.default,{"data-id":e.id,photo:e.photo,title:e.text,onClick:function(){return c(e.id)}},e.id)},data:v,notFoundText:A("calls_search_empty_list")},void 0)}),void 0)})),oc=function(e){var n=e.options,t=e.onChangeInput,a=(0,i.__read)((0,l.useState)(""),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)([]),2),_=u[0],v=u[1],p=(0,i.__read)((0,l.useState)((function(){return(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),2),f=p[0],A=p[1],g=(0,l.useRef)(null),h=(0,l.useCallback)((function(){d(!1),r("")}),[]);(0,l.useEffect)((function(){null==t||t(o)}),[o]),(0,l.useEffect)((function(){A(function(e,n,t){var a=t.reduce((function(e,n){return e[n.id]=!0,e}),{}),i=e.toLowerCase();return n.filter((function(e){return!a[e.id]&&e.text.toLowerCase().includes(i)}))}(o,n,_))}),[o,n,_]),function(e){var n=e.selector,t=e.opened,a=e.onClose;(0,l.useEffect)((function(){if(t){var e=function(e){var t=e.target;t instanceof HTMLElement&&(t.closest(n)||a(!1))};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}}),[t])}({selector:".ModalSendMessage__MultiSelect",onClose:h,opened:c});var m=(0,l.useCallback)((function(e){var n=e.target.value;r(n),d(!0)}),[]),C=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));return t&&v((function(e){var n=new Set(e);return n.add({id:t.id,text:t.text,src:t.photo}),(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),d(!1),r(""),Promise.resolve()}),[n]),E=(0,l.useCallback)((function(e){v((function(n){return n.filter((function(n){return n.id!==e}))})),d(!1)}),[]),S=(0,l.useCallback)((function(e){var n,t=e.target,a=null===(n=t.closest)||void 0===n?void 0:n.call(t,".TokenInput__token");a&&!a.classList.contains("TokenInput__token--add")||(d(!0),r(""),requestAnimationFrame((function(){var e;null===(e=g.current)||void 0===e||e.focus()})))}),[_,n]);return{ref:g,filteredOptions:f,handleAddToken:S,handleChange:m,handleRemoveToken:E,handleSelect:C,onClickAway:h,opened:c,options:n,tokens:_,value:o}},rc=function(e){var n=e.onClose,t=e.title,a=e.onSubmit,r=e.optionsIM,s=e.submitDisabled,c=e.initialText,d=e.onChangeInputIM,u=e.loading,_=(0,ue.useLang)().getLang,v=(0,i.__read)((0,l.useState)(c||""),2),p=v[0],f=v[1],A=(0,i.__read)((0,l.useState)(kl.IM),1)[0],g=oc({options:r,onChangeInput:d}),h=(0,l.useCallback)((function(e){var n=e.target.value;f(n)}),[]),m=(0,l.useCallback)((function(){switch(A){case kl.IM:var e=g.tokens.map((function(e){return e.id}));if(!e.length||!p)break;a({text:p,ids:e,destination:A})}}),[p,g.tokens,a,A]),C=!p||!g.tokens.length;return(0,o.jsx)(En.default,(0,i.__assign)({className:"ModalSendMessage",onClose:n,title:t,actionButtons:(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"primary",onClick:m,disabled:C||s},{children:_("calls_send")}),void 0),disableEscapeClose:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Main"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__Destination"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__RadioDestination"},{children:(0,o.jsx)(ic,(0,i.__assign)({loading:u},g),void 0)}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Message"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"ModalSendMessage__Message__title"},{children:_("calls_your_message")}),void 0),(0,o.jsx)(Or.default,{value:p,onChange:h},void 0)]}),void 0)]}),void 0)}),void 0)},sc=t(73521),lc=t(84356),cc=function(){var e=(0,ue.useLang)().getLang,n=(0,lc.usePromiseError)().handleError,t=u(),a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=k((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=function(){var e=(0,lc.usePromiseError)().handleError,n=(0,l.useRef)([]),t=(0,l.useRef)([]),a=(0,i.__read)((0,l.useState)([]),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)([]),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(!1),2),_=u[0],v=u[1],p=(0,Sl.useIsMounted)(),f=(0,l.useRef)(null),A=k((function(e){var n;return+((null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me)})),g=dc(),h=dc(),m=(0,l.useCallback)((function(a){f.current&&clearTimeout(f.current);var o=h.getId();if(!a||a.length<=2)return d(n.current),void r(t.current);var s=g.getId();f.current=setTimeout((function(){v(!0),Promise.allSettled([(0,sn.messagesSearch)({q:a}),(0,sn.friendsSearch)(A,a,20)]).then((function(e){var a=(0,i.__read)(e,2),s=a[0],l=a[1];if(p()&&o===h.prevId.current){var c,u;if("fulfilled"===s.status)(c=s.value).count&&c.conversations?r(c.conversations.map((function(e){var n,t,a;return{id:e.peer.id.toString(),photo:(null===(t=null===(n=e.chat_settings)||void 0===n?void 0:n.photo)||void 0===t?void 0:t.photo_50)||ql,text:(null===(a=e.chat_settings)||void 0===a?void 0:a.title)||""}}))):r(t.current);if("fulfilled"===l.status)(c=l.value).count?d((void 0===(u=c.items)&&(u=[]),u.map((function(e){return{id:e.id.toString(),photo:ec(e,e.id),text:tc(e,e.id)}})))):d(n.current)}})).catch(e).finally((function(){p()&&s===g.prevId.current&&v(!1)}))}),300)}),[]);return(0,l.useEffect)((function(){v(!0),(0,sn.messagesGetConversations)().then((function(e){if(p()){var n=function(e,n){var t,a;void 0===n&&(n=[]);var o=[];try{for(var r=(0,i.__values)(e),s=r.next();!s.done;s=r.next()){var l=s.value;"chat"===l.conversation.peer.type&&o.push({id:l.conversation.peer.id.toString(),photo:nc(l,n),text:ac(l,n)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}return o}(e.items,e.profiles);t.current=n,r(n)}})).catch(e).finally((function(){p()&&v(!1)}))}),[]),{conversations:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),(0,i.__read)(o),!1)}),[o,c]),loading:_,fetchSearchFriends:m}}(),v=_.conversations,p=_.fetchSearchFriends,f=_.loading,A=dc().getId,g=Ol().onClosePopupCalendar,h=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),m=(0,sc.useCalendarEventDetails)({meParticipant:h}),C=(0,Sl.useIsMounted)(),E=(0,l.useCallback)((function(e){if(e)return s(!0),e.destination===kl.IM?Promise.allSettled(e.ids.map((function(n){return(0,sn.messagesSend)({peer_id:+n,message:e.text,random_id:A()})}))).then(g).catch(n).finally((function(){C()&&s(!1)})):void 0}),[]),S=(0,l.useCallback)((function(){t({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})}),[t]);return(0,o.jsx)(rc,{onClose:S,onSubmit:E,optionsIM:v,title:e("calls_send_call_link_title"),submitDisabled:r,initialText:m.getDescription(c),onChangeInputIM:p,loading:f},void 0)};function dc(){var e=(0,l.useRef)(0);return e.current||(e.current=Date.now()),{getId:(0,l.useCallback)((function(){return e.current=Date.now(),e.current}),[]),prevId:e}}var uc=t(49336),_c=function(){return(0,o.jsxs)("svg",(0,i.__assign)({width:"40",height:"46",viewBox:"0 0 40 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("path",{d:"M30.5607 17.4393C31.1464 18.0251 31.1464 18.9749 30.5607 19.5607L18.5607 31.5607C17.9749 32.1464 17.0251 32.1464 16.4393 31.5607L10.4393 25.5607C9.85355 24.9749 9.85355 24.0251 10.4393 23.4393C11.0251 22.8536 11.9749 22.8536 12.5607 23.4393L17.5 28.3787L28.4393 17.4393C29.0251 16.8536 29.9749 16.8536 30.5607 17.4393Z",fill:"var(--accent)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1.5C12 0.671573 11.3284 0 10.5 0C9.67157 0 9 0.671573 9 1.5V3.10786L8.92347 3.11398C7.49669 3.23055 6.28944 3.47376 5.18709 4.03544C3.39955 4.94624 1.94624 6.39955 1.03544 8.18709C0.473764 9.28944 0.230548 10.4967 0.113976 11.9235C-2.00495e-05 13.3187 -1.09936e-05 15.0497 2.21849e-07 17.234V31.766C-1.09936e-05 33.9503 -2.00495e-05 35.6813 0.113976 37.0765C0.230548 38.5033 0.473764 39.7106 1.03544 40.8129C1.94624 42.6004 3.39955 44.0538 5.18709 44.9646C6.28944 45.5262 7.49669 45.7695 8.92347 45.886C10.3187 46 12.0497 46 14.234 46H25.766C27.9503 46 29.6813 46 31.0765 45.886C32.5033 45.7695 33.7106 45.5262 34.8129 44.9646C36.6004 44.0538 38.0538 42.6004 38.9646 40.8129C39.5262 39.7106 39.7695 38.5033 39.886 37.0765C40 35.6813 40 33.9503 40 31.766V17.234C40 15.0497 40 13.3187 39.886 11.9235C39.7695 10.4967 39.5262 9.28944 38.9646 8.18709C38.0538 6.39955 36.6004 4.94624 34.8129 4.03544C33.7106 3.47376 32.5033 3.23055 31.0765 3.11398C31.0511 3.1119 31.0256 3.10986 31 3.10786V1.5C31 0.671573 30.3284 0 29.5 0C28.6716 0 28 0.671573 28 1.5V3.00568C27.3129 2.99999 26.5702 3 25.766 3H21.5V1.5C21.5 0.671573 20.8284 0 20 0C19.1716 0 18.5 0.671573 18.5 1.5V3H14.234C13.4299 3 12.6871 2.99999 12 3.00568V1.5ZM28 6.0059C27.3158 6.00017 26.5546 6 25.7 6H21.5V7.5C21.5 8.32843 20.8284 9 20 9C19.1716 9 18.5 8.32843 18.5 7.5V6H14.3C13.4454 6 12.6842 6.00017 12 6.0059V7.5C12 8.32843 11.3284 9 10.5 9C9.67157 9 9 8.32843 9 7.5V6.11854C7.85638 6.22335 7.13009 6.41241 6.54906 6.70846C5.32601 7.33163 4.33164 8.32601 3.70846 9.54906C3.39819 10.158 3.20543 10.9265 3.10401 12.1678C3.00117 13.4265 3 15.035 3 17.3V31.7C3 33.965 3.00117 35.5735 3.10401 36.8322C3.20543 38.0735 3.39819 38.842 3.70846 39.4509C4.33164 40.674 5.32601 41.6684 6.54906 42.2915C7.15801 42.6018 7.92651 42.7946 9.16776 42.896C10.4265 42.9988 12.035 43 14.3 43H25.7C27.965 43 29.5735 42.9988 30.8322 42.896C32.0735 42.7946 32.842 42.6018 33.4509 42.2915C34.674 41.6684 35.6684 40.674 36.2915 39.4509C36.6018 38.842 36.7946 38.0735 36.896 36.8322C36.9988 35.5735 37 33.965 37 31.7V17.3C37 15.035 36.9988 13.4265 36.896 12.1678C36.7946 10.9265 36.6018 10.158 36.2915 9.54906C35.6684 8.32601 34.674 7.33163 33.4509 6.70846C32.8699 6.41241 32.1436 6.22335 31 6.11854V7.5C31 8.32843 30.3284 9 29.5 9C28.6716 9 28 8.32843 28 7.5V6.0059Z",fill:"var(--accent)"},void 0)]}),void 0)},vc=function(e){var n=e.onClose,t=e.text,a=e.onCopyLink,r=e.onCopyText,s=e.onSendByMessage,l=(0,ue.useLang)().getLang;return(0,o.jsx)(uc.BaseModal,(0,i.__assign)({className:"CallsModalEventPlanned",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__wrap"},{children:[(0,o.jsx)(_c,{},void 0),(0,o.jsx)("h3",(0,i.__assign)({className:"CallsModalEventPlanned__title"},{children:l("calls_event_planned")}),void 0),(0,o.jsx)("textarea",{className:"CallsModalEventPlanned__preview",value:t,readOnly:!0},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__buttons"},{children:[(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"primary",onClick:r},{children:l("calls_copy_invite_text")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"link",onClick:a},{children:l("calls_copy_invite_link")}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({appearance:"link",onClick:s},{children:l("calls_send_text_by_im")}),void 0)]}),void 0)]}),void 0)}),void 0)},pc=t(209),fc=function(){var e=(0,lc.usePromiseError)().handleError,n=(0,ue.useLang)().getLang,t=(0,pc.useNotifier)().showText,a=u(),i=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),r=Ol().onClosePopupCalendar,l=(0,sc.useCalendarEventDetails)({meParticipant:i}),c=k((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=l.getDescription(c);return c?(0,o.jsx)(vc,{onClose:r,text:_,onCopyLink:function(){c?(0,s.copyTextToClipboard)(c.join_link).then((function(){t(n("calls_create_call_by_link_copied"))})).catch(e):(0,yo.handlePromiseError)("No event stored is store to copy :(")},onCopyText:function(){c?(0,s.copyTextToClipboard)(_).then((function(){t(n("calls_create_call_by_link_text_copied"))})).catch(e):(0,yo.handlePromiseError)("No event stored is store to copy :(")},onSendByMessage:function(){a({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_ON_CALL_SEND_LINK})}},void 0):null},Ac=t(37184),gc=t(62833),hc=t(82659),mc=t(86969),Cc=function(){var e=Ol().onClosePopupCalendar,n=(0,ue.useLang)().getLang,t=function(){var e=u(),n=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),t=k((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEventOwnerOptions})),a=(0,l.useMemo)((function(){var e={value:n.peerId,label:n.name,profile:(0,i.__assign)((0,i.__assign)({},n),{id:n.peerId})};return(0,i.__spreadArray)([e],(0,i.__read)(t||[]),!1)}),[t,n]);return(0,l.useEffect)((function(){(0,sn.getGroupsForCall)().then((function(n){if(n.count>0){var t=(n.items||[]).map((function(e){return{value:-e.id,label:e.name||"",profile:e}}));e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS,data:t})}}))}),[]),{ownerOptions:a,meParticipant:n}}(),a=t.ownerOptions,r=t.meParticipant,c=function(){var e=u(),n=(0,i.__read)((0,l.useState)(!1),2),t=n[0],a=n[1],o=(0,lc.usePromiseError)().handleError,r=(0,pc.useNotifier)().showText,c=(0,ue.useLang)().getLang,_=(0,mc.useSendStatsDataCallScheduled)().sendCallScheduled,v=(0,Ko.useMailRuCounter)().mailRuCounter,p=(0,Sl.useIsMounted)(),f=Ol().onClosePopupCalendar,A=k((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),g=(0,sc.useCalendarEventDetails)({meParticipant:A}).getDescription;return{handleOnSubmit:(0,l.useCallback)((function(n){return a(!0),(0,sn.messagesStartCall)((0,gc.mapFormData)(n)).then((function(t){if(p()){var a=new Date(n.start),i={start:a,title:n.name,repeatRule:n.rrule,join_link:t.join_link,call_id:t.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},l=g(i);switch(i.description=l,(0,s.copyTextToClipboard)(l).then((function(){r(c("calls_create_call_by_link_text_copied"))})).catch(o),_({creatorId:n.groupId,sharingChannel:n.calendar}),v.push(Ko.EMailRuGoals.ScheduledCall),n.calendar){case hc.ECalendar.Other:return e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:i}),void e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL});case hc.ECalendar.Google:var u=(0,gc.google)((0,gc.mapGoogleIcsUrl)(i,c));(0,gc.openLinkInNewTab)(u,a);break;case hc.ECalendar.iCloud:case hc.ECalendar.Outlook:u=(0,gc.ics)((0,gc.mapGoogleIcsUrl)(i,c));(0,gc.openLinkInNewTab)(u,a,!1)}f()}})).catch(o).finally((function(){p()&&a(!1)}))}),[]),loading:t}}(),_=c.handleOnSubmit,v=c.loading;return(0,o.jsx)(Ac.ModalScheduleCall,{headerTitle:n("calls_plan_event"),onClose:e,onSubmit:_,userSelectOptions:a,myUserId:r.peerId,loading:v},void 0)};var Ec=function(e){var n,t,a,r,s,_,v,p=e.SDK,f=e.bridge,A=e.onBeforeCallStart,g=e.onAfterCallFinish,h=e.tabIsMaster,m=e.navigateToConvo,C=e.callSounds,E=e.navigateToProfile,S=e.onHandCountChanged,T=e.onSuccessFeedback,I=e.okPublicKey,N=e.config,x=e.streamUrlExtractor,y=N.allowAddMembers,b=N.incomingCall,w=N.showFeedbackScreen,P=(0,c.useSelector)((function(e){return e})),M=u(),D=(0,l.useCallback)((function(){M({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),j=(0,i.__read)((0,l.useState)(null),2),R=j[0],B=j[1],U=(0,l.useCallback)((function(e){M({type:d.E_ACTION.ERROR,text:e})}),[]),H=(0,l.useCallback)((function(){return M({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]);(0,l.useEffect)((function(){return P.mode===d.Mode.CALL?((0,O.increaseCallsCount)(),yr(),function(){br()}):function(){}}),[P.mode]),function(e,n,t,a){void 0===a&&(a=[]);var i=window.document,o=i.documentElement,r=o.requestFullscreen||o.webkitRequestFullscreen;if(r){var s=!o.requestFullscreen,c=s?i.webkitExitFullscreen:i.exitFullscreen,d=s?"webkitfullscreenchange":"fullscreenchange",u=s?"webkitFullscreenElement":"fullscreenElement";(0,l.useEffect)((function(){var e=function(){i.fullscreenElement?n&&n():t&&t()};return i.addEventListener(d,e),function(){return i.removeEventListener(d,e)}}),[]),(0,l.useEffect)((function(){e&&!i[u]?r.call(i.documentElement):!e&&i[u]&&c.call(i)}),a)}}(P.uiMode===d.UIMode.FULLSCREEN&&P.mode===d.Mode.CALL,(function(){var e;window.FastChat&&(B(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!0,"call")}),(function(){var e;P.uiMode===d.UIMode.FULLSCREEN&&M({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(R),B(null)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!1,"call")}),[P.uiMode,P.mode]),_r(p,P),(0,l.useEffect)((function(){if(P.mode===d.Mode.CALL&&((0,O.increaseCallsCount)(),P.callsCount%3==0)){var e=setTimeout((function(){return M({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!0})}),1e3);return function(){return clearTimeout(e)}}}),[P.mode]);var G,V=(0,l.useMemo)((function(){return function(){try{var e=window,n=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.CanvasCaptureMediaStreamTrack&&!0,t=ys()[0]===hs.Safari;return n&&!t}catch(e){return!1}}()}),[]);return G=k((function(e){return!!e.config.sferum})),(0,l.useMemo)((function(){var e=G?ee.Sferum:ee.VkCalls;ne.setAppType(e)}),[G]),(0,o.jsx)(mo,(0,i.__assign)({SDK:p,mode:P.mode,onReset:H},{children:(0,o.jsxs)(o.Fragment,{children:[(b||h())&&(0,o.jsx)(co,{onBeforeCallStart:A,onAfterCallFinish:g,callSounds:C},void 0),P.localDevice.status!==J.ParticipantStatus.WAITING_HALL&&P.mode===d.Mode.CALL&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(Fi,{SDK:p,isVirtualBackgroundSupported:V,navigateToConvo:m,navigateToProfile:E,onHandCountChanged:S},void 0),P.localDevice.status===J.ParticipantStatus.WAITING_HALL&&P.mode===d.Mode.CALL&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(_s,{SDK:p,navigateToConvo:m},void 0),P.mode===d.Mode.INCOMING&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(L,{SDK:p,bridge:f},void 0),P.localDevice.status!==J.ParticipantStatus.WAITING_HALL&&P.mode!==d.Mode.READY&&P.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(to,{SDK:p},void 0),P.localDevice.status===J.ParticipantStatus.WAITING_HALL&&P.mode!==d.Mode.READY&&P.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(cs,{SDK:p},void 0),P.mode===d.Mode.START&&P.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(os,{},void 0),w&&P.mode===d.Mode.FEEDBACK&&(0,o.jsx)(es,{onSuccessFeedback:T},void 0),P.mode===d.Mode.CALL_BY&&(0,o.jsx)(ls,{bridge:f},void 0),P.mode===d.Mode.JOIN&&(0,o.jsx)(or,(0,i.__assign)({},P.join,{bridge:f,withPopup:!0,onClose:D,onError:U,okPublicKey:I}),void 0),P.mode===d.Mode.CREATE_CALL&&(0,o.jsx)(Kl,{bridge:f},void 0),P.errorShown&&(0,o.jsx)(cr,{title:null===(n=P.error)||void 0===n?void 0:n.title,text:null===(t=P.error)||void 0===t?void 0:t.text,handleType:null===(a=P.error)||void 0===a?void 0:a.handleType,callId:null===(r=P.error)||void 0===r?void 0:r.callId,bridge:f,onCloseFatal:D},void 0),P.cautionShown&&(0,o.jsx)(vr,{isIncoming:P.isIncoming},void 0),P.groupCallSetup&&(0,o.jsx)(Qa,{SDK:p},void 0),P.isManagementOpen&&(0,o.jsx)(ri,{bridge:f,SDK:p,navigateToProfile:E,navigateToConvo:m,allowAddMembers:y},void 0),P.popup===d.POPUP_SETTINGS&&(0,o.jsx)(ho,{SDK:p},void 0),P.popup===d.POPUP_TRANSLATION&&(0,o.jsx)(Rr,{},d.POPUP_TRANSLATION),P.popup===d.POPUP_RECORD&&(0,o.jsx)(Rr,{isRecord:!0},d.POPUP_RECORD),P.popup===d.POPUP_TRANSLATION_START_COUNTDOWN&&(0,o.jsx)(Yr,{},void 0),P.popup===d.POPUP_TRANSLATION_STOP&&(0,o.jsx)(Ur,{},void 0),P.popup===d.POPUP_TRANSLATION_SHARE&&(0,o.jsx)(Gr,{link:P.translation.link,linkExtractor:x},void 0),P.popup===d.POPUP_EXIT&&(0,o.jsx)(ur,{SDK:p},void 0),P.popup===d.POPUP_TRANSFER_ADMIN_RIGHTS&&(0,o.jsx)(zr,{SDK:p},void 0),P.popup===d.POPUP_UNMUTE_REQUEST&&(0,o.jsx)(hr,{SDK:p,withVideo:!0},void 0),P.popup===d.POPUP_UNMUTE_AUDIO_REQUEST&&(0,o.jsx)(hr,{SDK:p,withVideo:!1},void 0),P.popup===d.POPUP_ADMIN_PIN_UNMUTE_REQUEST&&(0,o.jsx)(Fr,{SDK:p},void 0),(0,Ve.hasIn)(P.popup,d.POPUP_ON_CALL_HANGUP_BUSY,d.POPUP_ON_CALL_HANGUP_KILLED,d.POPUP_ON_CALL_HANGUP_BANNED,d.POPUP_ON_CALL_HANGUP_REMOVED,d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE)&&(0,o.jsx)(Ql,{},void 0),(null===(s=P.misc)||void 0===s?void 0:s.popupCalendarPlanning)===d.POPUP_ON_CALL_SEND_LINK&&(0,o.jsx)(cc,{},void 0),(null===(_=P.misc)||void 0===_?void 0:_.popupCalendarPlanning)===d.POPUP_SHARE_PLANNED_CALL&&(0,o.jsx)(fc,{},void 0),(null===(v=P.misc)||void 0===v?void 0:v.popupCalendarPlanning)===d.POPUP_PLAN_CALENDAR_EVENT&&(0,o.jsx)(Cc,{},void 0),V&&(0,o.jsx)(Bl,{SDK:p},void 0),P.participantKick&&(0,o.jsx)(Jr,{SDK:p},void 0),P.membersUnban&&(0,o.jsx)(ts,{SDK:p},void 0),P.participantsManagement&&(0,o.jsx)(fr,{},void 0),P.adminAssignment&&(0,o.jsx)(Cr,{SDK:p},void 0),P.isLoaderVisible&&(0,o.jsx)(Er.default,{},void 0)]},void 0)}),void 0)},Sc=t(40182);function Tc(e,n,t,a,o){var r=a.reduce((function(a,r){switch(r.type){case d.INCOMING_CALL:if(!Ic(e,r)){a.push(Promise.resolve());break}var s=(0,Ve.isGroupCallEvent)(r),l=s,c=(0,Ve.convertCallerFromLongpoll)(r.payload);if(!s&&c.peerId<0)JSON.parse((0,wa.decodeHTMLEntities)(r.payload.payload)).with_join_link&&(l=!0);if(l){var u=s?(0,Ve.convertChatFromLongpoll)(r.payload):(0,O.getDefaultConversation)(o);if(n({type:d.E_ACTION.LOAD_PEERS,conversation:u,members:[c],peerId:u.peerId,caller:s?u:c}),u.photo&&a.push(st(u.photo).catch((function(e){return(0,J.debugMessage)(J.DebugMessageType.WARN,e)}))),s){var _=function(e,n,t,a){return(0,sn.retryLoadCallPeers)(a).then((function(e){var a=(0,i.__read)((0,Ve.convertServerData)(e),3),o=a[0],r=a[1],s=a[2];mt(n,s),lt([o,r]).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,J.debugMessage)(J.DebugMessageType.ERROR,e),console.error(e)})),n({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r})}))}(0,n,t,u.peerId);a.push(_)}}else n({type:d.E_ACTION.LOAD_PEERS,conversation:c,members:[c],peerId:c.peerId});c.photo&&a.push(st(c.photo).catch((function(e){n({type:d.E_ACTION.LOAD_PEERS,members:[(0,i.__assign)((0,i.__assign)({},c),{photo:""})]}),(0,J.debugMessage)(J.DebugMessageType.WARN,e)})))}return a}),[]);return Promise.all(r)}function Ic(e,n){return function(e){return!!e.payload.call_id}(n)&&e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL}function Nc(){return(0,c.useSelector)((function(e){return e})).isLoaderVisible?(0,o.jsx)(Er.default,{},void 0):null}var xc=t(14890),yc=function(e,n,t,a){var o,r=a.isDev,s=void 0!==r&&r,l=a.token,c=a.config,u=void 0===c?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,incomingCall:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:c,_=a.localVideoResolution,v=void 0===_?d.VideoResolutionTypes.SD:_,p=a.friends,f=void 0===p?[]:p,A=a.friendsCache,g=a.privacySettings,h=a.ipSettingEnabled,m=a.pushToTalkEnabled,C=void 0!==m&&m,E=a.friendsCount,S=window.vk&&window.vk.id||e.peerId;return{anonymSecret:l,me:S,groupId:0,mode:d.Mode.READY,peer:0,participants:(o={},o[S]=(0,i.__assign)({},e),o),devices:{},localDevice:{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1,videoStreams:[]},statusData:{hand:{state:!1,ts:Date.now()}},networkStatus:1,roles:[],permissions:{audio:d.MediaPermissionType.ALLOW,video:d.MediaPermissionType.ALLOW,screenSharing:d.MediaPermissionType.ALLOW},status:J.ParticipantStatus.WAITING},callData:{type:null,ts:null,localTimeStamp:null,conversation:t},imHash:n,isDev:s,popup:null,uiMode:d.UIMode.DEFAULT,orator:null,adminPinnedParticipant:null,screenSharingPinnedParticipant:null,screenSharingNeedDisableOratorModeAfterStop:!0,screenSharingOldPinnedParticipant:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!0,chatMembers:[],groupMembers:[],groupMembersCount:0,preselectedIds:null,friends:f,friendsCount:E,speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1,isLoaderVisible:!1,translation:{deferredId:null,isOn:!1},participantsManagement:null,adminAssignment:null,participantKick:null,membersUnban:null,noiseCancellation:d.NoiseCancellationTypes.NEURAL,config:u,localVideoResolution:v,conversationOptions:[],privacySettings:{callsIp:(null==g?void 0:g.callsIp)||"friends"},friendsCache:A||{},groupMembersCache:{},unableToCallGroupMembersIds:[],ipSettingEnabled:h||!1,isIncoming:!1,pushToTalkEnabled:C,gridScrollPosition:0,gridScrollFirstVisible:0,oratorScrollPosition:0,oratorScrollFirstVisible:0,oratorScrollNumberOfVisible:5,callsCount:(0,O.getCallsCount)(),shouldShowDesktopAppNotification:!1,shouldShowWarningDesktopAppNotification:!0,virtualBackgroundSettings:{photos:[],videoOptions:{}},permissions:{},maps:{vkIdToDevices:new Map}}};function bc(e,n){var t,a,o,r,s,l,c,u,_,v,p,f,A,g,h,m,C;switch(n.type){case d.E_ACTION.LOAD_PEERS:var E=n.conversation||e.callData.conversation,S={};try{for(var T=(0,i.__values)(n.members),I=T.next();!I.done;I=T.next()){var N=I.value;N&&N.peerId&&(S[N.peerId]=(0,i.__assign)((0,i.__assign)({},e.participants[N.peerId]||{}),N))}}catch(e){t={error:e}}finally{try{I&&!I.done&&(a=T.return)&&a.call(T)}finally{if(t)throw t.error}}return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),S),callData:(0,i.__assign)((0,i.__assign)({},e.callData),{conversation:E}),peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,caller:"caller"in n?n.caller:e.caller});case d.E_ACTION.CHANGE_MODE:var x=n.mode!==d.Mode.READY&&n.data&&n.data.type?n.data.type:null;if(n.mode===d.Mode.READY||n.mode===d.Mode.FEEDBACK){E=e.callData&&e.callData.conversation;var y=yc(e.participants[e.me],e.imHash,E,{token:e.anonymSecret,config:e.config,localVideoResolution:e.localVideoResolution,friends:e.friends,friendsCache:e.friendsCache,friendsCount:e.friendsCount,privacySettings:e.privacySettings,ipSettingEnabled:e.ipSettingEnabled,isDev:e.isDev});return n.mode===d.Mode.FEEDBACK&&(y.mode=d.Mode.FEEDBACK,y.lastCallData={callId:null!==(l=null===(s=e.callData)||void 0===s?void 0:s.callId)&&void 0!==l?l:"",peerId:null!==(c=e.peer)&&void 0!==c?c:0}),y.virtualBackgroundSettings=e.virtualBackgroundSettings,y.misc=e.misc,e.hangupType===J.HangupType.BUSY?y.lastCallData=(0,i.__assign)((0,i.__assign)({},y.lastCallData||{}),{opponentName:null===(u=e.participants[e.peer])||void 0===u?void 0:u.name}):e.hangupType!==J.HangupType.KILLED&&e.hangupType!==J.HangupType.KILLED_WITHOUT_DELETE||(y.lastCallData=(0,i.__assign)((0,i.__assign)({},y.lastCallData||{}),{isMeEndedCallForAll:null===(_=e.lastCallData)||void 0===_?void 0:_.isMeEndedCallForAll})),y}e.maps.vkIdToDevices.clear();var b=(0,i.__assign)((0,i.__assign)({},e),{mode:n.mode,peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,callData:(0,i.__assign)((0,i.__assign)({},e.callData),{type:x,ts:n.ts||e.callData.ts||null}),hangupType:e.hangupType,entryPoint:n.entryPoint||e.entryPoint,join:(0,i.__assign)({},e.join||{})});return n.joinLink&&b.join&&(b.join.joinLink=n.joinLink),n.vkJoinLink&&b.join&&(b.join.vkJoinLink=n.vkJoinLink),b;case d.E_ACTION.HANGUP:return(0,i.__assign)((0,i.__assign)({},e),{hangupType:n.data});case d.E_ACTION.TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{ts:n.data})});case d.E_ACTION.LOCAL_TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{localTimeStamp:n.data})});case d.E_ACTION.REMOVE_USER:var O=(0,P.externalIdToString)(n.participantId),w=e.devices[O]?function(e,n,t){var a;return(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)((0,i.__assign)({},e.devices),(a={},a[n]=(0,i.__assign)((0,i.__assign)({},e.devices[n]),t),a))})}(e,O,{status:void 0,statusData:void 0,wasConnected:void 0,mediaSettings:{},stream:void 0,screenSharingStream:void 0}):(0,i.__assign)({},e);if(null===(v=e.maps.vkIdToDevices.get(+n.participantId.id))||void 0===v||v.delete(O),e.screenSharers[O]&&delete w.screenSharers[O],(0,P.isSameExternalId)(e.orator,n.participantId)&&(w.orator=null),(0,P.isSameExternalId)(e.pinnedParticipant,n.participantId)&&(w.pinnedParticipant=null),(0,P.isSameExternalId)(e.adminPinnedParticipant,n.participantId)&&(w.adminPinnedParticipant=null),(0,P.isSameExternalId)(e.screenSharingPinnedParticipant,n.participantId)&&(w.screenSharingPinnedParticipant=null),e.participantsAddedByMe.has(+n.participantId.id)){var L=new Set(e.participantsAddedByMe);L.delete(+n.participantId.id),w.participantsAddedByMe=L}return w;case d.E_ACTION.SET_CHAT_INFO:return(0,i.__assign)((0,i.__assign)({},e),{chatMembers:n.data,chatData:n.conversation});case d.E_ACTION.GROUP_CALL_SETUP:return(0,i.__assign)((0,i.__assign)({},e),{groupCallSetup:n.open,peer:n.peerId||e.peer||0,preselectedIds:n.preselectedIds});case d.E_ACTION.TOGGLE_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data||null});case d.E_ACTION.UPDATE_HASH:return(0,i.__assign)((0,i.__assign)({},e),{imHash:n.hash});case d.E_ACTION.CHANGE_UI_MODE:return(0,i.__assign)((0,i.__assign)({},e),{uiMode:n.mode||d.UIMode.DEFAULT});case d.E_ACTION.TOGGLE_ORATOR_MODE:return(0,i.__assign)((0,i.__assign)({},e),{isOratorMode:n.isOratorMode});case d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE:return(0,i.__assign)((0,i.__assign)({},e),{isShownParticipantsAside:n.isShownParticipantsAside});case d.E_ACTION.SET_ORATOR:return(0,i.__assign)((0,i.__assign)({},e),{orator:n.orator||null});case d.E_ACTION.SET_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{pinnedParticipant:n.pinnedParticipant});case d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{adminPinnedParticipant:n.data});case d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{screenSharingPinnedParticipant:n.screenSharingPinnedParticipant,screenSharingNeedDisableOratorModeAfterStop:!!n.screenSharingNeedDisableOratorModeAfterStop,screenSharingOldPinnedParticipant:n.screenSharingOldPinnedParticipant||null});case d.E_ACTION.MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{isManagementOpen:n.isOpen,managementView:n.managementView});case d.E_ACTION.CALL_STATE:b=(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),n.callData),join:(0,i.__assign)({},e.join||{}),externalId:n.externalId||e.externalId});return n.joinLink&&b.join&&(b.join.joinLink=n.joinLink),n.vkJoinLink&&b.join&&(b.join.vkJoinLink=n.vkJoinLink),b;case d.E_ACTION.CALL_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{notification:n.notification});case d.E_ACTION.JOIN:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.JOIN,join:n.data});case d.E_ACTION.CALL_BY_NAME:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.CALL_BY,callByName:n.data});case d.E_ACTION.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{mode:n.handleType===d.ErrorHandleType.FATAL?d.Mode.ERROR:e.mode,errorShown:!n.isClosed,error:{title:n.title,text:n.text,handleType:n.handleType,callId:n.callId}});case d.E_ACTION.CHANGE_PARTICIPANT_ROLES:O=n.participantId;return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),(o={},o[O]=(0,i.__assign)((0,i.__assign)({},e.participants[O]||{}),{roles:n.data}),o))});case d.E_ACTION.SET_SCREEN_SHARER:return(0,i.__assign)((0,i.__assign)({},e),{screenSharers:(0,i.__assign)((0,i.__assign)({},e.screenSharers),(r={},r[(0,P.externalIdToString)(n.participantId)]=n.isScreenSharingEnabled,r))});case d.E_ACTION.SET_FRIENDS:return(0,i.__assign)((0,i.__assign)({},e),{friends:n.data,friendsCache:(0,Vn.createFriendsCache)(n.data),friendsCount:n.friendsCount});case d.E_ACTION.SET_GROUP_MEMBERS:return(0,i.__assign)((0,i.__assign)({},e),{groupMembersCount:n.groupMembersCount,groupMembers:n.groupMembers,unableToCallGroupMembersIds:n.unableToCallGroupMembersIds,groupMembersCache:(0,Vn.createFriendsCache)(n.groupMembers)});case d.E_ACTION.SET_SPEAKERS:var k=n.data,M=k.speakers,D=k.speakersInHeader;return e=(0,i.__assign)((0,i.__assign)({},e),{speakers:M||e.speakers,speakersInHeader:D||e.speakersInHeader});case d.E_ACTION.UPDATE_PARTICIPANTS_BATCH:return function(e,n){var t=(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)({},e.devices)}),a=e.maps.vkIdToDevices;return(0,Ve.objectForEach)(n,(function(o){var r=(0,P.externalIdToString)(o.externalId),s=e.devices[r]||{};if(void 0===(null==s?void 0:s.status)&&o.status===J.ParticipantStatus.HANGUP)delete t.devices[r];else{var l=a.get(+o.externalId.id);l||(l=new Set,a.set(+o.externalId.id,l)),l.add(r);var c=o.statusData?(0,i.__assign)((0,i.__assign)({},s.statusData),o.statusData):s.statusData,d=s.wasConnected||o.status===J.ParticipantStatus.CONNECTED,u=Object.assign({},s.mediaSettings,o.mediaSettings);t.devices[r]=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},e.devices[r]),n[r]),{statusData:c,wasConnected:d,mediaSettings:u})}})),t}(e,n.data);case d.E_ACTION.REMOVE_DEVICE_FROM_CACHE:var j=(0,i.__assign)({},e.devices);return delete j[O=n.id],(0,i.__assign)((0,i.__assign)({},e),{devices:j});case d.E_ACTION.SET_UNREAD_COUNT:return(0,i.__assign)((0,i.__assign)({},e),{chatUnreadCount:n.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in n?n.chatUpToMsgId:e.chatUpToMsgId});case d.E_ACTION.SHOW_CAUTION_BOX:return(0,i.__assign)((0,i.__assign)({},e),{cautionShown:n.isOpen,isIncoming:n.isIncoming||e.isIncoming});case d.E_ACTION.SHOW_LOADER:return(0,i.__assign)((0,i.__assign)({},e),{isLoaderVisible:n.isLoaderVisible});case d.E_ACTION.SET_ENTRYPOINT:return(0,i.__assign)((0,i.__assign)({},e),{entryPoint:n.entryPoint});case d.E_ACTION.SET_TOOLTIP:var R=n.tooltips?n.tooltips:Object.keys(e.tooltips).reduce((function(e,n){return e[n]=!1,e}),{});return(0,i.__assign)((0,i.__assign)({},e),{tooltips:(0,i.__assign)((0,i.__assign)({},e.tooltips),R)});case d.E_ACTION.MANUAL_ADD_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{participantsAddedByMe:(n.participants||[]).reduce((function(e,n){return e.add(n),e}),new Set(e.participantsAddedByMe))});case d.E_ACTION.SET_TRANSLATION:return(0,i.__assign)((0,i.__assign)({},e),{translation:(0,i.__assign)((0,i.__assign)({},e.translation),n.data)});case d.E_ACTION.UPDATE_ANON_SECRET:return(0,i.__assign)((0,i.__assign)({},e),{anonymSecret:n.secret});case d.E_ACTION.TOGGLE_PARTICIPANTS_KICK:return(0,i.__assign)((0,i.__assign)({},e),{participantKick:n.data?{participant:n.data.participant,type:n.data.type}:null});case d.E_ACTION.UNBAN_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{membersUnban:n.data?{members:n.data.members}:null});case d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{participantsManagement:n.data?{mode:n.data.mode,device:n.data.device}:null});case d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT:return(0,i.__assign)((0,i.__assign)({},e),{adminAssignment:n.data?{participant:n.data.participant}:null});case d.E_ACTION.SET_NOISE_CANCELLATION:return(0,i.__assign)((0,i.__assign)({},e),{noiseCancellation:n.data});case d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION:return(0,i.__assign)((0,i.__assign)({},e),{localVideoResolution:n.data});case d.E_ACTION.SET_CONVERSATION_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{conversationOptions:n.data});case d.E_ACTION.SET_PRIVACY_SETTINGS:return(0,i.__assign)((0,i.__assign)({},e),{privacySettings:n.data});case d.E_ACTION.SET_GROUP:return(0,i.__assign)((0,i.__assign)({},e),{groupId:n.groupId,meGroup:n.meGroup});case d.E_ACTION.SET_WAITING_HALL:return(0,i.__assign)((0,i.__assign)({},e),{waitingHall:n.data});case d.E_ACTION.SET_PUSH_TO_TALK_ENABLE:return(0,i.__assign)((0,i.__assign)({},e),{pushToTalkEnabled:n.data});case d.E_ACTION.SET_GRID_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{gridScrollPosition:n.position,gridScrollFirstVisible:n.firstVisible});case d.E_ACTION.SET_ORATOR_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{oratorScrollPosition:n.position,oratorScrollFirstVisible:n.firstVisible,oratorScrollNumberOfVisible:n.numberOfVisible});case d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowDesktopAppNotification:n.data});case d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowWarningDesktopAppNotification:n.data});case d.E_ACTION.SET_START_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{startOptions:n.data});case d.E_ACTION.VB_SET_USER_PHOTOS:return Oc(e,{photos:(0,i.__spreadArray)([],(0,i.__read)(n.photos),!1)});case d.E_ACTION.VB_ADD_USER_PHOTO:return Oc(e,{photos:(0,i.__spreadArray)([n.photo],(0,i.__read)(e.virtualBackgroundSettings.photos),!1)});case d.E_ACTION.VB_REMOVE_USER_PHOTO:return Oc(e,{photos:e.virtualBackgroundSettings.photos.filter((function(e){return e.id!==n.photoId}))});case d.E_ACTION.VB_SET_VIDEO_OPTIONS:return Oc(e,{videoOptions:n.videoOptions});case d.E_ACTION.SET_CALL_PERMISSIONS:var B=n.data;return B[J.MediaOption.AUDIO]===e.permissions[J.MediaOption.AUDIO]&&B[J.MediaOption.VIDEO]===e.permissions[J.MediaOption.VIDEO]&&B[J.MediaOption.SCREEN_SHARING]===e.permissions[J.MediaOption.SCREEN_SHARING]?e:(0,i.__assign)((0,i.__assign)({},e),{permissions:n.data});case d.E_ACTION.SET_PARTICIPANTS_CHUNK:return(0,i.__assign)((0,i.__assign)({},e),{participantsChunk:(0,i.__assign)({countBefore:null!==(f=null===(p=e.participantsChunk)||void 0===p?void 0:p.countBefore)&&void 0!==f?f:0,ids:null!==(g=null===(A=e.participantsChunk)||void 0===A?void 0:A.ids)&&void 0!==g?g:[],countAfter:null!==(m=null===(h=e.participantsChunk)||void 0===h?void 0:h.countAfter)&&void 0!==m?m:0},n.data)});case d.E_ACTION.SET_PARTICIPANT_HAND_STATE:var U=n.key,H=n.value,G=e.handState;if((null!==(C=null==G?void 0:G[U])&&void 0!==C&&C)===H)return e;var V=(0,i.__assign)({},G);return V[U]=H,H||delete V[U],(0,i.__assign)((0,i.__assign)({},e),{handState:V});case d.E_ACTION.CLEAN_LAST_CALL_DATA:return wc(e,{opponentName:void 0,isMeEndedCallForAll:void 0});case d.E_ACTION.SET_LAST_CALL_DATA:return wc(e,n.data);case d.E_ACTION.SET_LOCAL_DEVICE:return(0,i.__assign)((0,i.__assign)({},e),{localDevice:(0,i.__assign)((0,i.__assign)({},e.localDevice),n.data)});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT:return Lc(e,{plannedCalendarEvent:n.data});case d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING:return Lc(e,{popupCalendarPlanning:n.data});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS:return Lc(e,{plannedCalendarEventOwnerOptions:n.data});case d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowRecordEndedDesktopAppNotification:n.data});default:return e}}function Oc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{virtualBackgroundSettings:(0,i.__assign)((0,i.__assign)({},e.virtualBackgroundSettings),n)})}function wc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{lastCallData:(0,i.__assign)((0,i.__assign)({},e.lastCallData||{}),n)})}function Lc(e,n){return(0,i.__assign)((0,i.__assign)({},e),{misc:(0,i.__assign)((0,i.__assign)({},e.misc||{}),n)})}var kc=t(87080);function Pc(e,n){switch(n.type){case kc.HistoryScreenActionTypes.DELETE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{deleteCallId:n.data});case kc.HistoryScreenActionTypes.SET_CURRENT_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{currentCalls:n.data});case kc.HistoryScreenActionTypes.SET_HISTORY_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{historyCalls:n.data});case kc.HistoryScreenActionTypes.SET_PROFILES:return(0,i.__assign)((0,i.__assign)({},e),{profiles:(0,i.__assign)((0,i.__assign)({},e.profiles),n.data)});case kc.HistoryScreenActionTypes.SET_URLS:return(0,i.__assign)((0,i.__assign)({},e),{joinLinks:(0,i.__assign)((0,i.__assign)({},e.joinLinks),n.data)});case kc.HistoryScreenActionTypes.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{error:n.data});case kc.HistoryScreenActionTypes.SET_LOADING:return(0,i.__assign)((0,i.__assign)({},e),{loading:n.data});case kc.HistoryScreenActionTypes.SET_SHOW_CREATE_BUTTON:return(0,i.__assign)((0,i.__assign)({},e),{showCreateCall:n.data});case kc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCalls:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCalls||{}),n.data):void 0});case kc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCallsPreview:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCallsPreview||{}),n.data):void 0});case kc.HistoryScreenActionTypes.SET_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data});case kc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{scheduledEditableCall:n.data});case kc.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE:return(0,i.__assign)((0,i.__assign)({},e),{callsQueueResponse:n.data});default:return e}}var Mc=function(e){var n=e.onClose,t=e.actionButtons,a=e.text,r=Wl().getLang;return(0,o.jsx)(En.default,(0,i.__assign)({className:"DeleteCallModal",title:r("calls_history_delete_modal_title"),actionButtons:t,onClose:n,appearance:"blue"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"DeleteCallModal__content"},{children:a}),void 0)}),void 0)},Dc=t(95098),jc=c.useSelector,Rc=function(){return(0,c.useDispatch)()},Bc=t(50611),Uc=function(){var e=Rc(),n=Wl(),t=n.getLang,a=n.langShortDateTime,r=jc((function(e){return e.deleteCallId})),s=jc((function(e){return e.profiles})),c=jc((function(e){return e.historyCalls})),d=jc((function(e){return e.currentCalls})),u=r in c?c[r]:null,_=(0,l.useCallback)((function(){e((0,Bc.dispatchDeleteCall)(-1))}),[]),v=(0,l.useCallback)((function(){if((null==u?void 0:u.type)&&"merged"===(null==u?void 0:u.type)&&(null==u?void 0:u.items)){var n=u.items.reduce((function(e,n){return(null==n?void 0:n.id)&&e.push(n.id),e}),[]);n.length>0&&(0,J.removeHistoryRecords)(n)}else(null==u?void 0:u.id)&&(0,J.removeHistoryRecords)([u.id]);c.splice(r,1),e((0,Bc.dispatchSetHistoryCalls)((0,i.__spreadArray)([],(0,i.__read)(c),!1))),_()}),[u]),p=(0,l.useCallback)((function(){if(null==u?void 0:u.call_id){(0,sn.forceCallFinish)(u.call_id);var n=d.filter((function(e){return e.call_id!==u.call_id}));e((0,Bc.dispatchSetCurrentCalls)(n))}v()}),[u]),f=[];if((null==u?void 0:u.can_finish_call)&&(f=f.concat([(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){p()},appearance:"secondary"},{children:t("calls_history_delete_and_finish_call_button")}),"finishAndDeleteCall")])),f=f.concat([(0,o.jsx)(Un.default,(0,i.__assign)({onClick:function(){v()}},{children:t("calls_history_delete_call_button")}),"deleteCall")]),!u)return(0,o.jsx)(o.Fragment,{},void 0);var A=(0,Dc.getHistoryItemOwner)(u,s),g=A.member,h=A.chat;if(!g&&!h)return(0,o.jsx)(o.Fragment,{},void 0);var m="";if(h)m=t("calls_history_delete_group_call").replace("%name",(0,Ve.shorten)(h.title,50));else{if(!g)return(0,o.jsx)(o.Fragment,{},void 0);var C=u.is_missed,E=u.is_inbound;m=(m=t(C&&E?"calls_history_delete_missed_call":!C&&E?"calls_history_delete_inbound_call":C&&!E?"calls_history_delete_declined_call":"calls_history_delete_outbound_call")).replace("%name",String(g.nameGen||g.name))}var S=(null==u?void 0:u.finished_at)?a(u.finished_at):"";return m=m.replace("%date",S),(0,o.jsx)(Mc,{onClose:_,actionButtons:f,text:m},void 0)},Hc=t(69050),Gc=t(84330),Vc=t(3244),Fc=t(6057);const Wc=(0,X.makeIcon)("Icon16CalendarOutline","calendar_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="calendar_outline_16"><path fill="currentColor" d="M12 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" /><path fill="currentColor" fill-rule="evenodd" d="M5 .5a.75.75 0 0 1 .75.75v.25H10.251v-.25a.75.75 0 0 1 1.5 0v.318c.347.047.669.13.975.286a3.25 3.25 0 0 1 1.42 1.42c.199.391.28.81.317 1.273.037.448.037.998.037 1.672V9.78c0 .674 0 1.224-.037 1.672-.037.463-.118.882-.317 1.272a3.25 3.25 0 0 1-1.42 1.42c-.391.2-.81.28-1.273.318-.447.037-.998.037-1.671.037H6.219c-.674 0-1.224 0-1.672-.037-.463-.037-.882-.118-1.272-.317a3.25 3.25 0 0 1-1.42-1.42c-.2-.391-.28-.81-.318-1.273-.037-.447-.037-.998-.037-1.672V6.22c0-.674 0-1.224.037-1.672.037-.463.118-.882.317-1.272a3.25 3.25 0 0 1 1.42-1.42c.306-.156.628-.24.976-.287V1.25A.75.75 0 0 1 5 .5ZM10.25 3v.25a.75.75 0 0 0 1.5 0v-.16c.125.028.218.062.294.1a1.75 1.75 0 0 1 .765.766c.074.144.13.343.16.713.027.333.03.751.03 1.331H3c0-.58.004-.998.032-1.331.03-.37.085-.57.159-.713a1.75 1.75 0 0 1 .764-.765c.077-.04.17-.073.295-.101v.16a.75.75 0 1 0 1.5 0V3h4.5ZM3 7.5v2.25c0 .712 0 1.202.032 1.58.03.371.085.57.159.714a1.75 1.75 0 0 0 .765.765c.144.074.343.13.713.16.38.03.869.031 1.581.031h3.5c.712 0 1.202 0 1.58-.032.371-.03.57-.085.714-.159a1.75 1.75 0 0 0 .765-.765c.074-.144.13-.343.16-.713.03-.38.031-.869.031-1.581V7.5H3Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0);var zc=function(e){var n=e.onCreateCallClick,t=e.onPlanCalendarEvent,a=Wl().getLang;return(0,o.jsx)(Vc.default,(0,i.__assign)({title:"",isSaved:!1,savedTitle:"",className:""},{children:(0,o.jsx)(Tn.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall",border:!1},{children:(0,o.jsx)(In.default,(0,i.__assign)({chevron:!1,selectable:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(Un.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:n,size:"s"},{children:[(0,o.jsx)(Fc.default,{width:16,height:16},void 0),a("calls_page_call_by_link_create")]}),void 0),(0,o.jsxs)(Un.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:t,appearance:"secondary",size:"s"},{children:[(0,o.jsx)(Wc,{},void 0),a("calls_landing_standalone_schedule_call")]}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenCreateCall--title"},{children:a("calls_page_call_by_link_header_v2")}),void 0)}),void 0)}),void 0)}),void 0)},Kc=function(e){var n=e.showCreateCall,t=e.onCreateCallClick,a=e.activeMenuItem,r=e.menuItems,s=e.onMenuItemClick,l=e.loading,c=e.banner,d=e.children,u=e.onPlanCalendarEvent;return(0,o.jsx)(Hc.PageColumns,(0,i.__assign)({narrow:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Gc.RightMenu,{tabs:r,activeTab:a,onTabClick:s,loading:l},void 0),c]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen"},{children:[n&&(0,o.jsx)(zc,{onCreateCallClick:function(){return t(Ja.CallStatSource.HISTORY_CREATE)},onPlanCalendarEvent:u},void 0),d]}),void 0)}),void 0)},Yc=(0,l.createContext)({bridge:{},SDK:{}}),Qc=function(){return(0,l.useContext)(Yc)},Zc=function(){var e=Qc().bridge,n=(0,l.useCallback)((function(n){e.showCreateCallByLinkPopup(n)}),[e]),t=(0,l.useCallback)((function(n,t,a){void 0===t&&(t=0),e.showStartCallModal(t,n,a)}),[e]),a=(0,l.useCallback)((function(){e.showPlanCalendarEventPopup()}),[e]),i=(0,l.useCallback)((function(n){var t;null===(t=e.setPlannedCalendarEvent)||void 0===t||t.call(e,n)}),[e]);return{onCreateCallClick:n,onJoin:t,onPlanCalendarEvent:a,setPlannedCalendarEvent:i}},Jc=function(){var e=jc((function(e){return e.loading})),n=Rc(),t=(0,l.useCallback)((function(e){n((0,Bc.dispatchSetLoading)(e))}),[]);return{loading:e,setLoading:t}};const Xc=(0,X.makeIcon)("Icon12ArrowDownLeft","arrow_down_left_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_down_left_12"><path d="M3 10a1 1 0 0 1-1-1V4a1 1 0 0 1 2 0v2.586l4.293-4.293a1 1 0 0 1 1.414 1.414L5.415 8.001 8 8a1 1 0 0 1 0 2z" fill="currentColor" /></symbol>',12,12,!1,void 0),qc=(0,X.makeIcon)("Icon12ArrowUpRight","arrow_up_right_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_up_right_12"><path d="M9 2a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V5.414L3.707 9.707a1 1 0 0 1-1.414-1.414l4.292-4.294L4 4a1 1 0 0 1 0-2z" fill="currentColor" /></symbol>',12,12,!1,void 0);var $c=t(67458),ed=t(39446);const nd=(0,X.makeIcon)("Icon24PhoneOutline","phone_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="phone_outline_24"><g fill="none"><path d="M0 0h24v24H0z" /><path d="M4.477 4.116c-2.924 3.217-1.362 8.196 2.932 12.51 4.204 4.222 9.407 5.8 12.486 2.936 1.685-1.567 1.436-4.343-.645-6.198l-.19-.161c-1.931-1.563-4.734-1.568-6.445-.027l-.088.082-.05-.042c-.187-.16-.43-.381-.724-.673l-.298-.303-.306-.326c-.092-.101-.174-.194-.246-.277l-.124-.147-.07.075c1.69-1.697 1.706-4.72.006-6.75-1.887-2.255-4.75-2.335-6.238-.699zM9.335 5.97c1.18 1.41 1.049 3.371.099 4.325l-.148.14c-.63.567-1.246.901 1.032 3.218 2.458 2.499 2.765 1.622 3.405.952 1.006-1.01 2.975-1.104 4.329.103 1.497 1.334 1.335 2.868.617 3.536-2.222 2.067-6.476.636-9.984-2.888-3.507-3.523-5.064-7.622-2.876-10.03.508-.558 2.101-1.057 3.526.644z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),td=(0,X.makeIcon)("Icon24VideocamOutline","videocam_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="videocam_outline_24"><path fill="currentColor" fill-rule="evenodd" d="M1 10.9c0-2.24 0-3.36.436-4.216a4 4 0 0 1 1.748-1.748C4.04 4.5 5.16 4.5 7.4 4.5h3.2c2.24 0 3.36 0 4.216.436a4 4 0 0 1 1.748 1.748c.155.305.255.643.32 1.053l.577-.414c.948-.68 1.422-1.02 1.785-1.15a2.8 2.8 0 0 1 3.65 1.874C23 8.418 23 9 23 10.167v4.02c0 1.04 0 1.56-.093 1.9a2.6 2.6 0 0 1-3.309 1.781c-.335-.109-.769-.395-1.637-.967l-1.067-.704c-.064.44-.167.798-.33 1.119a4 4 0 0 1-1.748 1.748c-.856.436-1.976.436-4.216.436H7.4c-2.24 0-3.36 0-4.216-.436a4 4 0 0 1-1.748-1.748C1 16.46 1 15.34 1 13.1v-2.2Zm6.4-4.6h3.2c1.15 0 1.904.001 2.48.049.556.045.787.124.919.19a2.2 2.2 0 0 1 .961.962c.067.132.146.363.191.918.048.577.049 1.331.049 2.481v2.2c0 1.15-.001 1.904-.048 2.48-.046.556-.125.787-.192.919a2.2 2.2 0 0 1-.961.961c-.132.067-.363.146-.918.191-.577.048-1.331.049-2.481.049H7.4c-1.15 0-1.904-.001-2.48-.049-.556-.045-.787-.124-.919-.19a2.2 2.2 0 0 1-.961-.962c-.067-.132-.146-.363-.191-.918C2.8 15.004 2.8 14.25 2.8 13.1v-2.2c0-1.15.001-1.904.049-2.48.045-.556.124-.787.19-.919a2.2 2.2 0 0 1 .962-.961c.132-.067.363-.146.918-.192C5.496 6.301 6.25 6.3 7.4 6.3Zm10.153 3.172.957-.686c.486-.348.808-.579 1.054-.741l.295-.18a1 1 0 0 1 1.302.663s.017.084.027.35c.012.296.012.692.012 1.29v4.02c0 .534 0 .883-.01 1.142a2.89 2.89 0 0 1-.022.288.8.8 0 0 1-1.004.541 2.852 2.852 0 0 1-.253-.14 33.487 33.487 0 0 1-.959-.62l-1.356-.895a247.905 247.905 0 0 1-.35-.237.7.7 0 0 1-.24-.446S17 13.422 17 13.398v-2.85l.005-.403a.7.7 0 0 1 .223-.434s.307-.226.325-.24Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var ad,id=t(81536);!function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.MESSAGE=2]="MESSAGE",e[e.DELETE=3]="DELETE"}(ad||(ad={}));var od=function(e,n){void 0===n&&(n=0);var t="";if(n){var a=new Date(n);if((0,s.isDateToday)(a)){var i=(0,s.leadingZero)(a.getMinutes());t=a.getHours()+":"+i}else t=n?e(n,!1):""}return t},rd=function(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}},sd=(0,l.memo)((function(e){var n=e.index,t=e.call,a=e.onMenuItemClick,r=e.selectedOwnerId,c=void 0===r?0:r,d=jc((function(e){return e.profiles})),u=Wl(),_=u.getLang,v=u.langShortDate,p=(0,Dc.getHistoryItemOwner)(t,d),f=p.member,A=p.chat,g=(0,l.useMemo)((function(){var e=t.type,r=t.items,l=t.started_at,c=t.finished_at,d="";l&&c&&(d=(0,s.formatDuration)(Math.floor((c-l)/1e3)));var u=function(e){if(void 0===e&&(e=0),!e)return{date:"",time:""};var n=new Date(e),t=n.getDate(),a=n.getMonth()+1,i=n.getFullYear(),o=n.getHours(),r=n.getMinutes();return{date:[(0,s.leadingZero)(t),(0,s.leadingZero)(a),i].join("."),time:[(0,s.leadingZero)(o),(0,s.leadingZero)(r)].join(":")}}(c),p=u.date,g=u.time,h=A?function(e,n,t,a){var i=t.title,o=void 0===i?"":i,r=t.photo_100,s=void 0===r?"":r,l=t.id,c=void 0===l?0:l,d=a.finished_at,u=void 0===d?0:d,_=c?"/im?sel=c"+c:"",v=e("calls_history_call_type_group_hint"),p=od(n,u);return{title:o,href:_,hint:p?e("calls_history_call_type_group_time_hint").replace("{time}",p):"",photo:s,status:v}}(_,v,A,t):f?function(e,n,t,a){var r=t.name,l=void 0===r?"":r,c=t.photo,d=void 0===c?"":c,u=t.id,_=void 0===u?0:u,v=t.link,p=void 0===v?"":v,f=a.is_inbound,A=void 0!==f&&f,g=a.finished_at,h=void 0===g?0:g,m=a.reach_status,C=void 0===m?"":m,E=A?(0,o.jsx)(Xc,{className:"CallHistoryListItem--hintIcon"},void 0):(0,o.jsx)(qc,{className:"CallHistoryListItem--hintIcon"},void 0),S=od(n,h),T="",I=!1;return A?"CANCELLED_BY_INITIATOR"===C?(T=e("calls_history_status_inb_cancelled_by_initiator"),I=!0):T=e("REACHED"===C?"calls_history_status_inb_reached":"REJECTED_BY_RECEIVER"===C?"calls_history_status_inb_reject_by_receiver":"calls_history_status_inb"):"CANCELLED_BY_INITIATOR"===C?T=e("calls_history_status_out_cancelled_by_initiator"):"REACHED"===C?T=e("calls_history_status_out_reached"):"REJECTED_BY_RECEIVER"===C?(T=e("calls_history_status_out_reject_by_receiver"),I=!0):T=e("calls_history_status_out"),{title:l,href:p||"/id"+_,hint:(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("CallHistoryListItem",{"CallHistoryListItem--important":I})},{children:[E,e("calls_history_call_list_item_description").replace("%type",T).replace("%time",S)]}),void 0),photo:d,status:T}}(_,v,f,t):{},m=h.title,C=void 0===m?"":m,E=h.photo,S=void 0===E?"":E,T=h.href,I=void 0===T?"":T,N=h.hint,x=void 0===N?"":N,y=h.status,b=void 0===y?"":y;C+="merged"===e?" ("+(null==r?void 0:r.length)+")":"";var O=(0,Dc.getHistoryCallPeerId)(t),w=[],L=function(e){return function(){return a(t,e,n)}};return w.push({onClick:function(){},noHover:!0,text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatus"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusFinishTime"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDate"},{children:p}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusTime"},{children:g}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusType"},{children:b}),void 0),!!d&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDuration"},{children:d}),void 0)]}),void 0)}),O&&(w.push(rd((0,o.jsx)($c.default,{},void 0),_("calls_history_dropdown_item_message"),L(ad.MESSAGE))),w.push({separator:!0})),w.push(rd((0,o.jsx)(ed.default,{},void 0),_("calls_history_dropdown_item_delete"),L(ad.DELETE))),{title:C,photo:S,href:I,hint:x,actions:w,peerId:O}}),[t]),h=g.title,m=g.photo,E=g.href,S=g.hint,T=g.actions,I=g.peerId;return f||A?(0,o.jsx)(In.default,(0,i.__assign)({className:"CallHistoryListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--aside"},{children:[!!I&&!(null==A?void 0:A.left_or_kicked)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_audio")},{children:(0,o.jsx)(nd,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return a(t,ad.AUDIO,n,c)}},void 0)}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_video")},{children:(0,o.jsx)(td,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return a(t,ad.VIDEO,n,c)}},void 0)}),void 0)]},void 0),(0,o.jsx)(Xe.default,(0,i.__assign)({className:"CallHistoryListItem--asideMenu",trigger:"hover",align:"right",data:T},{children:(0,o.jsx)(id.default,{className:"CallHistoryScreen--friendsIcon CallHistoryListItem--asidePointers"},void 0)}),void 0)]}),void 0)},{children:(0,o.jsx)(Bn.default,{className:"CallHistoryListItem--entity",photo:m,title:h,href:E,description:S||_("calls_history_call_type_group_hint"),target:"_blank"},void 0)}),void 0):(0,o.jsx)(o.Fragment,{},void 0)})),ld=t(23985),cd=function(e){var n=e.calls,t=e.onMenuItemClick,a=e.stubText,r=e.hasMore,s=e.onLoadMore,l=e.selectedOwnerId,c=void 0===l?0:l;return(0,o.jsx)(ld.default,(0,i.__assign)({useWindowScroll:!0,hasMore:r,loadMore:s},{children:(0,o.jsxs)(Tn.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[n.map((function(e,n){return(0,o.jsx)(sd,{selectedOwnerId:c,onMenuItemClick:t,call:e,index:n},n)})),0===n.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:a}),void 0)]}),void 0)}),void 0)},dd=(0,l.createContext)({navigateToConvo:function(e){},navigateToProfile:function(e,n){}}),ud=function(){return(0,l.useContext)(dd)},_d=function(){var e=jc((function(e){return e.profiles})),n=jc((function(e){return e.joinLinks})),t=Rc(),a=ud().navigateToConvo,i=Qc().bridge,o=(0,l.useCallback)((function(o,r,s,l){var c;void 0===l&&(l=0);var u=(0,Dc.getHistoryCallPeerId)(o);if(r===ad.AUDIO||r===ad.VIDEO){if(i.isInActiveCall)return;var _=r===ad.VIDEO;if((0,O.isGroupCallByPeer)(u))if(u in n)i.joinCallByLink(n[u],void 0,_,d.CallStatSource.HISTORY,l);else{var v=(0,Dc.getHistoryItemOwner)(o,e).chat;(null==v?void 0:v.call_in_progress)&&(null===(c=null==v?void 0:v.call_in_progress)||void 0===c?void 0:c.join_link)?i.joinCallByLink(v.call_in_progress.join_link,void 0,_,d.CallStatSource.HISTORY,l):i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else r===ad.MESSAGE?a(u):t((0,Bc.dispatchDeleteCall)(s))}),[n,e,i]);return{onHistoryAction:o}},vd=function(e){void 0===e&&(e="all");var n=(0,Sl.useIsMounted)(),t=jc((function(e){return e.historyCalls})),a=(0,c.useDispatch)(),o=Jc(),r=o.setLoading,s=o.loading,d=(0,i.__read)((0,l.useState)(!1),2),u=d[0],_=d[1],v=(0,i.__read)((0,l.useState)(0),2),p=v[0],f=v[1],A=(0,i.__read)((0,l.useState)(!1),2),g=A[0],h=A[1];(0,l.useEffect)((function(){r(!0),(0,Bc.loadHistoryCalls)(a,25,p,0,e).then((function(e){var t,a;if(n())return _(null!==(t=e.has_more)&&void 0!==t&&t),f(null!==(a=e.next_from)&&void 0!==a?a:0),e})).then((function(e){e&&(0,Bc.updateProfilesAndUrls)(a,[e]).then((function(e){h(!e)}))})).finally((function(){n()&&r(!1)}))}),[]);var m=function(t,i,o,r){return void 0===o&&(o=[]),void 0===r&&(r=!1),(0,Bc.loadHistoryCalls)(a,25,t,i,e,o,r).then((function(e){var t,a;return!!n()&&(_(null!==(t=e.has_more)&&void 0!==t&&t),f(null!==(a=e.next_from)&&void 0!==a?a:0),e)})).then((function(e){return!!e&&(0,Bc.updateProfilesAndUrls)(a,[e])}))};return{onShowMoreHistory:function(){return m(p,0,t)},loadHistory:m,loading:s,showMoreHistory:u,showLanding:g,setLoading:r}},pd=function(){var e=jc((function(e){return e.historyCalls})),n=Wl().getLang,t=vd("missed"),a=t.onShowMoreHistory,r=t.loading,s=t.showMoreHistory,l=_d().onHistoryAction;return r?(0,o.jsx)(Vc.default,{children:(0,o.jsx)(gl.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsx)(Vc.default,(0,i.__assign)({title:n("calls_history_missed_list_header"),className:"CallHistoryScreen--content"},{children:(0,o.jsx)(cd,{calls:e,onMenuItemClick:l,stubText:n("calls_history_missed_list_stub"),hasMore:s,onLoadMore:a},void 0)}),void 0)},fd=t(25432),Ad=t(60837),gd=t(33024),hd=function(e){var n=e.onChange,t=e.placeholder,a=e.className,r=(0,i.__read)((0,l.useState)(""),2),c=r[0],d=r[1];return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ui_search_new","ui_search",a)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_block"},{children:[(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_button_search"},{children:(0,o.jsx)(Ad.default,{},void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_inner"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ui_search_controls"},{children:!!c&&(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_reset_button ui_search_button_control",onClick:function(){d(""),null==n||n("")}},{children:(0,o.jsx)(gd.default,{},void 0)}),void 0)}),void 0),(0,o.jsx)("form",(0,i.__assign)({onSubmit:function(e){e.preventDefault()}},{children:(0,o.jsx)("input",{type:"text",className:"ui_search_field",placeholder:t,value:c,onChange:function(e){e.preventDefault();var t=e.target.value;d(t),null==n||n(t)}},void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)},md=100;var Cd=function(){var e=Wl(),n=e.getLang,t=e.langShortDate,a=e.langNumeric,r=e.langSex,s=jc((function(e){return e.meId})),c=Jc(),u=c.setLoading,_=c.loading,v=Qc().bridge,p=(0,i.__read)((0,l.useState)([]),2),f=p[0],A=p[1],g=(0,i.__read)((0,l.useState)(!1),2),h=g[0],m=g[1],C=(0,i.__read)((0,l.useState)(0),2),E=C[0],S=C[1],T=(0,i.__read)((0,l.useState)(0),2),I=T[0],N=T[1],y=(0,i.__read)((0,l.useState)(""),2),b=y[0],O=y[1],w=(0,i.__read)((0,l.useState)(!1),2),L=w[0],k=w[1],P=(0,l.useRef)(null),M=jc((function(e){return!!e.config.enableNewSearchInput}));(0,l.useEffect)((function(){u(!0);(0,sn.getFriends)(100,E).then((function(e){var n=e.count,t=e.items;N(n);m(100<n),S(100);var a=t.map(Vn.normalizeUser);A(a)})).finally((function(){u(!1)}))}),[]);var D=(0,l.useMemo)((function(){return I>md}),[I]);(0,l.useEffect)((function(){var e=b;if(D){if(e.length>=1&&!L)return P.current&&clearTimeout(P.current),P.current=setTimeout((function(){k(!0),(0,sn.friendsSearch)(s,e,50).then((function(e){var n=e.count,t=e.items;m(50<n),S(50);var a=t.map(Vn.normalizeUser);A(a)})).finally((function(){k(!1)}))}),1e3),function(){clearTimeout(P.current)};0===e.length&&(0,sn.getFriends)(md,0).then((function(e){var n=e.count,t=e.items;m(100<n),S(100);var a=t.map(Vn.normalizeUser);A(a)}))}}),[b]);var j=(0,l.useCallback)((function(e,n){v.call(e,n,void 0,d.CallStatSource.HISTORY_FRIENDS_LIST)}),[]),R=(0,l.useCallback)((function(e){return e.name}),[]),B=(0,l.useCallback)((function(e){return e.peerId}),[]),U=x(f,R,B),H=b&&!D?U.search(b):f,G=(0,l.useCallback)((function(e){O(e.target.value)}),[]),V=function(e,s){var l,c,d,u,_,v,p,f="";return(null===(l=e.onlineInfo)||void 0===l?void 0:l.is_online)?f="Online":(null===(c=e.onlineInfo)||void 0===c?void 0:c.last_seen)?f=function(e,n,t,a){var i=Math.floor((Date.now()-a)/1e3);return i<60?e("global_just_now"):i<3600?n(Math.floor(i/60),"global_mins_ago",e("global_mins_ago",!0)):i<21600?n(Math.floor(i/3600),"global_hours_ago",e("global_hours_ago",!0)):t(a,!1)}(n,a,t,1e3*(null===(d=e.onlineInfo)||void 0===d?void 0:d.last_seen)):(null===(u=e.onlineInfo)||void 0===u?void 0:u.status)&&(f="recently"===(null===(_=e.onlineInfo)||void 0===_?void 0:_.status)?r(e.sex,"global_online_was_recently",n("global_online_was_recently",!0)):"last_week"===(null===(v=e.onlineInfo)||void 0===v?void 0:v.status)?r(e.sex,"global_online_was_week",n("global_online_was_week",!0)):r(e.sex,"global_online_long_ago",n("global_online_long_ago",!0))),(0,o.jsx)(In.default,(0,i.__assign)({selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsIcons"},{children:[(0,o.jsx)(nd,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return j(e.peerId,!1)}},void 0),(0,o.jsx)(td,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return j(e.peerId,!0)}},void 0)]}),void 0)},{children:(0,o.jsx)(Bn.default,{size:"34",photo:(0,o.jsx)(fd.default,{id:s,photo:e.photo,title:e.name,isOnline:null===(p=e.onlineInfo)||void 0===p?void 0:p.is_online},void 0),title:e.name,href:e.link,description:f,target:"_blank"},void 0)}),s)};return _?(0,o.jsx)(Vc.default,{children:(0,o.jsx)(gl.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsxs)(Vc.default,(0,i.__assign)({title:n("calls_page_menu_friends_calls"),className:"CallHistoryScreen--content"},{children:[!M&&(0,o.jsx)(Mn.BlockSearchInput,{className:"CallParticipantList__input",value:b,placeholder:n("global_search"),onChange:G,onInput:G,onPaste:G},void 0),M&&(0,o.jsx)(hd,{className:"CallParticipantList__input--new",placeholder:n("global_search"),onChange:O},void 0),(0,o.jsx)(ld.default,(0,i.__assign)({useWindowScroll:!0,hasMore:h,loadMore:function(){return b&&D?(0,sn.friendsSearch)(s,b,50,E).then((function(e){var n=e.count,t=e.items,a=E+50;m(a<n),S(a);var o=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(f),!1),(0,i.__read)(t.map(Vn.normalizeUser)),!1);return A(o),!0})):(0,sn.getFriends)(md,E).then((function(e){var n=e.items,t=E+md;m(t<I),S(t);var a=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(f),!1),(0,i.__read)(n.map(Vn.normalizeUser)),!1);return A(a),!0}))}},{children:(0,o.jsxs)(Tn.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[H.map((function(e,n){return V(e,n)})),0===H.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:n("calls_page_friends_not_found")}),void 0)]}),void 0)}),void 0)]}),void 0)},Ed=t(80170);var Sd=function(e){var n=e.call,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a,s=jc((function(e){return e.profiles})),c=Wl(),u=c.getLang,_=c.langNumeric,v=(0,Dc.getCurrentCallOwner)(n,s),p=v.member,f=v.chat,A=(0,l.useMemo)((function(){var e,t,a=f?function(e){var n=e.title,t=void 0===n?"":n,a=e.photo_100,i=void 0===a?"":a,o=e.id,r=void 0===o?0:o;return{title:t,photo:i,href:r?"/im?sel=c"+r:"",id:r}}(f):p?function(e){var n=e.name,t=void 0===n?"":n,a=e.photo,i=void 0===a?"":a,o=e.link,r=void 0===o?"":o,s=e.id,l=void 0===s?0:s;return{title:t,photo:i,href:r||"/im?sel=c"+l,id:l}}(p):{},o=a.id,r=void 0===o?0:o,l=a.title,c=void 0===l?"":l,d=a.photo,v=void 0===d?"":d,A=a.href,g=void 0===A?"":A,h=n.users_count,m=n.user_ids,C=n.join_link,E=void 0===C?"":C,S=n.caller_id,T=n.name;S&&(0,P.isParticipantGroup)(S)&&(c=T||c);var I=_(h,"calls_history_members_count",u("calls_history_members_count",h)).replace("%n",String(h)),N=m.slice(0,3),x=[];try{for(var y=(0,i.__values)(N),b=y.next();!b.done;b=y.next()){var O=b.value;O in s&&x.push((0,Vn.getMemberForUserStack)(s[O]))}}catch(n){e={error:n}}finally{try{b&&!b.done&&(t=y.return)&&t.call(y)}finally{if(e)throw e.error}}return{id:r,title:c,photo:v,href:g,description:I,join_link:E,avatarItems:x}}),[f,n,p,s]),h=A.id,m=A.title,C=A.photo,E=A.href,S=A.description,T=A.avatarItems,I=A.join_link;return p||f?(0,o.jsx)(In.default,(0,i.__assign)({border:r,className:"CurrentCallsListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)(o.Fragment,{children:[T.length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"CurrentCallsListItem--avatarStack"},{children:(0,o.jsx)(Ed.AvatarsStackNoSvg,{size:Ed.AvatarsStackNoSvgSizes.SIZE_24,items:T},void 0)}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({size:"s",onClick:function(){return t(I,h,d.CallStatSource.HISTORY)}},{children:u("calls_history_join_call_button")}),void 0)]},void 0)},{children:(0,o.jsx)(Bn.default,{photo:(0,o.jsx)(g.CallPhoto,{id:h,photo:C,alt:m,size:"34"},void 0),title:m,href:E,description:S,target:"_blank"},void 0)}),h):(0,o.jsx)(o.Fragment,{},void 0)},Td=function(e){var n=e.currentCalls,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a;return n.length?(0,o.jsx)(Tn.default,(0,i.__assign)({border:!1},{children:n.map((function(e,n){return(0,o.jsx)(Sd,{listItemBorder:r,call:e,onJoin:t},n)}))}),void 0):(0,o.jsx)(o.Fragment,{},void 0)},Id=function(){var e=Rc(),n=jc((function(e){return e.profiles})),t=jc((function(e){return e.currentCalls})),a=jc((function(e){return e.callsQueueResponse})),o=(0,i.__read)((0,l.useState)(!0),2),r=o[0],s=o[1],c=function(){s(!0),(0,Bc.loadCurrentCalls)(e).then((function(n){(0,Bc.updateProfilesAndUrls)(e,[n])})).finally((function(){s(!1)}))};return(0,l.useEffect)((function(){c()}),[]),(0,l.useEffect)((function(){var e;!!(null===(e=null==a?void 0:a.events)||void 0===e?void 0:e.some((function(e){var n;return"current_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&c()}),[a]),{currentCallsBlockLoading:r,currentCalls:t,profiles:n}},Nd=function(){var e=Wl().getLang,n=Zc().onJoin,t=Id(),a=t.currentCallsBlockLoading,r=t.currentCalls,s=t.profiles,c=Jc().setLoading,d=(0,l.useMemo)((function(){return a?(0,o.jsx)(Vc.default,{children:(0,o.jsx)(gl.DivBlockSkeleton,{height:300},void 0)},void 0):(0,o.jsxs)(Vc.default,(0,i.__assign)({title:e("calls_history_current_list_header"),className:"CallHistoryScreen--content CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(Td,{currentCalls:r,profiles:s,onJoin:n},void 0),0===r.length&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:e("calls_history_current_calls_list_stub")}),void 0)]}),void 0)}),[a,r]);return(0,l.useEffect)((function(){c(a)}),[a]),(0,o.jsx)(o.Fragment,{children:d},void 0)};const xd=(0,X.makeIcon)("Icon28ChainOutline","chain_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="chain_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M12.59 16.83c-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l5.24-5.24a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.436 1.436a.999.999 0 0 1-1.414-1.41l1.43-1.436a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-5.23 5.23a2.982 2.982 0 0 0 0 4.24c.41.39.41 1.03 0 1.42Zm2.82-5.66c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-5.24 5.24a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.431-1.431a1 1 0 0 1 1.414 0h.001c.39.392.39 1.025 0 1.415L5.94 17.82a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l5.23-5.23a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),yd=(0,X.makeIcon)("Icon28ArrowUpRectangleOutline","arrow_up_rectangle_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" id="arrow_up_rectangle_outline_28"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.07 4.801C6.164 4.216 7.243 4 9.691 4h8.616c2.448 0 3.527.216 4.622.801A5.465 5.465 0 0 1 25.2 7.07c.585 1.096.801 2.175.801 4.623v4.616c0 2.448-.216 3.527-.801 4.622A5.465 5.465 0 0 1 22.93 23.2c-1.095.585-2.174.801-4.622.801H9.692c-2.448 0-3.527-.216-4.623-.801a5.465 5.465 0 0 1-2.268-2.269C2.216 19.835 2 18.756 2 16.308v-4.616c0-2.448.216-3.527.801-4.623A5.466 5.466 0 0 1 5.07 4.801ZM9.691 6c-2.335 0-3.019.212-3.68.565a3.466 3.466 0 0 0-1.447 1.448C4.212 8.673 4 9.357 4 11.692v4.616c0 2.335.212 3.019.565 3.68a3.466 3.466 0 0 0 1.448 1.447c.66.353 1.344.565 3.679.565h8.616c2.335 0 3.019-.212 3.68-.565a3.467 3.467 0 0 0 1.447-1.448c.353-.66.565-1.344.565-3.679v-4.616c0-2.335-.212-3.019-.565-3.68a3.466 3.466 0 0 0-1.448-1.447C21.327 6.212 20.643 6 18.308 6H9.692Z" fill="currentColor" /><path d="M13 18a1 1 0 1 0 2 0v-5.586l1.293 1.293a1 1 0 0 0 1.414-1.414l-3-3a1 1 0 0 0-1.414 0l-3 3a1 1 0 1 0 1.414 1.414L13 12.414V18Z" fill="currentColor" /></symbol>',28,28,!1,void 0);var bd=function(e){var n=e.onCreateCallClick,t=Wl().getLang;return(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--header"},{children:t("calls_screen_landing_header")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--subheader"},{children:t("calls_screen_landing_subheader")}),void 0),(0,o.jsxs)(Tn.default,(0,i.__assign)({className:"CallHistoryScreenLanding--list",border:!1},{children:[(0,o.jsx)(In.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Io,{},void 0)},{children:t("calls_screen_landing_feature_participants")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(xd,{},void 0)},{children:t("calls_screen_landing_feature_anon")}),void 0),(0,o.jsx)(In.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(yd,{},void 0)},{children:t("calls_screen_landing_feature_share")}),void 0)]}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({size:"l",className:"CallHistoryScreenLanding--createButton",onClick:function(){return n(Ja.CallStatSource.HISTORY_CREATE)}},{children:t("calls_current_calls_create_call_by_link")}),void 0)]}),void 0)}),void 0)},Od=t(64891);const wd=(0,X.makeIcon)("Icon28PhoneOutline","phone_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="phone_outline_28"><g fill-rule="nonzero" fill="none"><path d="M0 0h28v28H0z" /><path d="m16.112 17.259-.734.734a.712.712 0 0 1-.75.166c-.73-.269-1.643-.95-2.74-2.047-1.095-1.096-1.778-2.01-2.045-2.74a.712.712 0 0 1 .164-.75l.736-.734c1.354-1.354 1.478-3.487.284-4.903l-.862-1.024c-.984-1.17-2.756-1.288-3.96-.264a3.319 3.319 0 0 0-.974 1.443 3.25 3.25 0 0 0-.159.752c-.44 3.272 1.137 6.707 4.733 10.303 3.596 3.596 7.03 5.174 10.303 4.733a3.318 3.318 0 0 0 2.195-1.134c1.024-1.202.905-2.976-.263-3.96l-1.025-.862c-1.417-1.192-3.55-1.067-4.903.287Zm-2.81-2.561c.525.523.982.92 1.35 1.191 2.124-2.123 5.428-2.317 7.652-.447l1.023.862c2.03 1.708 2.233 4.751.49 6.798-.896 1.036-2.156 1.687-3.442 1.808-3.982.536-7.987-1.303-11.984-5.3-3.997-3.998-5.837-8.004-5.31-11.896.036-.414.122-.822.257-1.22A5.33 5.33 0 0 1 4.91 4.174c2.037-1.732 5.079-1.53 6.785.5l.86 1.023c1.873 2.22 1.681 5.527-.4 7.608.227.413.624.87 1.148 1.394Z" fill="currentColor" /></g></symbol>',28,28,!1,void 0);var Ld,kd=t(33483),Pd=t(59247);!function(e){e[e.Preview=0]="Preview",e[e.Full=1]="Full"}(Ld||(Ld={}));var Md=function(e){var n=e.type,t=void 0===n?Ld.Preview:n,a=e.forceUpdate,o=e.disabled,r=e.callerId,s=(0,ue.useLang)().getLang,c=(0,Pd.useLocale)().locale,d=(0,lc.usePromiseError)().handleError,u=(0,Sl.useIsMounted)(),_=(0,l.useRef)(),v=(0,i.__read)((0,l.useState)(),2),p=v[0],f=v[1],A=Rc(),g=jc((function(e){return e.scheduledCalls})),h=jc((function(e){return e.scheduledCallsPreview})),m=jc((function(e){return e.profiles}));(0,l.useEffect)((function(){if(null==p?void 0:p.size){var e=[];p.forEach((function(n){m[n]||e.push(n)})),e.length&&(0,sn.loadCallPeersByPeerIds)(e).then((function(e){if(u()){var n=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.profiles||[]),!1),(0,i.__read)(e.groups||[]),!1);n.length&&(0,Bc.loadProfiles)(A,n)}})).catch(d)}}),[p,m]);var C=(0,l.useCallback)((function(){if(!o){var e,n=new Date,a={grouped:1};switch(a.start_time=Math.round(n.valueOf()/1e3),r&&(a.caller_id=r),t){case Ld.Full:a.finish_time=a.start_time+31536e3,e=jd;break;case Ld.Preview:a.finish_time=a.start_time+604800,e=Dd}e(A,{loading:!0}),(0,sn.messagesGetScheduledCalls)(a).then((function(t){if(u()){var a=(0,kd.mapCalls)({now:n,items:null==t?void 0:t.items,locale:c,getLang:s,groups:null==t?void 0:t.groups}),i=a.calls,o=a.callerIds,r=a.total;e(A,{items:i,total:r}),f(o)}})).catch(d).finally((function(){u()&&e(A,{loading:!1})})),_.current=function(){e(A)}}}),[t,o,r]);return(0,l.useEffect)((function(){return function(){var e;null===(e=_.current)||void 0===e||e.call(_)}}),[]),(0,l.useEffect)((function(){C()}),[t,a,r]),{scheduledCalls:g,scheduledCallsPreview:h,fetchData:C}};function Dd(e,n){e({type:kc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW,data:n})}function jd(e,n){e({type:kc.HistoryScreenActionTypes.SET_SCHEDULED_CALLS,data:n})}var Rd,Bd=t(32997),Ud=function(e){var n=e.children;return(0,o.jsx)(In.default,(0,i.__assign)({className:"CallsScheduledRowBlockTitle",selectable:!1,canBeHovered:!1},{children:n}),void 0)},Hd=t(767),Gd=function(e){var n=e.text,t=e.href,a=e.className,r=e.onClick,l=e.rightIcon,c=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__text"},{children:n}),void 0),l&&(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__icon"},{children:l}),void 0)]},void 0);return t?(0,o.jsx)(Od.default,(0,i.__assign)({href:t,className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0)},Vd=function(e){var n,t,a=e.calls,r=e.loading,c=e.onLinkClick,d=e.skeletonHeight,u=e.ownerSelect,_=e.section,v=(0,ue.useLang)().getLang,p=Rc(),f=(0,pc.useNotifier)().showText,A=Qc().bridge,g=ud().navigateToConvo,h=(0,i.__read)((0,l.useState)((function(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone})),1)[0],m=jc((function(e){return e.meId})),C=jc((function(e){return e.profiles[m]})),E=(0,sc.useCalendarEventDetails)({meParticipant:C}),S=(0,Sl.useIsMounted)(),T="scheduled"===_,I=function(e){var n=e.allCalls,t=e.isScheduledSection,a=(0,i.__read)((0,l.useState)(!1),2),o=a[0],r=a[1],c=(0,l.useCallback)((function(){r((function(e){return!e}))}),[]),d=(0,l.useMemo)((function(){var e,a;if((0,s.isUndefined)(n)||t||o||!n.total||n.total<=3||!Array.isArray(null==n?void 0:n.items))return n;var r=[],l=0;try{for(var c=(0,i.__values)(null==n?void 0:n.items),d=c.next();!d.done;d=c.next()){var u=d.value,_=u.calls,v=(0,i.__rest)(u,["calls"]);if(l>=3)break;var p=3-l,f=_.length<p?_:_.slice(0,p);r.push((0,i.__assign)((0,i.__assign)({},v),{calls:f})),l+=f.length}}catch(n){e={error:n}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(e)throw e.error}}return r.length?(0,i.__assign)((0,i.__assign)({},n),{items:r}):null}),[n,o]);return{isShowAll:o,toggleShowAll:c,calls:d}}({allCalls:a,isScheduledSection:T}),N=I.calls,x=I.isShowAll,y=I.toggleShowAll;(0,l.useEffect)((function(){C||(0,sn.loadChatMembers)(m).then((function(e){(null==e?void 0:e.profiles)&&S()&&(0,Bc.loadProfiles)(p,e.profiles)}))}),[C,m]);var b=(0,l.useCallback)((function(e){A.joinCallByLink(e.join_link,void 0,!1,Ja.CallStatSource.HISTORY)}),[]),O=(0,l.useCallback)((function(e){e.vk_join_link&&(0,s.copyTextToClipboard)(e.vk_join_link).then((function(){f(v("calls_create_call_by_link_copied"))}))}),[v,f]),w=(0,l.useCallback)((function(e){var n,t,a,i,o={call_id:e.call_id,title:e.name||"",start:new Date(1e3*((null===(n=e.schedule)||void 0===n?void 0:n.time)||0)),timezone:h,duration:(null===(t=e.schedule)||void 0===t?void 0:t.duration)||0,join_link:e.vk_join_link||"",repeatRule:(0,gc.mapRecurrenceRule)(null===(a=e.schedule)||void 0===a?void 0:a.recurrence_rule)};(null===(i=e.group)||void 0===i?void 0:i.name)&&(o.displayName=e.group.name),(0,s.copyTextToClipboard)(E.getDescription(o)).then((function(){f(v("calls_create_call_by_link_text_copied"))}))}),[E,v,f]),L=(0,l.useCallback)((function(e){p({type:kc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),p({type:kc.HistoryScreenActionTypes.SET_POPUP,data:kc.EHistoryScreenPopup.DeleteCalendarEvent})}),[]),k=(0,l.useCallback)((function(e){p({type:kc.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),p({type:kc.HistoryScreenActionTypes.SET_POPUP,data:kc.EHistoryScreenPopup.EditCalendarEvent})}),[]),P=(0,l.useCallback)((function(){c&&c(event,"scheduled","calls?section=scheduled")}),[c]),M=(0,l.useCallback)((function(e){var n;(null===(n=e.chat)||void 0===n?void 0:n.peer_id)&&g(e.chat.peer_id)}),[g]),D=function(){var e;return T&&(null===(e=null==u?void 0:u.options)||void 0===e?void 0:e.length)?(0,o.jsx)(Bd.default,(0,i.__assign)({className:"CallHistoryScreen--listHeaderSelector",disabled:r},u),void 0):c&&!T?(0,o.jsx)(Od.default,(0,i.__assign)({className:"CallHistoryScreen--moreLink",href:"/calls?section=scheduled",onClick:P},{children:v("calls_show_all")}),void 0):void 0}(),j=!!(null===(n=null==N?void 0:N.items)||void 0===n?void 0:n.length),R=r&&!j,B=!r&&j,U=!(r||j||c&&!(null==u?void 0:u.value)),H=j||U||R,G=r&&j,V=B&&!T&&(null==a?void 0:a.total)&&a.total>3,F=x?v("calls_collapse"):v("calls_history_scheduled_calls_show_all").replace("{count}",((null==a?void 0:a.total)||0)-3);return H?(0,o.jsxs)(Vc.default,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--content",{"CallHistoryScreen--currentCalls":!R})},{children:[!R&&(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--listHeader","HistoryScreenScheduledCalls__header",{"HistoryScreenScheduledCalls__header--standalone":T&&!U}),right:D},{children:v("calls_scheduled")}),void 0),R&&(0,o.jsx)(gl.DivBlockSkeleton,{height:d||300},void 0),G&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(Me.default,{},void 0)},void 0),B&&(null===(t=null==N?void 0:N.items)||void 0===t?void 0:t.map((function(e,n){return(0,o.jsxs)("div",{children:[(0,o.jsx)(Ud,{children:e.title},void 0),e.calls.map((function(t){return(0,o.jsx)(Hd.ScheduledCallRow,{call:t,isToday:e.isToday,isTomorrow:e.isTomorrow,onCallEnter:b,onCallCopyLink:O,onCallCopyText:w,onCallDelete:L,onCallEdit:k,onCallMessage:M},t.call_id+"-"+n)}))]},e.title)}))),V&&(0,o.jsx)(Gd,{text:F,onClick:y},void 0),U&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:v("calls_history_scheduled_calls_list_stub")}),void 0)]}),void 0):null},Fd=function(e){var n=e.historyCalls,t=e.loading,a=e.historyBlockReloading,r=e.selectedOwnerId,s=e.ownerOptions,c=e.onGroupSelectChange,d=e.onHistoryAction,u=e.onShowMoreHistory,_=e.showMoreHistory,v=e.isShowList,p=(0,ue.useLang)().getLang,f=(0,l.useMemo)((function(){return s.length>1?(0,o.jsx)(uo.default,{className:"CallHistoryScreen--listHeaderSelector",options:s,value:r,onChange:c},void 0):(0,o.jsx)(o.Fragment,{},void 0)}),[s]),A=(0,l.useMemo)((function(){return p(0===r?"calls_history_list_stub":"calls_history_list_groups_stub")}),[r]),g=!(t||a||v||n.length),h=p("calls_history_list_header");return(0,o.jsxs)(Vc.default,(0,i.__assign)({title:g?h:void 0},{children:[g&&(0,o.jsx)(Re.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:A}),void 0),t&&(0,o.jsx)(gl.DivBlockSkeleton,{height:500},void 0),v&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:f},{children:h}),void 0),a&&(0,o.jsx)(Re.default,{children:(0,o.jsx)(Me.default,{},void 0)},void 0),!a&&(0,o.jsx)(cd,{selectedOwnerId:r,calls:n,onMenuItemClick:d,stubText:A,hasMore:_,onLoadMore:u},void 0)]},void 0)]}),void 0)},Wd=function(e){void 0===e&&(e={});var n=e.initialOptions,t=(0,i.__read)((0,l.useState)([]),2),a=t[0],o=t[1];return(0,l.useEffect)((function(){a.length||(0,sn.getGroupsForCall)().then((function(e){var t=e.count,a=e.items,i=n||[];t>0&&(a.forEach((function(e){var n=e.id,t=e.name,a=void 0===t?"":t;i.push({value:-n,label:a})})),o(i))}))}),[]),{ownerOptions:a}},zd=function(){var e=(0,ue.useLang)().getLang,n=(0,c.useStore)(),t=Rc(),a=jc((function(e){return e.historyCalls})),o=jc((function(e){return e.joinLinks})),r=jc((function(e){return e.profiles})),s=Qc(),d=s.SDK,u=s.bridge,_=(0,i.__read)((0,l.useState)(!1),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(0),2),A=f[0],g=f[1],h=_d().onHistoryAction,m=vd("all"),C=m.onShowMoreHistory,E=m.loading,S=m.showMoreHistory,T=m.loadHistory,I=(0,l.useMemo)((function(){return[{value:0,label:e("calls_history_list_personal_option")}]}),[]),N=Wd({initialOptions:I}).ownerOptions,x=(0,l.useCallback)((function(e){var a=Number(e.selected.value);p(!0),g(a),T(0,a,[],!0).then((function(e){p(!1),e&&Xo(d,u,n,a,t,!0)}))}),[r,o,a]),y=!E&&(a.length>0||A<0||0===A&&v);return{loading:E,historyCalls:a,historyBlockReloading:v,selectedOwnerId:A,ownerOptions:N,onGroupSelectChange:x,onHistoryAction:h,onShowMoreHistory:C,showMoreHistory:S,isShowList:y,isDisplayBlock:E||y||v}},Kd=function(){var e=(0,l.useRef)(),n=jc((function(e){return e.callsQueueResponse}));return(0,l.useMemo)((function(){var t;return(null===(t=null==n?void 0:n.events)||void 0===t?void 0:t.some((function(e){var n;return"scheduled_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&(e.current=Date.now()),e.current}),[n])},Yd=function(e){var n=e.onMenuItemClick,t=Rc(),a=Wl().getLang,r=jc((function(e){return e.profiles})),c=jc((function(e){return e.historyCalls})),u=Md({type:Ld.Preview,forceUpdate:Kd()}).scheduledCallsPreview,_=Zc(),v=_.onCreateCallClick,p=_.onJoin,f=Id(),A=f.currentCallsBlockLoading,g=f.currentCalls,h=(0,i.__read)((0,l.useState)(!1),2),m=h[0],C=h[1],E=(0,i.__read)((0,l.useState)([]),2),S=E[0],T=E[1],I=(0,i.__read)((0,l.useState)(!1),2),N=I[0],x=I[1],y=zd();(0,l.useEffect)((function(){C(!0),(0,sn.getFriends)(7).then((function(e){var n=e.items.map(Vn.normalizeUser);T(n)})).finally((function(){C(!1)}))}),[]);var b=(0,l.useCallback)((function(e,t,a){e.preventDefault(),n(t,a)}),[]),O=(0,l.useCallback)((function(e,n){return!(!e.ctrlKey&&!e.metaKey)||(e.preventDefault(),p("",n,d.CallStatSource.HISTORY_FRIENDS_LIST),!1)}),[]);return(0,l.useEffect)((function(){if(!y.loading){var e=!(A||g.length||y.loading||c.length||0!==y.selectedOwnerId);x(e),t((0,Bc.dispatchSetShowCreateButton)(!e))}return function(){t((0,Bc.dispatchSetShowCreateButton)(!0))}}),[A,g.length,y.loading,c.length,y.selectedOwnerId]),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--content"},{children:[N&&(0,o.jsx)(Vc.default,(0,i.__assign)({className:(0,s.classNames)({"CallHistoryScreenLanding--pageBlock":!m&&0===S.length})},{children:(0,o.jsx)(bd,{onCreateCallClick:v},void 0)}),void 0),m&&(0,o.jsx)(Vc.default,{children:(0,o.jsx)(gl.DivBlockSkeleton,{height:147},void 0)},void 0),!m&&S.length>0&&(0,o.jsxs)(Vc.default,{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:(0,o.jsx)(Od.default,(0,i.__assign)({href:"/calls?section=friends",onClick:function(){return b(event,"friends","calls?section=friends")},className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_friends_header_link")}),void 0)},{children:a("calls_history_friends_block_header")}),void 0),(0,o.jsx)("ul",(0,i.__assign)({className:"CallHistoryScreen--friendsList"},{children:S.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallHistoryScreen--friendsListItem"},{children:(0,o.jsx)("a",(0,i.__assign)({href:e.link,onClick:function(){return O(event,e.peerId)}},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemContent"},{children:[(0,o.jsx)(fd.default,{className:"CallHistoryScreen--friendsListItemPhoto",photo:e.photo,title:e.name},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemPhotoHoverIcon"},{children:(0,o.jsx)(wd,{fill:"white"},void 0)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemName"},{children:e.firstName}),void 0)]}),void 0)}),void 0)}),e.id)}))}),void 0)]},void 0),A&&(0,o.jsx)(Vc.default,{children:(0,o.jsx)(gl.DivBlockSkeleton,{height:300},void 0)},void 0),!A&&g.length>0&&(0,o.jsxs)(Vc.default,(0,i.__assign)({className:"CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(Dn.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",extra:g.length,right:g.length?(0,o.jsx)(Od.default,(0,i.__assign)({onClick:function(){return b(event,"current","calls?section=current")},href:"/calls?section=current",className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_header_link")}),void 0):""},{children:a("calls_history_current_list_header")}),void 0),(0,o.jsx)(Td,{currentCalls:g.slice(0,5),profiles:r,onJoin:p},void 0)]}),void 0),(0,o.jsx)(Vd,{calls:u,loading:null==u?void 0:u.loading,onLinkClick:b,skeletonHeight:300},void 0),y.isDisplayBlock&&(0,o.jsx)(Fd,(0,i.__assign)({},y),void 0)]}),void 0)},Qd=t(95418),Zd=function(){var e,n,t,a,i=Jc().setLoading,r=(e=(0,ue.useLang)().getLang,n=jc((function(e){return e.meId})),t=(0,l.useMemo)((function(){return[{label:e("calls_all"),value:0},{label:e("calls_history_list_personal_option"),value:n}]}),[n]),a=Wd({initialOptions:t}).ownerOptions,(0,Qd.useFormSelectValue)({options:a,initialValue:function(){return 0}})),s=Md({type:Ld.Full,forceUpdate:Kd(),callerId:r.value}).scheduledCalls;return(0,l.useEffect)((function(){i(!!(null==s?void 0:s.loading))}),[null==s?void 0:s.loading]),(0,o.jsx)(Vd,{calls:s,loading:null==s?void 0:s.loading,skeletonHeight:500,section:"scheduled",ownerSelect:r},void 0)},Jd=function(){var e=zd();return(0,o.jsx)(Fd,(0,i.__assign)({},e),void 0)},Xd=t(61737),qd=t(66626),$d=t(55198),eu=t(38133),nu=t(31344),tu=t(76016),au=t(84147);!function(e){e.APP_STORE="appStore",e.GOOGLE_PLAY="googlePlay",e.RU_STORE="ruStore"}(Rd||(Rd={}));var iu=function(e){var n=e.onClose,t=e.appMarket,a=Wl().getLang,r=t===Rd.APP_STORE?_i.OS.IOS:_i.OS.ANDROID;return(0,o.jsx)(uc.BaseModal,(0,i.__assign)({className:"CallsModalMobileAppDownloaded",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__wrap"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__device-img CallsModalMobileAppDownloaded__device-img-"+r},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__qr"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__qrImg CallsModalMobileAppDownloaded__qrImg-"+t},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__title"},{children:function(){switch(r){case _i.OS.IOS:return a("calls_application_for_ios");case _i.OS.ANDROID:return a("calls_application_for_android")}}()}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__text"},{children:a("calls_scan_qr_offer")}),void 0)]}),void 0)]}),void 0)}),void 0)},ou=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.205 16.205 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.79 22.79 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.215 25.215 0 0 0 .647-1.49l.003-.008a18.66 18.66 0 0 0 .919-3.044.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.538 16.538 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#b)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395v14.068h2.395v-6.026h.598l5.268 6.026h3.153ZM73.52 13.797c1.258-.399 2.156-1.476 2.156-3.053 0-2.294-2.035-3.93-4.909-3.93-2.514 0-4.39 1.257-5.228 3.631l2.255.38c.519-1.098 1.517-1.817 2.913-1.817 1.457 0 2.554.779 2.554 1.916 0 1.157-1.137 1.936-2.733 1.936h-1.776v2.095h1.776c2.075 0 2.973.878 2.973 2.015 0 1.297-1.058 2.115-2.814 2.115-1.636 0-2.554-.698-3.192-2.015l-2.295.379c.579 2.275 2.654 3.831 5.507 3.831 3.313 0 5.248-1.856 5.248-4.21 0-1.756-1.137-2.834-2.434-3.273ZM85.286 15.693c.898-.419 1.477-1.117 1.477-2.195 0-1.636-1.497-2.793-3.652-2.793h-4.968V21.08h5.188c2.235 0 3.791-1.218 3.791-2.874a2.605 2.605 0 0 0-1.836-2.514ZM80.437 12.6h2.674c.798 0 1.357.479 1.357 1.138 0 .658-.559 1.117-1.357 1.117h-2.674V12.6Zm2.894 6.585h-2.894v-2.534h2.894c.898 0 1.496.519 1.496 1.277 0 .758-.598 1.257-1.496 1.257ZM94.16 21.28c3.252 0 5.547-2.235 5.547-5.387 0-3.153-2.295-5.388-5.547-5.388-3.253 0-5.548 2.235-5.548 5.388 0 3.152 2.295 5.387 5.548 5.387Zm0-2.095c-1.876 0-3.153-1.337-3.153-3.292 0-1.956 1.277-3.293 3.153-3.293 1.875 0 3.152 1.337 3.152 3.293 0 1.955-1.277 3.292-3.152 3.292ZM108.646 10.704v4.091h-4.649v-4.09h-2.295V21.08h2.295v-4.19h4.649v4.19h2.295V10.704h-2.295ZM119.975 21.08h3.013l-4.769-5.387 4.37-4.989h-2.734l-3.472 4.031h-.558v-4.03h-2.295V21.08h2.295v-4.13h.558l3.592 4.13ZM124.286 21.08h3.253l3.871-7.702h.319v7.703h2.195V10.704h-3.252l-3.871 7.703h-.32v-7.703h-2.195v10.377Z"},void 0)}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},ru=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#b)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.897 22.897 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.164 25.164 0 0 0 .647-1.49l.003-.008c.412-1.05.711-2.048.919-3.044a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.535 16.535 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#c)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395V21.08h2.395v-6.027h.598l5.268 6.027h3.153ZM72.623 21.28c2.893 0 5.348-1.616 6.345-4.17l-2.374-.4c-.699 1.497-2.155 2.375-3.891 2.375-2.674 0-4.51-2.055-4.51-5.048 0-2.973 1.856-5.029 4.51-5.029 1.716 0 3.112.838 3.791 2.275l2.374-.399c-.957-2.514-3.332-4.07-6.245-4.07-4.03 0-6.924 3.012-6.924 7.223 0 4.23 2.893 7.243 6.924 7.243ZM85.004 10.505c-2.016 0-3.791 1.037-4.31 2.833l2.115.36c.32-.639 1.037-1.238 2.075-1.238 1.257 0 1.995.898 2.095 2.255h-2.235c-3.053 0-4.57 1.337-4.57 3.253 0 1.935 1.497 3.312 3.612 3.312 1.697 0 2.834-.978 3.333-1.836l.479 1.637h1.696v-5.827c0-3.013-1.636-4.75-4.29-4.75Zm-.679 8.84c-1.117 0-1.835-.58-1.835-1.477 0-.798.578-1.357 2.334-1.357H87c0 1.696-1.077 2.834-2.674 2.834ZM91.883 21.08h2.295V7.014h-2.295V21.08ZM96.969 21.08h2.295V7.014h-2.295V21.08ZM105.687 21.28c2.973 0 4.33-1.477 4.33-3.153 0-2.055-1.916-2.674-3.552-3.132-1.217-.34-2.275-.659-2.275-1.497 0-.678.758-1.038 1.616-1.038.958 0 1.676.5 2.056 1.357l2.135-.359c-.579-1.816-2.155-2.953-4.211-2.953-2.115 0-3.971.978-3.971 3.053 0 2.175 1.996 2.753 3.652 3.212 1.177.32 2.195.619 2.195 1.417 0 .818-.878 1.137-1.796 1.137-1.177 0-2.055-.558-2.394-1.536l-2.215.38c.439 1.915 2.075 3.112 4.43 3.112Z"},void 0)}),void 0)]}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h134v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"c"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},su=function(e){return"ru"===e.lang?(0,o.jsx)(ou,{},void 0):(0,o.jsx)(ru,{},void 0)},lu=t(64372);const cu=(0,X.makeIcon)("Icon16LogoApple","logo_apple_16","0 0 16 16",'<symbol viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="logo_apple_16"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.833 7.44c-.018-1.774 1.45-2.624 1.516-2.666-.825-1.204-2.11-1.369-2.568-1.388-1.093-.11-2.134.642-2.689.642-.553 0-1.41-.625-2.317-.609-1.192.018-2.29.691-2.904 1.755-1.239 2.143-.318 5.317.89 7.055.59.85 1.293 1.806 2.216 1.772.89-.036 1.225-.574 2.3-.574 1.076 0 1.378.574 2.319.556.957-.018 1.563-.867 2.149-1.72.677-.987.956-1.942.972-1.991-.02-.01-1.866-.714-1.884-2.832Zm-1.768-5.204c.49-.593.82-1.415.73-2.236-.706.029-1.561.469-2.068 1.06-.454.525-.852 1.363-.745 2.167.788.061 1.592-.4 2.083-.991Z" fill="currentColor" /></symbol>',16,16,!1,void 0),du=(0,ci.makeIcon)("Icon16LogoWindows","logo_windows_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_windows_16"><path fill="currentColor" d="M2 8V3.677l5-.678V8H2Zm5.5 0H14V2l-6.5.903V8Zm-.5.5H2v3.823L7 13V8.5Zm.5 0v4.597L14 14V8.5H7.5Z" /></symbol>',16,16),uu=(0,ci.makeIcon)("Icon16LogoLinux","logo_linux_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_linux_16"><path fill="currentColor" d="M12.744 12.112c-.336-.26-.205-.835-.554-1.118.338-1.963-.61-3.693-1.739-4.802-.948-.93-.642-1.836-.642-2.62C9.809 2.322 9.27 1 7.639 1 5.896 1 5.418 2.388 5.401 3.18c-.042 1.903.403 2.398-.764 3.783-1.373 1.63-1.575 3.254-1.265 4.116-.145.161-.34.34-.706.487-1.01.42-.27 1.123-.549 1.622A.884.884 0 0 0 2 13.62c0 .437.364.816 1.026.76.893-.077 1.717.527 2.25.527.47 0 .856-.255 1.036-.607.842-.198 1.88-.173 2.721.034.151.403.56.666 1.016.666.997 0 1.189-1.079 2.332-1.444a.9.9 0 0 0 .619-.868c0-.227-.085-.444-.256-.576Zm-5.59-6.105c-.195 0-.356-.15-.611-.331-.323-.229-.65-.36-.647-.6 0-.166.231-.217.53-.398.322-.194.448-.391.764-.391.324 0 .422.156.862.337.432.18.734.25.734.451 0 .207-.453.355-.708.507-.375.22-.567.425-.924.425Zm1.018-3.042c.539.083.6.987.341 1.432l-.217-.085c.113-.317.11-.838-.266-.871-.239-.021-.393.28-.426.537a1.07 1.07 0 0 0-.32-.074c.039-.538.403-1.013.888-.939Zm-2.08.193c.413-.098.657.36.659.837l-.19.111c-.025-.2-.119-.523-.353-.454-.252.075-.21.632-.07.746l-.188.1c-.256-.413-.256-1.245.142-1.34ZM4.8 14.383c-1.2-.52-1.608-.402-1.837-.402-.475 0-.63-.338-.452-.657.152-.272.105-.556.068-.784-.058-.35-.068-.463.292-.614.498-.201.72-.461.884-.655.463-.547.93.313 1.314 1.079.249.496.738.748.89 1.298.138.508-.435 1.05-1.16.735Zm4.27-1.093c-.846.393-1.924.573-2.73.175-.12-.329-.31-.541-.515-.755.33-.082.574-.474.281-.868-.312-.42-.95-.714-1.595-1.19-.603-.445-.794-1.542.028-2.769-.4 1.087-.167 2.088.034 2.374.042-.576.09-1.539.915-2.692.416-.582.422-1.351.431-1.832l.379.248c.279.196.512.413.847.413.495 0 .769-.272 1.15-.498.15-.088.375-.176.564-.3.318 1.445 1.634 3.182 1.708 4.171.306-.601-.087-2.05-.087-2.05.515.75.556 1.375.578 2.142.36.14.747.506.782.989l-.15-.016c-.077-.537-1.593-1.324-1.73-.315-.726.106-.462 1.205-.608 1.918-.068.326-.192.584-.283.855Zm2.96-.024c-.601.222-1.008.693-1.287.985-.538.564-1.249.293-1.325-.234-.08-.563.22-.87.35-1.501.118-.576-.014-1.462.263-1.557.18 1.023 1.263.593 1.51.314.401 0 .435.13.525.488.056.225.133.414.353.636.255.26.177.661-.388.87ZM7.143 5.68c-.398 0-.696-.253-.938-.45-.124-.099.031-.283.155-.183.237.192.475.394.783.394.37 0 .698-.303 1.14-.47.152-.056.238.167.088.223-.43.162-.775.486-1.228.486Z" /></symbol>',16,16);var _u=function(e){var n=e.icon,t=e.text,a=e.onClick;return(0,o.jsxs)(Un.default,(0,i.__assign)({appearance:"secondary",className:"CallsAppDownloadBanner--bannerButton",onClick:a},{children:[t,(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonIcon"},{children:n}),void 0)]}),void 0)},vu=function(){var e=function(){return vi("/calls?act=download_app&type=mac",d.DESKTOP_CALLS_FILENAME[_i.OS.MAC],!0)},n=function(){return vi("/calls?act=download_app&type=windows",d.DESKTOP_CALLS_FILENAME[_i.OS.WINDOWS],!0)},t=function(){return function(e){void 0===e&&(e=d.DESKTOP_CALLS_DOWNLOAD_PAGE);var n=document.createElement("a");n.target="_blank",n.href=e,document.body.appendChild(n),n.click(),n.remove()}("/calls?act=download_app&type=linux")},a=null,r=(0,o.jsx)(o.Fragment,{},void 0);switch(_i.Platform.OS){case _i.OS.WINDOWS:r=(0,o.jsx)(_u,{icon:(0,o.jsx)(du,{},void 0),text:"Windows",onClick:n},void 0);break;case _i.OS.MAC:r=(0,o.jsx)(_u,{icon:(0,o.jsx)(cu,{},void 0),text:"Mac",onClick:e},void 0);break;case _i.OS.LINUX:r=(0,o.jsx)(_u,{icon:(0,o.jsx)(uu,{},void 0),text:"Linux",onClick:t},void 0);break;default:r=(0,o.jsx)(_u,{icon:(0,o.jsx)(du,{},void 0),text:"Windows",onClick:n},void 0),a=(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonsSecond"},{children:[(0,o.jsx)(_u,{icon:(0,o.jsx)(cu,{},void 0),text:"Mac",onClick:e},void 0),(0,o.jsx)(_u,{icon:(0,o.jsx)(uu,{},void 0),text:"Linux",onClick:t},void 0)]}),void 0)}return{mainButton:r,otherButtons:a}},pu=function(e){var n=e.link,t=e.storeIcon,a=e.onClick;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row"},{children:[(0,o.jsx)(Od.default,(0,i.__assign)({className:"CallsAppDownloadBanner__link",target:"_blank",href:n,rel:"noreferrer"},{children:t}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink",onClick:a},{children:(0,o.jsx)(Xd.default,{},void 0)}),void 0)]}),void 0)},fu=function(e){var n=e.onCreateCall,t=Wl().getLang,a=(0,Pd.useLocale)().locale;return(0,o.jsx)(lu.Dropdown,(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown",trigger:"hover",position:"l",dataJsx:function(){var e=(0,i.__read)(t("calls_dropdown_ios_download_disabled_v2").split("{link}"),2),a=e[0],r=e[1];return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__ctx CallsDropdownComponent__in"},{children:[(0,o.jsxs)("p",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__desc"},{children:[a.trim()," ",(0,o.jsx)(Od.default,(0,i.__assign)({target:"_blank",href:"https://calls.vk.com",rel:"noreferrer"},{children:"calls.vk.com"}),void 0),r?" "+r:""]}),void 0),(0,o.jsx)(Un.default,(0,i.__assign)({wide:!0,appearance:"primary",size:"s",onClick:function(){return n(Ja.CallStatSource.HISTORY_CREATE)}},{children:t("calls_dropdown_ios_call_from_web")}),void 0)]}),void 0)},marginLeft:-221,useFixedPosition:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row","data-platform":"ios"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__link","data-platform":"ios"},{children:gu(a)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink","data-platform":"ios"},{children:(0,o.jsx)(Xd.default,{},void 0)}),void 0)]}),void 0)}),void 0)},Au=(0,l.memo)((function(e){var n=e.onCreateCall,t=e.useDisabledAppStoreBtn,a=Wl().getLang,r=(0,Pd.useLocale)().locale,s=function(){var e=(0,i.__read)((0,l.useState)(!1),2),n=e[0],t=e[1],a=(0,l.useCallback)((function(){t(!1)}),[]);return{openedModal:n,openAppStoreModal:(0,l.useCallback)((function(){t(Rd.APP_STORE)}),[]),openGooglePlayModal:(0,l.useCallback)((function(){t(Rd.GOOGLE_PLAY)}),[]),openRuStoreModal:(0,l.useCallback)((function(){t(Rd.RU_STORE)}),[]),closeModal:a}}(),c=s.openedModal,d=s.openAppStoreModal,u=s.openGooglePlayModal,_=s.openRuStoreModal,v=s.closeModal,p=vu(),f=p.mainButton,A=p.otherButtons;return(0,o.jsxs)(Vc.default,(0,i.__assign)({className:"CallsAppDownloadBanner--banner"},{children:[(0,o.jsx)(su,{lang:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerDesc"},{children:a("calls_history_desktop_banner_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerSubDesc"},{children:a("calls_history_desktop_banner_sub_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_mobile")}),void 0),t&&(0,o.jsx)(fu,{onCreateCall:n},void 0),!t&&(0,o.jsx)(pu,{link:"https://apps.apple.com/app/id1612939275",storeIcon:gu(r),onClick:d},void 0),(0,o.jsx)(pu,{link:"https://play.google.com/store/apps/details?id=com.vk.calls",storeIcon:hu(r),onClick:u},void 0),(0,o.jsx)(pu,{link:"https://apps.rustore.ru/app/com.vk.calls",storeIcon:mu(r),onClick:_},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtons"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_desktop")}),void 0),f,A]}),void 0),c&&(0,o.jsx)(iu,{appMarket:c,onClose:v},void 0)]}),void 0)}));function gu(e){return"ru"===e?(0,o.jsx)(qd.default,{},void 0):(0,o.jsx)($d.default,{},void 0)}function hu(e){return"ru"===e?(0,o.jsx)(eu.default,{},void 0):(0,o.jsx)(nu.default,{},void 0)}function mu(e){return"ru"===e?(0,o.jsx)(tu.default,{},void 0):(0,o.jsx)(au.default,{},void 0)}var Cu=function(){var e=Wl().getLang,n=jc((function(e){return e.showCreateCall})),t=function(e){var n=(0,l.useMemo)((function(){return{urlSection:new URLSearchParams(e.search).get("section")||""}}),[e]).urlSection,t=(0,i.__read)((0,l.useState)(n),2);return{section:t[0],setSection:t[1]}}(window.location),a=t.section,r=t.setSection,s=Zc(),c=s.onCreateCallClick,d=s.onPlanCalendarEvent,u=Jc(),_=u.loading,v=u.setLoading,p=(0,l.useMemo)((function(){return[{id:"",label:e("calls_page_menu_all_calls"),href:"calls",ref:(0,l.createRef)()},{id:"friends",label:e("calls_page_menu_friends_calls"),href:"calls?section=friends",ref:(0,l.createRef)()},{id:"sep1",separator:!0},{id:"current",label:e("calls_page_menu_current_calls"),href:"calls?section=current",ref:(0,l.createRef)()},{id:"scheduled",label:e("calls_scheduled"),href:"calls?section=scheduled",ref:(0,l.createRef)()},{id:"sep2",separator:!0},{id:kc.HistoryScreenSections.HISTORY,label:e("calls_history"),href:"calls?section="+kc.HistoryScreenSections.HISTORY,ref:(0,l.createRef)()},{id:"missed",label:e("calls_page_menu_miss_calls"),href:"calls?section=missed",ref:(0,l.createRef)()}]}),[e]),f=(0,l.useCallback)((function(e,n){return(0,Bc.changeQuery)(n),r(e),v(!0),window.scrollTo({top:0}),Promise.resolve()}),[]),A=(0,l.useMemo)((function(){return a===kc.HistoryScreenSections.MISS?(0,o.jsx)(pd,{},void 0):a===kc.HistoryScreenSections.FRIENDS?(0,o.jsx)(Cd,{},void 0):a===kc.HistoryScreenSections.CURRENT?(0,o.jsx)(Nd,{},void 0):a===kc.HistoryScreenSections.HISTORY?(0,o.jsx)(Jd,{},void 0):a===kc.HistoryScreenSections.SCHEDULED?(0,o.jsx)(Zd,{},void 0):(0,o.jsx)(Yd,{onMenuItemClick:f},void 0)}),[a]);return(0,o.jsx)(Kc,(0,i.__assign)({showCreateCall:n,onCreateCallClick:c,activeMenuItem:a,menuItems:p,onMenuItemClick:f,loading:_,banner:(0,o.jsx)(Au,{onCreateCall:c},void 0),onPlanCalendarEvent:d},{children:A}),void 0)},Eu=function(){var e=Rc(),n=jc((function(e){return e.error})),t=Wl().getLang,a=function(){e((0,Bc.dispatchSetError)(null))};return(0,o.jsx)(lr,{title:(0,o.jsxs)(o.Fragment,{children:[(null==n?void 0:n.title)||t("calls_oops")," "]},void 0),onClose:a,actionButtons:(0,o.jsx)(Un.default,(0,i.__assign)({onClick:a},{children:t("calls_close")}),void 0),text:(0,o.jsx)(o.Fragment,{children:null==n?void 0:n.text},void 0)},void 0)},Su=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e,n){console.error("Call history crashed:",e,n)},n.prototype.render=function(){return this.state.hasError?(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--error"},{children:(0,o.jsx)(Vc.default,(0,i.__assign)({title:this.props.getLang("global_error")},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--errorContent"},{children:this.props.getLang("global_unexpected_error_try_later")}),void 0)}),void 0)}),void 0):this.props.children},n}(l.Component),Tu=t(72382),Iu=t(75683),Nu=t(21333),xu=function(){var e=(0,Sl.useIsMounted)(),n=Rc(),t=(0,ue.useLang)().getLang,a=(0,lc.usePromiseError)().handleError,i=Zc().setPlannedCalendarEvent,r=(0,pc.useNotifier)().showText,c=(0,Nu.useFetchData)({cb:sn.messagesEditCall}),d=(0,Nu.useFetchData)({cb:sn.messagesDeleteScheduledCall}),u=(0,mc.useSendStatsDataCallScheduled)().sendCallScheduled,_=jc((function(e){return e.scheduledEditableCall})),v=jc((function(e){return e.popup})),p=jc((function(e){return e.profiles[e.meId]})),f=jc((function(e){return _?e.profiles[_.caller_id||""]:void 0})),A=(0,l.useMemo)((function(){return(0,gc.getUserSelectOptions)(f)}),[f]),g=(0,sc.useCalendarEventDetails)({meParticipant:p}).getDescription,h=(0,l.useCallback)((function(){n({type:kc.HistoryScreenActionTypes.SET_POPUP})}),[]),m=(0,l.useCallback)((function(){n({type:kc.HistoryScreenActionTypes.SET_POPUP,data:kc.EHistoryScreenPopup.RescheduleCalendarEvent})}),[]),C=(0,l.useCallback)((function(n){if(_)return c.fetchData((0,gc.mapFormData)(n,_)).then((function(){if(e()){var o=new Date(n.start),l={start:o,title:n.name,repeatRule:n.rrule,join_link:_.vk_join_link||"",call_id:_.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},c=g(l);switch(l.description=c,(0,s.copyTextToClipboard)(c).then((function(){r(t("calls_create_call_by_link_text_copied"))})).catch(a),u({creatorId:_.caller_id,sharingChannel:n.calendar,isEdit:!0}),n.calendar){case hc.ECalendar.Other:i(l);break;case hc.ECalendar.Google:var d=(0,gc.google)((0,gc.mapGoogleIcsUrl)(l,t));(0,gc.openLinkInNewTab)(d,o);break;case hc.ECalendar.iCloud:case hc.ECalendar.Outlook:d=(0,gc.ics)((0,gc.mapGoogleIcsUrl)(l,t));(0,gc.openLinkInNewTab)(d,o,!1)}h()}})).catch(a)}),[_,c.fetchData]),E=(0,l.useCallback)((function(){_&&d.fetchData({call_id:_.call_id}).then(h)}),[_,d.fetchData]);return _?(0,o.jsxs)(o.Fragment,{children:[v===kc.EHistoryScreenPopup.EditCalendarEvent&&(0,o.jsx)(Ac.ModalScheduleCall,{onClose:h,headerTitle:t("calls_edit_call_title"),onSubmit:C,call:_,loading:c.loading,myUserId:null==p?void 0:p.id,userSelectOptions:A},void 0),v===kc.EHistoryScreenPopup.DeleteCalendarEvent&&(0,o.jsx)(Iu.ModalDeleteCall,{call:_,onClose:h,onSubmit:E,onReschedule:m,loading:d.loading},void 0),v===kc.EHistoryScreenPopup.RescheduleCalendarEvent&&(0,o.jsx)(Tu.ModalRescheduleCall,{call:_,onClose:h,onSubmit:C,loading:c.loading,myUserId:null==p?void 0:p.id,userSelectOptions:A},void 0)]},void 0):((0,yo.handlePromiseError)("Пытаемся показать окно редактирования без выбранного звонка"),null)},yu=t(68891);const bu=function(){var e,n,t=Wl().getLang,a=jc((function(e){return e.error})),r=jc((function(e){return e.deleteCallId})),s=jc((function(e){return e.popup}));return e=Rc(),n=jc((function(e){return e.meId})),(0,l.useEffect)((function(){var t=new yu.CallsLongpoll(n,(function(n){e({type:kc.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE,data:n})}));return t.wait(),function(){t.destroy()}}),[n]),(0,o.jsxs)(Su,(0,i.__assign)({getLang:t},{children:[(0,o.jsx)(Cu,{},void 0),r>=0&&(0,o.jsx)(Uc,{},void 0),null!==a&&(0,o.jsx)(Eu,{},void 0),(0,Ve.hasIn)(s,kc.EHistoryScreenPopup.DeleteCalendarEvent,kc.EHistoryScreenPopup.EditCalendarEvent,kc.EHistoryScreenPopup.RescheduleCalendarEvent)&&(0,o.jsx)(xu,{},void 0)]}),void 0)};function Ou(e){var n=e.actionStatCollector,t=e.saveStatlogEvents,a=e.langUtils,l=e.navigateToConvo,u=e.navigateToProfile,_=e.apiWrapperWithAuth,v=e.apiWrapper,p=e.callSounds,f=e.config,A=void 0===f?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,incomingCall:!1,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:f,g=e.eventHandlers,h=e.streamUrlExtractor;return(0,Sc.setApiWrappers)(_,v),{initialized:!1,initializing:!1,eventHandlers:null!=g?g:{},init:function(e){var _,v=this,f=e.callPreview,m=e.callsCredentials,C=e.imHash,S=e.callsOkStaging,T=e.tabIsMaster,I=e.onBeforeCallStart,N=e.onAfterCallFinish,x=e.onError,b=e.toggles,L=void 0===b?{}:b,k=e.friends,P=e.isFriend,M=e.getFriends,D=e.pushToTalkEnabled;if(this.initialized)return this.initializing;if(!(null==m?void 0:m.me))return console.log("Calls were not initialized as there are no callsCredentials.me"),!1;this.initialized=!0,this.isFriend=P,this.getFriends=M;var j=(0,i.__assign)((0,i.__assign)({},A),L);if(!J.browser.isBrowserSupported()){var R=function(){var e=a.getLang("calls_unsupported_browser_error");return x&&x({msg:e}),(null==g?void 0:g.onError)&&g.onError(new Error(e)),console.error(e),Promise.resolve()};return this.call=R,this.startGroupCall=R,this.startCall=R,this.acceptCall=R,this.joinCallByLink=R,this.showJoinPopup=R,this.showCallByNamePopup=R,this.showCreateCallByLinkPopup=R,void(this.showPlanCalendarEventPopup=R)}this.id=window.vk&&window.vk.id||m.me.peerId;var B=T||function(){return!0},U=null!==(_=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY))&&void 0!==_?_:d.VideoResolutionTypes.SD;Zn.GlobalStore.setCallsStore((0,xc.createStore)(bc,yc(m.me,C,f,{isDev:!!m.is_dev,token:m.secret,config:j,localVideoResolution:j.fullHD?U:U===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD,friends:k||[],friendsCache:(0,Vn.createFriendsCache)(k||[]),ipSettingEnabled:m.ip_setting_enabled,privacySettings:m.privacySettings,pushToTalkEnabled:D}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));var H=Zn.GlobalStore.getCallsStore();return this.collapseCall=function(){j.enableNavChangeCallCollapse&&(J.debugMessage(J.DebugMessageType.WARN,{message:"[external] bridge.collapseCall called"}),zi({isModalView:A.isModalView,uiMode:H.getState().uiMode,changeUIMode:function(e){H.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})}}),H.dispatch({type:d.E_ACTION.MANAGEMENT,isOpen:!1}))},this.restoreCall=function(){H.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})},this.showStartCallModal=function(e,n,t){v.isInActiveCall||H.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,peerId:e,joinLink:n,entryPoint:t})},this.setPlannedCalendarEvent=function(e){H.dispatch({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:e}),H.dispatch({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})},t&&Ho(t),n&&w.callStats.setActionStatCollector(n),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:H},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:j},{children:(0,o.jsx)(Nc,{},void 0)}),void 0)}),void 0)}),void 0),wu("calls")),this.initializing=Yo(this,J,m,H,a.getLang,S).catch((function(){return!0})).then((function(){!function(e,n,t,a){var o=a.dispatch,r=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];r.forEach((function(e){e.type===d.INCOMING_CALL&&(0,sn.logCallReceived)(e.payload.call_id)}));var l=a.getState();Tc(l,o,e,r,t).then((function(){r.forEach((function(t){switch(t.type){case d.INCOMING_CALL:if(Ic(l,t))a.getState().ipSettingEnabled&&n.forceRelayPolicy(!t.payload.p2p_allowed),n.processPush(t.payload.call_id).then((function(){var e=JSON.parse((0,wa.decodeHTMLEntities)(t.payload.payload)),n=e.is_video?d.CallType.VIDEO:d.CallType.AUDIO,a=(0,Ve.getPeerIdFromLongpoll)(t.payload),r=(0,Ve.isGroupCallEvent)(t);a<0&&(r=e.with_join_link),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.INCOMING,peerId:a<0&&r?0:a,data:(0,i.__assign)((0,i.__assign)({},t.payload),{type:n,payload:e})}),Bo({timeStart:Date.now(),startType:n}),w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:t.payload.call_id,peer_id:a,is_group_call:r,reason:e.is_video?d.CallType.VIDEO:d.CallType.AUDIO})})).catch((function(n){if(e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug)if("object"==typeof n){var t=n.hangup,a=n.message;console.error("Push process error",t,a)}else console.error("Push process error",n)}));else if(t.type===d.INCOMING_CALL){var r=function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(new Error(n)),e.debug&&console.warn("Incoming push skipped:",n,t)};switch(!0){case!t.payload.call_id:r("old lib call");break;case l.mode===d.Mode.CALL||l.mode===d.Mode.INCOMING:r("already in a call"),n.processPush(t.payload.call_id).then((function(){e.eventHandlers.onError&&e.eventHandlers.onError(new Error("processPush was incorrect accepted with call_id: "+t.payload.call_id)),e.debug&&console.warn("processPush was incorrect accepted",t.payload.call_id)})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.warn("processPush rejected:",n,t.payload.call_id)}));break;default:r("reason of decline is unknown")}}break;case d.ADD_MESSAGE:var s=a.getState(),c=(0,La.isChatPeer)(s.peer),u=s.callData.callId;if(s.peer!==t.peerId||t.flags&d.FLAG_OUTBOUND||s.me===t.userId||o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount+1:1}),c||!(0,O.isActiveGroupCallMessage)(t))return;var _=t.peerId;if(u===t.kludges.attach1_call_id)return vt(a.getState(),o,_);break;case d.READ_INBOUND:null!==t.chatUnreadCount&&a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t.unread,chatUpToMsgId:t.upToId});break;case d.SET_FLAGS:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&!(t.flags&d.FLAG_OUTBOUND)&&(t.flags&d.FLAG_DELETED||t.flags&d.FLAG_SPAM)&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.DELETE_DIALOG:a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case d.EDIT_MESSAGE:case d.REPLACE_MESSAGE:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&t.kludges.is_expired&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.CONVERSATION_UPDATED:_=t.peerId;var v=t.updateType;if(a.getState().peer!==_)return;if(v!==d.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==a.getState().callData.canFinishCall&&a.getState().callData.hasUrlLink||pt(a.getState(),o,_)}}))})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.error("Resource loading error",n),r.forEach((function(e){if(e.type===d.INCOMING_CALL){if(!Ic(l,e))return;o({type:d.E_ACTION.ERROR,text:t("calls_incoming_process_error"),handleType:d.ErrorHandleType.PROCESS,callId:e.payload.call_id})}}))}))};if(e.handleEvent=r,void 0!==window.Notifier){var s=window.Notifier.getLpInstance();s&&s.onData(r)}}(v,J,a.getLang,H);var e=wu("calls");r.unmountComponentAtNode(e),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:H},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:j},{children:(0,o.jsx)(Ec,{bridge:v,SDK:J,tabIsMaster:B,onBeforeCallStart:I,onAfterCallFinish:N,callSounds:p,navigateToConvo:l,onHandCountChanged:null==g?void 0:g.onHandCountChanged,onSuccessFeedback:null==g?void 0:g.onSuccessFeedback,navigateToProfile:u,okPublicKey:m.key,config:j,streamUrlExtractor:h},void 0)}),void 0)}),void 0)}),void 0),e)})),this.initializing.catch((function(e){if(null==g?void 0:g.onError){var n=e?e.message||e.msg:"sdk did not send the reasons for the error",t=e?e.error:"";[401].includes(t)||g.onError(new Error("Could not init calls. "+n+": "+t))}console.error("Could not init calls",e.error,e)}))},showJoinScreen:function(e,s,l,c,d,u,_){void 0===_&&(_=!1);var v=zo(c,g);if(!J.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));Ho(t),w.callStats.setActionStatCollector(n);var p=e.callsAllowCallByName,f=e.callsAllowWaitingHall,h=document.querySelector(s),m=(0,i.__assign)((0,i.__assign)({},A),{allowCallByName:p,allowWaitingHall:f});r.render((0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:m},{children:(0,o.jsx)(or,(0,i.__assign)({},e,{withPopup:_,bridge:this,entryPoint:l,onError:v,okPublicKey:d,onClose:u}),void 0)}),void 0)}),void 0),h)},showHistoryScreen:function(e,n,s){var d,_;void 0===n&&(n={}),void 0===s&&(s=!0);var v=zo(void 0,g);if(!J.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));Ho(t);var p=(0,xc.createStore)(Pc,function(e,n){var t,a;return{meId:null!==(t=e.meId)&&void 0!==t?t:0,currentCalls:[],historyCalls:[],deleteCallId:-1,profiles:{},joinLinks:{},isDev:null!==(a=e.isDev)&&void 0!==a&&a,error:null,loading:!0,showCreateCall:!0,config:(0,i.__assign)((0,i.__assign)({},n),e.config||{})}}(n,A),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),f=document.querySelector(e),h={navigateToConvo:l,navigateToProfile:u},m={bridge:this,SDK:J};if(r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:p},{children:(0,o.jsx)(Yc.Provider,(0,i.__assign)({value:m},{children:(0,o.jsx)(dd.Provider,(0,i.__assign)({value:h},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(y.ConfigContext.Provider,(0,i.__assign)({value:A},{children:(0,o.jsx)(bu,{},void 0)}),void 0)}),void 0)}),void 0)}),void 0)}),void 0),f),s){var C=document.querySelector("#l_ca");C&&C.classList.contains("AppLeftMenuWithNotify")&&C.classList.remove("AppLeftMenuWithNotify"),C&&C.classList.contains("AppLeftMenuWithNotifyBlueDot")&&C.classList.remove("AppLeftMenuWithNotifyBlueDot")}null===(_=null===(d=window.cur)||void 0===d?void 0:d.destroy)||void 0===_||_.push((function(){f&&r.unmountComponentAtNode(f)}))},debug:!1,setDebug:function(e){this.debug=e,J.debug(e)}}}function wu(e){var n=document.getElementById(e);if(n)return n;var t=document.createElement("section");return t.setAttribute("id",e),document.body.appendChild(t),t}}}]);try{stManager.done("dist/b3c52704711ff506ec36e9c85b864ca9.6f1402d29ce0fe1026ef.js")}catch(e){}