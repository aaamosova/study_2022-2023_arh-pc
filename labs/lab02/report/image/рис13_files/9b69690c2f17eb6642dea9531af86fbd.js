/*! For license information please see 9b69690c2f17eb6642dea9531af86fbd.d82ecd92edf29a9ffa40.js.LICENSE.txt */
(self.webpackChunkvk=self.webpackChunkvk||[]).push([[25901],{8679:(e,t,r)=>{"use strict";var n=r(59864),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return n.isMemo(e)?a:s[e.$$typeof]||o}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=a;var c=Object.defineProperty,d=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,g=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(g){var o=h(r);o&&o!==g&&e(t,o,n)}var a=d(r);u&&(a=a.concat(u(r)));for(var s=l(t),_=l(r),f=0;f<a.length;++f){var v=a[f];if(!(i[v]||n&&n[v]||_&&_[v]||s&&s[v])){var m=p(r,v);try{c(t,v,m)}catch(e){}}}}return t}},41143:e=>{"use strict";e.exports=function(e,t,r,n,o,i,a,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,o,i,a,s],d=0;(l=new Error(t.replace(/%s/g,(function(){return c[d++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}}},69921:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,n=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,i=r?Symbol.for("react.fragment"):60107,a=r?Symbol.for("react.strict_mode"):60108,s=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,d=r?Symbol.for("react.async_mode"):60111,u=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,h=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,_=r?Symbol.for("react.memo"):60115,f=r?Symbol.for("react.lazy"):60116,v=r?Symbol.for("react.block"):60121,m=r?Symbol.for("react.fundamental"):60117,y=r?Symbol.for("react.responder"):60118,x=r?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case d:case u:case i:case s:case a:case h:return e;default:switch(e=e&&e.$$typeof){case c:case p:case f:case _:case l:return e;default:return t}}case o:return t}}}function C(e){return w(e)===u}t.AsyncMode=d,t.ConcurrentMode=u,t.ContextConsumer=c,t.ContextProvider=l,t.Element=n,t.ForwardRef=p,t.Fragment=i,t.Lazy=f,t.Memo=_,t.Portal=o,t.Profiler=s,t.StrictMode=a,t.Suspense=h,t.isAsyncMode=function(e){return C(e)||w(e)===d},t.isConcurrentMode=C,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return w(e)===p},t.isFragment=function(e){return w(e)===i},t.isLazy=function(e){return w(e)===f},t.isMemo=function(e){return w(e)===_},t.isPortal=function(e){return w(e)===o},t.isProfiler=function(e){return w(e)===s},t.isStrictMode=function(e){return w(e)===a},t.isSuspense=function(e){return w(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===u||e===s||e===a||e===h||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===_||e.$$typeof===l||e.$$typeof===c||e.$$typeof===p||e.$$typeof===m||e.$$typeof===y||e.$$typeof===x||e.$$typeof===v)},t.typeOf=w},59864:(e,t,r)=>{"use strict";e.exports=r(69921)},29804:(e,t,r)=>{"use strict";var n=r(14890).compose;t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)}},42236:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreators=t.ActionTypes=void 0;var r={UNDO:"@@redux-undo/UNDO",REDO:"@@redux-undo/REDO",JUMP_TO_FUTURE:"@@redux-undo/JUMP_TO_FUTURE",JUMP_TO_PAST:"@@redux-undo/JUMP_TO_PAST",JUMP:"@@redux-undo/JUMP",CLEAR_HISTORY:"@@redux-undo/CLEAR_HISTORY"};t.ActionTypes=r;var n={undo:function(){return{type:r.UNDO}},redo:function(){return{type:r.REDO}},jumpToFuture:function(e){return{type:r.JUMP_TO_FUTURE,index:e}},jumpToPast:function(e){return{type:r.JUMP_TO_PAST,index:e}},jump:function(e){return{type:r.JUMP,index:e}},clearHistory:function(){return{type:r.CLEAR_HISTORY}}};t.ActionCreators=n},18823:(e,t)=>{"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){n=e},t.start=function(e,t){void(o={header:[],prev:[],action:[],next:[],msgs:[]}),n&&(console.group?(o.header=["%credux-undo","font-style: italic","action",e.type],o.action=l("action",a,e),o.prev=l("prev history",i,t)):(o.header=["redux-undo action",e.type],o.action=["action",e],o.prev=["prev history",t]))},t.end=function(e){n&&(console.group?o.next=l("next history",s,e):o.next=["next history",e],function(){var e=o,t=e.header,n=e.prev,i=e.next,a=e.action,s=e.msgs;if(console.group){var l,c,d,u,p;(l=console).groupCollapsed.apply(l,r(t)),(c=console).log.apply(c,r(n)),(d=console).log.apply(d,r(a)),(u=console).log.apply(u,r(i)),(p=console).log.apply(p,r(s)),console.groupEnd()}else{var h,g,_,f,v;(h=console).log.apply(h,r(t)),(g=console).log.apply(g,r(n)),(_=console).log.apply(_,r(a)),(f=console).log.apply(f,r(i)),(v=console).log.apply(v,r(s))}}())},t.log=function(){if(n){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];o.msgs=o.msgs.concat([].concat(t,["\n"]))}};var i="#9E9E9E",a="#03A9F4",s="#4CAF50";function l(e,t,r){return["%c".concat(e),"color: ".concat(t,"; font-weight: bold"),r]}},91619:(e,t)=>{"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(e)?e:"string"==typeof e?[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.parseActions=r,t.isHistory=function(e){return void 0!==e.present&&void 0!==e.future&&void 0!==e.past&&Array.isArray(e.future)&&Array.isArray(e.past)},t.includeAction=function(e){var t=r(e);return function(e){return t.indexOf(e.type)>=0}},t.excludeAction=function(e){var t=r(e);return function(e){return t.indexOf(e.type)<0}},t.combineFilters=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return function(r,n,o){return e(r,n,o)&&t(r,n,o)}}),(function(){return!0}))},t.groupByActionTypes=function(e){var t=r(e);return function(e){return t.indexOf(e.type)>=0?e.type:null}},t.newHistory=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{past:e,present:t,future:r,group:n,_latestUnfiltered:t,index:e.length,limit:e.length+r.length+1}}},21090:(e,t,r)=>{"use strict";Object.defineProperty(t,"ActionCreators",{enumerable:!0,get:function(){return o.ActionCreators}}),Object.defineProperty(t,"includeAction",{enumerable:!0,get:function(){return i.includeAction}}),Object.defineProperty(t,"combineFilters",{enumerable:!0,get:function(){return i.combineFilters}}),Object.defineProperty(t,"newHistory",{enumerable:!0,get:function(){return i.newHistory}}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}});var n,o=r(42236),i=r(91619),a=(n=r(82479))&&n.__esModule?n:{default:n}},82479:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.set(t.debug);var r,n=c({limit:void 0,filter:function(){return!0},groupBy:function(){return null},undoType:i.ActionTypes.UNDO,redoType:i.ActionTypes.REDO,jumpToPastType:i.ActionTypes.JUMP_TO_PAST,jumpToFutureType:i.ActionTypes.JUMP_TO_FUTURE,jumpType:i.ActionTypes.JUMP,neverSkipReducer:!1,ignoreInitialState:!1,syncFilter:!1},t,{initTypes:(0,a.parseActions)(t.initTypes,["@@redux-undo/INIT"]),clearHistoryType:(0,a.parseActions)(t.clearHistoryType,[i.ActionTypes.CLEAR_HISTORY])}),s=n.neverSkipReducer?function(t,r){for(var n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return c({},t,{present:e.apply(void 0,[t.present,r].concat(o))})}:function(e){return e};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.start(i,t);for(var l,c=t,d=arguments.length,u=new Array(d>2?d-2:0),m=2;m<d;m++)u[m-2]=arguments[m];if(!r){if(o.log("history is uninitialized"),void 0===t){var y={type:"@@redux-undo/CREATE_HISTORY"},x=e.apply(void 0,[t,y].concat(u));return c=p(x,n.ignoreInitialState),o.log("do not set initialState on probe actions"),o.end(c),c}(0,a.isHistory)(t)?(c=r=n.ignoreInitialState?t:(0,a.newHistory)(t.past,t.present,t.future),o.log("initialHistory initialized: initialState is a history",r)):(c=r=p(t,n.ignoreInitialState),o.log("initialHistory initialized: initialState is not a history",r))}switch(i.type){case void 0:return c;case n.undoType:return l=f(c,-1),o.log("perform undo"),o.end(l),s.apply(void 0,[l,i].concat(u));case n.redoType:return l=f(c,1),o.log("perform redo"),o.end(l),s.apply(void 0,[l,i].concat(u));case n.jumpToPastType:return l=_(c,i.index),o.log("perform jumpToPast to ".concat(i.index)),o.end(l),s.apply(void 0,[l,i].concat(u));case n.jumpToFutureType:return l=g(c,i.index),o.log("perform jumpToFuture to ".concat(i.index)),o.end(l),s.apply(void 0,[l,i].concat(u));case n.jumpType:return l=f(c,i.index),o.log("perform jump to ".concat(i.index)),o.end(l),s.apply(void 0,[l,i].concat(u));case v(i.type,n.clearHistoryType):return l=p(c.present,n.ignoreInitialState),o.log("perform clearHistory"),o.end(l),s.apply(void 0,[l,i].concat(u));default:if(l=e.apply(void 0,[c.present,i].concat(u)),n.initTypes.some((function(e){return e===i.type})))return o.log("reset history due to init action"),o.end(r),r;if(c._latestUnfiltered===l)return c;var w="function"==typeof n.filter&&!n.filter(i,l,c);if(w){var C=(0,a.newHistory)(c.past,l,c.future,c.group);return n.syncFilter||(C._latestUnfiltered=c._latestUnfiltered),o.log("filter ignored action, not storing it in past"),o.end(C),C}var E=n.groupBy(i,l,c);if(null!=E&&E===c.group){var T=(0,a.newHistory)(c.past,l,c.future,c.group);return o.log("groupBy grouped the action with the previous action"),o.end(T),T}return c=h(c,l,n.limit,E),o.log("inserted new state into history"),o.end(c),c}}};var o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}r.default=e,t&&t.set(e,r);return r}(r(18823)),i=r(42236),a=r(91619);function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(e,t){var r=(0,a.newHistory)([],e,[]);return t&&(r._latestUnfiltered=null),r}function h(e,t,r,n){var i=e.past.length+1;o.log("inserting",t),o.log("new free: ",r-i);var s=e.past,l=e._latestUnfiltered,c=r&&r<=i,d=s.slice(c?1:0),p=null!=l?[].concat(u(d),[l]):d;return(0,a.newHistory)(p,t,[],n)}function g(e,t){if(t<0||t>=e.future.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,i=[].concat(u(r),[o],u(n.slice(0,t))),s=n[t],l=n.slice(t+1);return(0,a.newHistory)(i,s,l)}function _(e,t){if(t<0||t>=e.past.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,i=r.slice(0,t),s=[].concat(u(r.slice(t+1)),[o],u(n)),l=r[t];return(0,a.newHistory)(i,l,s)}function f(e,t){return t>0?g(e,t-1):t<0?_(e,e.past.length+t):e}function v(e,t){return t.indexOf(e)>-1?e:!e}},67121:(e,t,r)=>{"use strict";r.d(t,{default:()=>n}),e=r.hmd(e);const n=function(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:e)},34790:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var n=r(95724),o=[{title:"photos_pe_crop_aspect_free",value:0},{title:"photos_pe_crop_aspect_original",value:-1},{title:"photos_pe_crop_aspect_16_9",value:16/9},{title:"photos_pe_crop_aspect_4_3",value:4/3},{title:"photos_pe_crop_aspect_1_1",value:1},{title:"photos_pe_crop_aspect_3_4",value:3/4},{title:"photos_pe_crop_aspect_9_16",value:9/16}];const i={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{NONE:"none",PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:(0,n.isRetina)()?2:1,STICKER_THUMB:"thumb",STICKER_SMALL:64,STICKER_MEDIUM:(0,n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#FF3301","#FF8C49","#F9D827","#2EBA48","#4189E8","#9F4BED","#69E4B3","#FF84A0","#F7A978","#F8786C","#8B3232","#93B658","#556E35","#5B4490","#1B1B1B","#333333","#4D4D4D","#666666","#808080","#999999","#B3B3B3","#CCCCCC"],FONTS:["classic","cursive","marker","italics","typewriter","poster","retro","impact","lobster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,PHOTO_FILTERS:["regular","nox","vesper","latona","liber","luna","minerva","mitra","pro","terra","veles","vesta","zaria","sepia","genius","horus","fortuna"],COLOR_CORRECTION:["exposure","contrast","saturation","warmth","vignette","sharpness","grain"],BLUR_TYPES:{ROUND:"round",RECTANGULAR:"rectangular"},AVERAGE_COLORS_MAP:[{s:12,v:-40},{s:9,v:-30},{s:6,v:-20},{s:3,v:-10},{s:0,v:0},{s:-3,v:10},{s:-6,v:20},{s:-9,v:30},{s:-12,v:40}],LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image",BACKGROUND:"background"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"},FILTER_PREVIEW_WIDTH:127,FILTER_PREVIEW_HEIGHT:95,DRAWING_PREVIEW_WIDTH:270,DRAWING_PREVIEW_HEIGHT:110,CROP_MIN_SIZE:100,CROP_SIDES:{CENTER:"center",NW:"nw",NE:"ne",SW:"sw",SE:"se",N:"n",S:"s",W:"w",E:"e"},CROP_ASPECTS:o,CROP_ASPECT_FREE:0,CROP_ASPECT_ORIGINAL:-1}},50492:(e,t,r)=>{"use strict";r.d(t,{default:()=>Fn});var n=r(70655),o=r(85893),i=r(67294),a=r(35886),s=r(14890),l=r(21090),c=r(29804),d=r(53894),u=r(34790),p={};function h(e){var t=e.present.background,r=t.currentBackgroundType,o=t.currentPhotoUrl,i=t.currentBackgroundId,a="";if(r===u.default.BACKGROUND_MODES.PHOTO)a=o||"";else{var s=e.present.data.backgrounds,l=s.gradients,c=s.emojies,d=s.advice_gradients,h=s.colors,g=(0,n.__spreadArray)((0,n.__spreadArray)((0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(l),!1),(0,n.__read)(c),!1),(0,n.__read)(d),!1),(0,n.__read)(h),!1).filter((function(e){return e.id===i}))[0];if(g.url)a=g.url;else if(p[g.id])a=p[g.id];else{var _=e.present.data,f=_.originalWidth,v=_.originalHeight,m=document.createElement("canvas"),y=m.getContext("2d");m.width=f,m.height=v,y.fillStyle=g.background,y.fillRect(0,0,f,v),p[g.id]=m.toDataURL(),a=p[g.id]}}return a}function g(e){var t=e.present.data,r=t.addons,n=t.artboardHeight,o=n;return r&&r.photoHeight&&(o=r.photoHeight),n/2-o/2}var _="SET_DATA_LOADED",f="SET_SHOW_DROP_BOX",v="SET_SAVE_LOADING",m="SET_CURRENT_TAB",y="SET_CURRENT_STICKER_PACK_INDEX",x="SET_HEADER_SCROLL_POSITION",w="SET_SETTING_COLOR",C="SET_SETTING_BRUSH_WIDTH",E="SET_SETTING_BRUSH_OPACITY",T="SET_SETTING_FONT_SIZE",S="SET_SETTING_FONT_FAMILY",b="SET_SETTING_COLOR_CORRECTION",P="SET_SETTING_FILTER",I="SET_SETTING_FILTER_AMOUNT",R="SET_SETTING_BLUR_ENABLE",A="SET_SETTING_BLUR_FORM",L="SET_SETTING_BLUR_SIZE",k="SET_SETTING_BLUR_POSITION",N="SET_SETTING_AUTO_CORRECTION",O="SET_SETTING_CROP_ASPECT",D="SET_SETTING_CROPPED",M="SET_SETTING_FLIP_X",B="SET_SETTING_FLIP_Y",F="SET_SETTING_ROTATE",j="SET_CURRENT_LAYER",H="ADD_LAYER_STICKER",U="ADD_LAYER_TEXT",z="ADD_LAYER_IMAGE",W="SET_LAYER_POSITION",Z="SET_LAYER_SCALE",Y="START_LAYER_SCALE",G="SET_LAYER_COLOR",V="SET_LAYER_FONT_SIZE",X="SET_LAYER_FONT_STYLE",K="SET_LAYER_TEXT",q="TOGGLE_TEXT_EDITOR",$="UPDATE_BACKGROUND_LAYER",J="DELETE_LAYER",Q="UPDATE_LAYERS_AFTER_CROP",ee="ADD_VECTOR",te="UPDATE_DRAWING",re="SET_CURRENT_BACKGROUND_TYPE",ne="SET_CURRENT_PHOTO_URL",oe="SET_CURRENT_BACKGROUND_ID",ie="SET_DATA",ae={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:u.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0};const se=function(e,t){switch(void 0===e&&(e=ae),t.type){case _:return(0,n.__assign)((0,n.__assign)({},e),{isDataLoaded:!0});case f:return(0,n.__assign)((0,n.__assign)({},e),{isShowDropBox:t.value});case v:return(0,n.__assign)((0,n.__assign)({},e),{isSaveLoading:t.value});case m:return(0,n.__assign)((0,n.__assign)({},e),{currentMode:t.value});case y:return(0,n.__assign)((0,n.__assign)({},e),{currentStickerPackIndex:t.value});case x:return(0,n.__assign)((0,n.__assign)({},e),{stickerHeaderScrollPosition:t.value});default:return e}};var le={color:u.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:u.default.FONTS[0],filter:{name:u.default.PHOTO_FILTERS[0],value:.5},colorCorrection:{exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},blur:{isEnabled:!1,form:u.default.BLUR_TYPES.ROUND,size:50,position:[.5,.5]},isAutoCorrection:!1,cropAspect:u.default.CROP_ASPECT_FREE,isCropped:!1,flipX:!1,flipY:!1,rotation:0};const ce=function(e,t){var r;switch(void 0===e&&(e=le),t.type){case w:return(0,n.__assign)((0,n.__assign)({},e),{color:t.color});case C:return(0,n.__assign)((0,n.__assign)({},e),{brushWidth:t.brushWidth});case E:return(0,n.__assign)((0,n.__assign)({},e),{brushOpacity:t.brushOpacity});case T:return(0,n.__assign)((0,n.__assign)({},e),{fontSize:t.fontSize});case S:return(0,n.__assign)((0,n.__assign)({},e),{fontStyle:t.fontStyle});case b:return(0,n.__assign)((0,n.__assign)({},e),{colorCorrection:(0,n.__assign)((0,n.__assign)({},e.colorCorrection),(r={},r[t.filter]=t.value,r))});case P:return(0,n.__assign)((0,n.__assign)({},e),{filter:(0,n.__assign)((0,n.__assign)({},e.filter),{name:t.name})});case I:return(0,n.__assign)((0,n.__assign)({},e),{filter:(0,n.__assign)((0,n.__assign)({},e.filter),{value:t.value})});case R:return(0,n.__assign)((0,n.__assign)({},e),{blur:(0,n.__assign)((0,n.__assign)({},e.blur),{isEnabled:t.isEnabled})});case A:return(0,n.__assign)((0,n.__assign)({},e),{blur:(0,n.__assign)((0,n.__assign)({},e.blur),{form:t.form})});case L:return(0,n.__assign)((0,n.__assign)({},e),{blur:(0,n.__assign)((0,n.__assign)({},e.blur),{size:t.size})});case k:return(0,n.__assign)((0,n.__assign)({},e),{blur:(0,n.__assign)((0,n.__assign)({},e.blur),{position:t.position})});case N:return(0,n.__assign)((0,n.__assign)({},e),{isAutoCorrection:t.isAutoCorrection});case O:return(0,n.__assign)((0,n.__assign)({},e),{cropAspect:t.aspect});case D:return(0,n.__assign)((0,n.__assign)({},e),{isCropped:t.isCropped});case M:return(0,n.__assign)((0,n.__assign)({},e),{flipX:t.value});case B:return(0,n.__assign)((0,n.__assign)({},e),{flipY:t.value});case F:return(0,n.__assign)((0,n.__assign)({},e),{rotation:t.value});default:return e}};var de={currentIndex:null,items:[{canvas:document.createElement("canvas"),type:u.default.LAYER_TYPES.BACKGROUND,width:1,height:1,isBackground:!0,locked:!0,x:0,y:0,rotate:0,canDelete:!1,scale:1,avgColor:{r:128,g:128,b:128}}]};const ue=function(e,t){switch(void 0===e&&(e=de),t.type){case j:return(0,n.__assign)((0,n.__assign)({},e),{currentIndex:t.index});case H:case U:case z:return(0,n.__assign)((0,n.__assign)({},e),{items:(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(e.items),!1),[t.payload],!1)});case W:case Z:case G:case V:case X:case K:case q:return(0,n.__assign)((0,n.__assign)({},e),{items:e.items.map((function(r,o){return e.currentIndex===o?(0,n.__assign)((0,n.__assign)({},r),t.payload):r}))});case Y:return(0,n.__assign)({},e);case $:return(0,n.__assign)((0,n.__assign)({},e),{items:e.items.map((function(e,r){return 0===r?(0,n.__assign)((0,n.__assign)({},e),t.payload):e}))});case J:return(0,n.__assign)((0,n.__assign)({},e),{currentIndex:null,items:e.items.filter((function(e,r){return r!==t.index}))});case Q:return(0,n.__assign)((0,n.__assign)({},e),{items:t.items});default:return e}};const pe=function(e,t){switch(void 0===e&&(e=[]),t.type){case ee:return(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(e),!1),[t.payload],!1);case te:return t.payload;default:return e}};var he={currentBackgroundType:u.default.BACKGROUND_MODES.NONE,currentPhotoUrl:null,currentBackgroundId:null};const ge=function(e,t){switch(void 0===e&&(e=he),t.type){case re:return(0,n.__assign)((0,n.__assign)({},e),{currentBackgroundType:t.value});case ne:return(0,n.__assign)((0,n.__assign)({},e),{currentPhotoUrl:t.value});case oe:return(0,n.__assign)((0,n.__assign)({},e),{currentBackgroundId:t.value});default:return e}};const _e=function(e,t){return void 0===e&&(e={}),t.type===ie?(0,n.__assign)((0,n.__assign)({},e),t.payload):e};var fe,ve=!1;const me=(0,l.default)((0,s.combineReducers)({ui:se,settings:ce,layers:ue,drawings:pe,background:ge,data:_e}),{limit:100,syncFilter:!0,filter:(0,l.combineFilters)((0,l.includeAction)([b,L,k,R,A,N,P,I,H,U,J,ee,re,ne,oe,G,V,X,q,f,Y]),(function(e){return e.type===q?e.payload.isEdit:e.type===f?e.value:![b,I,L,k,V].includes(e.type)||(e.type!==fe?(ve=!1,fe=e.type,!0):!ve&&(ve=!0,setTimeout((function(){ve=!1}),500),!0))}))});var ye=r(54612),xe=r(86125),we=r(52205),Ce=r(59397),Ee=r(40906),Te=function(e){return{type:j,index:e}},Se=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var i=o().present.layers.items;n({type:e,payload:t}),r&&n(Te(i.length))}},be=function(e,t){return function(r,n){var o,i=n().present,a=i.data,s=i.settings,l=g(n()),c=a.artboardWidth/2,d=a.artboardHeight/2-l,p=(0,Ce.decodeHTMLEntities)(a.placeholders[(0,Ee.irand)(0,a.placeholders.length-1)]),h=0,_=!1,f=s.fontStyle,v=s.color,m=s.fontSize,y=1;t&&(c=void 0!==t.x?t.x:c,d=void 0!==t.y?t.y:d,p=void 0!==t.text?t.text:p,h=void 0!==t.rotate?t.rotate:h,_=void 0!==t.isEdit?t.isEdit:_,f=void 0!==t.style?t.style:f,v=void 0!==t.color?t.color:v,m=void 0!==t.fontSize?t.fontSize:m,o=t.initialFontSize,y=void 0!==t.scale?t.scale:y),(0,we.sendStat)(we.EVENTS.ADD_TEXT),e&&r(ke(u.default.TABS.TEXT)),r(Se(U,{type:u.default.LAYER_TYPES.TEXT,text:p,x:c,y:d,rotate:h,isEdit:_,fontSize:m,initialFontSize:o,fontStyle:f,color:v,scale:y,canDelete:!0},e))}},Pe=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:q,payload:{isEdit:e}})}},Ie=function(e){return{type:$,payload:e}},Re=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var i=o[n];i&&(i.type===u.default.LAYER_TYPES.STICKER?(0,we.sendStat)(we.EVENTS.DELETE_STICKER):i.type===u.default.LAYER_TYPES.TEXT&&(0,we.sendStat)(we.EVENTS.DELETE_TEXT),e(Le(!1)),e({type:J,index:n}))}}},Ae=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var i=o[n];i&&i.type===u.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(Pe(!1)):e(Re()))}}},Le=function(e){return{type:f,value:e}},ke=function(e){return function(t,r){var n=r().present.layers,o=n.items,i=n.currentIndex;null!==i&&(o[i].type===u.default.LAYER_TYPES.TEXT&&t(Ae()),[u.default.TABS.PAINT,u.default.TABS.FILTERS,u.default.TABS.COLOR,u.default.TABS.CROP].includes(e)&&t(Te(null))),t({type:m,value:e})}},Ne=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:G,payload:{color:e}})}}(e)),t({type:w,color:e})}},Oe=function(e){return{type:O,aspect:e}},De=function(e){return{type:re,value:e}},Me=function(e){return{type:ne,value:e}},Be=function(e){return(0,we.sendStat)(we.EVENTS.SELECT_BACKGROUND),{type:oe,value:e}},Fe=function(e){return{type:ie,payload:e}},je=function(e){return function(t){(0,a.batch)((function(){var r,n,o;e.hasOwnProperty("url")&&t(Me(e.url)),e.hasOwnProperty("data")&&t(Fe(e.data)),e.hasOwnProperty("isCropped")&&t((r=e.isCropped,{type:D,isCropped:r})),e.hasOwnProperty("flipX")&&t((n=e.flipX,(0,we.sendStat)(we.EVENTS.FLIP_X),{type:M,value:n})),e.hasOwnProperty("flipY")&&t(function(e){return(0,we.sendStat)(we.EVENTS.FLIP_Y),{type:B,value:e}}(e.flipY)),e.hasOwnProperty("rotate")&&t(function(e){return{type:F,value:e}}(e.rotate)),e.hasOwnProperty("layers")&&t((o=e.layers,{type:Q,items:o})),e.hasOwnProperty("drawings")&&t(function(e){return{type:te,payload:e}}(e.drawings))}))}},He=r(73935);function Ue(e,t){return new Promise((function(r,n){var o=new Image;o.crossOrigin="Anonymous",t&&(o.dataset.name=t),o.onerror=function(){n(new Error("Failed to load image's URL: "+e))},o.onload=function(){r(o)},o.src=e}))}function ze(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0,width:0,height:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top,i=r.width,a=r.height;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o,width:i,height:a}}function We(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function Ze(e,t,r,n,o,i,a){var s=0,l=0;switch(e){case"left_top":s=n+i,l=o+a;break;case"left_center":s=n+i,l=r/2+a;break;case"left_bottom":s=n+i,l=r-o+a;break;case"center_top":s=t/2+i,l=o+a;break;case"center":s=t/2+i,l=r/2+a;break;case"center_bottom":s=t/2+i,l=r-o+a;break;case"right_top":s=t-n+i,l=o+a;break;case"right_center":s=t-n+i,l=r/2+a;break;case"right_bottom":s=t-n+i,l=r-o+a}return{x:Math.round(s),y:Math.round(l)}}function Ye(e,t,r){var n=e.getContext("2d");n&&(n.clearRect(0,0,e.width,e.height),n.fillStyle="rgb(30, 30, 30)",n.fillRect(0,0,e.width,e.height),n.save(),n.filter="blur(135px)",n.drawImage(t,0,0,e.width,e.height),n.restore(),"none"!==n.filter&&(n.fillStyle="rgb("+r.r+", "+r.g+", "+r.b+")",n.fillRect(0,0,e.width,e.height)))}var Ge=r(83295),Ve=function(e){function t(t){var r=e.call(this,t)||this;return r.renderDrawings=function(){var e=r.props.drawings,t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach((function(e){n.lineWidth=e.width*u.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=We(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach((function(e){n.lineTo(e[0]*o,e[1]*o)})),n.stroke()}))}}},r.drawStart=function(e){if(r.props.ui.currentMode===u.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=ze(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var i=r.props.settings;r.props.addDrawing({color:i.color,width:i.brushWidth,opacity:i.brushOpacity,path:r.currentDrawing}),r.renderDrawings()}},r.drawProcess=function(e){var t=ze(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings()},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvas=(0,i.createRef)(),r.currentDrawing=[],r}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,n=e.height,i=e.ui,a=(0,Ge.classNames)("EditorCanvas__canvas","EditorCanvas__canvas--draw",{"EditorCanvas__canvas--disabled":i.currentMode!==u.default.TABS.PAINT});return(0,o.jsx)("canvas",{ref:this.canvas,className:a,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:n}},void 0)},t.prototype.componentDidMount=function(){this.renderDrawings()},t.prototype.componentDidUpdate=function(){this.renderDrawings()},t}(i.PureComponent),Xe={addDrawing:function(e){return(0,we.sendStat)(we.EVENTS.ADD_GRAFFITI),{type:ee,payload:e}},addLayerText:be};const Ke=(0,a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,drawings:e.present.drawings,data:e.present.data}}),Xe)(Ve);var qe=new(function(){function e(){this.images={}}return e.prototype.get=function(e){var t=this;return new Promise((function(r,n){var o=t.images[e];o?r(o):Ue(e).then((function(n){t.setImage(e,n),r(n)})).catch(n)}))},e.prototype.setImage=function(e,t){this.images[e]=t},e}()),$e="WebGL context not found",Je="Create texture failed",Qe="Shader compile failed",et="Create program failed",tt="Incomplete framebuffer",rt="Filter not found",nt=function(e,t,r){var n=e.createShader(r);if(!n)throw new Error(Qe);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(""+e.getShaderInfoLog(n));this.shader=n},ot=function(){function e(e,t,r){if(!e)throw new Error($e);var n=e.createTexture();if(!n)throw new Error(Je);this.texture=n,e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&r&&this.updateSize(e,t,r),e.bindTexture(e.TEXTURE_2D,null)}return e.prototype.attachImage=function(e,t){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.updateSize=function(e,t,r){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.use=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},e.unuse=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.destroy=function(e){e.deleteTexture(this.texture)},e}(),it=r(95724),at=function(){function e(e,t,r){if(!e)throw new Error($e);var n=new nt(e,t,e.VERTEX_SHADER).shader,o=new nt(e,r,e.FRAGMENT_SHADER).shader;this.gl=e,this.program=this.createProgram(n,o),this.framebuffer=e.createFramebuffer()}return e.prototype.createProgram=function(e,t){var r=this.gl.createProgram();if(!r)throw new Error(et);if(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error(""+this.gl.getProgramInfoLog(r));return r},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e.prototype.attribute=function(e,t){var r=this.gl.getAttribLocation(this.program,e),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0)},e.prototype.uniforms=function(e){for(var t in this.gl.useProgram(this.program),e)if(e.hasOwnProperty(t)){var r=this.gl.getUniformLocation(this.program,t),n=e[t];if(Array.isArray(n))switch(n.length){case 1:this.gl.uniform1fv(r,new Float32Array(n));break;case 2:this.gl.uniform2fv(r,new Float32Array(n));break;case 3:this.gl.uniform3fv(r,new Float32Array(n));break;case 4:this.gl.uniform4fv(r,new Float32Array(n))}else(0,it.isNumber)(n)&&this.gl.uniform1f(r,n)}},e.prototype.textures=function(e,t){var r=this;this.gl.useProgram(this.program),e.forEach((function(e,n){t?(e.use(r.gl,n),r.gl.uniform1i(r.gl.getUniformLocation(r.program,"u_image"+n),n)):ot.unuse(r.gl,n)}))},e.prototype.draw=function(e,t){this.gl.useProgram(this.program),t&&(t.updateSize(this.gl,e.width,e.height),this.bindTexture(t.texture)),this.gl.canvas.width=e.width,this.gl.canvas.height=e.height,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);var r=e.width,n=e.height;this.attribute("a_position",[0,0,r,0,0,n,0,n,r,0,r,n]),this.attribute("a_texCoord",[0,0,1,0,0,1,0,1,1,0,1,1]),this.uniforms(Object.assign(e.uniforms,{u_resolution:[e.width,e.height]})),e.textures&&this.textures(e.textures,!0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6),e.textures&&this.textures(e.textures,!1),t&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.prototype.bindTexture=function(e,t){if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0),t){var r=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(r!==this.gl.FRAMEBUFFER_COMPLETE){var n="";switch(r){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:n="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:n="There is no attachment.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:n="Height and width of the attachment are not the same.";break;case this.gl.FRAMEBUFFER_UNSUPPORTED:n="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer."}throw new Error(tt+". "+n)}}},e}();const st="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// convert the rectangle from pixels to 0.0 to 1.0\n\tvec2 zeroToOne = a_position / u_resolution;\n\n\t// convert from 0->1 to 0->2\n\tvec2 zeroToTwo = zeroToOne * 2.0;\n\n\t// convert from 0->2 to -1->+1 (clipspace)\n\tvec2 clipSpace = zeroToTwo - 1.0;\n\n\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n\t// pass the texCoord to the fragment shader\n\t// The GPU will interpolate this value between points.\n\tv_texCoord = a_texCoord;\n}\n";var lt={regular:"/images/filters/maps/regular.png",nox:"/images/filters/maps/nox.png",vesper:"/images/filters/maps/vesper.png",latona:"/images/filters/maps/latona.png",liber:"/images/filters/maps/liber.png",luna:"/images/filters/maps/luna.png",minerva:"/images/filters/maps/minerva.png",mitra:"/images/filters/maps/mitra.png",pro:"/images/filters/maps/pro.png",terra:"/images/filters/maps/terra.png",veles:"/images/filters/maps/veles.png",vesta:"/images/filters/maps/vesta.png",zaria:"/images/filters/maps/zaria.png",sepia:"/images/filters/maps/sepia.png",genius:"/images/filters/maps/genius.png",horus:"/images/filters/maps/horus.png",fortuna:"/images/filters/maps/fortuna.png"},ct=["/images/filters/maps/contrast_negative.png","/images/filters/maps/contrast_positive.png","/images/filters/maps/exposure_negative.png","/images/filters/maps/exposure_positive.png","/images/filters/maps/warm_negative_lut.png","/images/filters/maps/warm_positive_lut.png"];var dt={preserveDrawingBuffer:!0,premultipliedAlpha:!1},ut=document.createElement("canvas"),pt=ut.getContext("webgl",dt)||ut.getContext("experimental-webgl",dt),ht={},gt=function(){function e(){this.baseColorCorrectionProgram=new at(pt,st,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0; // image\nuniform sampler2D u_image1; // contrast_negative.png\nuniform sampler2D u_image2; // contrast_positive.png\nuniform sampler2D u_image3; // exposure_negative.png\nuniform sampler2D u_image4; // exposure_positive.png\nuniform sampler2D u_image5; // warm_negative_lut.png\nuniform sampler2D u_image6; // warm_positive_lit.png\nuniform sampler2D u_image7; // color table\n\nuniform float u_exposure;\nuniform float u_contrast;\nuniform float u_saturation;\nuniform float u_warmth;\nuniform float u_amount;\n\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\n\treturn conColor;\n}\n\nfloat BF_SoftLight(float base, float blend) {\n\treturn 2.0 * base * blend + base * base * (1.0 - 2.0 * blend);\n}\n\nvec3 BF_SoftLight(vec3 base, vec3 blend) {\n\treturn vec3(BF_SoftLight(base.r, blend.r), BF_SoftLight(base.g, blend.g), BF_SoftLight(base.b, blend.b));\n}\n\nvec3 Exposure(vec3 view, float intensity) {\n\tvec3 exposure1;\n\texposure1.r = texture2D(u_image3, vec2(view.r, 0.5)).r;\n\texposure1.g = texture2D(u_image3, vec2(view.g, 0.5)).g;\n\texposure1.b = texture2D(u_image3, vec2(view.b, 0.5)).b;\n\n\tvec3 exposure2;\n\texposure2.r = texture2D(u_image4, vec2(view.r, 0.5)).r;\n\texposure2.g = texture2D(u_image4, vec2(view.g, 0.5)).g;\n\texposure2.b = texture2D(u_image4, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, exposure2, intensity);\n\t} else {\n\t\tresult = mix(view, exposure1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Contrast(vec3 view, float intensity) {\n\tvec3 contrast1;\n\tcontrast1.r = texture2D(u_image1, vec2(view.r, 0.5)).r;\n\tcontrast1.g = texture2D(u_image1, vec2(view.g, 0.5)).g;\n\tcontrast1.b = texture2D(u_image1, vec2(view.b, 0.5)).b;\n\n\tvec3 contrast2;\n\tcontrast2.r = texture2D(u_image2, vec2(view.r, 0.5)).r;\n\tcontrast2.g = texture2D(u_image2, vec2(view.g, 0.5)).g;\n\tcontrast2.b = texture2D(u_image2, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, contrast2, intensity);\n\t} else {\n\t\tresult = mix(view, contrast1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 ColorTemp(vec3 view, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec3 coldColor1 = texture2D(u_image5, texPos1).rgb;\n\tvec3 coldColor2 = texture2D(u_image5, texPos2).rgb;\n\tvec3 coldColor = mix(coldColor1, coldColor2, fract(blueColor));\n\n\tvec3 warmColor1 = texture2D(u_image6, texPos1).rgb;\n\tvec3 warmColor2 = texture2D(u_image6, texPos2).rgb;\n\tvec3 warmColor = mix(warmColor1, warmColor2, fract(blueColor));\n\n\tvec3 result;\n\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, warmColor, intensity);\n\t} else {\n\t\tresult = mix(view, coldColor, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Saturation(vec3 view, float intensity) {\n\treturn ContrastSaturationBrightness(view, 1.0, intensity, 1.0);\n}\n\nvec3 Lut(vec3 view, sampler2D tex, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec3 newColor1 = texture2D(tex, texPos1).rgb;\n\tvec3 newColor2 = texture2D(tex, texPos2).rgb;\n\n\tvec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n\tvec3 color = mix(view, newColor, intensity);\n\n\treturn color;\n}\n\n// [-1.0; 1.0]\nvec3 pExposure(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Exposure(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pContrast(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Contrast(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pColorTemp(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn ColorTemp(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pSaturation(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.6);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? 1.0 + (range.y - 1.0) * intensity : range.x + (1.0 - range.x) * (intensity + 1.0);\n\treturn Saturation(view, intensity);\n}\n\n// [0.0; 1.0]\nvec3 pLut(vec3 view,sampler2D tex, float intensity) {\n\tvec2 range = vec2(0.0, 1.0);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\treturn Lut(view, tex, intensity);\n}\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 texture = texture2D(u_image0, texelCoord);\n\n\ttexture.rgb = pColorTemp(texture.rgb, u_warmth);\n\ttexture.rgb = pLut(texture.rgb, u_image7, u_amount);\n\ttexture.rgb = pExposure(texture.rgb, u_exposure);\n\ttexture.rgb = pContrast(texture.rgb, u_contrast);\n\ttexture.rgb = pSaturation(texture.rgb, u_saturation);\n\n\tgl_FragColor = texture;\n}\n"),this.postProcessProgram=new at(pt,st,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0;\n\nuniform float u_vignette;\nuniform float u_sharpness;\nuniform float u_grain;\n\nuniform vec2 u_sourceSize;\n\nvec4 rnm(in vec2 tc) {\n\tfloat timer = 0.4;\n\tfloat noise = sin(dot(tc + vec2(timer, timer), vec2(12.9898, 78.233))) * 43758.5453;\n\n\tfloat noiseR = fract(noise) * 2.0 - 1.0;\n\tfloat noiseG = fract(noise * 1.2154) * 2.0 - 1.0;\n\tfloat noiseB = fract(noise * 1.3453) * 2.0 - 1.0;\n\tfloat noiseA = fract(noise * 1.3647) * 2.0 - 1.0;\n\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\n\nfloat fade(in float t) {\n\treturn t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = 0.00195313 * floor(p) + 0.00195313;\n\tvec3 pf = fract(p); // Fractional part for interpolation\n\n\t// Noise contributions from (x=0, y=0), z=0 and z=1\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3  grad001 = rnm(vec2(perm00, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=0, y=1), z=0 and z=1\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, 0.00195313)).a ;\n\tvec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3  grad011 = rnm(vec2(perm01, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\n\t// Noise contributions from (x=1, y=0), z=0 and z=1\n\tfloat perm10 = rnm(pi.xy + vec2(0.00195313, 0.0)).a ;\n\tvec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3  grad101 = rnm(vec2(perm10, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=1, y=1), z=0 and z=1\n\tfloat perm11 = rnm(pi.xy + vec2(0.00195313, 0.00195313)).a ;\n\tvec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3  grad111 = rnm(vec2(perm11, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\n\t// Blend contributions along x\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\n\t// Blend contributions along y\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\n\t// Blend contributions along z\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\n\t// We're done, return the final noise value.\n\treturn n_xyz;\n}\n\n//2d coordinate orientation thing\nvec2 coordRot(in vec2 tc, in float angle) {\n\tfloat aspect = u_sourceSize.x / u_sourceSize.y;\n\tvec2 uv = (tc * 2.0) - 1.0;\n\tfloat rotX = (uv.x * aspect * cos(angle)) - (uv.y * sin(angle));\n\tfloat rotY = (uv.y * cos(angle)) + (uv.x * aspect * sin(angle));\n\trotX = ((rotX / aspect) * 0.5 + 0.5);\n\trotY = rotY * 0.5 + 0.5;\n\treturn vec2(rotX, rotY);\n}\n\nvec3 BF_Multiply(vec3 base, vec3 blend) {\n\treturn base * blend;\n}\n\nfloat BF_Screen(float base, float blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 BF_Screen(vec3 base, vec3 blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 Sharpness(vec3 view, float intensity) {\n\tvec2 uv = v_texCoord;\n\tvec2 step = 1.0 / u_sourceSize;\n\n\tvec3 texA = texture2D(u_image0, uv + vec2(-step.x, -step.y) * 1.0).rgb;\n\tvec3 texB = texture2D(u_image0, uv + vec2( step.x, -step.y) * 1.0).rgb;\n\tvec3 texC = texture2D(u_image0, uv + vec2(-step.x,  step.y) * 1.0).rgb;\n\tvec3 texD = texture2D(u_image0, uv + vec2( step.x,  step.y) * 1.0).rgb;\n\n\tvec3 around = 0.25 * (texA + texB + texC + texD);\n\tvec3 center  = texture2D(u_image0, uv ).rgb;\n\tvec3 col = center + (center - around) * intensity;\n\n\treturn col;\n}\n\nvec3 Grain(vec3 view, float intensity) {\n\tvec2 texCoord = v_texCoord;\n\n\tfloat timer = 0.4;\n\tfloat coloramount = 0.4;\n\tfloat grainsize = 2.0;\n\tfloat lumamount = 0.3;\n\n\tbool colored = true;\n\n\tvec3 rotOffset = vec3(1.425, 3.892, 5.835); // rotation offset values\n\tvec2 rotCoordsR = coordRot(texCoord, timer + rotOffset.x);\n\tvec3 noise = vec3(pnoise3D(vec3(rotCoordsR * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 0.0)));\n\n\tif (colored) {\n\t\tvec2 rotCoordsG = coordRot(texCoord, timer + rotOffset.y);\n\t\tvec2 rotCoordsB = coordRot(texCoord, timer + rotOffset.z);\n\t\tnoise.g = mix(noise.r, pnoise3D(vec3(rotCoordsG * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 1.0)), coloramount);\n\t\tnoise.b = mix(noise.r, pnoise3D(vec3(rotCoordsB * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 2.0)), coloramount);\n\t}\n\n\tvec3 col = view.rgb;\n\tvec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n\tfloat luminance = lumamount * dot(col, lumcoeff);\n\tfloat lum = smoothstep(0.2, 0.0, luminance);\n\n\tlum += luminance;\n\tnoise = mix(noise, vec3(0.0), pow(lum, 4.0));\n\tcol = col + noise * intensity;\n\n\treturn col;\n}\n\nvec3 Vignette(vec3 view, float intensity) {\n\tfloat inten = abs(intensity);\n\tfloat dist = distance(v_texCoord, vec2(0.5, 0.5));\n\tfloat size = 0.5 - inten * 0.4;\n\tfloat amount = inten * inten * 0.1 + 0.5 * inten;\n\tfloat vignette = smoothstep(0.8, size * 0.799, dist * (amount + size));\n\treturn (intensity >= 0.0) ? view * vignette : BF_Screen(view,vec3(1.0-vignette));\n}\n\n// [-1; 1]\nvec3 pSharpness(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.5);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity+1.0) + range.x;\n\treturn Sharpness(view, intensity);\n}\n\n// [0; 1]\nvec3 pGrain(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 0.2);\n\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Grain(view, intensity);\n}\n\n// [-1; 1]\nvec3 pVignette(vec3 view, float intensity) {\n\tvec2 range = vec2(-1.0, 1.0);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Vignette(view, intensity);\n}\n\nvoid main() {\n\tvec4 texture = texture2D(u_image0, v_texCoord);\n\n\ttexture.rgb = pSharpness(texture.rgb, u_sharpness);\n\ttexture.rgb = pVignette(texture.rgb, u_vignette);\n\ttexture.rgb = pGrain(texture.rgb, u_grain);\n\n\tgl_FragColor = texture;\n}\n"),this.flippedProgram=new at(pt,st,"precision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = texture2D(u_texture, vec2(v_texCoord.x, 1.0 - v_texCoord.y));\n\tgl_FragColor = color;\n}\n"),this.triangleBlurProgram=new at(pt,st,"precision mediump float;\n\nuniform sampler2D u_image0; // original image\nuniform vec2 u_delta;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = vec4(0.0);\n\tfloat total = 0.0;\n\tfloat offset = fract(sin(dot(gl_FragCoord.xyz, vec3(12.9898, 78.233, 151.7182))) * 43758.5453);\n\n\tfor (float t = -30.0; t <= 30.0; t++) {\n\t\tfloat percent = (t + offset - 0.5) / 30.0;\n\t\tfloat weight = 1.0 - abs(percent);\n\t\tvec4 sampleColor = texture2D(u_image0, v_texCoord + u_delta * percent);\n\t\tsampleColor.rgb *= sampleColor.a;\n\n\t\tcolor += sampleColor * weight;\n\t\ttotal += weight;\n\t}\n\n\tcolor = color / total;\n\tcolor.rgb /= color.a + 0.00001;\n\tgl_FragColor = color;\n}\n"),this.roundBlurProgram=new at(pt,st,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tfloat distanceFromCenter = distance(u_position, texelCoord);\n\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.3 - 0.2, 0.3, distanceFromCenter), 0.0, 1.0));\n\tgl_FragColor = color;\n}\n"),this.squareBlurProgram=new at(pt,st,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tvec2 realPosition = u_position;\n\trealPosition.x = texelCoord.x;\n\n\tfloat distanceFromCenter = distance(realPosition, texelCoord);\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.2 - 0.1, 0.2, distanceFromCenter), 0.0, 1.0));\n\n\tgl_FragColor = color;\n}\n"),this.colorCorrectionTexture=new ot(pt),this.postProcessTexture=new ot(pt),this.blurTexture1=new ot(pt),this.blurTexture2=new ot(pt),this.resultBlurTexture=new ot(pt)}return e.getOrCreateTexture=function(t,r,n){var o=n?r.src+"_auto":r.src;if(!ht[o]){var i=void 0;i=n?e.getAuto(r):r;var a=new ot(t);a.attachImage(t,i),ht[o]=a}return ht[o]},e.loadTextures=function(t,r){return new Promise((function(n){var o=[],i=r.map((function(e){return qe.get(e)}));Promise.all(i).then((function(r){r.forEach((function(r){var n=e.getOrCreateTexture(t,r);o.push(n)})),n(o)})).catch((function(){}))}))},e.getAuto=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return t;t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height);var n=e.width*e.height,o=255,i=r.getImageData(0,0,e.width,e.height),a=i.data;function s(e,t,r,n){t+r>=e&&(t=(e-1)/2,r=(e-1)/2);var i=function(e,t,r,n){for(var o,i=256,s=[],l=0;l<256;l++)s.push(0);for(o=0;o<e;o++)s[a[4*o+n]]+=1;for(o=1;o<i;o++)s[o]+=s[o-1];var c={};for(o=0;o<i&&s[o]<=t;)o++;for(c.min=o,o=255;o<i&&s[o]>e-r;)o--;return o<255&&o++,c.max=o,c}(e,t,r,n);!function(e,t,r,n){var i,s;if(r<=t)for(i=0;i<e;i++)a[(s=4*i)+n]=127.5;else{var l=new Array(256);for(i=0;i<t;i++)l[i]=0;for(i=t;i<r;i++)l[i]=(i-t)*o/(r-t)+.5;for(i=r;i<256;i++)l[i]=o;for(i=0;i<e;i++)a[(s=4*i)+n]=l[a[s+n]]}}(e,i.min,i.max,n)}!function(e,t,r){s(e,t,r,0),s(e,t,r,1),s(e,t,r,2)}(n,.01*n,.01*n),r.putImageData(i,0,0);var l=document.createElement("canvas");return l.width=e.width,l.height=e.height,null==(r=l.getContext("2d"))||r.drawImage(t,0,0,t.width,t.height),t},e.prototype.render=function(t,r,o,i,a,s,l){var c=this;return void 0===a&&(a={}),new Promise((function(d){requestAnimationFrame((function(){if(!pt)throw new Error($e);var p=function(e){var t=lt[e];if(t)return(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(ct),!1),[t],!1)}(i);if(!p)throw new Error(rt);var h=e.getOrCreateTexture(pt,o,l);e.loadTextures(pt,p).then((function(e){var o=c.postProcessTexture;if(c.baseColorCorrectionProgram.draw({width:t,height:r,uniforms:{u_exposure:a.exposure,u_contrast:a.contrast,u_warmth:a.warmth,u_saturation:a.saturation,u_amount:a.amount},textures:(0,n.__spreadArray)([h],(0,n.__read)(e),!1)},c.colorCorrectionTexture),c.postProcessProgram.draw({width:t,height:r,uniforms:{u_vignette:a.vignette,u_sharpness:a.sharpness,u_sourceSize:a.sourceSize,u_grain:a.grain},textures:[c.colorCorrectionTexture]},c.postProcessTexture),s&&s.isEnabled){var i=s.form===u.default.BLUR_TYPES.ROUND?c.roundBlurProgram:c.squareBlurProgram;c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[s.size/t,0]},textures:[c.postProcessTexture]},c.blurTexture1),c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[0,s.size/r]},textures:[c.blurTexture1]},c.blurTexture2),i.draw({width:t,height:r,uniforms:{u_position:s.position},textures:[c.blurTexture2,c.postProcessTexture]},c.resultBlurTexture),o=c.resultBlurTexture}return c.flippedProgram.draw({width:t,height:r,uniforms:{},textures:[o]}),d(ut)})).catch((function(e){console.error(new Error(e))}))}))}))},e}(),_t={},ft=function(e){function t(t){var r=e.call(this,t)||this;return r.canvas=(0,i.createRef)(),r.renderer=new gt,r.needUpdateSize=!0,r}return(0,n.__extends)(t,e),t.prototype.componentDidMount=function(){this.update()},t.prototype.componentDidUpdate=function(e){var t=this.props,r=t.originalWidth,n=t.originalHeight,o=t.background,i=r!==e.originalWidth||n!==e.originalHeight;this.needUpdateSize=i||JSON.stringify(o)!==JSON.stringify(e.background),this.update()},t.prototype.render=function(){var e=this.props,t=e.originalWidth,r=e.originalHeight;return(0,o.jsx)("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:t,height:r,style:{width:this.props.width,height:this.props.height}},void 0)},t.prototype.update=function(){var e=this,t=this.props.currentBackgroundUrl;t&&qe.get(t).then((function(t){e.renderImage(t)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this,r=this.canvas.current;if(r&&r.getContext("2d")){var n=this.props.background,o=this.props,i=o.colorCorrection,a=o.filter,s=o.blur,l=o.isAutoCorrection;n.currentBackgroundType===u.default.BACKGROUND_MODES.BACKGROUND&&(a={name:u.default.PHOTO_FILTERS[0],value:0},i={exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},s={isEnabled:!1,form:s.form,size:s.size,position:s.position},l=!1);var c={exposure:i.exposure,contrast:i.contrast,saturation:i.saturation,warmth:i.warmth,amount:a.value,vignette:i.vignette,sharpness:i.sharpness,grain:i.grain,sourceSize:[e.width,e.height]};this.renderer.render(e.width,e.height,e,a.name,c,s,l).then((function(n){if(n){var o,i,a=e.height/e.width;a>1.77?(o=t.props.height/a,i=t.props.height):(o=t.props.width,i=t.props.width*a);var s=Math.floor(t.props.width/2),l=Math.floor(t.props.height/2),c=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,null==r||r.drawImage(e,0,0,e.width,e.height),t}(n),d=_t[e.src];d||(_t[e.src]=function(e){var t,r=e.getContext("2d"),n={r:0,g:0,b:0};if(!r)return n;try{t=r.getImageData(0,0,r.canvas.width,r.canvas.height)}catch(e){return n}for(var o=-4,i=0;(o+=20)<t.data.length;)++i,n.r+=t.data[o],n.g+=t.data[o+1],n.b+=t.data[o+2];return n.r=~~(n.r/i),n.g=~~(n.g/i),n.b=~~(n.b/i),n}(c),d=_t[e.src]),Ye(r,c,d);var u={canvas:c,width:o,height:i,avgColor:d};t.needUpdateSize&&Object.assign(u,{x:s,y:l,locked:!0,rotate:0,scale:1}),t.props.updateBackgroundLayer(u)}})).catch((function(e){console.error(new Error(e))}))}},t}(i.PureComponent),vt={updateBackgroundLayer:Ie};const mt=(0,a.connect)((function(e){return{currentBackgroundUrl:h(e),originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight,background:e.present.background,isAutoCorrection:e.present.settings.isAutoCorrection,colorCorrection:e.present.settings.colorCorrection,filter:e.present.settings.filter,blur:e.present.settings.blur}}),vt)(ft);var yt=r(41650),xt=r(63192);const wt=(0,xt.makeIcon)("Icon24Chevron","chevron_24","0 0 16 24",'<symbol viewBox="0 0 16 24" xmlns="http://www.w3.org/2000/svg" id="chevron_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h16v24H0z" /><path d="M4.706 7.706a1 1 0 0 1 0-1.412l.088-.088a.997.997 0 0 1 1.414.002l5.084 5.084a.998.998 0 0 1 0 1.416l-5.084 5.084a1.002 1.002 0 0 1-1.414.002l-.088-.088a.995.995 0 0 1 0-1.412L9 12 4.706 7.706Z" fill="currentColor" /></g></symbol>',16,24,!1,void 0);var Ct=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,i=t.currentIndex,a=t.items,s=null!==i&&a[i],l=s&&s.type===u.default.LAYER_TYPES.TEXT&&s.isEdit,c="";return s&&(s.type===u.default.LAYER_TYPES.STICKER?c=(0,yt.getLang)("photos_pe_delete_sticker"):s.type===u.default.LAYER_TYPES.TEXT&&(c=(0,yt.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==u.default.BACKGROUND_MODES.BACKGROUND||s||(e=!0),(0,o.jsx)("div",(0,n.__assign)({className:(0,Ge.classNames)("StatusPanel StatusPanel--square")},{children:e?r.renderBackgrounds():(0,o.jsxs)("div",(0,n.__assign)({className:"StatusPanel__inner"},{children:[r.renderLeftBlock(),(0,o.jsxs)("div",{children:[s&&!l&&(0,o.jsx)("a",(0,n.__assign)({className:"StatusPanel__link",onClick:r.props.deleteLayer},{children:c}),void 0),s&&l&&(0,o.jsx)("a",(0,n.__assign)({className:"StatusPanel__link",onClick:r.props.closeTextEditor},{children:(0,yt.getLang)("photos_pe_save_text")}),void 0)]},void 0)]}),void 0)}),void 0)},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?(0,o.jsxs)("div",{children:[e&&e.edited&&e.canEdit&&(0,o.jsx)("a",(0,n.__assign)({className:"StatusPanel__link",onClick:e.restore},{children:(0,yt.getLang)("photos_filtered_restore")}),void 0),e&&!e.canEdit&&(0,o.jsx)("span",(0,n.__assign)({className:"StatusPanel__info"},{children:(0,yt.getLang)("photos_will_be_saved_to_pe_album")}),void 0)]},void 0):(0,o.jsx)("div",{children:r.props.currentBackgroundType===u.default.BACKGROUND_MODES.PHOTO&&(0,o.jsx)("a",(0,n.__assign)({className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},{children:(0,yt.getLang)("photos_pe_change_photo")}),void 0)},void 0)},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds,i=t.advice_gradients,a=t.colors,s=r.scrollElement.current,l=s?e+s.offsetWidth:0,c=!!e,d=!s||!!(s.scrollWidth-l),u=(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(i),!1),(0,n.__read)(a),!1);return(0,o.jsxs)("div",(0,n.__assign)({className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},{children:u.map((function(e){var t=e.id,n=e.preview,i=e.background;return(0,o.jsx)("a",{className:(0,Ge.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),style:{backgroundColor:i,backgroundImage:"url("+n+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}},t)}))}),void 0),c&&(0,o.jsx)("div",(0,n.__assign)({className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},{children:(0,o.jsx)(wt,{className:"StatusPanel__arrowIcon"},void 0)}),void 0),d&&(0,o.jsx)("div",(0,n.__assign)({className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},{children:(0,o.jsx)(wt,{className:"StatusPanel__arrowIcon"},void 0)}),void 0)]}),void 0)},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,i=n.offsetWidth,a=Math.max(0,Math.min(o+e,n.scrollWidth-i));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:a})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=(0,i.createRef)(),r.scrollWithAnimation=!1,r}return(0,n.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.scrollElement.current,t=document.querySelector(".StatusPanel__background--active");if(e&&t){t.offsetLeft+30>e.offsetWidth&&this.setPosition(e.offsetWidth)}},t}(i.Component),Et={deleteLayer:Re,closeTextEditor:Ae};const Tt=(0,a.connect)((function(e){return{context:e.present.data.context,layers:e.present.layers,addons:e.present.data.addons}}),Et)(Ct);var St=r(88420),bt=function(e,t,r){[u.default.CROP_ASPECT_ORIGINAL,u.default.CROP_ASPECT_FREE].includes(e)&&(e=t/r);var n=t,o=n/e;return o>r&&(n=(o=r)*e),{x:t/2-n/2,y:r/2-o/2,width:n,height:o}},Pt=function(e){function t(t){var r=e.call(this,t)||this;r.controlMouseDown=function(e,t){e.stopPropagation();var n=r.areaEl.current;if(n){window.addEventListener("mousemove",r.controlMouseMove),window.addEventListener("mouseup",r.controlMouseUp);var o=ze(e.nativeEvent,n),i=o.x,a=o.y;r.shiftX=i,r.shiftY=a,r.initCrop=r.state,r.side=t}},r.controlMouseMove=function(e){var t=r.containerEl.current;if(t&&void 0!==r.shiftX&&void 0!==r.shiftY&&void 0!==r.initCrop&&void 0!==r.side){var n=r.state,o=r.props,i=o.artboardWidth,a=o.artboardHeight,s=o.cropAspect,l=s===u.default.CROP_ASPECT_ORIGINAL?i/a:s,c=ze(e,t),d=c.x,p=c.y,h=c.width,g=c.height,_=n.x,f=n.y,v=n.width,m=n.height,y=u.default.CROP_MIN_SIZE,x=u.default.CROP_MIN_SIZE;if(l&&(l>1?y=u.default.CROP_MIN_SIZE*l:l<1&&(x=u.default.CROP_MIN_SIZE/l)),r.side===u.default.CROP_SIDES.CENTER)_=Math.min(Math.max(0,d-r.shiftX),h-v),f=Math.min(Math.max(0,p-r.shiftY),g-m);else{var w=Math.max(0,d-r.shiftX),C=Math.max(0,p-r.shiftY);switch(r.side){case u.default.CROP_SIDES.S:m=p-f-(r.shiftY-r.initCrop.height);break;case u.default.CROP_SIDES.N:m-=(f=C)-n.y;break;case u.default.CROP_SIDES.W:v-=(_=w)-n.x;break;case u.default.CROP_SIDES.E:v=d-_-(r.shiftX-r.initCrop.width);break;case u.default.CROP_SIDES.NW:f=C,v-=(_=w)-n.x,m-=f-n.y;break;case u.default.CROP_SIDES.NE:f=C,v=d-_-(r.shiftX-r.initCrop.width),m-=f-n.y;break;case u.default.CROP_SIDES.SW:v-=(_=w)-n.x,m=p-f-(r.shiftY-r.initCrop.height);break;case u.default.CROP_SIDES.SE:v=d-_-(r.shiftX-r.initCrop.width),m=p-f-(r.shiftY-r.initCrop.height)}if(l){var E=Math.min(v,h-_)/l;if([u.default.CROP_SIDES.NW,u.default.CROP_SIDES.NE].includes(r.side)&&(f=Math.max(0,f+m-E)),g-(f+E)<0)return;m=E}v=Math.min(Math.max(y,v),h-_),m=Math.min(Math.max(x,m),g-f),v-y<=0&&(_=n.x,v=n.width),m-x<=0&&(f=n.y,m=n.height)}r.setState({x:_,y:f,width:v,height:m})}},r.controlMouseUp=function(){window.removeEventListener("mousemove",r.controlMouseMove),window.removeEventListener("mouseup",r.controlMouseUp),delete r.shiftX,delete r.shiftY,delete r.initCrop,delete r.side},r.cropImage=function(){var e=r.state,t=e.width,o=e.height,i=e.x,a=e.y,s=r.props,l=s.currentBackgroundUrl,c=s.artboardWidth,d=s.artboardHeight;r.setState({isButtonDisable:!0});var u=document.createElement("canvas"),p=u.getContext("2d");p&&qe.get(l).then((function(e){var s=e.width/c,l=e.height/d;u.width=t*s,u.height=o*l,p.drawImage(e,i*s,a*l,t*s,o*l,0,0,u.width,u.height),u.toBlob((function(e){r.props.setCrop({url:URL.createObjectURL(e),isCropped:!0,data:{artboardWidth:t,originalWidth:u.width,originalHeight:u.height,addons:(0,n.__assign)((0,n.__assign)({},r.props.addons),{photoHeight:o})},layers:r.props.layers.items.map((function(e){return(0,n.__assign)((0,n.__assign)({},e),{x:e.x-i,y:e.y-a})})),drawings:r.props.drawings.map((function(e){return(0,n.__assign)((0,n.__assign)({},e),{path:e.path.map((function(e){return[e[0]-i,e[1]-a]}))})}))}),r.reset(t,o)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},r.reset=function(e,t){r.props.setAspect(u.default.CROP_ASPECT_FREE),r.setState({x:0,y:0,width:e,height:t,isButtonDisable:!1})},r.containerEl=(0,i.createRef)(),r.areaEl=(0,i.createRef)();var o=t.cropAspect,a=t.artboardWidth,s=t.artboardHeight;return r.state=(0,n.__assign)({isButtonDisable:!1},bt(o,a,s)),r}return(0,n.__extends)(t,e),t.prototype.shouldComponentUpdate=function(e){return e.cropAspect===this.props.cropAspect&&e.artboardWidth===this.props.artboardWidth&&e.artboardHeight===this.props.artboardHeight||this.setState(bt(e.cropAspect,e.artboardWidth,e.artboardHeight)),!0},t.prototype.render=function(){var e=this,t=u.default.CROP_SIDES,r=this.props,i=r.artboardWidth,a=r.artboardHeight,s=this.state,l=s.x,c=s.y,d=s.width,p=s.height,h=s.isButtonDisable,g=d<210,_=g?100:60,f=(0,Ge.classNames)("CropControls__buttons",{"CropControls__buttons--top":c+p+_>=a,"CropControls__buttons--small":g}),v=0!==l||0!==c||d!==i||p!==a;return(0,o.jsx)("div",(0,n.__assign)({className:"CropControls",ref:this.containerEl},{children:(0,o.jsxs)("div",(0,n.__assign)({className:"CropControls__inner",ref:this.areaEl,style:{top:c,left:l,width:d,height:p}},{children:[v&&(0,o.jsxs)("div",(0,n.__assign)({className:f},{children:[(0,o.jsx)(St.default,(0,n.__assign)({size:"s",className:"CropControls__button CropControls__button--cancel",onClick:function(){return e.reset(e.props.artboardWidth,e.props.artboardHeight)}},{children:(0,yt.getLang)("photos_pe_crop_cancel")}),void 0),(0,o.jsx)(St.default,(0,n.__assign)({size:"s",className:"CropControls__button",onClick:this.cropImage,disabled:h},{children:(0,yt.getLang)("photos_pe_crop_apply")}),void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"CropControls__grid",onMouseDown:function(r){return e.controlMouseDown(r,t.CENTER)}},{children:[(0,o.jsx)("div",{className:"CropControls__line CropControls__line--v",style:{left:"33.3333%"}},void 0),(0,o.jsx)("div",{className:"CropControls__line CropControls__line--v",style:{left:"66.6666%"}},void 0),(0,o.jsx)("div",{className:"CropControls__line CropControls__line--h",style:{top:"33.3333%"}},void 0),(0,o.jsx)("div",{className:"CropControls__line CropControls__line--h",style:{top:"66.6666%"}},void 0),(0,o.jsx)("div",{className:"CropControls__handleCorner CropControls__handleCorner--nw",onMouseDown:function(r){return e.controlMouseDown(r,t.NW)}},void 0),(0,o.jsx)("div",{className:"CropControls__handleCorner CropControls__handleCorner--ne",onMouseDown:function(r){return e.controlMouseDown(r,t.NE)}},void 0),(0,o.jsx)("div",{className:"CropControls__handleCorner CropControls__handleCorner--sw",onMouseDown:function(r){return e.controlMouseDown(r,t.SW)}},void 0),(0,o.jsx)("div",{className:"CropControls__handleCorner CropControls__handleCorner--se",onMouseDown:function(r){return e.controlMouseDown(r,t.SE)}},void 0),this.props.cropAspect===u.default.CROP_ASPECT_FREE&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"CropControls__handle CropControls__handle--n",onMouseDown:function(r){return e.controlMouseDown(r,t.N)}},void 0),(0,o.jsx)("div",{className:"CropControls__handle CropControls__handle--s",onMouseDown:function(r){return e.controlMouseDown(r,t.S)}},void 0),(0,o.jsx)("div",{className:"CropControls__handle CropControls__handle--w",onMouseDown:function(r){return e.controlMouseDown(r,t.W)}},void 0),(0,o.jsx)("div",{className:"CropControls__handle CropControls__handle--e",onMouseDown:function(r){return e.controlMouseDown(r,t.E)}},void 0)]},void 0)]}),void 0)]}),void 0)}),void 0)},t}(i.Component),It={setAspect:Oe,setCrop:je},Rt=(0,a.connect)((function(e){return{currentBackgroundUrl:h(e),cropAspect:e.present.settings.cropAspect,addons:e.present.data.addons,layers:e.present.layers,drawings:e.present.drawings}}),It)(Pt),At=function(e){function t(t){var r=e.call(this,t)||this;return r.canvasBg=(0,i.createRef)(),r}return(0,n.__extends)(t,e),t.prototype.componentDidUpdate=function(){this.drawImage()},t.prototype.render=function(){var e=this.props.layer,t=e.width*e.scale,r=e.height*e.scale;return(0,o.jsx)("canvas",{ref:this.canvasBg,width:t*u.default.CANVAS_SCALE,height:r*u.default.CANVAS_SCALE,style:{width:t,height:r}},void 0)},t.prototype.drawImage=function(){var e=this.props.layer,t=this.canvasBg.current,r=null==t?void 0:t.getContext("2d");if(r){var n=e.width*e.scale,o=e.height*e.scale;r.drawImage(e.canvas,0,0,n*u.default.CANVAS_SCALE,o*u.default.CANVAS_SCALE)}},t}(i.PureComponent);const Lt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.props.startLayerScale(),t.layer=t.props.layer,t.layer.type===u.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth/t.layer.scale,t.height=n.offsetHeight/t.layer.scale}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=ze(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var i={x:n-t.layer.x,y:o-t.layer.y},a=180*(Math.atan2(i.y,i.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(u.default.LAYER_MIN_SIZE,Math.sqrt(i.x*i.x+i.y*i.y))/t.distanceToZero;t.props.setLayerScale(s,a)}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this;return(0,o.jsxs)("div",(0,n.__assign)({className:"EditorLayerSelection"},{children:[(0,o.jsx)("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}},void 0),(0,o.jsx)("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}},void 0),(0,o.jsx)("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}},void 0),(0,o.jsx)("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}},void 0)]}),void 0)},t}(i.Component);var kt=r(26330);const Nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.render=function(){return kt.default.get("story_show_clickable_zones")?this.props.clickableZones.map((function(e,t){var r=e.clickable_area,n=100*Math.abs(r[1].x-r[0].x),i=100*Math.abs(r[2].y-r[1].y);return(0,o.jsx)("div",{className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:n+"%",height:i+"%"}},t)})):null},t}(i.Component);var Ot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDoubleClick=function(){t.props.toggleTextEditor(!0)},t}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,i=(0,Ge.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--locked":t.locked});switch(t.type){case u.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,i);break;case u.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,i);break;case u.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,i);break;case u.default.LAYER_TYPES.BACKGROUND:o=this.renderLayerBackground(t,n,i)}if(t.isBackground){var a=document.querySelector(".EditorCanvas__layers--bg");return a?He.createPortal(o,a):null}return o},t.prototype.renderLayerBackground=function(e,t,r){return(0,o.jsx)("div",(0,n.__assign)({className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},{children:(0,o.jsxs)("div",(0,n.__assign)({className:"EditorLayer__inner"},{children:[(0,o.jsx)(At,{layer:e},void 0),this.props.currentIndex===t&&(0,o.jsx)(Lt,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale},void 0)]}),void 0)}),t)},t.prototype.renderLayerSticker=function(e,t,r){var i=this.props.getStickerUrlById(e.id,u.default.STICKER_LARGE);return(0,o.jsx)("div",(0,n.__assign)({className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},{children:(0,o.jsx)("div",(0,n.__assign)({className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+i+"')"}},{children:this.props.currentIndex===t&&(0,o.jsx)(Lt,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale},void 0)}),void 0)}),t)},t.prototype.renderLayerImage=function(e,t,r){return(0,o.jsx)("div",(0,n.__assign)({className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},{children:(0,o.jsxs)("div",(0,n.__assign)({className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+e.url+"')"}},{children:[this.props.currentIndex===t&&(0,o.jsx)(Lt,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale},void 0),e.clickableZones&&(0,o.jsx)(Nt,{clickableZones:e.clickableZones},void 0)]}),void 0)}),t)},t.prototype.renderLayerText=function(e,t,r){var i=Math.max(10,e.fontSize*u.default.FONT_SIZE_COEFFICIENT);r+=" PhotoEditorFontStyle--"+e.fontStyle;var a={fontSize:i*e.scale,color:e.color};return this.props.currentIndex===t&&e.isEdit?null:(0,o.jsx)("div",(0,n.__assign)({className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},{children:(0,o.jsxs)("div",(0,n.__assign)({className:"EditorLayer__inner",style:a,onDoubleClick:this.handleDoubleClick},{children:[(0,o.jsx)("div",{children:(0,Ce.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))},void 0),this.props.currentIndex===t&&(0,o.jsx)(Lt,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale},void 0)]}),void 0)}),t)},t}(i.Component);const Dt=Ot;var Mt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,i=t.currentIndex,a=(0,Ge.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":[u.default.TABS.PAINT,u.default.TABS.FILTERS,u.default.TABS.COLOR,u.default.TABS.CROP].includes(this.props.currentMode)});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,n.__assign)({className:a+" EditorCanvas__layers--items"},{children:r.map((function(t,r){return(0,o.jsx)(Dt,{index:r,currentIndex:i,layer:t,setLayerScale:e.props.setLayerScale,startLayerScale:e.props.startLayerScale,toggleTextEditor:e.props.toggleTextEditor,getStickerUrlById:e.props.getStickerUrlById},r)}))}),void 0),(0,o.jsx)("div",{className:a+" EditorCanvas__layers--bg"},void 0)]},void 0)},t}(i.Component),Bt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=Math.max(10,e.fontSize*u.default.FONT_SIZE_COEFFICIENT);return e.initialFontSize&&(t=e.initialFontSize*u.default.FONT_SIZE_COEFFICIENT),(0,o.jsx)("div",(0,n.__assign)({className:"EditorText"},{children:(0,o.jsx)("div",(0,n.__assign)({className:"EditorText__inner"},{children:(0,o.jsx)("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:(0,Ce.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onKeyDown:r.onKeyDown,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}},void 0)}),void 0)}),void 0)},r.onKeyDown=function(e){if("Enter"===e.key)if(e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.metaKey||e.shiftKey){var t=r.textareaEl.current;if(t){var n=e.target.selectionStart,o=e.target.selectionEnd;t.value=t.value.substring(0,n)+"\n"+t.value.substring(o),t.selectionStart=t.selectionEnd=n+1,r.onChange()}}else r.props.closeTextEditor()},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},(function(){r.setState({height:e.scrollHeight})})),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,i=-1;o<t.length;o++){var a=t.charAt(o);if(" "!=a&&"-"!=a&&"+"!=a||(i=o),r.value+=a,r.scrollWidth>n){var s="";if(i>=0){for(var l=i+1;l<o;l++)s+=t.charAt(l);i=-1}s+=a,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=(0,i.createRef)(),(0,we.sendStat)(we.EVENTS.EDIT_TEXT),r}return(0,n.__extends)(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontSize===this.props.layer.fontSize&&e.layer.fontStyle===this.props.layer.fontStyle||this.onChange()},t}(i.Component);const Ft=(0,xt.makeIcon)("Icon28CameraOutline","camera_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="camera_outline_28"><path fill-rule="evenodd" d="M11 14a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm3-5a5 5 0 1 0 0 10 5 5 0 0 0 0-10Zm-1.337-6h-.076c-.469 0-.822 0-1.161.058a4 4 0 0 0-2.223 1.19c-.237.25-.433.543-.693.934l-.042.063-.086.129a3.862 3.862 0 0 1-.18.261 1 1 0 0 1-.673.36A3.86 3.86 0 0 1 7.212 6h-.09c-.574 0-.98 0-1.338.057a4.5 4.5 0 0 0-3.727 3.727C2 10.141 2 10.548 2 11.122v3.922c0 1.363 0 2.447.071 3.322.074.895.227 1.659.583 2.358a6 6 0 0 0 2.622 2.622c.7.356 1.463.51 2.359.583.874.071 1.958.071 3.321.071h6.088c1.363 0 2.447 0 3.322-.071.895-.074 1.659-.227 2.358-.583a6.001 6.001 0 0 0 2.622-2.622c.356-.7.51-1.463.583-2.358.071-.875.071-1.96.071-3.322v-3.922c0-.574 0-.98-.057-1.338a4.5 4.5 0 0 0-3.727-3.727C21.859 6 21.452 6 20.878 6h-.09a3.86 3.86 0 0 1-.317-.005 1 1 0 0 1-.673-.36 3.877 3.877 0 0 1-.18-.261l-.086-.129-.042-.063c-.26-.39-.456-.684-.693-.934a4 4 0 0 0-2.223-1.19C16.235 3 15.882 3 15.413 3h-2.75Zm0 2c-.578 0-.748.003-.897.03a2 2 0 0 0-1.112.594c-.104.11-.201.25-.522.73l-.085.129-.02.03a4.814 4.814 0 0 1-.28.392 3 3 0 0 1-2.018 1.08C7.579 8 7.424 8 7.249 8h-.037c-.7 0-.932.003-1.11.032a2.5 2.5 0 0 0-2.07 2.07c-.029.178-.032.41-.032 1.11V15c0 1.417 0 2.419.065 3.203.063.771.182 1.243.371 1.613a4 4 0 0 0 1.748 1.748c.37.189.842.308 1.613.371C8.581 22 9.583 22 11 22h6c1.417 0 2.419 0 3.203-.065.771-.063 1.243-.182 1.613-.37a4 4 0 0 0 1.748-1.749c.189-.37.308-.841.371-1.613C24 17.419 24 16.417 24 15v-3.788c0-.7-.003-.932-.032-1.11a2.5 2.5 0 0 0-2.07-2.07c-.178-.029-.41-.032-1.11-.032h-.036c-.176 0-.33 0-.481-.015a3 3 0 0 1-2.018-1.08 4.888 4.888 0 0 1-.28-.392l-.02-.03-.085-.128c-.32-.482-.418-.621-.522-.731a2 2 0 0 0-1.112-.595c-.149-.026-.319-.029-.897-.029h-2.674Z" clip-rule="evenodd" /></symbol>',28,28,!1,void 0);var jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===u.default.BACKGROUND_MODES.PHOTO?(0,we.sendStat)(we.EVENTS.CLICK_TO_CAMERA_ICON):e===u.default.BACKGROUND_MODES.BACKGROUND&&(0,we.sendStat)(we.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this;return(0,o.jsx)("div",(0,n.__assign)({className:"SwitchMode"},{children:Object.values(u.default.BACKGROUND_MODES).map((function(t){var r=(0,Ge.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current}),i=t===u.default.BACKGROUND_MODES.PHOTO?(0,o.jsx)(Ft,{},void 0):null;return(0,o.jsx)("span",(0,n.__assign)({className:r,onClick:function(){return e.setMode(t)}},{children:i}),t)}))}),void 0)},t}(i.PureComponent),Ht=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this,r=(0,Ge.classNames)("DropBox",{"DropBox--hover":this.state.onHover});return(0,o.jsx)("div",(0,n.__assign)({className:r,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},{children:t.renderIcon()}),void 0)},t.renderIcon=function(){return(0,o.jsxs)("svg",(0,n.__assign)({xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50",fill:"none"},{children:[(0,o.jsx)("path",{fill:"#fff",d:"M17.5 18.38a1 1 0 00-2 .24l1.8 15.23a3 3 0 002.98 2.65h9.44a3 3 0 002.98-2.65l1.8-15.23a1 1 0 10-2-.24l-1.78 15.24a1 1 0 01-1 .88h-9.44a1 1 0 01-1-.88L17.5 18.38z"},void 0),(0,o.jsx)("path",{fill:"#fff",d:"M22 21.45a1 1 0 00-2 .1l.5 10a1 1 0 102-.1l-.5-10zm8 .1a1 1 0 00-2-.1l-.5 10a1 1 0 102 .1l.5-10zm-4-.05a1 1 0 10-2 0v10a1 1 0 002 0v-10z"},void 0),(0,o.jsx)("path",{fill:"#fff",fillRule:"evenodd",d:"M20.62 16.5c.08-.35.2-.77.42-1.2.32-.64.8-1.19 1.38-1.59A4.55 4.55 0 0125 13c1.05 0 1.9.27 2.58.71.59.4 1.06.95 1.38 1.6.21.42.34.84.42 1.19H36a1 1 0 010 2H14a1 1 0 010-2h6.63zm6.68 0a2.9 2.9 0 00-.13-.3c-.16-.33-.4-.61-.7-.82-.31-.2-.77-.38-1.47-.38s-1.16.17-1.47.38c-.32.2-.54.5-.7.82-.05.1-.1.2-.13.3h4.6z",className:"DropBox__cap",clipRule:"evenodd"},void 0)]}),void 0)},t}(i.PureComponent),Ut=r(97404);const zt=(0,xt.makeIcon)("Icon16Repost","repost_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="repost_16"><path d="m8.583 1.914.061-.087a.6.6 0 0 1 .758-.128l.088.063 3.272 2.805.04.043a.6.6 0 0 1 .01.768l-.075.078L9.49 8.238a.6.6 0 0 1-.982-.358L8.5 7.783V5.999L5 6a1 1 0 0 0-.993.883L4 7v4a1 1 0 0 0 .883.993L5 12h4a1 1 0 0 1 .117 1.993L9 14H5a3 3 0 0 1-2.995-2.824L2 11V7a3 3 0 0 1 2.824-2.995L5 4h3.5V2.216a.6.6 0 0 1 .083-.303l.061-.087z" fill="currentColor" /></symbol>',16,16,!1,void 0),Wt=(0,xt.makeIcon)("Icon24Fullscreen","fullscreen_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="fullscreen_24"><path fill-rule="evenodd" d="M14 4.9a.9.9 0 0 1 .9-.9h4.2a.9.9 0 0 1 .9.9v4.2a.9.9 0 1 1-1.8 0V7.073l-3.664 3.663a.9.9 0 1 1-1.272-1.272L16.927 5.8H14.9a.9.9 0 0 1-.9-.9Zm-3.264 8.364a.9.9 0 0 1 0 1.272L7.073 18.2h2.025a.9.9 0 1 1 0 1.8H4.9a.9.9 0 0 1-.9-.9v-4.2a.9.9 0 0 1 1.8 0v2.027l3.664-3.663a.9.9 0 0 1 1.272 0Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0),Zt=(0,xt.makeIcon)("Icon24FullscreenExit","fullscreen_exit_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="fullscreen_exit_24"><path fill-rule="evenodd" d="M5 13.9a.9.9 0 0 1 .9-.9h4.2a.9.9 0 0 1 .9.9v4.2a.9.9 0 1 1-1.8 0v-2.027l-3.664 3.663a.9.9 0 1 1-1.272-1.272L7.927 14.8H5.9a.9.9 0 0 1-.9-.9Zm14.736-9.636a.9.9 0 0 1 0 1.272L16.073 9.2h2.025a.9.9 0 0 1 0 1.8H13.9a.9.9 0 0 1-.9-.9V5.9a.9.9 0 1 1 1.8 0v2.027l3.664-3.663a.9.9 0 0 1 1.272 0Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var Yt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?He.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,a=e.background,s=e.data,l=e.ui,c=e.settings,d=s.addons,p=s.artboardWidth,h=s.artboardHeight,g=s.attachment,_=t.props.layers,f=_.currentIndex,v=_.items,m=null!==f&&v[f],y=!r.items[0].locked,x=m&&m.type===u.default.LAYER_TYPES.TEXT&&m.isEdit,w=t.props.ui.isDataLoaded&&t.props.data.context===u.default.CONTEXT_TYPES.STORY,C=t.props.marginTop,E=h;d&&d.photoHeight&&(E=d.photoHeight);var T=(0,Ge.classNames)("EditorCanvas",{"EditorCanvas--blurCursor":u.default.TABS.COLOR===l.currentMode&&c.blur.isEnabled});return(0,o.jsxs)(i.Fragment,{children:[(0,o.jsxs)("div",(0,n.__assign)({style:{width:p,height:E,marginTop:C},className:T},{children:[t.props.ui.isDataLoaded&&l.currentMode===u.default.TABS.CROP&&(0,o.jsx)(Rt,{artboardWidth:p,artboardHeight:E},void 0),(0,o.jsx)(Mt,{setLayerScale:t.props.setLayerScale,startLayerScale:t.props.startLayerScale,toggleTextEditor:t.props.toggleTextEditor,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r},void 0),x&&m?(0,o.jsx)(Bt,{layer:m,onChange:t.onChangeText,closeTextEditor:t.props.closeTextEditor},void 0):w&&(0,o.jsxs)(i.Fragment,{children:[!!g&&!l.isShowDropBox&&(0,o.jsx)(Ut.default,(0,n.__assign)({text:(0,yt.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},{children:(0,o.jsx)("span",(0,n.__assign)({className:"EditorCanvas__postIcon"},{children:(0,o.jsx)(zt,{},void 0)}),void 0)}),void 0),!l.isShowDropBox&&t.props.background.currentBackgroundType===u.default.BACKGROUND_MODES.PHOTO&&[u.default.TABS.STICKERS,u.default.TABS.TEXT].includes(t.props.ui.currentMode)&&(0,o.jsx)("button",(0,n.__assign)({className:"EditorCanvas__scaleButton",onClick:t.onClickScaleButton},{children:y?(0,o.jsx)(Wt,{},void 0):(0,o.jsx)(Zt,{},void 0)}),void 0),!l.isShowDropBox&&(0,o.jsx)(jt,{current:a.currentBackgroundType,setMode:t.props.setMode},void 0)]},void 0),l.isShowDropBox&&m&&m.canDelete&&(0,o.jsx)(Ht,{onDelete:t.props.deleteLayer},void 0),t.props.ui.isDataLoaded&&(0,o.jsx)(Ke,{width:p,height:E},void 0),t.props.ui.isDataLoaded&&(0,o.jsx)(mt,{width:p,height:E},void 0)]}),void 0),t.props.ui.isDataLoaded&&(0,o.jsx)(Tt,{currentBackgroundId:a.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:a.currentBackgroundType,uploadPhoto:t.props.uploadPhoto,backgrounds:t.props.data.backgrounds},void 0)]},void 0)},t.onClickScaleButton=function(){var e,r,n=t.props.layers.items[0],o={},i=t.props.data,a=i.artboardWidth,s=i.artboardHeight,l=n.height/n.width;l>1.77?e=(r=s)/l:(e=a,r=a*l);var c=a/2,d=s/2;n.locked?((0,we.sendStat)(we.EVENTS.ZOOM),Object.assign(o,{locked:!1,scale:.7})):((0,we.sendStat)(we.EVENTS.UNZOOM),Object.assign(o,{locked:!0,rotate:0,x:c,y:d,width:e,height:r,scale:1})),t.props.updateBackgroundLayer(o),t.props.setCurrentLayer(n.locked?0:null)},t.onChangeText=function(e){t.props.setLayerText(e)},t}return(0,n.__extends)(t,e),t}(i.Component),Gt={setCurrentBackgroundId:Be,setLayerScale:function(e,t){return function(r,n){var o=n().present.layers,i=o.currentIndex,a=o.items;null!==i&&a[i]&&r({type:Z,payload:{scale:e,rotate:t}})}},startLayerScale:function(){return{type:Y}},setLayerText:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:K,payload:{text:e}})}},toggleTextEditor:Pe,deleteLayer:Re,updateBackgroundLayer:Ie,setCurrentLayer:Te,setBackgroundType:De,closeTextEditor:Ae};const Vt=(0,a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data,marginTop:g(e)}}),Gt)(Yt);var Xt=r(99940),Kt=r(31897);const qt=(0,xt.makeIcon)("Icon24SmileOutline","smile_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="smile_outline_24"><path d="M8.438 14.297a.9.9 0 0 1 1.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 0 0 1.773-.488c.191-.12.382-.26.53-.432a.9.9 0 0 1 1.4 1.132 4.045 4.045 0 0 1-.976.826A5.094 5.094 0 0 1 12 17.15a5.094 5.094 0 0 1-2.727-.762 3.987 3.987 0 0 1-.976-.826.9.9 0 0 1 .14-1.265zm1.812-4.047a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0zM15 11.5A1.25 1.25 0 1 0 15 9a1.25 1.25 0 0 0 0 2.5z" fill="currentColor" /><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.1c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9zM3.9 12a8.1 8.1 0 1 1 16.2 0 8.1 8.1 0 0 1-16.2 0z" fill="currentColor" /></symbol>',24,24,!1,void 0),$t=(0,xt.makeIcon)("Icon24TextOutline","text_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="text_outline_24"><path fill-rule="evenodd" d="M3.038 18.111c.566 0 .881-.278 1.104-1.002l.872-2.616h4.583l.872 2.616c.213.715.547 1.002 1.113 1.002.603 0 1.002-.352 1.002-.909 0-.232-.056-.482-.158-.788L8.947 6.57c-.315-.937-.77-1.336-1.614-1.336-.844 0-1.299.409-1.624 1.336L2.23 16.414c-.12.352-.176.593-.176.816 0 .538.4.881.984.881Zm2.477-5.232 1.744-5.353h.102l1.735 5.353H5.515Zm14.25 3.85h.102v.436c.046.585.408.928.974.928.64 0 1.002-.408 1.002-1.113v-5.613c0-2.134-1.383-3.322-3.86-3.322-1.02 0-1.8.177-2.393.501-.826.446-1.216 1.002-1.216 1.568 0 .446.297.752.752.752.353 0 .594-.093.844-.334.566-.575 1.104-.854 1.883-.854 1.253 0 1.93.575 1.93 1.68v.871h-2.449c-2.19.01-3.507 1.114-3.507 2.923 0 1.781 1.29 2.987 3.2 2.987 1.216 0 2.2-.5 2.738-1.41Zm-3.869-1.68c0-.9.63-1.41 1.726-1.41h2.161v1.058c0 1.058-.918 1.874-2.115 1.874-1.058 0-1.772-.612-1.772-1.521Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0),Jt=(0,xt.makeIcon)("Icon24BrushOutline","brush_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="brush_outline_24"><path d="M20.377 3.467a1.857 1.857 0 0 0-2.558.09l-6.93 6.866a.911.911 0 0 0-.007 1.285.904.904 0 0 0 1.281.008l6.935-6.87c.044-.045.117-.018.07.04l-6.154 7.74a.911.911 0 0 0 .143 1.278.904.904 0 0 0 1.273-.143l6.15-7.735a1.85 1.85 0 0 0-.203-2.56Z" /><path fill-rule="evenodd" d="M8.488 12.624c-2.003 0-3.476 1.63-3.56 3.533-.043.938-.454 1.416-.83 1.732-.382.321-.894.553-1.052 1.065-.13.418.033.863.373 1.128.763.593 2.355 1.343 4.654.622 2.399-.752 3.977-2.509 3.977-4.506a3.568 3.568 0 0 0-3.562-3.574Zm-1.75 3.614c.046-1.037.82-1.796 1.75-1.796.967 0 1.75.786 1.75 1.756 0 .947-.789 2.17-2.705 2.77-.866.272-1.549.249-2.057.123.59-.56 1.198-1.442 1.261-2.853Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0),Qt=(0,xt.makeIcon)("Icon24Crop","crop_24","0 0 24 24",'<symbol fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="crop_24"><g fill="currentColor"><path d="M6 1.006a.9.9 0 0 1 .9.9V14.8c0 .575 0 .952.024 1.24.023.278.062.394.096.46a1.1 1.1 0 0 0 .48.48c.067.034.182.073.46.096.288.023.665.024 1.24.024h12.898a.9.9 0 0 1 0 1.8H18.9v3.198a.9.9 0 1 1-1.8 0V18.9H9.165c-.53 0-.981 0-1.352-.03-.389-.032-.768-.102-1.13-.286a2.9 2.9 0 0 1-1.267-1.267c-.184-.362-.254-.741-.286-1.13-.03-.37-.03-.822-.03-1.352V6.9H1.903a.9.9 0 0 1 0-1.8H5.1V1.906a.9.9 0 0 1 .9-.9z" /><path d="M16.04 6.924c-.288-.023-.665-.024-1.24-.024H9.907a.9.9 0 1 1 0-1.8h4.928c.53 0 .981 0 1.352.03.39.032.768.102 1.13.286a2.9 2.9 0 0 1 1.267 1.267c.184.362.254.74.286 1.13.03.37.03.822.03 1.352V14.1a.9.9 0 1 1-1.8 0V9.2c0-.575 0-.952-.024-1.24-.023-.278-.062-.394-.096-.46a1.1 1.1 0 0 0-.48-.48c-.067-.034-.182-.073-.46-.096z" /></g></symbol>',24,24,!1,void 0),er=(0,xt.makeIcon)("Icon24Filter","filter_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="filter_24"><path fill-rule="evenodd" d="M6.242 8.9a2.901 2.901 0 0 0 5.516 0H20a.9.9 0 1 0 0-1.8h-8.242a2.901 2.901 0 0 0-5.515 0H4a.9.9 0 1 0 0 1.8h2.242ZM9 6.9a1.1 1.1 0 1 0 0 2.2 1.1 1.1 0 0 0 0-2.2ZM3.1 16a.9.9 0 0 1 .9-.9h8.242a2.901 2.901 0 0 1 5.516 0H20a.9.9 0 1 1 0 1.8h-2.242a2.901 2.901 0 0 1-5.516 0H4a.9.9 0 0 1-.9-.9Zm10.8 0a1.1 1.1 0 1 1 2.2 0 1.1 1.1 0 0 1-2.2 0Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0),tr=(0,xt.makeIcon)("Icon24ImageFilterOutline","image_filter_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="image_filter_outline_24"><path d="M8.983 15.8a3.8 3.8 0 0 0 0-7.6A7.166 7.166 0 0 0 7.9 12c0 1.395.396 2.696 1.083 3.8Z" /><path fill-rule="evenodd" d="M8.9 4.6A7.4 7.4 0 1 0 12 18.721a7.4 7.4 0 1 0 0-13.443A7.372 7.372 0 0 0 8.9 4.6ZM3.3 12a5.6 5.6 0 1 1 11.2 0 5.6 5.6 0 0 1-11.2 0Zm10.586-5.468A7.38 7.38 0 0 1 16.3 12a7.38 7.38 0 0 1-2.414 5.468 5.6 5.6 0 1 0 0-10.936Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var rr=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.getHeaderItem=function(e){if(e){var i=e.props["data-disabled"],a=(0,Ce.classNames)("EditorTabs__item",{"EditorTabs__item--current":r.props.current===e.props["data-mode"],"EditorTabs__item--disabled":i}),s=(0,o.jsx)("div",(0,n.__assign)({className:a,onClick:function(){return r.onTabClick(e.props["data-mode"],i)}},{children:t.getIcon(e.props["data-mode"])}),e.props["data-mode"]);if(i){var l=(0,o.jsxs)("div",(0,n.__assign)({className:"EditorTabsTooltip"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"EditorTabsTooltip__text"},{children:(0,yt.getLang)("photos_pe_filters_disabled_text")}),void 0),(0,o.jsx)(Kt.default,(0,n.__assign)({onClick:function(){return r.props.setMode(u.default.BACKGROUND_MODES.PHOTO)},className:"EditorTabsTooltip__link"},{children:(0,yt.getLang)("photos_pe_filters_disabled_button")}),void 0)]}),void 0);return(0,o.jsx)(Xt.default,(0,n.__assign)({className:"EditorTabs__tooltip",text:l,appearance:"light",position:"b",maxWidth:203},{children:s}),void 0)}return s}},r.getTabContentItem=function(e){if(e){var t=(0,Ce.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":r.props.current===e.props["data-mode"]});return(0,i.cloneElement)(e,{className:t})}},r.onTabClick=function(e,t){t||r.props.change(e)},r}return(0,n.__extends)(t,e),t.prototype.render=function(){return(0,o.jsxs)("div",(0,n.__assign)({className:"EditorTabs"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"EditorTabs__header"},{children:i.Children.map(this.props.children,this.getHeaderItem)}),void 0),(0,o.jsx)("div",(0,n.__assign)({className:"EditorTabs__content"},{children:i.Children.map(this.props.children,this.getTabContentItem)}),void 0)]}),void 0)},t.getIcon=function(e){var t;switch(e){case u.default.TABS.STICKERS:t=(0,o.jsx)(qt,{},void 0);break;case u.default.TABS.TEXT:t=(0,o.jsx)($t,{},void 0);break;case u.default.TABS.PAINT:t=(0,o.jsx)(Jt,{},void 0);break;case u.default.TABS.CROP:t=(0,o.jsx)(Qt,{},void 0);break;case u.default.TABS.COLOR:t=(0,o.jsx)(er,{},void 0);break;case u.default.TABS.FILTERS:t=(0,o.jsx)(tr,{},void 0)}return t},t}(i.Component);const nr=(0,xt.makeIcon)("Icon24Done","done_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="done_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="m9 16.2-3.5-3.5a.99.99 0 1 0-1.4 1.4l4.193 4.193a1 1 0 0 0 1.414 0L20.3 7.7a.99.99 0 0 0-1.4-1.4L9 16.2Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var or=function(e){function t(t){var r=e.call(this,t)||this;return r.colors=r.getColors(t.avgColor),r}return(0,n.__extends)(t,e),t.prototype.shouldComponentUpdate=function(e){return JSON.stringify(e.avgColor)!==JSON.stringify(this.props.avgColor)&&(this.colors=this.getColors(e.avgColor)),!0},t.prototype.render=function(){var e=this;return(0,o.jsx)("div",(0,n.__assign)({className:"ColorPicker"},{children:this.colors.map((function(t,r){var i=t===e.props.color,a=(0,Ce.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":i});return(0,o.jsx)("div",(0,n.__assign)({className:a,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}},{children:i&&(0,o.jsx)(nr,{},void 0)}),r)}))}),void 0)},t.prototype.getColors=function(e){var t,r=function(e,t,r){var n=0,o=0,i=e/255,a=t/255,s=r/255,l=Math.max(i,a,s),c=l-Math.min(i,a,s),d=function(e){return(l-e)/6/c+.5},u=function(e){return Math.round(100*e)/100};if(0!==c){o=c/l;var p=d(i),h=d(a),g=d(s);i===l?n=g-h:a===l?n=1/3+p-g:s===l&&(n=2/3+h-p),n<0?n+=1:n>1&&(n-=1)}return{h:Math.round(360*n),s:u(100*o),v:u(100*l)}}(e.r,e.g,e.b),o=[];return u.default.AVERAGE_COLORS_MAP.forEach((function(e){var t=Math.round(Math.min(Math.max(r.s+e.s,0),100)),n=Math.round(Math.min(Math.max(r.v+e.v,0),100));o.push(function(e,t,r){t/=100,r/=100;var n=(1-Math.abs(2*r-1))*t,o=n*(1-Math.abs(e/60%2-1)),i=r-n/2,a=0,s=0,l=0;return 0<=e&&e<60?(a=n,s=o,l=0):60<=e&&e<120?(a=o,s=n,l=0):120<=e&&e<180?(a=0,s=n,l=o):180<=e&&e<240?(a=0,s=o,l=n):240<=e&&e<300?(a=o,s=0,l=n):300<=e&&e<360&&(a=n,s=0,l=o),a=Math.round(255*(a+i)).toString(16),s=Math.round(255*(s+i)).toString(16),l=Math.round(255*(l+i)).toString(16),1==a.length&&(a="0"+a),1==s.length&&(s="0"+s),1==l.length&&(l="0"+l),"#"+a+s+l}(r.h,t,n).toUpperCase())})),(t=(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(u.default.COLORS),!1),(0,n.__read)(o),!1),t.filter((function(e,t,r){return r.indexOf(e)==t}))).slice(0,30)},t}(i.Component),ir=r(84454),ar=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,i=e.setColor,a=e.setBrushWidth,s=e.setBrushOpacity,l=e.avgColor;return r.updateDrawingPreview(),(0,o.jsxs)("div",(0,n.__assign)({className:"DrawPanel"},{children:[(0,o.jsx)("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:u.default.DRAWING_PREVIEW_WIDTH*u.default.CANVAS_SCALE,height:u.default.DRAWING_PREVIEW_HEIGHT*u.default.CANVAS_SCALE,style:{width:u.default.DRAWING_PREVIEW_WIDTH,height:u.default.DRAWING_PREVIEW_HEIGHT}},void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"DrawPanel__sliders"},{children:[(0,o.jsxs)("div",(0,n.__assign)({className:"DrawPanel__slider"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"DrawPanel__title"},{children:(0,yt.getLang)("photos_pe_intensity")}),void 0),(0,o.jsx)(ir.default,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return s(e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"DrawPanel__slider"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"DrawPanel__title"},{children:(0,yt.getLang)("photos_pe_line_width")}),void 0),(0,o.jsx)(ir.default,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushWidth,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return a(e)}},void 0)]}),void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"DrawPanel__colors"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"DrawPanel__title DrawPanel__title--largeOffset"},{children:(0,yt.getLang)("photos_pe_color")}),void 0),(0,o.jsx)(or,{color:t.color,avgColor:l,setColor:i},void 0)]}),void 0)]}),void 0)},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,i=o.width,a=o.height;n.clearRect(0,0,i,a);var s=u.default.CANVAS_SCALE,l=new Path2D("M"+69*s+" "+65*s+"L"+93*s+" "+41*s+"L"+121*s+" "+69*s+"L"+149*s+" "+41*s+"L"+177*s+" "+69*s+"L"+201*s+" "+45*s),c="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*u.default.BRUSH_WIDTH_COEFFICIENT*s,n.strokeStyle=We(c,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke(l)}}},r.previewCanvas=(0,i.createRef)(),r}return(0,n.__extends)(t,e),t}(i.Component),sr={setColor:Ne,setBrushWidth:function(e){return{type:C,brushWidth:Math.max(.1,e)}},setBrushOpacity:function(e){return{type:E,brushOpacity:e}}};const lr=(0,a.connect)((function(e){return{settings:e.present.settings,drawings:e.present.drawings,avgColor:e.present.layers.items[0].avgColor}}),sr)(ar),cr=(0,xt.makeIcon)("Icon20RotateRight","rotate_right_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="rotate_right_20"><path fill-rule="evenodd" d="M13.2 9.5h-2.4c-.865 0-1.423.001-1.848.036-.408.033-.559.09-.633.127a1.5 1.5 0 0 0-.656.656c-.037.074-.094.225-.127.633-.035.425-.036.983-.036 1.848v.4c0 .865.001 1.423.036 1.848.033.408.09.559.127.633a1.5 1.5 0 0 0 .656.656c.074.037.225.094.633.127.425.035.983.036 1.848.036h2.4c.865 0 1.423-.001 1.848-.036.408-.033.559-.09.633-.127a1.5 1.5 0 0 0 .656-.656c.037-.074.094-.225.127-.633.035-.425.036-.983.036-1.848v-.4c0-.865-.001-1.423-.036-1.848-.033-.408-.09-.559-.127-.633a1.5 1.5 0 0 0-.656-.656c-.074-.037-.225-.094-.633-.127-.425-.035-.983-.036-1.848-.036Zm-6.873.138C6 10.28 6 11.12 6 12.8v.4c0 1.68 0 2.52.327 3.162a3 3 0 0 0 1.311 1.311C8.28 18 9.12 18 10.8 18h2.4c1.68 0 2.52 0 3.162-.327a3 3 0 0 0 1.311-1.311C18 15.72 18 14.88 18 13.2v-.4c0-1.68 0-2.52-.327-3.162a3 3 0 0 0-1.311-1.311C15.72 8 14.88 8 13.2 8h-2.4c-1.68 0-2.52 0-3.162.327a3 3 0 0 0-1.311 1.311ZM6.47 1.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.75.75 0 0 1-1.06-1.06l.72-.72H7A3.25 3.25 0 0 0 3.75 8.5V11a.75.75 0 0 1-1.5 0V8.5A4.75 4.75 0 0 1 7 3.75h.19l-.72-.72a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),dr=(0,xt.makeIcon)("Icon20RotateLeft","rotate_left_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="rotate_left_20"><path fill-rule="evenodd" d="M9.2 9.5H6.8c-.865 0-1.423.001-1.848.036-.408.033-.559.09-.633.127a1.5 1.5 0 0 0-.656.656c-.037.074-.094.225-.127.633-.035.425-.036.983-.036 1.848v.4c0 .865.001 1.423.036 1.848.033.408.09.559.127.633a1.5 1.5 0 0 0 .656.656c.074.037.225.094.633.127.425.035.983.036 1.848.036h2.4c.865 0 1.423-.001 1.848-.036.408-.033.559-.09.633-.127a1.5 1.5 0 0 0 .655-.656c.038-.074.095-.225.128-.633.035-.425.036-.983.036-1.848v-.4c0-.865-.001-1.423-.036-1.848-.033-.408-.09-.559-.128-.633a1.5 1.5 0 0 0-.655-.656c-.074-.037-.225-.094-.633-.127C10.623 9.5 10.065 9.5 9.2 9.5Zm-6.873.138C2 10.28 2 11.12 2 12.8v.4c0 1.68 0 2.52.327 3.162a3 3 0 0 0 1.311 1.311C4.28 18 5.12 18 6.8 18h2.4c1.68 0 2.52 0 3.162-.327a3 3 0 0 0 1.311-1.311C14 15.72 14 14.88 14 13.2v-.4c0-1.68 0-2.52-.327-3.162a3 3 0 0 0-1.311-1.311C11.72 8 10.88 8 9.2 8H6.8c-1.68 0-2.52 0-3.162.327a3 3 0 0 0-1.311 1.311ZM13.53 1.97a.75.75 0 0 1 0 1.06l-.72.72H13a4.75 4.75 0 0 1 4.75 4.75V11a.75.75 0 0 1-1.5 0V8.5A3.25 3.25 0 0 0 13 5.25h-.19l.72.72a.75.75 0 0 1-1.06 1.06l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),ur=(0,xt.makeIcon)("Icon20FlipHorizontal","flip_horizontal_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="flip_horizontal_20"><path fill-rule="evenodd" d="M8.465 7.531A.75.75 0 0 1 9 8.25v8a.75.75 0 0 1-.75.75H3a.75.75 0 0 1-.627-1.162l5.25-8a.75.75 0 0 1 .842-.307ZM4.389 15.5H7.5v-4.74L4.39 15.5ZM6.53 1.47a.75.75 0 0 1 0 1.06l-.72.72h8.38l-.72-.72a.75.75 0 0 1 1.06-1.06l2 2a.75.75 0 0 1 0 1.06l-2 2a.75.75 0 1 1-1.06-1.06l.72-.72H5.81l.72.72a.75.75 0 0 1-1.06 1.06l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.06 0Zm5.005 6.061a.75.75 0 0 1 .842.308l5.25 8A.75.75 0 0 1 17 17h-5.25a.75.75 0 0 1-.75-.75v-8a.75.75 0 0 1 .535-.719Zm.965 3.229v4.74h3.11l-3.11-4.74Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),pr=(0,xt.makeIcon)("Icon20FlipVertical","flip_vertical_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="flip_vertical_20"><path fill-rule="evenodd" d="M3.394 2.34a.75.75 0 0 1 .767.033l8 5.25A.75.75 0 0 1 11.75 9h-8A.75.75 0 0 1 3 8.25V3a.75.75 0 0 1 .394-.66ZM4.5 4.39V7.5h4.74L4.5 4.39ZM3 11.75a.75.75 0 0 1 .75-.75h8a.75.75 0 0 1 .412 1.377l-8 5.25A.75.75 0 0 1 3 17v-5.25Zm1.5.75v3.11l4.74-3.11H4.5Zm10.97-9.03a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1-1.06 1.06l-.72-.72v8.38l.72-.72a.75.75 0 1 1 1.06 1.06l-2 2a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l.72.72V5.81l-.72.72a.75.75 0 1 1-1.06-1.06l2-2Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var hr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flip=function(e,r){var n=document.createElement("canvas"),o=null==n?void 0:n.getContext("2d"),i=t.props.currentBackgroundUrl;o&&qe.get(i).then((function(i){n.width=i.width,n.height=i.height,e?(o.translate(n.width,0),o.scale(-1,1)):r&&(o.translate(0,n.height),o.scale(1,-1)),o.drawImage(i,0,0),n.toBlob((function(n){var o={url:URL.createObjectURL(n)};e&&(o.flipX=!t.props.flipX),r&&(o.flipY=!t.props.flipY),t.props.setCrop(o)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t.rotate=function(e){var r=document.createElement("canvas"),o=null==r?void 0:r.getContext("2d"),i=t.props,a=i.currentBackgroundUrl,s=i.originalWidth,l=i.originalHeight;o&&qe.get(a).then((function(i){r.width=i.height,r.height=i.width;var a=e?-90:90;o.translate(r.width/2,r.height/2),o.rotate(a*Math.PI/180),o.drawImage(i,-i.width/2,-i.height/2),r.toBlob((function(e){var o=r.height/r.width,i=t.props.rotate+a;t.props.rotate>i?(0,we.sendStat)(we.EVENTS.TURN_LEFT):(0,we.sendStat)(we.EVENTS.TURN_RIGHT);var c,d,p=document.getElementById("pv_photo").getBoundingClientRect(),h=p.width,g=p.height;g-=u.default.BOTTOM_PANEL_HEIGHT,o>=.67?(c=g/o,d=g):(c=h,d=h*o),t.props.setCrop({url:URL.createObjectURL(e),data:{artboardWidth:c,originalWidth:l,originalHeight:s,addons:(0,n.__assign)((0,n.__assign)({},t.props.addons),{photoHeight:d})},rotate:i>270?0:i})}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this;return(0,o.jsxs)("div",(0,n.__assign)({className:"CropPanel"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"CropPanel__title"},{children:(0,yt.getLang)("photos_pe_crop_aspect_title")}),void 0),(0,o.jsx)("ul",(0,n.__assign)({className:"CropPanelRatioTabs"},{children:u.default.CROP_ASPECTS.map((function(t){var r=(0,Ge.classNames)("CropPanelRatioTabs__button",{"CropPanelRatioTabs__button--active":e.props.cropAspect===t.value});return(0,o.jsx)("li",(0,n.__assign)({className:"CropPanelRatioTabs__item"},{children:(0,o.jsx)("button",(0,n.__assign)({className:r,onClick:function(){return e.props.setAspect(t.value)}},{children:(0,yt.getLang)(t.title)}),void 0)}),t.title)}))}),void 0),(0,o.jsxs)("ul",(0,n.__assign)({className:"CropPanelSettings"},{children:[(0,o.jsx)("li",(0,n.__assign)({className:"CropPanelSettings__item"},{children:(0,o.jsxs)(Kt.default,(0,n.__assign)({className:"CropPanelSettings__link",onClick:function(){return e.rotate(!1)}},{children:[(0,o.jsx)(cr,{className:"CropPanelSettings__icon"},void 0),(0,yt.getLang)("photos_pe_rotate_right")]}),void 0)}),void 0),(0,o.jsx)("li",(0,n.__assign)({className:"CropPanelSettings__item"},{children:(0,o.jsxs)(Kt.default,(0,n.__assign)({className:"CropPanelSettings__link",onClick:function(){return e.rotate(!0)}},{children:[(0,o.jsx)(dr,{className:"CropPanelSettings__icon"},void 0),(0,yt.getLang)("photos_pe_rotate_left")]}),void 0)}),void 0),(0,o.jsx)("li",(0,n.__assign)({className:"CropPanelSettings__item"},{children:(0,o.jsxs)(Kt.default,(0,n.__assign)({className:"CropPanelSettings__link",onClick:function(){return e.flip(!0,!1)}},{children:[(0,o.jsx)(ur,{className:"CropPanelSettings__icon"},void 0),(0,yt.getLang)("photos_pe_flip_horizontal")]}),void 0)}),void 0),(0,o.jsx)("li",(0,n.__assign)({className:"CropPanelSettings__item"},{children:(0,o.jsxs)(Kt.default,(0,n.__assign)({className:"CropPanelSettings__link",onClick:function(){return e.flip(!1,!0)}},{children:[(0,o.jsx)(pr,{className:"CropPanelSettings__icon"},void 0),(0,yt.getLang)("photos_pe_flip_vertical")]}),void 0)}),void 0)]}),void 0)]}),void 0)},t}(i.Component),gr={setCrop:je,setAspect:Oe},_r=(0,a.connect)((function(e){return{flipX:e.present.settings.flipX,flipY:e.present.settings.flipY,rotate:e.present.settings.rotation,cropAspect:e.present.settings.cropAspect,currentBackgroundUrl:h(e),addons:e.present.data.addons,artboardWidth:e.present.data.artboardWidth,artboardHeight:e.present.data.artboardHeight,originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight}}),gr)(hr),fr=r(71982);const vr=(0,xt.makeIcon)("Icon12Add","add_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="add_12"><path d="M6.75 1.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z" /></symbol>',12,12,!1,void 0);var mr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,i=e.setColor,a=e.setFontSize,s=e.layer,l=e.fontsPlaceholders,c=e.avgColor,d=s&&s.isEdit,p=s&&s.fontStyle,h=s&&s.fontSize,g=s&&s.color;return(0,o.jsxs)("div",(0,n.__assign)({className:"TextPanel"},{children:[d?(0,o.jsx)(St.default,(0,n.__assign)({className:"TextPanelButton",onClick:t.props.closeTextEditor},{children:(0,yt.getLang)("photos_pe_save_text")}),void 0):(0,o.jsxs)(St.default,(0,n.__assign)({className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},{children:[(0,o.jsx)(vr,{className:"TextPanelButton__icon"},void 0),(0,yt.getLang)("photos_pe_add_text")]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"TextPanelButton__fonts"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"TextPanelButton__title"},{children:(0,yt.getLang)("photos_pe_font")}),void 0),u.default.FONTS.map((function(e,i){return(0,o.jsx)(fr.default,(0,n.__assign)({value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:p?p===e:r.fontStyle===e},{children:(0,o.jsx)("span",(0,n.__assign)({className:"TextPanelButton__font TextPanelButton__font--"+e+" PhotoEditorFontStyle--"+e},{children:l[i]}),void 0)}),e)}))]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"TextPanelButton__fontSize"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"TextPanelButton__title"},{children:(0,yt.getLang)("photos_pe_font_size")}),void 0),(0,o.jsx)(ir.default,{min:0,max:1,isShowHandle:!0,value:h||r.fontSize,formatHint:function(e){return""+Math.round(100*e)},onChange:function(e){return a(e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"TextPanelButton__colors"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"TextPanelButton__title"},{children:(0,yt.getLang)("photos_pe_color")}),void 0),(0,o.jsx)(or,{color:g||r.color,avgColor:c,setColor:i},void 0)]}),void 0)]}),void 0)},t}return(0,n.__extends)(t,e),t}(i.Component),yr={addLayerText:be,setColor:Ne,setFontSize:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:V,payload:{fontSize:e}})}}(e)),t({type:T,fontSize:e})}},setFontStyle:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;o&&!i[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,i=n.items;null!==o&&i[o]&&t({type:X,payload:{fontStyle:e}})}}(e)),t({type:S,fontStyle:e})}},closeTextEditor:Ae};const xr=(0,a.connect)((function(e){var t=e.present.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{settings:e.present.settings,layer:o,fontsPlaceholders:e.present.data.fontsPlaceholders,avgColor:e.present.layers.items[0].avgColor}}),yr)(mr);var wr=r(56589),Cr=r(13984);const Er=(0,xt.makeIcon)("Icon20Stars","stars_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="stars_20"><path fill-rule="evenodd" d="M12.004 8.13c-.368.835-.857 1.717-1.507 2.367-.65.65-1.532 1.14-2.367 1.507.835.367 1.717.857 2.367 1.507.65.65 1.14 1.532 1.507 2.367.367-.835.857-1.717 1.507-2.367.65-.65 1.532-1.14 2.367-1.507-.835-.368-1.717-.857-2.367-1.507-.65-.65-1.14-1.532-1.507-2.367Zm-.785-2.178c-.421 1.317-1.014 2.716-1.782 3.485-.769.768-2.168 1.36-3.485 1.782a21.073 21.073 0 0 1-1.162.338c-.38.1-.38.793 0 .894a27.146 27.146 0 0 1 .912.26c.083.025.166.05.25.078 1.317.421 2.716 1.014 3.485 1.782.768.768 1.36 2.168 1.782 3.485a20.843 20.843 0 0 1 .27.907l.068.255c.1.38.793.38.894 0a27.487 27.487 0 0 1 .26-.912c.025-.083.05-.166.078-.25.421-1.317 1.014-2.717 1.782-3.485.768-.768 2.168-1.36 3.485-1.782a20.843 20.843 0 0 1 .907-.27l.255-.068c.38-.1.38-.793 0-.894a27.487 27.487 0 0 1-.912-.26 20.843 20.843 0 0 1-.25-.078c-1.317-.421-2.717-1.014-3.485-1.782-.768-.769-1.36-2.168-1.782-3.485a21.13 21.13 0 0 1-.338-1.162c-.1-.38-.793-.38-.894 0a27.146 27.146 0 0 1-.26.912 21.13 21.13 0 0 1-.078.25ZM4.365.763a.385.385 0 0 0-.73 0l-.414 1.24a1.926 1.926 0 0 1-1.218 1.218l-1.24.414a.385.385 0 0 0 0 .73l1.24.414a1.926 1.926 0 0 1 1.218 1.218l.414 1.24a.385.385 0 0 0 .73 0l.414-1.24a1.926 1.926 0 0 1 1.218-1.218l1.24-.414a.385.385 0 0 0 0-.73l-1.24-.414a1.926 1.926 0 0 1-1.218-1.218L4.365.763Z" /></symbol>',20,20,!1,void 0),Tr=(0,xt.makeIcon)("Icon20WaterDropOutline","water_drop_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="water_drop_outline_20"><path fill-rule="evenodd" d="M5.4 8.683c-.419.85-.65 1.647-.65 2.317a5.25 5.25 0 1 0 10.5 0c0-.67-.231-1.467-.65-2.317-.414-.842-.988-1.69-1.615-2.447-.628-.759-1.292-1.408-1.874-1.86a4.888 4.888 0 0 0-.76-.499 1.644 1.644 0 0 0-.255-.106A.419.419 0 0 0 10 3.75a.42.42 0 0 0-.096.02c-.065.02-.15.054-.254.107a4.854 4.854 0 0 0-.76.5c-.583.451-1.247 1.1-1.875 1.859-.627.757-1.201 1.605-1.615 2.447Zm3.573-6.145c.308-.155.667-.288 1.027-.288.36 0 .72.133 1.027.288.322.163.662.389 1.003.654.684.53 1.425 1.26 2.11 2.087.686.828 1.33 1.774 1.806 2.742.473.96.804 1.992.804 2.979a6.75 6.75 0 0 1-13.5 0c0-.987.331-2.018.804-2.979.476-.969 1.12-1.914 1.806-2.742.685-.827 1.426-1.557 2.11-2.087a6.44 6.44 0 0 1 1.003-.654Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var Sr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.settings,r=e.setColorCorrection;return(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel"},{children:[(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__items"},{children:[(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__item"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanel__name"},{children:(0,yt.getLang)("photos_pe_correction_exposure")}),void 0),(0,o.jsx)(ir.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.exposure,onChange:function(e){return r("exposure",e)},formatHint:function(e){return Math.round(100*e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__item"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanel__name"},{children:(0,yt.getLang)("photos_pe_correction_contrast")}),void 0),(0,o.jsx)(ir.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.contrast,onChange:function(e){return r("contrast",e)},formatHint:function(e){return Math.round(100*e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__item"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanel__name"},{children:(0,yt.getLang)("photos_pe_correction_saturation")}),void 0),(0,o.jsx)(ir.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.saturation,onChange:function(e){return r("saturation",e)},formatHint:function(e){return Math.round(100*e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__item"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanel__name"},{children:(0,yt.getLang)("photos_pe_correction_warmth")}),void 0),(0,o.jsx)(ir.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.warmth,onChange:function(e){return r("warmth",e)},formatHint:function(e){return Math.round(100*e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__item"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanel__name"},{children:(0,yt.getLang)("photos_pe_correction_vignette")}),void 0),(0,o.jsx)(ir.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.vignette,onChange:function(e){return r("vignette",e)},formatHint:function(e){return Math.round(100*e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__item"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanel__name"},{children:(0,yt.getLang)("photos_pe_correction_sharpness")}),void 0),(0,o.jsx)(ir.default,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.sharpness,onChange:function(e){return r("sharpness",e)},formatHint:function(e){return Math.round(100*e)}},void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanel__item"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanel__name"},{children:(0,yt.getLang)("photos_pe_correction_grain")}),void 0),(0,o.jsx)(ir.default,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.grain,onChange:function(e){return r("grain",e)},formatHint:function(e){return Math.round(100*e)}},void 0)]}),void 0)]}),void 0),(0,o.jsx)("div",(0,n.__assign)({className:"ColorPanel__linkBox"},{children:this.renderAutoCorrectionPanel()}),void 0),(0,o.jsx)("div",(0,n.__assign)({className:"ColorPanel__linkBox"},{children:this.renderBlurPanel()}),void 0)]}),void 0)},t.prototype.renderAutoCorrectionPanel=function(){var e=this.props,t=e.settings,r=e.setAutoCorrection;return t.isAutoCorrection?(0,o.jsx)("div",(0,n.__assign)({className:"ColorPanelEnabledBox"},{children:(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanelEnabledBox__header"},{children:[(0,o.jsx)(Cr.default,(0,n.__assign)({className:""},{children:(0,yt.getLang)("photos_pe_correction_auto_enabled")}),void 0),(0,o.jsx)("span",{className:"dvd"},void 0),(0,o.jsx)(Kt.default,(0,n.__assign)({className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},{children:(0,yt.getLang)("photos_pe_cancel")}),void 0)]}),void 0)}),void 0):(0,o.jsxs)(Kt.default,(0,n.__assign)({className:"ColorPanel__link",onClick:function(){return r(!0)}},{children:[(0,o.jsx)(Er,{className:"ColorPanel__icon"},void 0),(0,yt.getLang)("photos_pe_correction_auto")]}),void 0)},t.prototype.renderBlurPanel=function(){var e=this.props,t=e.settings,r=e.setBlurEnable,i=e.setBlurForm,a=e.setBlurSize,s=t.blur,l=[{label:(0,yt.getLang)("photos_pe_correction_blur_type_round"),value:u.default.BLUR_TYPES.ROUND},{label:(0,yt.getLang)("photos_pe_correction_blur_type_rec"),value:u.default.BLUR_TYPES.RECTANGULAR}];return s.isEnabled?(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanelEnabledBox"},{children:[(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanelEnabledBox__header"},{children:[(0,o.jsx)(Cr.default,(0,n.__assign)({className:""},{children:(0,yt.getLang)("photos_pe_correction_blur_enabled")}),void 0),(0,o.jsx)("span",{className:"dvd"},void 0),(0,o.jsx)(Kt.default,(0,n.__assign)({className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},{children:(0,yt.getLang)("photos_pe_cancel")}),void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"ColorPanelEnabledBox__select"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"ColorPanelEnabledBox__type"},{children:(0,yt.getLang)("photos_pe_correction_blur_type")}),void 0),(0,o.jsx)(wr.default,{appearance:"fancy",value:s.form,options:l,onChange:function(e){return i(String(e.selected.value))}},void 0)]}),void 0),(0,o.jsx)(ir.default,{min:0,max:100,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.blur.size,onChange:function(e){return a(e)},formatHint:function(e){return Math.round(e)}},void 0)]}),void 0):(0,o.jsxs)(Kt.default,(0,n.__assign)({className:"ColorPanel__link",onClick:function(){return r(!0)}},{children:[(0,o.jsx)(Tr,{className:"ColorPanel__icon"},void 0),(0,yt.getLang)("photos_pe_correction_blur")]}),void 0)},t}(i.Component),br={setColorCorrection:function(e,t){return{type:b,filter:e,value:t}},setBlurEnable:function(e){return e?(0,we.sendStat)(we.EVENTS.ENABLE_BLUR):(0,we.sendStat)(we.EVENTS.DISABLE_BLUR),{type:R,isEnabled:e}},setBlurForm:function(e){return{type:A,form:e}},setBlurSize:function(e){return{type:L,size:e}},setAutoCorrection:function(e){return e?(0,we.sendStat)(we.EVENTS.ENABLE_AUTOCORRECTION):(0,we.sendStat)(we.EVENTS.DISABLE_AUTOCORRECTION),{type:N,isAutoCorrection:e}}};const Pr=(0,a.connect)((function(e){return{settings:e.present.settings}}),br)(Sr),Ir=(0,xt.makeIcon)("Icon16Done","done_16","0 0 16 16",'<symbol viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="done_16"><path d="M13.743 3.756a.872.872 0 0 1 0 1.237l-7.317 7.25a.88.88 0 0 1-1.242 0L2.257 9.366a.872.872 0 0 1 0-1.237.88.88 0 0 1 1.242 0l2.306 2.261L12.5 3.756a.88.88 0 0 1 1.242 0Z" fill="currentColor" /></symbol>',16,16,!1,void 0);var Rr=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props,n=t.currentBackgroundUrl,o=t.currentFilterName,i=n!==e.currentBackgroundUrl;return o!==e.currentFilterName||(i&&r.update(e.currentBackgroundUrl),!1)},r.handleClick=function(){r.props.setFilter(r.props.filter)},r.canvas=(0,i.createRef)(),r.renderer=new gt,r}return(0,n.__extends)(t,e),t.prototype.componentDidMount=function(){this.update(this.props.currentBackgroundUrl)},t.prototype.render=function(){var e=this.props.currentFilterName===this.props.filter,t=(0,Ge.classNames)("FiltersItem",{"FiltersItem--active":e}),r=e?(0,o.jsx)("div",(0,n.__assign)({className:"FiltersItem__checked"},{children:(0,o.jsx)(Ir,{},void 0)}),void 0):null;return(0,o.jsx)("div",(0,n.__assign)({className:t,onClick:this.handleClick},{children:(0,o.jsxs)("div",(0,n.__assign)({className:"FiltersItem__inner",style:{width:u.default.FILTER_PREVIEW_WIDTH}},{children:[(0,o.jsx)("canvas",{className:"FiltersItem__image",ref:this.canvas,width:u.default.FILTER_PREVIEW_WIDTH*u.default.CANVAS_SCALE,height:u.default.FILTER_PREVIEW_HEIGHT*u.default.CANVAS_SCALE,style:{width:u.default.FILTER_PREVIEW_WIDTH,height:u.default.FILTER_PREVIEW_HEIGHT}},void 0),(0,o.jsx)("span",(0,n.__assign)({className:"FiltersItem__name"},{children:(0,yt.getLang)("photos_pe_filter_"+this.props.filter)}),void 0),r]}),void 0)}),void 0)},t.prototype.update=function(e){var t=this;e&&qe.get(e).then((function(e){t.renderImage(e)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this;this.renderer.render(u.default.FILTER_PREVIEW_WIDTH*u.default.CANVAS_SCALE,u.default.FILTER_PREVIEW_HEIGHT*u.default.CANVAS_SCALE,e,this.props.filter,{amount:.75,sourceSize:[e.width,e.height]}).then((function(r){if(r){var n=t.canvas.current;if(n){var o=n.getContext("2d");if(o){var i,a,s=+(e.height/e.width).toFixed(2);s>1.77?(i=n.height/s,a=n.height):(i=n.width,a=n.width*s);var l=n.width/2-i/2,c=n.height/2-a/2;Ye(n,r,t.props.avgColor),o.drawImage(r,l,c,i,a)}}}})).catch((function(e){console.error(new Error(e))}))},t}(i.Component),Ar={setFilter:function(e){return"regular"===e?(0,we.sendStat)(we.EVENTS.REMOVE_FILTER):(0,we.sendStat)(we.EVENTS.ADD_FILTER),{type:P,name:e}}};const Lr=(0,a.connect)((function(e){return{currentFilterName:e.present.settings.filter.name,currentBackgroundUrl:h(e)}}),Ar)(Rr);var kr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this;return(0,o.jsxs)("div",(0,n.__assign)({className:"FiltersPanel"},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"FiltersPanel__header"},{children:this.renderHeader()}),void 0),(0,o.jsx)("div",(0,n.__assign)({className:"FiltersPanel__inner"},{children:u.default.PHOTO_FILTERS.map((function(t){return(0,o.jsx)(Lr,{avgColor:e.props.avgColor,filter:t},t)}))}),void 0)]}),void 0)},t.prototype.renderHeader=function(){var e=this.props.settings;return"regular"===e.filter.name?(0,o.jsx)("span",{children:(0,yt.getLang)("photos_pe_filter_disabled")},void 0):(0,o.jsxs)("div",(0,n.__assign)({className:"FiltersPanel__slider"},{children:[(0,o.jsx)("span",(0,n.__assign)({className:"FiltersPanel__title"},{children:(0,yt.getLang)("photos_pe_filter_enabled")}),void 0),(0,o.jsx)(ir.default,{min:0,max:1,value:e.filter.value,isShowHandle:!0,onChange:this.props.setFilterAmount,formatHint:function(e){return Math.round(100*e)+"%"}},void 0)]}),void 0)},t}(i.Component),Nr={setFilterAmount:function(e){return{type:I,value:e}}};const Or=(0,a.connect)((function(e){return{settings:e.present.settings,avgColor:e.present.layers.items[0].avgColor}}),Nr)(kr);var Dr=r(23985);const Mr=(0,xt.makeIcon)("Icon24StorefrontOutline","storefront_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="storefront_outline_24"><path fill-rule="evenodd" d="M7 14a.9.9 0 0 1 .9.9v4.2h8.2v-4.2a.9.9 0 0 1 1.8 0V20a.9.9 0 0 1-.9.9H7a.9.9 0 0 1-.9-.9v-5.1A.9.9 0 0 1 7 14Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M3 20a.9.9 0 0 1 .9-.9h16.2a.9.9 0 1 1 0 1.8H3.9A.9.9 0 0 1 3 20Zm13.9-10a1.1 1.1 0 0 0 2.2 0h1.8a2.9 2.9 0 0 1-5.8 0h1.8Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M16 9.1a.9.9 0 0 1 .9.9 1.1 1.1 0 0 0 2.2 0 .9.9 0 1 1 1.8 0 2.9 2.9 0 0 1-5.8 0 .9.9 0 0 1 .9-.9Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M12 9.1a.9.9 0 0 1 .9.9 1.1 1.1 0 0 0 2.2 0 .9.9 0 1 1 1.8 0 2.9 2.9 0 0 1-5.8 0 .9.9 0 0 1 .9-.9Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M8 9.1a.9.9 0 0 1 .9.9 1.1 1.1 0 0 0 2.2 0 .9.9 0 1 1 1.8 0 2.9 2.9 0 0 1-5.8 0 .9.9 0 0 1 .9-.9Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M4 9.1a.9.9 0 0 1 .9.9 1.1 1.1 0 0 0 2.2 0 .9.9 0 0 1 1.8 0 2.9 2.9 0 0 1-5.8 0 .9.9 0 0 1 .9-.9Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M8.703 3.1h6.594c.553 0 1.019-.001 1.453.137a2.9 2.9 0 0 1 1.033.585c.342.301.581.7.865 1.175l.056.094 1.612 2.686.027.045c.143.239.264.44.352.66.077.195.133.397.167.604.038.234.038.47.038.747V10h-1.8v-.114c0-.358-.003-.438-.014-.51a1.1 1.1 0 0 0-.064-.228c-.027-.068-.066-.138-.25-.445L17.16 6.017c-.37-.618-.462-.752-.566-.843a1.1 1.1 0 0 0-.392-.222c-.131-.042-.294-.052-1.014-.052H8.812c-.72 0-.883.01-1.014.052a1.1 1.1 0 0 0-.392.222c-.104.091-.196.225-.566.843L5.228 8.703c-.185.307-.223.377-.25.445a1.1 1.1 0 0 0-.064.228c-.011.072-.014.152-.014.51V10H3.1v-.167c0-.278 0-.513.038-.747a2.9 2.9 0 0 1 .167-.603c.088-.22.209-.422.352-.66l.027-.046L5.296 5.09l.056-.094c.284-.474.523-.874.865-1.175a2.9 2.9 0 0 1 1.033-.585c.434-.138.9-.138 1.453-.137Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0),Br=(0,xt.makeIcon)("Icon24RecentOutline","recent_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="recent_outline_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M12 21.428A9.428 9.428 0 0 1 2.571 12 9.428 9.428 0 0 1 12 2.57c5.206 0 9.429 4.221 9.429 9.429 0 5.207-4.223 9.428-9.429 9.428Zm0-1.8a7.63 7.63 0 1 0-.001-15.258A7.63 7.63 0 0 0 12 19.628Zm4.085-6.387a.9.9 0 1 1-.575 1.706l-4.226-1.427a.9.9 0 0 1-.613-.853V8.353a.9.9 0 1 1 1.8 0v3.668l3.614 1.22Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',24,24,!1,void 0);var Fr=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.fetchStickers()},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e="vkcom_dark"===document.body.getAttribute("scheme"),t=r.props,i=t.stickers,a=t.stickerMouseDown,s=r.props.ui,l=s.stickerHeaderScrollPosition,c=s.currentStickerPackIndex,d=r.scrollElement.current,p=!!l,h=!1,g=0;d&&(g=l+d.offsetWidth,h=!!(d.scrollWidth-g));var _=i[c]?i[c].items:[];r.needReset&&(r.needReset=!1,_=[],r.setState({}));for(var f=[],v=0,m=_.length;v<m;v+=3)f.push(_.slice(v,v+3));return(0,o.jsxs)("div",(0,n.__assign)({className:"StickerPacksPanel"},{children:[(0,o.jsxs)("div",(0,n.__assign)({className:"StickerPacksPanel__header"},{children:[(0,o.jsxs)("div",(0,n.__assign)({className:"StickerPacksPanel__scroll",style:{transform:"translateX(-"+l+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"StickerPacksPanel__tab",onClick:function(){return r.showStickerShop()}},{children:(0,o.jsx)(Mr,{},void 0)}),void 0),i.map((function(e,t){var i=e.id,a=r.getTabPreviewUrl(t);if(!a)return null;var s=!(0,it.inArray)(i,["recent","editor"]),l=(0,Ge.classNames)("StickerPacksPanel__tab",{"StickerPacksPanel__tab--selected":t===c}),d=s?null:"recent"===i?(0,o.jsx)(Br,{},void 0):(0,o.jsx)(qt,{},void 0);return(0,o.jsx)("div",(0,n.__assign)({className:l,style:s?{backgroundImage:"url('"+a+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}},{children:d}),i)}))]}),void 0),p&&(0,o.jsx)("div",(0,n.__assign)({className:"StickerPacksPanel__arrow StickerPacksPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},{children:(0,o.jsx)(wt,{className:"StickerPacksPanel__arrowIcon"},void 0)}),void 0),h&&(0,o.jsx)("div",(0,n.__assign)({className:"StickerPacksPanel__arrow StickerPacksPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},{children:(0,o.jsx)(wt,{className:"StickerPacksPanel__arrowIcon"},void 0)}),void 0)]}),void 0),(0,o.jsx)(Dr.default,(0,n.__assign)({virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickerPacksPanel__content",itemHeight:98},{children:f.map((function(t,r){return(0,o.jsx)("div",(0,n.__assign)({className:"StickerPacksPanel__row"},{children:t.map((function(t){var r=t.id,i=t.sizes,s=e&&!r.startsWith("editor_"),l=i[u.default.STICKER_MEDIUM+(s?"b":"")];return(0,o.jsx)("div",(0,n.__assign)({className:"StickerPacksPanel__preview",onMouseDown:function(e){return a(e,r)}},{children:(0,o.jsx)("img",{src:l,className:"StickerPacksPanel__previewImage"},void 0)}),r)}))}),r)}))}),void 0)]}),void 0)},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,o=(0,n.__read)(t||[],1)[0],i=void 0===o?null:o;return!(!t||!i)&&i.sizes[u.default.STICKER_THUMB]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var i=n.offsetWidth,a=Math.max(0,Math.min(o+e,n.scrollWidth-i));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(a)}},r.loadingLimit=25,r.scrollElement=(0,i.createRef)(),r.scrollWithAnimation=!1,r.needReset=!1,r}return(0,n.__extends)(t,e),t.prototype.fetchStickers=function(){var e=this;window.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){var r={};t.stickers.forEach((function(e){e.items.forEach((function(e){r[e.id]=e}))})),e.props.setData({stickers:t.stickers,stickersMap:r})},onFail:function(e){return console.error(e),!0}})},t.prototype.showStickerShop=function(){var e=this;(0,ye.showBox)("al_im.php",{act:"stickers_store",box:1},{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy:function(){e.fetchStickers()}}})},t}(i.Component),jr={setCurrentStickerPackIndex:function(e){return{type:y,value:e}},setHeaderScrollPosition:function(e){return{type:x,value:e}},setData:Fe};const Hr=(0,a.connect)((function(e){return{ui:e.present.ui,stickers:e.present.data.stickers}}),jr)(Fr),Ur=(0,xt.makeIcon)("Icon24ArrowUturnLeftOutline","arrow_uturn_left_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="arrow_uturn_left_outline_24"><path fill-rule="evenodd" d="M10.236 3.264a.9.9 0 0 1 0 1.272L7.673 7.1H12a5.9 5.9 0 1 1 0 11.8H7.9a.9.9 0 1 1 0-1.8H12a4.1 4.1 0 0 0 0-8.2H7.673l2.563 2.564a.9.9 0 0 1-1.272 1.272l-4.1-4.1a.9.9 0 0 1 0-1.272l4.1-4.1a.9.9 0 0 1 1.272 0Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0),zr=(0,xt.makeIcon)("Icon24ArrowUturnRightOutline","arrow_uturn_right_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="arrow_uturn_right_outline_24"><path fill-rule="evenodd" d="M13.764 3.264a.9.9 0 0 1 1.272 0l4.1 4.1a.9.9 0 0 1 0 1.272l-4.1 4.1a.9.9 0 0 1-1.272-1.272L16.327 8.9H12a4.1 4.1 0 1 0 0 8.2h4.1a.9.9 0 0 1 0 1.8H12a5.9 5.9 0 1 1 0-11.8h4.327l-2.563-2.564a.9.9 0 0 1 0-1.272Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var Wr=l.ActionCreators;const Zr=(0,a.connect)((function(e){return{canUndo:e.past.length>0,canRedo:e.future.length>0}}),Wr)((function(e){var t=e.canUndo,r=e.canRedo,i=e.undo,a=e.redo;return(0,o.jsxs)("div",(0,n.__assign)({className:"UndoRedo"},{children:[(0,o.jsx)("button",(0,n.__assign)({className:"UndoRedo__button",onClick:function(){(0,we.sendStat)(we.EVENTS.UNDO),i()},disabled:!t},{children:(0,o.jsx)(Ur,{},void 0)}),void 0),(0,o.jsx)("button",(0,n.__assign)({className:"UndoRedo__button",onClick:function(){(0,we.sendStat)(we.EVENTS.REDO),a()},disabled:!r},{children:(0,o.jsx)(zr,{},void 0)}),void 0)]}),void 0)}));var Yr,Gr=function(){function e(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return e.prototype.draw=function(e,t,r,n,o,i){var a=this;return new Promise((function(s,l){var c=r[0];a.canvas.width=e,a.canvas.height=t,Ye(a.canvas,c.canvas,c.avgColor);var d=c.width*c.scale,u=c.height*c.scale,p=c.x-d/2,h=c.y-u/2;a.drawImage(c.canvas,d*o,u*o,p*o,h*o,c.rotate),a.drawBrush(n,o),a.drawLayers(r,o,e,t,i).then((function(){a.canvas.toBlob((function(e){s({blob:e,width:a.canvas.width,height:a.canvas.height})}),"image/jpeg",1)})).catch((function(e){l(e)}))}))},e.prototype.drawImage=function(e,t,r,n,o,i){this.context&&(this.context.save(),this.context.imageSmoothingEnabled=!1,this.context.translate(n,o),this.context.translate(t/2,r/2),this.context.rotate(i*Math.PI/180),this.context.translate(-t/2,-r/2),this.context.drawImage(e,0,0,t,r),this.context.restore())},e.prototype.drawBrush=function(e,t){var r=this.context;r&&(r.save(),r.lineCap="round",r.lineJoin="round",e.forEach((function(e){r.lineWidth=e.width*u.default.BRUSH_WIDTH_COEFFICIENT*t,r.strokeStyle=We(e.color,e.opacity),r.beginPath(),r.moveTo(e.path[0][0]*t,e.path[0][1]*t),e.path.forEach((function(e){r.lineTo(e[0]*t,e[1]*t)})),r.stroke()})),r.restore())},e.prototype.drawLayers=function(e,t,r,n,o){var i=this;return new Promise((function(r,n){var a=[];e.forEach((function(e,r){var n=null;if(e.type!==u.default.LAYER_TYPES.BACKGROUND){if(e.type===u.default.LAYER_TYPES.STICKER){var s=o((e=e).id,u.default.STICKER_LARGE);n=i.fetchImage(s,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate)}else if(e.type===u.default.LAYER_TYPES.IMAGE)e=e,n=i.fetchImage(e.url,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate);else if(e.type===u.default.LAYER_TYPES.TEXT){var l=document.querySelector('[data-index="'+r+'"] .EditorLayer__inner');l&&(n=i.drawTextLayer(e,l,t))}n&&a.push(n)}})),Promise.all(a).then((function(e){e.forEach((function(e){var r=e.width,n=e.height,o=e.x-r/2,a=e.y-n/2;i.drawImage(e.image,r*t,n*t,o*t,a*t,e.rotate)})),r()})).catch((function(e){n(e)}))}))},e.prototype.drawTextLayer=function(e,t,r){return new Promise((function(n,o){var i=document.createElement("canvas"),a=i.getContext("2d");if(!a)return o();var s=100;i.width=t.offsetWidth*u.default.CANVAS_SCALE*r+s,i.height=t.offsetHeight*u.default.CANVAS_SCALE*r+s;var l="";switch(e.fontStyle){case"classic":l="RobotoPE";break;case"cursive":l="PacificoPE";break;case"marker":l="AmaticPE";break;case"italics":l="TTCommonsPE";break;case"typewriter":l="GoraPE";break;case"poster":l="DinPE";break;case"retro":l="Rodchenko";break;case"impact":l="Impact";break;case"lobster":l="Lobster"}var c=e.fontSize*e.scale*u.default.FONT_SIZE_COEFFICIENT*u.default.CANVAS_SCALE*r;a.font=c+"px "+l+", serif",a.fillStyle=e.color,a.textAlign="center",a.textBaseline="top",function(e,t,r,n,o,i){if((i=i||0)<=0)e.fillText(t,r,n);else{for(var a=t.replace(/(\v)/gm,"\n").split("\n"),s=0,l=1;a.length>0&&l<=a.length;){var c=a.slice(0,l).join(" ");e.measureText(c).width>i?(1===l&&(l=2),e.fillText(a.slice(0,l-1).join(" "),r,n+o*s),s++,a=a.splice(l-1),l=1):l++}l>0&&e.fillText(a.join(" "),r,n+o*s)}}(a,e.text,i.width/2,50,c,i.width-s),n({image:i,width:i.width/u.default.CANVAS_SCALE/r,height:i.height/u.default.CANVAS_SCALE/r,x:e.x,y:e.y,rotate:e.rotate})}))},e.prototype.fetchImage=function(e,t,r,n,o,i){return new Promise((function(a){Ue(e).then((function(e){a({image:e,width:t,height:r,x:n,y:o,rotate:i})})).catch((function(e){console.error(e)}))}))},e}(),Vr=new Gr,Xr=function(){function e(){this.layers=[],this.images=[],this.width=0,this.height=0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return e.prototype.drawScene=function(){var e=this.ctx;e&&(this.canvas.width=this.getWidth(),this.canvas.height=this.getHeight(),e.clearRect(0,0,this.canvas.width,this.canvas.height),this.layers.forEach((function(t){t.draw(e)})))},e.prototype.add=function(e){this.layers.push(e)},e.prototype.getCanvas=function(){return this.canvas},e.prototype.toBlob=function(){var e=this;return new Promise((function(t,r){e.canvas.toBlob((function(e){e||r(),t(e)}),"image/png",1)}))},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.setWidth=function(e){this.width=e},e.prototype.setHeight=function(e){this.height=e},e.prototype.loadImages=function(e){var t=this;return new Promise((function(r,o){var i,a,s=[];try{for(var l=(0,n.__values)(Object.entries(e)),c=l.next();!c.done;c=l.next()){var d=(0,n.__read)(c.value,2),u=d[0],p=d[1];u&&p&&s.push(Ue(p,u))}}catch(e){i={error:e}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}Promise.all(s).then((function(e){t.images=e,r(1)})).catch((function(e){o(e)}))}))},e.prototype.getIconUrl=function(e){return URL.createObjectURL(new Blob([e],{type:"image/svg+xml"}))},e.prototype.getImage=function(e){return this.images.find((function(t){return t.dataset.name===e}))},e}(),Kr=function(){function e(e){this.props=e}return e.prototype.getBoundingClientRect=function(){var e=this.props,t=e.x,r=void 0===t?0:t,n=e.y,o=void 0===n?0:n;return{width:this.getWidth(),height:this.getHeight(),top:o,left:r,right:r+this.getWidth(),bottom:o+this.getHeight()}},e.prototype.setX=function(e){this.props.x=e},e.prototype.setY=function(e){this.props.y=e},e}(),qr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.draw=function(e){var t=this.props,r=t.x,n=void 0===r?0:r,o=t.y,i=void 0===o?0:o,a=t.width,s=void 0===a?0:a,l=t.height,c=void 0===l?0:l,d=t.background,u=void 0===d?"transparent":d,p=t.borderSize,h=void 0===p?0:p,g=t.borderColor,_=void 0===g?"transparent":g,f=this.props.radius,v=void 0===f?0:f;s<2*v&&(v=s/2),c<2*v&&(v=c/2),e.save(),e.beginPath(),e.fillStyle=u,e.lineWidth=h,e.strokeStyle=_,e.moveTo(n+v,i),e.arcTo(n+s,i,n+s,i+c,v),e.arcTo(n+s,i+c,n,i+c,v),e.arcTo(n,i+c,n,i,v),e.arcTo(n,i,n+s,i,v),e.closePath(),e.stroke(),e.fill(),e.restore()},t.prototype.getWidth=function(){var e=this.props.width;return void 0===e?0:e},t.prototype.setWidth=function(e){this.props.width=e},t.prototype.getHeight=function(){var e=this.props.height;return void 0===e?0:e},t.prototype.setHeight=function(e){this.props.height=e},t}(Kr),$r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.draw=function(e){var t=this.props,r=t.x,n=void 0===r?0:r,o=t.y,i=void 0===o?0:o,a=t.image,s=t.width,l=void 0===s?0:s,c=t.height,d=void 0===c?0:c,u=t.radius,p=void 0===u?0:u,h=t.borderSize,g=void 0===h?0:h,_=t.borderColor,f=void 0===_?"transparent":_,v=t.shadowBlur,m=void 0===v?0:v,y=t.shadowColor,x=void 0===y?"":y,w=Math.min(a.width,a.height),C=(a.width-w)/2,E=(a.height-w)/2;e.save(),e.lineWidth=g,e.strokeStyle=f,m&&x&&(e.shadowBlur=m,e.shadowColor=x,e.shadowOffsetX=1e4+n,e.shadowOffsetY=1e4+i,e.fillRect(-1e4,-1e4,l,l)),e.beginPath(),e.arc(n+p,i+p,p,Math.PI,Math.PI+Math.PI/2),e.lineTo(n+l-p,i),e.arc(n+l-p,i+p,p,Math.PI+Math.PI/2,2*Math.PI),e.lineTo(n+l,i+d-p),e.arc(n+l-p,i+d-p,p,2*Math.PI,Math.PI/2),e.lineTo(n+p,i+d),e.arc(n+p,i+d-p,p,Math.PI/2,Math.PI),e.closePath(),e.clip(),e.drawImage(a,C,E,w,w,n,i,l,d),e.stroke(),e.restore()},t.prototype.getWidth=function(){return this.props.width},t.prototype.setWidth=function(e){this.props.width=e},t.prototype.getHeight=function(){return this.props.height},t.prototype.setWeight=function(e){this.props.height=e},t}(Kr);!function(e){e.LEFT="LEFT",e.CENTER="CENTER"}(Yr||(Yr={}));var Jr=function(e){function t(t){var r=e.call(this,t)||this;return r.context=document.createElement("canvas").getContext("2d"),r.splitText=r.splitTextIntoLines(),r}return(0,n.__extends)(t,e),t.prototype.draw=function(e){var r=this,n=this.props,o=n.x,i=void 0===o?0:o,a=n.y,s=void 0===a?0:a,l=n.color,c=void 0===l?"#000":l,d=n.lineHeight,u=n.fillColor,p=n.fillRadius,h=void 0===p?0:p,g=n.align,_=void 0===g?Yr.LEFT:g,f=n.maxWidth,v=void 0===f?0:f,m=n.shadowBlur,y=n.shadowColor,x=n.maxLines,w=n.afterPadding,C=void 0===w?0:w;if(e.save(),this.setFont(e),e.fillStyle=c,e.textBaseline="top",e.textAlign="left",m&&y&&(e.shadowBlur=m,e.shadowColor=y),u){var E=this.getPadding(),T=0;this.splitText.forEach((function(n,o){var a=e.measureText(n).width;x&&o==r.splitText.length-1&&(a+=C);var s=i;_===Yr.CENTER&&(s=i+(v-a)/2);var l=0;l=0===o?E.top:E.top/2;var c=0;c=o===r.splitText.length-1?E.bottom:E.bottom/2;var p={tl:0,tr:0,bl:0,br:0};if(0===o)p.tl=h,p.tr=h,(g=e.measureText(r.splitText[o]).width)>(m=e.measureText(r.splitText[o+1]).width)&&(p.bl=0,p.br=h);else if(o===r.splitText.length-1){p.bl=h,p.br=h,(g=e.measureText(r.splitText[o]).width)>(f=e.measureText(r.splitText[o-1]).width)&&(p.tl=0,p.tr=h)}else{var g=e.measureText(r.splitText[o]).width,f=e.measureText(r.splitText[o-1]).width,m=e.measureText(r.splitText[o+1]).width;g>f&&(p.tl=0,p.tr=h),g>m&&(p.bl=0,p.br=h)}var y=d+l+c;t.drawFill(e,s,T,a+E.left+E.right,y,u,p),e.fillText(n,s+E.left,T+l),T+=y}))}else this.splitText.forEach((function(t,n){var o=e.measureText(t).width;x&&n==r.splitText.length-1&&(o+=C);var a=i;_===Yr.CENTER&&(a=i+(v-o)/2),e.fillText(t,a,s+d*n)}));e.restore()},t.drawFill=function(e,t,r,n,o,i,a){e.save(),e.beginPath(),e.fillStyle=i,e.lineWidth=0,e.strokeStyle="transparent",e.moveTo(t+a.tl,r),e.lineTo(t+n-a.tr,r),e.quadraticCurveTo(t+n,r,t+n,r+a.tr),e.lineTo(t+n,r+o-a.br),e.quadraticCurveTo(t+n,r+o,t+n-a.br,r+o),e.lineTo(t+a.bl,r+o),e.quadraticCurveTo(t,r+o,t,r+o-a.bl),e.lineTo(t,r+a.tl),e.quadraticCurveTo(t,r,t+a.tl,r),e.closePath(),e.stroke(),e.fill(),e.restore()},t.prototype.setFont=function(e){var t=this.props,r=t.fontSize,n=t.lineHeight,o=t.fontFamily,i=void 0===o?"sans-serif":o,a=t.fontWeight,s=void 0===a?"normal":a;e.font=s+" "+r+"px/"+n+"px "+i},t.prototype.splitLongWords=function(e){var t=this.context,r=this.props.maxWidth,o=void 0===r?0:r,i=[];return t&&o?(this.setFont(t),e.forEach((function(e){if("\n"!==e)if(t.measureText(e).width<=o)i.push(e);else{var r=Array.from(e).reduce((function(e,r){return t.measureText(e.current+r).width>o?{current:r,items:(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(e.items),!1),[e.current],!1)}:{current:e.current+r,items:(0,n.__spreadArray)([],(0,n.__read)(e.items),!1)}}),{current:"",items:[]});i.push.apply(i,(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(r.items),!1),[r.current],!1))}else i.push(e)})),i):e},t.prototype.splitTextIntoLines=function(){var e=this.context,t=this.props,r=t.text,n=t.maxWidth,o=void 0===n?0:n,i=t.maxLines,a=void 0===i?0:i,s=t.afterPadding,l=void 0===s?0:s,c=String((0,Ce.decodeHTMLEntities)(r)).replace(/(?:<br\s*\/?>)+/gim,"\n");if(!e)return c.split(/\n/);if(o<=0)return c.split(/\n/);this.setFont(e);for(var d=this.splitLongWords(c.replaceAll("\n"," \n ").split(" ")),u=0,p=[],h=function(){if(a&&p.length>=a-1){var t=d.splice(0).join(" ");if(e.measureText(t).width+l<=o)p.push(t);else{var r=e.measureText("...").width,n=!1,i=Array.from(t).reduce((function(t,i){var a=e.measureText(t+i).width;return!n&&a+r+l<=o?t+i:(n=!0,t)}),"");p.push(i.trim()+"...")}}else{var s=u+1,c="\n"===d[u],h=d.slice(0,s).join(" "),g=e.measureText(h).width;if(s>=d.length&&(g+=l),g>o||s>d.length||c){var _=d.splice(0,c?s:s-1);p.push(_.join(" ")),u=0}else u++}};d.length;)h();return p},t.prototype.getWidth=function(){var e=this.getLinesWidth();return 0===e.length?0:Math.max.apply(Math,(0,n.__spreadArray)([],(0,n.__read)(e),!1))},t.prototype.getLinesWidth=function(){var e=this.context,t=this.props,r=t.maxLines,n=t.afterPadding,o=void 0===n?0:n;if(!e)return[];this.setFont(e);for(var i=this.getPadding(),a=[],s=0;s<this.splitText.length;s++){var l=e.measureText(this.splitText[s]).width;r&&s==this.splitText.length-1&&(l+=o),l+=i.left+i.right,a.push(Math.round(l))}return a},t.prototype.getHeight=function(){var e=this.getPadding(),t=this.props,r=t.fillColor,n=t.lineHeight;if(r){var o=this.splitText.length*n,i=(this.splitText.length-1)*(e.top+e.bottom)/2;return e.top+o+i+e.bottom}return this.splitText.length*(n+e.top+e.bottom)},t.prototype.getPadding=function(){var e=this.props.padding,t=void 0===e?0:e;return"number"==typeof t?{top:t,bottom:t,left:t,right:t}:t},t}(Kr);var Qr=80,en="VK Sans Text, SF Pro Text, sans-serif",tn=function(e){function t(t){var r=e.call(this)||this;return r.props=t,r.setWidth(1400),r}return(0,n.__extends)(t,e),t.getReplyMediaIcon=function(e){var t="";switch(e){case"photo":t='<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M5.5 5.5c.57 0 1-.2 1.34-.52.24-.24.43-.54.55-.74l.06-.1c.15-.23.26-.37.39-.47.11-.08.3-.17.66-.17h3c.36 0 .55.09.66.17.13.1.24.24.4.48l.05.09c.12.2.3.5.55.74.33.32.77.52 1.34.52.73 0 .99 0 1.19.04.9.18 1.59.88 1.77 1.77.04.2.04.46.04 1.19v3.45c0 .85 0 1.45-.04 1.9-.04.46-.1.72-.2.92-.22.42-.57.77-.99.98-.2.1-.46.17-.91.21-.46.04-1.06.04-1.91.04h-6.9c-.85 0-1.45 0-1.91-.04a2.4 2.4 0 0 1-.91-.2 2.25 2.25 0 0 1-.99-.99 2.4 2.4 0 0 1-.2-.91c-.04-.46-.04-1.06-.04-1.91V8.5c0-.73 0-.99.04-1.19.18-.9.88-1.59 1.77-1.77.2-.04.46-.04 1.19-.04zm3-3.5c-.64 0-1.14.16-1.54.46-.39.27-.62.63-.78.9l-.08.11c-.13.22-.2.34-.3.43-.06.05-.12.1-.3.1h-.09c-.61 0-1.03 0-1.4.07a3.75 3.75 0 0 0-2.94 2.95C1 7.38 1 7.8 1 8.42v3.56c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.18.04 2 .04H13.48c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V8.41c0-.61 0-1.03-.07-1.4a3.75 3.75 0 0 0-2.95-2.94 7.5 7.5 0 0 0-1.4-.07h-.08c-.18 0-.24-.05-.3-.1-.1-.1-.17-.2-.3-.43l-.08-.12c-.16-.26-.4-.62-.78-.9-.4-.29-.9-.45-1.54-.45zm3.75 8.25a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0zm1.5 0a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0z" fill="currentColor" fill-rule="evenodd"/></svg>';break;case"video":t='<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M10 17a7 7 0 1 1 0-14 7 7 0 0 1 0 14zm-8.5-7a8.5 8.5 0 1 1 17 0 8.5 8.5 0 0 1-17 0zm8.65 3.38 2.7-1.56a2.1 2.1 0 0 0 0-3.64l-2.7-1.56A2.1 2.1 0 0 0 7 8.44v3.12a2.1 2.1 0 0 0 3.15 1.82zm1.95-3.9c.4.23.4.8 0 1.04l-2.7 1.56a.6.6 0 0 1-.9-.52V8.44c0-.46.5-.75.9-.52z" fill="currentColor" fill-rule="evenodd"/></svg>';break;case"audio":t='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="music_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="music_outline_20__Icons-20/music_outline_20"><g id="music_outline_20__music_outline_20"><path d="M0 0h20v20H0z"/><path d="M14.73 2.05a2.28 2.28 0 0 1 2.75 2.23v7.99c0 3.57-3.5 5.4-5.39 3.51-1.9-1.9-.06-5.38 3.52-5.38h.37V6.76L8 8.43v5.82c0 3.5-3.35 5.34-5.27 3.62l-.11-.1c-1.9-1.9-.06-5.4 3.51-5.4h.37V6.24c0-.64.05-1 .19-1.36l.05-.13c.17-.38.43-.7.76-.93.36-.26.7-.4 1.41-.54ZM6.5 13.88h-.37c-2.32 0-3.34 1.94-2.45 2.82.88.89 2.82-.13 2.82-2.45v-.37Zm9.48-1.98h-.37c-2.32 0-3.34 1.94-2.46 2.82.89.89 2.83-.13 2.83-2.45v-.37Zm-.02-7.78a.78.78 0 0 0-.92-.6L9.06 4.77c-.4.09-.54.15-.68.25a.8.8 0 0 0-.27.33c-.08.18-.1.35-.1.88v.67l7.97-1.67V4.2Z" id="music_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>';break;case"doc":t='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.18 1.5H9c-.8 0-1.47 0-2.01.05-.63.05-1.17.16-1.67.41a4.25 4.25 0 0 0-1.86 1.86c-.25.5-.36 1.04-.41 1.67C3 6.1 3 6.86 3 7.82v4.36c0 .95 0 1.71.05 2.33.05.63.16 1.17.41 1.67a4.25 4.25 0 0 0 1.86 1.86c.5.25 1.04.36 1.67.4.61.06 1.37.06 2.33.06h1.36c.96 0 1.72 0 2.33-.05a4.39 4.39 0 0 0 1.67-.41 4.25 4.25 0 0 0 1.86-1.86c.25-.5.36-1.04.41-1.67.05-.62.05-1.38.05-2.33V8.32c0-.48 0-.73-.06-.96-.05-.2-.13-.4-.24-.58-.12-.2-.3-.37-.64-.72l-3.62-3.62a4.27 4.27 0 0 0-.72-.65 2 2 0 0 0-.58-.24c-.23-.05-.48-.05-.96-.05Zm5.32 10.65c0 1 0 1.7-.04 2.24a2.9 2.9 0 0 1-.26 1.1A2.75 2.75 0 0 1 14 16.7c-.25.13-.57.21-1.11.26-.55.04-1.25.04-2.24.04h-1.3c-1 0-1.7 0-2.24-.04a2.9 2.9 0 0 1-1.1-.26 2.75 2.75 0 0 1-1.21-1.2 2.94 2.94 0 0 1-.26-1.11c-.04-.55-.04-1.25-.04-2.24v-4.3c0-1 0-1.7.04-2.24.05-.53.13-.86.26-1.1A2.75 2.75 0 0 1 6 3.3c.25-.13.57-.21 1.11-.26C7.66 3 8.36 3 9.35 3H10v2.35c0 .4 0 .76.02 1.05.03.3.09.61.24.9.21.4.54.73.94.94.29.15.6.21.9.24.29.02.64.02 1.05.02h2.35v3.65ZM14.88 7 11.5 3.62v1.7c0 .45 0 .74.02.95.02.22.05.3.07.33a.75.75 0 0 0 .3.31c.05.02.12.05.33.07.22.02.51.02.96.02h1.7Z" clip-rule="evenodd"/></svg>';break;case"article":t='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M17.5 5.25a.75.75 0 0 0-.74-.75H3.24a.75.75 0 0 0-.74.75c0 .41.34.75.74.75h13.52c.4 0 .74-.33.74-.75Zm0 5a.75.75 0 0 0-.74-.75H3.24a.75.75 0 0 0-.74.75c0 .41.34.75.74.75h13.52c.4 0 .74-.33.74-.75Zm-15 5c0 .41.34.75.76.75h8.98c.42 0 .76-.33.76-.75a.75.75 0 0 0-.76-.75H3.26a.75.75 0 0 0-.76.75Z" id="article_outline_20__path-1"/></defs><g id="article_outline_20__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="article_outline_20__article_outline_20"><path id="article_outline_20__Shape" d="M0 0h20v20H0z"/><mask id="article_outline_20__mask-2" fill="#fff"><use xlink:href="#article_outline_20__path-1"/></mask><use id="article_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero" xlink:href="#article_outline_20__path-1"/></g></g></svg>';break;case"narrative":t='<svg height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v20H0z"/><path d="M10.53 1.5c.69.17 1.29.51 1.77 1.03.53.56.82 1.16 1.16 2.44l.3 1.14a.75.75 0 1 1-1.44.38l-.3-1.13c-.3-1.07-.48-1.45-.81-1.8-.28-.3-.62-.5-1.02-.6-.44-.1-.84-.08-1.75.16l-.22.05-2.23.6c-.88.24-1.3.42-1.6.63l-.07.06-.14.12c-.3.28-.49.62-.58 1.01-.1.41-.09.78.1 1.55l.1.42 1.9 7.06.11.42c.23.76.4 1.09.7 1.4.27.29.61.48 1 .58.48.1.9.08 1.98-.2l.56-.16a.75.75 0 0 1 .4 1.45l-.57.15c-1.3.34-1.96.4-2.7.22a3.48 3.48 0 0 1-1.77-1.02 4.76 4.76 0 0 1-1.1-2.2L4.25 15l-1.9-7.06c-.34-1.29-.39-1.95-.21-2.7.14-.6.43-1.15.86-1.61l.17-.17.18-.15a5.1 5.1 0 0 1 2-.93l.25-.07 2.23-.6c1.3-.34 1.96-.39 2.7-.21zm5.6 6.75a3.2 3.2 0 0 1 3.12 3.28c0 1.75-.66 2.64-3.32 4.84l-1.15.96c-.45.37-1.1.37-1.56 0l-1.41-1.17c-2.44-2.05-3.06-2.93-3.06-4.63a3.2 3.2 0 0 1 5.12-2.65l.13.1.13-.1a3.44 3.44 0 0 1 1.78-.62zm0 1.5c-.59 0-1.1.24-1.58.75l-.19.2a.5.5 0 0 1-.72 0l-.19-.2c-.47-.51-.99-.75-1.58-.75-.88 0-1.62.78-1.62 1.78 0 1.16.44 1.75 2.77 3.69l.98.8.98-.8c2.25-1.87 2.74-2.49 2.77-3.58v-.11c0-1-.74-1.78-1.62-1.78z" fill="currentColor" fill-rule="nonzero"/></g></svg>';break;default:t='<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M14.95 3.8a2.72 2.72 0 0 0-3.86 0L5.56 9.35a4.5 4.5 0 0 0 0 6.34 4.46 4.46 0 0 0 6.32 0l2.88-2.86a.75.75 0 0 1 1.06 1.06l-2.88 2.86a5.96 5.96 0 0 1-8.44 0 6 6 0 0 1 0-8.46l5.53-5.55a4.22 4.22 0 0 1 5.98 0 4.24 4.24 0 0 1 0 6l-5.53 5.54a2.49 2.49 0 1 1-3.52-3.52l3.1-3.09a.75.75 0 0 1 1.06 1.07l-3.1 3.08a1 1 0 0 0 0 1.4.99.99 0 0 0 1.4 0l5.53-5.55a2.74 2.74 0 0 0 0-3.87z" fill="currentColor" fill-rule="evenodd"/></svg>'}return t},t.getPostMediaIcon=function(e){var t="";switch(e){case"audio":t='<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="music_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="music_outline_28__music_outline_28"><path d="M0 0h28v28H0z"/><path d="M11 16.93v2.46c0 4.7-4.58 7.1-7.07 4.61-2.5-2.49-.08-7.07 4.6-7.07H11Zm-2 2h-.46c-3.02 0-4.34 2.52-3.2 3.66C6.48 23.73 9 22.4 9 19.39v-.46Zm10.39-15.4A3 3 0 0 1 23 6.45v10.43c0 4.7-4.58 7.1-7.07 4.61-2.5-2.49-.08-7.07 4.6-7.07H21v-4.7L11 11.8V18H9V8.92c0-.95.08-1.43.31-1.96.23-.5.56-.9 1-1.23.47-.33.93-.51 1.85-.7ZM21 16.42h-.46c-3.02 0-4.34 2.52-3.2 3.66 1.14 1.14 3.66-.18 3.66-3.2v-.46Zm-.02-10.17a1 1 0 0 0-1.18-.78l-7.23 1.5c-.67.15-.88.23-1.08.37-.16.12-.27.25-.35.43-.1.23-.14.45-.14 1.14v.85l10-2.08V6.46a1 1 0 0 0 0-.1Z" id="music_outline_28__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>';break;case"video":t='<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="video_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="video_outline_28__video_outline_28" fill-rule="nonzero"><path d="M0 0h28v28H0z"/><path d="M14 2a12 12 0 1 1 0 24 12 12 0 0 1 0-24Zm0 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm-2.05 5.12c.35 0 .68.1.98.26l5.08 2.93a1.95 1.95 0 0 1 0 3.38l-5.08 2.93a1.95 1.95 0 0 1-2.93-1.7v-5.84c0-1.08.88-1.96 1.95-1.96Zm.05 2.03v5.7L16.94 14 12 11.15Z" id="video_outline_28__Icon-Color" fill="currentColor"/></g></g></svg>';break;case"poll":t='<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="poll_square_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="poll_square_outline_28__poll_square_outline_28"><path id="poll_square_outline_28__poll_outline_28" d="M0 0h28v28H0z"/><path d="M10.7 5c-2.14 0-2.9.15-3.69.57-.63.33-1.1.81-1.44 1.44C5.15 7.8 5 8.56 5 10.7v6.62c0 2.13.15 2.9.57 3.68.33.63.81 1.1 1.44 1.44.78.42 1.55.57 3.68.57h6.62c2.13 0 2.9-.15 3.68-.57A3.45 3.45 0 0 0 22.43 21c.42-.78.57-1.55.57-3.68v-6.62c0-2.13-.15-2.9-.57-3.68A3.45 3.45 0 0 0 21 5.57C20.2 5.15 19.44 5 17.3 5h-6.62Zm0-2h6.6c2.68 0 3.65.28 4.63.8a5.45 5.45 0 0 1 2.27 2.27c.52.98.8 1.95.8 4.62v6.62c0 2.67-.28 3.64-.8 4.62a5.45 5.45 0 0 1-2.27 2.27c-.98.52-1.95.8-4.62.8h-6.62c-2.67 0-3.64-.28-4.62-.8a5.45 5.45 0 0 1-2.27-2.27c-.52-.98-.8-1.95-.8-4.62v-6.62c0-2.67.28-3.64.8-4.62A5.45 5.45 0 0 1 6.07 3.8c.98-.52 1.95-.8 4.62-.8Zm.3 16a1 1 0 0 1-2 0v-6a1 1 0 0 1 2 0v6Zm4 0a1 1 0 0 1-2 0V9a1 1 0 0 1 2 0v10Zm4 0a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0v4Z" id="poll_square_outline_28__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>';break;case"narrative":t='<svg fill="none" height="28" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg"><g clip-rule="evenodd" fill="currentColor" fill-rule="evenodd"><path d="M24.11 19.09c.64-.88.88-1.86.89-2.93 0-2.3-1.86-4.16-4.16-4.16a5 5 0 0 0-2.7.82l-.14.1-.14-.1a4.76 4.76 0 0 0-2.7-.82A4.16 4.16 0 0 0 11 16.16c0 1.07.25 2.06.89 2.93.66.91 1.77 1.9 3.55 3.3l1.65 1.3c.53.42 1.29.42 1.82 0l1.65-1.3c1.77-1.4 2.89-2.39 3.55-3.3zm-10.6-1.18c.48.66 1.37 1.5 3.17 2.9L18 21.87l1.32-1.04c1.8-1.42 2.7-2.25 3.18-2.9.39-.54.5-1.1.5-1.76 0-1.2-.97-2.16-2.16-2.16-.8 0-1.5.3-2.13.94l-.36.35a.5.5 0 0 1-.7 0l-.36-.35a2.9 2.9 0 0 0-2.13-.94c-1.2 0-2.16.97-2.16 2.16 0 .65.12 1.22.5 1.75z"/><path d="m7.65 3.47 3.36-.9c.78-.2 1.42-.38 1.95-.48.56-.1 1.08-.13 1.62-.02a4 4 0 0 1 2.14 1.23c.36.4.6.88.78 1.41.18.52.36 1.16.56 1.93l.68 2.54a1 1 0 0 1-1.93.52l-.67-2.5c-.22-.83-.37-1.39-.52-1.81a2.16 2.16 0 0 0-.39-.75 2 2 0 0 0-1.07-.62c-.17-.03-.4-.04-.84.04-.44.08-1 .23-1.83.46L8.2 5.4c-.82.22-1.38.37-1.81.52-.41.15-.61.27-.74.39a2 2 0 0 0-.62 1.07c-.04.17-.04.4.04.83.08.45.23 1.01.45 1.84L8.2 20.09c.22.83.37 1.4.52 1.82.15.41.27.61.4.74a2 2 0 0 0 1.06.62c.34.07.79.01 2.1-.33a1 1 0 0 1 .5 1.93c-1.18.31-2.12.55-3.01.36a4 4 0 0 1-2.15-1.24c-.36-.4-.59-.88-.78-1.4-.18-.52-.35-1.16-.56-1.94L3.58 10.53c-.21-.78-.39-1.42-.48-1.96a4.09 4.09 0 0 1-.03-1.6 4 4 0 0 1 1.24-2.15c.4-.36.88-.6 1.4-.78.52-.19 1.16-.36 1.94-.57z"/></g></svg>';break;case"audio_playlist":t='<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="playlist_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="playlist_outline_28__playlist_outline_28"><path d="M0 0h28v28H0z"/><path d="M24.78 4.02A1 1 0 0 1 26 5v2.1a3.6 3.6 0 0 1-2.67 3.48l-3.33.89v7.92c0 4.7-4.58 7.1-7.07 4.61-2.58-2.57-.11-6.8 5.07-7.06v-6.22a1 1 0 0 1 0-.04V8.93c-.03-1.92.91-3.29 2.68-3.88.64-.21 2-.55 4.1-1.03ZM18 18.94c-3.54.2-4.84 2.46-3.66 3.65 1.14 1.14 3.66-.18 3.66-3.2ZM8.5 17a1 1 0 0 1 0 2h-4a1 1 0 0 1 0-2h4Zm5-6a1 1 0 0 1 0 2h-9a1 1 0 0 1 0-2h9ZM24 6.26c-1.35.31-2.25.54-2.68.69-.94.31-1.34.89-1.32 1.97v.48l2.81-.75A1.6 1.6 0 0 0 24 7.1ZM15 5a1 1 0 0 1 0 2H4.5a1 1 0 1 1 0-2H15Z" id="playlist_outline_28__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>';break;case"market":t='<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21.15 8c1.34 0 1.83.14 2.32.4.48.26.87.65 1.13 1.13l.1.19c.2.44.3.96.3 2.13v7.68c-.04 2.02-.3 2.83-.73 3.66a5 5 0 0 1-2.08 2.08c-.9.47-1.79.73-4.24.73H9.47c-2.02-.04-2.83-.3-3.66-.73a5 5 0 0 1-2.08-2.08c-.45-.86-.7-1.71-.73-3.94v-7.4c0-1.34.14-1.83.4-2.32.26-.48.65-.87 1.13-1.13l.19-.1c.4-.18.88-.28 1.88-.3h14.55Zm0 2H6.5c-.63.01-.82.06-1.01.16a.73.73 0 0 0-.32.32c-.1.2-.15.42-.16 1.18v7.29c0 1.93.13 2.6.5 3.3a3 3 0 0 0 1.26 1.25c.69.37 1.36.5 3.3.5h7.89c1.93 0 2.6-.13 3.3-.5a3 3 0 0 0 1.25-1.26c.37-.69.5-1.36.5-3.3v-7.1c0-.91-.04-1.14-.16-1.36a.73.73 0 0 0-.32-.32c-.2-.1-.38-.15-1.01-.16h-.36ZM19 12a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM9 12a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm5-10a6 6 0 0 1 6 6h-2a4 4 0 0 0-8 0H8a6 6 0 0 1 6-6Z" fill="currentColor"/></svg>';break;case"geo":t='<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="place_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="place_outline_28__place_outline_28"><path d="M0 0h28v28H0z"/><path d="M23 12.01a9 9 0 1 0-18 0c0 3.55 2.18 7.83 6.48 12.92a3.3 3.3 0 0 0 5.04 0c4.3-5.09 6.48-9.37 6.48-12.92ZM14.84 23.8a1.3 1.3 0 0 1-1.83-.15C8.98 18.88 7 14.98 7 12a7 7 0 1 1 14 0c0 2.97-1.98 6.87-6 11.63l-.16.15ZM10 12a4 4 0 1 1 8 0 4 4 0 0 1-8 0Zm2 0a2 2 0 1 0 4 0 2 2 0 0 0-4 0Z" id="place_outline_28__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>';break;case"doc":t='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 28 28"><path fill-rule="evenodd" d="M11.7 2c-2.46 0-3.53.22-4.63.8A5.47 5.47 0 0 0 4.8 5.07C4.22 6.17 4 7.24 4 9.69v8.62c0 2.45.22 3.53.8 4.62a5.46 5.46 0 0 0 2.27 2.27c1.1.58 2.17.8 4.62.8h4.62c2.45 0 3.53-.22 4.62-.8a5.46 5.46 0 0 0 2.27-2.27c.59-1.1.8-2.17.8-4.62v-5.95c0-.8-.03-1.16-.12-1.56a3.61 3.61 0 0 0-.47-1.13 6.4 6.4 0 0 0-1.02-1.2l-4.87-4.86c-.56-.57-.84-.8-1.2-1.02a3.61 3.61 0 0 0-1.12-.47A5.3 5.3 0 0 0 14 2h-2.3Zm0 2c-2.34 0-3.03.21-3.69.56a3.47 3.47 0 0 0-1.44 1.45C6.2 6.67 6 7.36 6 9.7v8.62c0 2.33.21 3.02.56 3.68a3.47 3.47 0 0 0 1.45 1.45c.66.35 1.35.56 3.68.56h4.62c2.33 0 3.02-.21 3.68-.56a3.47 3.47 0 0 0 1.45-1.45c.35-.66.56-1.35.56-3.68V12h-5.5A2.5 2.5 0 0 1 14 9.5V4H11.7Zm4.4 1.02-.1-.1V9.5a.5.5 0 0 0 .41.5h4.68a25.43 25.43 0 0 0-.11-.1L16.1 5.01Z" clip-rule="evenodd"/></svg>';break;case"article":t='<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.59 3c2.18 0 3.23.2 4.32.79a5.54 5.54 0 0 1 2.3 2.3c.59 1.09.79 2.14.79 4.32v7.18c0 2.18-.2 3.23-.79 4.32a5.54 5.54 0 0 1-2.3 2.3c-1.09.59-2.14.79-4.32.79h-7.18c-2.18 0-3.23-.2-4.32-.79a5.54 5.54 0 0 1-2.3-2.3C3.2 20.82 3 19.77 3 17.6v-7.18c0-2.18.2-3.23.79-4.32a5.54 5.54 0 0 1 2.3-2.3C7.18 3.2 8.23 3 10.4 3h7.18Zm0 2h-7.18c-1.88 0-2.62.14-3.38.55-.64.34-1.14.84-1.48 1.48-.4.76-.55 1.5-.55 3.38v7.18c0 1.88.14 2.62.55 3.38.34.64.84 1.14 1.48 1.48.76.4 1.5.55 3.38.55h7.18c1.88 0 2.62-.14 3.38-.55a3.54 3.54 0 0 0 1.48-1.48c.4-.76.55-1.5.55-3.38v-7.18c0-1.88-.14-2.62-.55-3.38a3.54 3.54 0 0 0-1.48-1.48c-.76-.4-1.5-.55-3.38-.55ZM13 17.5a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h4Zm6-4.5a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h10Zm0-4.5a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h10Z" fill="currentColor"/></svg>';break;default:t='<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="attach_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="attach_outline_28__attach_outline_28"><path d="M0 0h28v28H0z"/><path d="M14.19 10.9a1 1 0 1 1 1.41 1.41l-4.17 4.17a1.5 1.5 0 0 0 0 2.12c.6.6 1.56.57 2.12 0l7.78-7.77a4 4 0 0 0-5.66-5.66L7.9 12.95a6.52 6.52 0 0 0 0 9.19 6.52 6.52 0 0 0 9.19 0l4.17-4.17a1 1 0 0 1 1.41 1.41l-4.17 4.17a8.52 8.52 0 0 1-12.02 0 8.52 8.52 0 0 1 0-12.02l7.78-7.77a6 6 0 0 1 8.48 8.48l-7.77 7.78a3.5 3.5 0 0 1-4.95-4.95l4.17-4.17Z" id="attach_outline_28__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>'}return t},t.prototype.prepareData=function(){var e=this;return new Promise((function(r,n){var o=e.props,i=o.replyOwnerPhoto,a=o.replyMediaType,s=o.replyMediaPreviewUrl,l=o.postOwnerPhoto,c=o.postMediaType,d=o.postMediaPreviewUrl,u={replyOwnerPhoto:i,postOwnerPhoto:l,replyIcon:e.getIconUrl('<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="m7.58.92.06-.1A.6.6 0 0 1 8.4.7l.08.06 2.78 2.32.04.05a.6.6 0 0 1 0 .76l-.07.08-2.75 2.29a.6.6 0 0 1-.97-.37l-.01-.1V4.5H4a1 1 0 0 0-1 .88V8a1 1 0 0 0 .88 1H8a1 1 0 0 1 .12 2H4a3 3 0 0 1-3-2.82V5.5a3 3 0 0 1 2.82-3H7.5V1.2c0-.1.03-.2.08-.3l.06-.08z" fill="currentColor"/></svg>'.replace("currentColor","#99A2AD"))};if(s)u.replySticker=s;else if(a){(p=t.getReplyMediaIcon(a))&&(u.replyMediaIcon=e.getIconUrl(p.replace("currentColor","#3F8AE0")))}if(d)u.postPreview=d;else if(c){var p;(p=t.getPostMediaIcon(c))&&(u.postMediaIcon=e.getIconUrl(p.replace("currentColor","#99A2AD")))}e.loadImages(u).then((function(){return r(1)})).catch((function(e){return n(e)}))}))},t.prototype.render=function(){var e=this;return new Promise((function(t,r){e.prepareData().then((function(){e.draw(),t(1)})).catch((function(e){r(e)}))}))},t.prototype.draw=function(){var e=new qr({x:0,y:0,radius:72,background:"#fff"});this.add(e);var t=this.renderReplyHeader(Qr,Qr),r=this.renderReplyMessage(Qr,t.bottom+46),n=r?r.bottom:t.bottom,o=this.renderPost(Qr,n+52).bottom;this.setHeight(o+Qr),e.setWidth(this.getWidth()),e.setHeight(this.getHeight()),this.drawScene()},t.prototype.renderReplyHeader=function(e,t){var r=new $r({x:e,y:t,image:this.getImage("replyOwnerPhoto"),width:160,height:160,radius:80,borderSize:4,borderColor:"rgba(0, 0, 0, 0.08)"}),n=r.getBoundingClientRect(),o=n.right+52,i=new Jr({x:o,y:n.top+20,text:this.props.replyOwnerName,fontSize:60,lineHeight:80,fontFamily:en,fontWeight:"500",maxWidth:this.getInnerWidth()-n.width-52,maxLines:1,color:"#000"}),a=new $r({x:o,y:i.getBoundingClientRect().bottom,image:this.getImage("replyIcon"),width:44,height:44,radius:0}),s=new Jr({x:a.getBoundingClientRect().right+20,y:a.getBoundingClientRect().top,text:this.props.replySubtitle,fontSize:48,lineHeight:56,fontFamily:en,fontWeight:"400",maxWidth:880,maxLines:1,color:"#818C99"});return this.add(r),this.add(i),this.add(a),this.add(s),n},t.prototype.renderReplyMessage=function(e,t){var r={bottom:t};if(this.props.replyMediaPreviewUrl){var n=new $r({x:e,y:t,image:this.getImage("replySticker"),width:288,height:288});r=n.getBoundingClientRect(),this.add(n)}else if(this.props.replyText){var o=new Jr({x:e,y:t,text:this.props.replyText,fontSize:68,lineHeight:88,fontFamily:"SF Pro Text, sans-serif",fontWeight:"400",color:"#2C2D2E",maxWidth:1152,maxLines:3});r=o.getBoundingClientRect(),this.add(o)}if(this.props.replyMediaType&&"sticker"!==this.props.replyMediaType){var i=r?r.bottom+4:t;r=this.renderReplyAttach(e,i)}return r},t.prototype.renderReplyAttach=function(e,t){var r=new $r({x:e,y:t,image:this.getImage("replyMediaIcon"),width:76,height:76});return this.add(r),this.add(new Jr({x:r.getBoundingClientRect().right+32,y:r.getBoundingClientRect().top+12,text:this.props.replyMediaName,fontSize:56,lineHeight:72,fontFamily:"SF Pro Text, sans-serif",color:"#3F8AE0"})),r.getBoundingClientRect()},t.prototype.renderPost=function(e,t){var r,n,o=this.props.postMediaType,i=48,a=192,s=this.getInnerWidth()-96,l=s-a-32,c=new $r({x:e+i,y:t+i,image:this.getImage("postOwnerPhoto"),width:96,height:96,radius:48,borderSize:2,borderColor:"rgba(0, 0, 0, 0.08)"}),d=s-c.getBoundingClientRect().width-32,u=d-a-32,p=new Jr({x:c.getBoundingClientRect().right+32,y:c.getBoundingClientRect().top+20,text:this.props.postOwnerName,fontSize:56,lineHeight:72,fontFamily:en,fontWeight:"400",maxWidth:o?u:d,maxLines:1,color:"#000"});this.props.postText&&(r=new Jr({x:e+i,y:c.getBoundingClientRect().bottom+34,text:this.props.postText,fontSize:52,lineHeight:64,fontFamily:en,fontWeight:"400",color:"#000",maxWidth:o?l:s,maxLines:2})),n=r?r.getBoundingClientRect().bottom+20:c.getBoundingClientRect().bottom+48;var h=new Jr({x:e+i,y:n,text:this.props.postDate,fontSize:48,lineHeight:56,fontFamily:en,fontWeight:"400",color:"#818C99"}),g=new qr({x:Qr,y:t,width:this.getInnerWidth(),height:h.getBoundingClientRect().bottom-t+36,radius:64,background:"#fff",borderSize:4,borderColor:"#E1E3E6"});if(this.add(g),this.add(c),this.add(p),this.add(h),r&&this.add(r),o){var _=e+i+l+32;if("photo"===o&&this.props.postMediaPreviewUrl)this.add(new $r({x:_,y:t+i,image:this.getImage("postPreview"),width:a,height:a,radius:32,borderSize:4,borderColor:"rgba(0, 0, 0, 0.08)"}));else{var f=new qr({x:_,y:t+i,width:a,height:a,radius:32,background:"#F5F5F5",borderSize:4,borderColor:"rgba(0, 0, 0, 0.08)"});this.add(f);var v=f.getBoundingClientRect();this.add(new $r({x:v.left+(f.getWidth()/2-48),y:v.top+(f.getHeight()/2-48),image:this.getImage("postMediaIcon"),width:96,height:96,radius:0}))}}return g.getBoundingClientRect()},t.prototype.getInnerWidth=function(){return this.getWidth()-160},t}(Xr),rn={width:96,height:96,borderSize:4,borderColor:"rgba(0, 0, 0, 0.08)"},nn={top:0,left:0,width:968,padding:64,marginLeft:32,borderRadius:64,background:"#fff"},on={marginLeft:32,marginTop:20,fontSize:60,lineHeight:80,fontFamily:"VK Sans Text, SF Pro Text, sans-serif",color:"#000"},an={marginTop:48,fontSize:84,lineHeight:104,fontFamily:"VK Sans Text, SF Pro Text, sans-serif",fontWeight:"600",color:"#000"},sn={width:132,height:132,marginLeft:4},ln={top:80,left:168,width:968,padding:64,borderRadius:64,background:"#fff"},cn={marginLeft:32,marginTop:20,fontSize:60,lineHeight:80,fontFamily:"VK Sans Text, SF Pro Text, sans-serif",color:"#2C2D2E"},dn={marginTop:48,fontSize:80,lineHeight:96,fontFamily:"VK Sans Text, SF Pro Text, sans-serif",fontWeight:"400",color:"#000"},un={width:132,height:132,marginLeft:-100},pn=function(e){function t(t){var r=e.call(this)||this;return r.props=t,r}return(0,n.__extends)(t,e),t.prototype.prepareData=function(){var e=this;return new Promise((function(t,r){var n=e.props,o={questionOwnerPhoto:n.questionOwnerPhoto,answerOwnerPhoto:n.answerOwnerPhoto,cornerIcon:"/images/svg_icons/photo_editor/photo_editor_sticker_corner.svg",cornerIconFlipped:"/images/svg_icons/photo_editor/photo_editor_sticker_corner_flipped.svg"};e.loadImages(o).then((function(){return t(1)})).catch((function(e){return r(e)}))}))},t.prototype.render=function(){var e=this;return new Promise((function(t,r){e.prepareData().then((function(){e.draw(),t(1)})).catch((function(e){r(e)}))}))},t.prototype.draw=function(){var e=this.drawQuestion(nn.top,nn.left),t=this.drawAnswer(e.bottom+ln.top,ln.left);this.setWidth(t.right),this.setHeight(t.bottom),this.drawScene()},t.prototype.drawQuestion=function(e,t){var r=nn.width-2*nn.padding,n=new $r({x:t+sn.marginLeft,image:this.getImage("cornerIcon"),width:sn.width,height:sn.height}),o=new qr({x:t+nn.marginLeft,y:e,width:nn.width,radius:nn.borderRadius,background:nn.background}),i=new $r({x:o.getBoundingClientRect().left+nn.padding,y:o.getBoundingClientRect().top+nn.padding,image:this.getImage("questionOwnerPhoto"),width:rn.width,height:rn.height,radius:rn.width/2,borderSize:rn.borderSize,borderColor:rn.borderColor}),a=new Jr({x:i.getBoundingClientRect().right+on.marginLeft,y:i.getBoundingClientRect().top+on.marginTop,text:this.props.questionOwnerName,fontSize:on.fontSize,lineHeight:on.lineHeight,fontFamily:on.fontFamily,color:on.color,maxWidth:r-i.getBoundingClientRect().width-on.marginLeft,maxLines:1}),s=new Jr({x:o.getBoundingClientRect().left+nn.padding,y:i.getBoundingClientRect().bottom+an.marginTop,text:this.props.questionText,fontSize:an.fontSize,lineHeight:an.lineHeight,fontFamily:an.fontFamily,fontWeight:an.fontWeight,color:an.color,maxWidth:r,maxLines:8});return o.setHeight(s.getBoundingClientRect().bottom+nn.padding-8),n.setY(o.getBoundingClientRect().bottom-124),this.add(n),this.add(o),this.add(i),this.add(a),this.add(s),o.getBoundingClientRect()},t.prototype.drawAnswer=function(e,t){var r=ln.width-2*ln.padding,n=new qr({x:t,y:e,width:ln.width,radius:ln.borderRadius,background:ln.background}),o=new $r({x:n.getBoundingClientRect().right+un.marginLeft,image:this.getImage("cornerIconFlipped"),width:un.width,height:un.height}),i=new $r({x:n.getBoundingClientRect().left+ln.padding,y:n.getBoundingClientRect().top+ln.padding,image:this.getImage("answerOwnerPhoto"),width:rn.width,height:rn.height,radius:rn.width/2,borderSize:rn.borderSize,borderColor:rn.borderColor}),a=new Jr({x:i.getBoundingClientRect().right+cn.marginLeft,y:i.getBoundingClientRect().top+cn.marginTop,text:this.props.answerOwnerName,fontSize:cn.fontSize,lineHeight:cn.lineHeight,fontFamily:cn.fontFamily,maxWidth:r-i.getBoundingClientRect().width-cn.marginLeft,maxLines:1,color:cn.color}),s=new Jr({x:n.getBoundingClientRect().left+ln.padding,y:i.getBoundingClientRect().bottom+dn.marginTop,text:this.props.answerText,fontSize:dn.fontSize,lineHeight:dn.lineHeight,fontFamily:dn.fontFamily,fontWeight:dn.fontWeight,color:dn.color,maxWidth:r,maxLines:8});return n.setHeight(s.getBoundingClientRect().bottom+ln.padding-16-e),o.setY(n.getBoundingClientRect().bottom-124),this.add(o),this.add(n),this.add(i),this.add(a),this.add(s),o.getBoundingClientRect()},t}(Xr),hn=function(e){function t(t){var r=e.call(this)||this;return r.props=t,r}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this;return new Promise((function(t,r){e.loadImages({photo:e.props.photoUrl}).then((function(){e.draw(),t(1)})).catch((function(e){r(e)}))}))},t.prototype.draw=function(){var e=this.props,t=e.size,r=e.borderSize,n=void 0===r?0:r,o=e.borderColor,i=void 0===o?"":o,a=4*t,s=4*n,l=new $r({image:this.getImage("photo"),width:a,height:a,radius:a/2,borderSize:s,borderColor:i});this.add(l),this.setWidth(l.getWidth()),this.setHeight(l.getHeight()),this.drawScene()},t}(Xr),gn=136,_n=144,fn="VK Sans Display, SF Pro Text, sans-serif",vn="600",mn="#000",yn="#fff",xn=48,wn=64,Cn=40,En=72,Tn=72,Sn=function(e){function t(t){var r=e.call(this)||this;return r.props=t,r}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this;return new Promise((function(t){e.draw(),t(1)}))},t.prototype.draw=function(){var e=new Jr({text:this.props.text,fontSize:gn,lineHeight:_n,fontFamily:fn,fontWeight:vn,color:mn,fillColor:yn,fillRadius:xn,padding:{top:wn,bottom:Cn,left:En,right:Tn}});this.add(e),this.setWidth(e.getWidth()),this.setHeight(e.getHeight()),this.drawScene()},t}(Xr),bn=r(93680),Pn=r(19331),In=r(15544),Rn=r(18690),An=r(39664),Ln=r(91525);var kn=r(26271),Nn=function(e){function t(t){var r=e.call(this)||this;return r.data=t,r}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this;return new Promise((function(t,r){var n='<svg fill="none" height="28" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M18 8h-8v12h8v-2h-6v-3h5v-2h-5v-3h6z"/><path clip-rule="evenodd" d="M17.64 3h-7.28c-1.09 0-1.96 0-2.67.06-.73.06-1.37.18-1.96.48a5 5 0 0 0-2.19 2.19c-.3.6-.42 1.23-.48 1.96C3 8.4 3 9.27 3 10.36v7.28c0 1.09 0 1.96.06 2.67.06.73.18 1.37.48 1.96a5 5 0 0 0 2.19 2.19c.6.3 1.23.42 1.96.48.7.06 1.58.06 2.67.06h7.28c1.09 0 1.96 0 2.67-.06a5.13 5.13 0 0 0 1.96-.48 5 5 0 0 0 2.19-2.19c.3-.6.42-1.23.48-1.96.06-.7.06-1.58.06-2.67v-7.28c0-1.09 0-1.96-.06-2.67a5.13 5.13 0 0 0-.48-1.96 5 5 0 0 0-2.19-2.19c-.6-.3-1.23-.42-1.96-.48C19.6 3 18.73 3 17.64 3zm-11 2.33a3.2 3.2 0 0 1 1.21-.28C8.47 5 9.26 5 10.4 5h7.2c1.14 0 1.93 0 2.55.05.6.05.95.14 1.21.28a3 3 0 0 1 1.31 1.3c.14.27.23.62.28 1.22.05.62.05 1.41.05 2.55v7.2c0 1.14 0 1.93-.05 2.55-.05.6-.14.95-.28 1.21a3 3 0 0 1-1.3 1.31c-.27.14-.62.23-1.22.28-.62.05-1.41.05-2.55.05h-7.2c-1.14 0-1.93 0-2.55-.05-.6-.05-.95-.14-1.21-.28a3 3 0 0 1-1.31-1.3 3.2 3.2 0 0 1-.28-1.22A34.7 34.7 0 0 1 5 17.6v-7.2c0-1.14 0-1.93.05-2.55.05-.6.14-.95.28-1.21a3 3 0 0 1 1.3-1.31z" fill-rule="evenodd"/></g></svg>'.replace(/currentColor/,"rgba(255, 255, 255, 0.6)");e.loadImages({cover:e.data.audioImageUrl,explicit:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n)}).then((function(){e.doRender(),t(1)})).catch(r)}))},t.prototype.doRender=function(){var e=936,t=this.data.isImagePlaceholder?316:633,r=new $r({x:(e-t)/2,y:72,image:this.getImage("cover"),width:t,height:t,radius:36,shadowBlur:40,shadowColor:"rgba(0, 0, 0, 0.36)"});this.add(r);var n=100,o=this.data.isExplicit?140:0,i=new Jr({x:0,y:72+t+60,text:this.data.audioTitle,fontSize:96,lineHeight:112,fontWeight:"600",maxWidth:e,maxLines:3,align:Yr.CENTER,color:"#fff",shadowBlur:20,shadowColor:"rgba(0, 0, 0, 0.26)",afterPadding:o});if(this.add(i),this.data.isExplicit){var a=i.getLinesWidth(),s=a[a.length-1],l=s+(e-s)/2-n,c=kn.browser.safari?-8:4,d=i.getBoundingClientRect().bottom-112-c,u=new $r({x:l,y:d,image:this.getImage("explicit"),width:n,height:n});this.add(u)}var p=new Jr({x:0,y:i.getBoundingClientRect().bottom+24,text:this.data.audioArtist,fontSize:48,lineHeight:60,fontWeight:"400",maxWidth:e,maxLines:2,align:Yr.CENTER,color:"#fff",shadowBlur:20,shadowColor:"rgba(0, 0, 0, 0.16)"});this.add(p),this.setWidth(e),this.setHeight(p.getBoundingClientRect().bottom+72),this.drawScene()},t}(Xr),On=r(61540),Dn=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){window.addEventListener("keydown",r.handleKeyDown,{capture:!0}),window.addEventListener("mousedown",r.canvasMouseDown),r.getEditorData().then((function(e){var t,n,o=e.stickers,i=e.backgrounds,a=e.storyUploadUrlHash,s=e.storySaveHash,l=r.setBackground(i),c={};o.forEach((function(e){e.items.forEach((function(e){c[e.id]=e}))})),r.props.setData({stickers:o,stickersMap:c,backgrounds:i,placeholders:(0,yt.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:(0,yt.getLang)("photos_pe_fonts").split("<br>"),storyUploadUrlHash:a,storySaveHash:s}),r.props.setDataLoaded(),(null===(n=null===(t=r.props.data)||void 0===t?void 0:t.serviceInfo)||void 0===n?void 0:n.open_text_editor)?r.props.addLayerText(!0,{isEdit:!0,text:""}):r.props.stickers||r.props.background.currentBackgroundType!==u.default.BACKGROUND_MODES.BACKGROUND||(r.props.addLayerText(!0,{isEdit:!0,color:[201,206,203,207,205,202,204,303,306,307].includes(l)?"#333333":"#FFFFFF"}),r.props.closeTextEditor(),r.props.setCurrentLayer(null)),r.props.stickers&&r.prepareStickers(r.props.stickers)})).catch((function(){(0,ye.showFastBox)({title:(0,yt.getLang)("global_error")},(0,yt.getLang)("global_error"),(0,yt.getLang)("global_close"),(function(){(0,xe.curBox)().hide(),r.props.data.close(!1,!0)}))}))},r.componentWillUnmount=function(){window.removeEventListener("keydown",r.handleKeyDown,{capture:!0}),window.removeEventListener("mousedown",r.canvasMouseDown),delete window.cur.storyPublishContext},r.getEditorData=function(){return new Promise((function(e,t){bn.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})}))},r.render=function(){var e,t=r.props,i=t.ui,a=t.data,s=t.drawings,l=t.layers,c=t.settings;if(a.artboardContainer||(e={width:a.artboardWidth,height:parseInt(a.artboardHeight)+u.default.BOTTOM_PANEL_HEIGHT}),r.isSaveDisabled=!0,a.context===u.default.CONTEXT_TYPES.STORY)r.isSaveDisabled=!1;else{var d=c.colorCorrection,p=c.filter,h=c.blur,g=c.isAutoCorrection,_=c.isCropped,f=c.flipX,v=c.flipY,m=c.rotation;r.isSaveDisabled=!(!(l.items.length<=1)||s.length||d.exposure||d.contrast||d.saturation||d.warmth||d.vignette||d.sharpness||d.grain||"regular"!==p.name||h.isEnabled||g||_||f||v||m)}return(0,o.jsxs)("div",(0,n.__assign)({className:"PhotoEditor",style:{height:parseInt(a.artboardHeight)+u.default.BOTTOM_PANEL_HEIGHT}},{children:[(0,o.jsx)("div",(0,n.__assign)({className:"PhotoEditor__canvas",style:e},{children:(0,o.jsx)(Vt,{getStickerUrlById:r.getStickerUrlById,uploadPhoto:r.uploadPhoto,setMode:r.setMode},void 0)}),void 0),(0,o.jsx)("div",(0,n.__assign)({className:"PhotoEditor__tabs"},{children:i.isDataLoaded?r.renderTabs():(0,o.jsx)(An.default,{},void 0)}),void 0),(0,o.jsx)("input",{type:"file",accept:"image/*",className:"PhotoEditor__inputFile",onChange:r.handleChooseFile,ref:r.inputFile},void 0),!i.isDataLoaded&&r.renderFontsPreloading()]}),void 0)},r.renderTabs=function(){var e,t=r.props,i=t.data,a=t.background,s=i.context===u.default.CONTEXT_TYPES.STORY&&a.currentBackgroundType===u.default.BACKGROUND_MODES.BACKGROUND,l=(0,Pn.partConfigEnabled)("web_new_photo_editor"),c=(0,Pn.partConfigEnabled)("web_new_photo_editor_crop"),d=(0,yt.getLang)("photos_pe_save_action");return r.props.data.context===u.default.CONTEXT_TYPES.STORY&&(d=(0,yt.getLang)("photos_pe_publish_action")),(0,o.jsxs)("div",(0,n.__assign)({className:"PhotoEditor__inner"},{children:[(0,o.jsxs)(rr,(0,n.__assign)({current:r.props.ui.currentMode,change:r.props.setMode,setMode:r.setMode},{children:[(0,o.jsx)("div",(0,n.__assign)({"data-mode":u.default.TABS.STICKERS},{children:(0,o.jsx)(Hr,{stickerMouseDown:r.addSticker},void 0)}),void 0),(0,o.jsx)("div",(0,n.__assign)({"data-mode":u.default.TABS.TEXT},{children:(0,o.jsx)(xr,{},void 0)}),void 0),(0,o.jsx)("div",(0,n.__assign)({"data-mode":u.default.TABS.PAINT},{children:(0,o.jsx)(lr,{},void 0)}),void 0),c&&!(null===(e=i.addons)||void 0===e?void 0:e.disableCrop)&&i.context===u.default.CONTEXT_TYPES.PHOTO&&(0,o.jsx)("div",(0,n.__assign)({"data-mode":u.default.TABS.CROP},{children:(0,o.jsx)(_r,{},void 0)}),void 0),l&&(0,o.jsx)("div",(0,n.__assign)({"data-mode":u.default.TABS.FILTERS,"data-disabled":s},{children:(0,o.jsx)(Or,{},void 0)}),void 0),l&&(0,o.jsx)("div",(0,n.__assign)({"data-mode":u.default.TABS.COLOR,"data-disabled":s},{children:(0,o.jsx)(Pr,{},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,n.__assign)({className:"PhotoEditor__actions"},{children:[(0,o.jsx)(Zr,{},void 0),(0,o.jsxs)("div",{children:[(0,o.jsx)(St.default,(0,n.__assign)({appearance:"secondary",onClick:r.props.data.close},{children:(0,yt.getLang)("photos_pe_cancel_action")}),void 0),(0,o.jsx)(Rn.default,(0,n.__assign)({appearance:"primary",loading:r.props.ui.isSaveLoading,disabled:r.isSaveDisabled,onClick:r.save},{children:d}),void 0)]},void 0)]}),void 0)]}),void 0)},r.renderFontsPreloading=function(){return(0,o.jsx)("div",(0,n.__assign)({className:"PhotoEditor__fontPreload"},{children:u.default.FONTS.map((function(e){return(0,o.jsx)("span",{className:"PhotoEditorFontStyle--"+e},e)}))}),void 0)},r.save=function(){r.props.closeTextEditor(),r.props.setCurrentLayer(null),r.props.setSaveLoading(!0),setTimeout((function(){r.renderImageFromState().then((function(e){var t=e.blob,n=e.width,o=e.height,i=r.props,a=i.layers,s=i.drawings,l=i.background,c=i.settings,d=(0,we.prepareStat)(a.items,s,l.currentBackgroundType,l.currentBackgroundId),u=(0,we.prepareMediaEditorStat)(a.items,c),p=[];r.props.layers.items.forEach((function(e){e.clickableZones&&e.clickableZones.forEach((function(t){p.push(r.getPreparedClickableZone(e,t))}))}));var h={original_width:n,original_height:o,clickable_stickers:p};r.props.data.save(t,(function(){r.props.setSaveLoading(!1)}),{attachment:r.props.data.attachment,storyUploadUrlHash:r.props.data.storyUploadUrlHash,storySaveHash:r.props.data.storySaveHash,analytics:JSON.stringify(d),mediaEditorAnalytics:JSON.stringify(u),clickableStickers:JSON.stringify(h)})})).catch((function(e){r.props.setSaveLoading(!1),console.error(e)}))}),0)},r.renderImageFromState=function(){var e=r.props,t=e.layers,n=e.drawings,o=e.data,i=o.artboardWidth,a=o.originalWidth,s=o.originalHeight,l=a/i;return new Promise((function(e,o){Vr.draw(a,s,t.items,n,l,r.getStickerUrlById).then((function(t){var r=t.blob,n=t.width,o=t.height;e({blob:r,width:n,height:o})})).catch((function(e){o(e)}))}))},r.getPreparedClickableZone=function(e,t){var n,o=r.props.data.originalWidth/r.props.data.artboardWidth,i=e.rotate*(Math.PI/180),a=e.width*e.scale,s=e.height*e.scale,l=e.x-a/2,c=e.y-s/2,d=parseFloat(e.x)+(l-e.x)*Math.cos(i)-(c-e.y)*Math.sin(i),u=parseFloat(e.y)+(c-e.y)*Math.cos(i)+(l-e.x)*Math.sin(i),p=null===(n=t.clickable_area)||void 0===n?void 0:n.map((function(e){var t=e.x*a,r=e.y*s,n=t*Math.cos(i)-r*Math.sin(i),l=t*Math.sin(i)+r*Math.cos(i);return{x:(d+n)*o,y:(u+l)*o}})),h={type:t.action_type,clickable_area:p};return"link"===t.action_type?(h.link=t.action.link,t.action.tooltip_text_key&&(h.tooltip_text_key=t.action.tooltip_text_key)):"app"===t.action_type?(h.app_id=t.action.app_id,t.action.app_context&&(h.app_id=t.action.app_id)):"music"===t.action_type&&(h.audio_owner_id=t.action.audioOwnerId,h.audio_id=t.action.audioId),h},r.handleKeyDown=function(e){if("Escape"==e.key&&r.props.layers.currentIndex&&r.props.layers.items[r.props.layers.currentIndex].isEdit&&(e.preventDefault(),e.stopPropagation(),r.props.closeTextEditor()),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.shiftKey?r.props.redo():r.props.undo()),null!==r.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(["Backspace","Delete"].includes(e.key))e.preventDefault(),r.props.layers.items[r.props.layers.currentIndex].canDelete&&r.props.deleteLayer();else if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){var t=r.getCurrentLayer();if(!t)return;var n={x:t.x,y:t.y},o=e.shiftKey?10:1;switch(e.key){case"ArrowUp":n.y-=o;break;case"ArrowDown":n.y+=o;break;case"ArrowLeft":n.x-=o;break;case"ArrowRight":n.x+=o}r.props.setLayerPosition(n.x,n.y)}},r.canvasMouseDown=function(e){var t=r.getCurrentLayer(),n=e.target;if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void([u.default.TABS.PAINT,u.default.TABS.FILTERS].includes(r.props.ui.currentMode)||(t&&t.type===u.default.LAYER_TYPES.TEXT&&t.isEdit?r.props.closeTextEditor():(r.props.ui.currentMode===u.default.TABS.COLOR&&r.props.settings.blur.isEnabled&&r.moveBlurStart(e),n.closest(".EditorLayer")?r.layerDragStart(e):t&&r.props.setCurrentLayer(null)))))},r.moveBlurStart=function(e){window.addEventListener("mousemove",r.moveBlurProcess),window.addEventListener("mouseup",r.moveBlurFinish),r.moveBlurProcess(e)},r.moveBlurProcess=function(e){var t=ze(e,document.querySelector(".EditorCanvas__canvas--bg")),n=t.x,o=t.y,i=t.width,a=t.height,s=[Math.max(0,Math.min(n/i,1)),1-Math.max(0,Math.min(o/a,1))];r.props.setBlurPosition(s)},r.moveBlurFinish=function(){window.removeEventListener("mousemove",r.moveBlurProcess),window.removeEventListener("mouseup",r.moveBlurFinish)},r.getCurrentLayer=function(){var e=r.props.layers,t=e.items,n=e.currentIndex;return null===n?n:t[n]},r.layerDragStart=function(e){window.addEventListener("mousemove",r.layerDragProcess),window.addEventListener("mouseup",r.layerDragFinish);var t,n=e.target.closest("[data-index]");t=n?+(0,In.domData)(n,"index"):r.props.layers.currentIndex,r.props.layers.currentIndex!==t&&r.props.setCurrentLayer(t);var o=ze(e,document.querySelector(".EditorCanvas__canvas--draw")),i=o.x,a=o.y;if(r.currentLayer=r.getCurrentLayer(),r.currentLayer){var s=r.currentLayer;s.isBackground&&s.locked?r.props.setCurrentLayer(null):(r.clientX=e.clientX,r.clientY=e.clientY,r.shiftX=i-r.currentLayer.x,r.shiftY=a-r.currentLayer.y)}},r.layerDragProcess=function(e){if(r.currentLayer){var t=document.querySelector(".EditorCanvas__canvas--draw");if(t){var n=ze(e,t),o=n.x,i=n.y;if(void 0!==r.shiftX&&void 0!==r.shiftY){var a=o-r.shiftX,s=i-r.shiftY;r.props.setLayerPosition(a,s),r.props.ui.isShowDropBox||r.props.setShowDropBox(!0)}}}},r.layerDragFinish=function(e){if(window.removeEventListener("mousemove",r.layerDragProcess),window.removeEventListener("mouseup",r.layerDragFinish),r.getCurrentLayer()&&r.currentLayer&&void 0!==r.shiftX&&void 0!==r.shiftY){var t=document.querySelector(".EditorCanvas__canvas--draw");if(t){var n=ze(e,t),o=n.x,i=n.y,a=o-r.shiftX,s=i-r.shiftY;r.props.setLayerPosition(Math.round(a),Math.round(s)),r.props.setShowDropBox(!1),delete r.currentLayer,delete r.shiftX,delete r.shiftY,delete r.clientX,delete r.clientY}}},r.getStickerUrlById=function(e,t){var n=r.props.data.stickersMap[e];return n?n.sizes[t]:""},r.addSticker=function(e,t){e.persist();var n=document.querySelector(".EditorCanvas__canvas--draw");if(n){var o=ze(e.nativeEvent,n),i=o.width,a=o.height;r.props.addLayerSticker({id:t,x:i/2,y:a/2,width:u.default.LAYER_DEFAULT_SIZE,height:u.default.LAYER_DEFAULT_SIZE,rotate:0,canDelete:!0,scale:1})}},r.prepareStickers=function(e){var t=r.props.data,n=t.artboardWidth,o=t.artboardHeight;e.forEach((function(e){var t=e.sticker.transform||{},i=t.gravity,a=void 0===i?"center":i,s=t.rotation,l=void 0===s?0:s,c=t.translation_x,d=void 0===c?0:c,p=t.translation_y,h=void 0===p?0:p,g=t.relation_width;if(d=Math.min(Math.max(d,-1),1),h=Math.min(Math.max(h,-1),1),g&&(g=Math.min(Math.max(g,.1),1)),"renderable"===e.sticker_type)r.prepareRenderableSticker(e.sticker,a,d,h,g).then((function(t){var n=t.url,o=t.x,i=t.y,a=t.stickerWidth,s=t.stickerHeight,c=t.clickableZones;r.props.addLayerImage({url:n,x:o,y:i,width:Math.round(a),height:Math.round(s),rotate:-l,clickableZones:c,canDelete:Boolean(e.sticker.can_delete),scale:1})})).catch((function(e){console.error(e)}));else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var _=g?n*g:u.default.LAYER_DEFAULT_SIZE,f=g?n*g:u.default.LAYER_DEFAULT_SIZE,v=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(r.props.data.stickersMap[v]){var m=Ze(a,n,o,_/2,f/2,d*n,h*o),y=m.x,x=m.y;r.props.addLayerSticker({id:v,x:y,y:x,width:Math.round(_),height:Math.round(f),rotate:-l,canDelete:!0,scale:1})}break;case"text":var w=.5;g&&(w=r.getFontSize(e.sticker.action.text,n*g,e.sticker.action.style));var C=r.getTextRect(e.sticker.action.text,w*u.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),E=(_=C.width,f=C.height,Ze(a,n,o,_/2,f/2,d*n,h*o));y=E.x,x=E.y;r.props.addLayerText(!0,{isEdit:!0,text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:w,initialFontSize:w,rotate:-l,scale:1,x:y,y:x}),r.props.closeTextEditor(),r.props.setCurrentLayer(null);break;case"comment":var T=e.sticker.action,S=T.postRawId,b=T.replyId,P=new tn(e.sticker.action);P.render().then((function(){P.toBlob().then((function(t){var i=Ze(a,n,o,P.getWidth()/2,P.getHeight()/2,d*n,h*o),s=i.x,l=i.y,c=P.getWidth()/n,u=P.getWidth()/c,p=P.getHeight()/c;r.props.addLayerImage({url:URL.createObjectURL(t),x:s,y:l,width:Math.round(u),height:Math.round(p),rotate:0,clickableZones:[{action_type:"link",action:{link:"https://"+(0,On.getHostName)()+"/wall"+S+"?reply="+b,tooltip_text_key:"tooltip_open_post"},clickable_area:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}]}],canDelete:Boolean(e.sticker.can_delete),scale:.8})})).catch((function(e){(0,Ln.logError)(e,{environment:"photoEditor"})}))})).catch((function(e){(0,Ln.logError)(e,{environment:"photoEditor"})}));break;case"answer_question":var I=new pn(e.sticker.action);I.render().then((function(){I.toBlob().then((function(t){var i=I.getHeight()/I.getWidth(),s=g?n*g:I.getWidth()/4,c=g?s*i:I.getHeight()/4,u=Ze(a,n,o,s/2,c/2,d*n,h*o),p=u.x,_=u.y;r.props.addLayerImage({url:URL.createObjectURL(t),x:p,y:_,width:Math.round(s),height:Math.round(c),rotate:-l,canDelete:Boolean(e.sticker.can_delete),scale:1})})).catch((function(e){console.error(e)}))})).catch((function(e){console.error(e)}));break;case"ask_question_avatar":var R=new hn(e.sticker.action);R.render().then((function(){R.toBlob().then((function(t){var i=R.props.size,s=R.props.size,c=Ze(a,n,o,i/2,s/2,d*n,h*o),u=c.x,p=c.y;r.props.addLayerImage({url:URL.createObjectURL(t),x:u,y:p,width:Math.round(i),height:Math.round(s),rotate:-l,canDelete:Boolean(e.sticker.can_delete),scale:1})})).catch((function(e){console.error(e)}))})).catch((function(e){console.error(e)}));break;case"ask_question_text":var A=new Sn(e.sticker.action);A.render().then((function(){A.toBlob().then((function(t){var i=A.getWidth()/4,s=A.getHeight()/4,c=Ze(a,n,o,i/2,s/2,d*n,h*o),u=c.x,p=c.y;r.props.addLayerImage({url:URL.createObjectURL(t),x:u,y:p,width:Math.round(i),height:Math.round(s),rotate:-l,canDelete:Boolean(e.sticker.can_delete),scale:1})})).catch((function(e){console.error(e)}))})).catch((function(e){console.error(e)}));break;case"music":var L=e.sticker.action,k=new Nn(L);k.render().then((function(){k.toBlob().then((function(t){var i=k.getWidth()+144,s=n*k.getWidth()/i,l=k.getWidth()/s,c=k.getHeight()/l,d=Ze(a,n,o,k.getWidth()/2,k.getHeight()/2,0,0),u=d.x,p=d.y;r.props.addLayerImage({url:URL.createObjectURL(t),x:u,y:p,width:s,height:c,rotate:0,clickableZones:[{action_type:"music",action:{audioOwnerId:L.audioOwnerId,audioId:L.audioId},clickable_area:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}]}],canDelete:Boolean(e.sticker.can_delete),scale:1})})).catch((function(e){(0,Ln.logError)(e,{environment:"photoEditor"})}))})).catch((function(e){(0,Ln.logError)(e,{environment:"photoEditor"})}))}}))},r.prepareRenderableSticker=function(e,t,o,i,a){var s=r.props.data,l=s.artboardWidth,c=s.artboardHeight,d=s.originalWidth/l;return new Promise((function(r,s){"string"!=typeof e.url&&"string"!=typeof e.blob&&s();var u=e.url||e.blob||"";Ue(u).then((function(s){var p=s.height/s.width,h=0,g=0;a?g=(h=l*a)*p:(h=s.width/d,g=s.height/d,h>l&&(g=(h=l)*p));var _,f=Ze(t,l,c,h/2,g/2,o*l,i*c),v=f.x,m=f.y;e.clickable_zones&&(_=e.clickable_zones.map((function(e){var t;return t=e.clickable_area?e.clickable_area.map((function(e){return{x:e.x/s.width,y:e.y/s.height}})):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],(0,n.__assign)((0,n.__assign)({},e),{clickable_area:t})}))),r({url:u,x:v,y:m,stickerWidth:h,stickerHeight:g,clickableZones:_})})).catch((function(){s()}))}))},r.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=(0,it.clean)(e),n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.appendChild(n);var o=n.getBoundingClientRect();return n.remove(),o},r.getFontSize=function(e,t,r){var n=2*t,o=document.createElement("span");for(o.innerHTML=(0,it.clean)(e),o.style.display="inline-block",o.style.width=t+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",r&&o.classList.add("PhotoEditorFontStyle--"+r),document.body.appendChild(o);n&&o.scrollWidth>Math.round(t);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},r.uploadPhoto=function(){var e;null===(e=r.inputFile.current)||void 0===e||e.click()},r.setMode=function(e){var t=r.props.ui,n=r.props.background,o=n.currentBackgroundType,i=n.currentPhotoUrl;r.props.setCurrentLayer(null),e===u.default.BACKGROUND_MODES.PHOTO&&!i||o===u.default.BACKGROUND_MODES.PHOTO&&o===e?r.uploadPhoto():(r.props.setBackgroundType(e),e===u.default.BACKGROUND_MODES.BACKGROUND&&[u.default.TABS.COLOR,u.default.TABS.FILTERS].includes(t.currentMode)&&r.props.setMode(u.default.TABS.STICKERS))},r.handleChooseFile=function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t.item(0);if(n){var o=URL.createObjectURL(n);Ue(o).then((function(){(function(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,i=2;i<o;){if(n.getUint16(i+2,!1)<=8)return t(-1);var a=n.getUint16(i,!1);if(i+=2,65505==a){if(1165519206!=n.getUint32(i+=2,!1))return t(-1);var s=18761==n.getUint16(i+=6,!1);i+=n.getUint32(i+4,s);var l=n.getUint16(i,s);i+=2;for(var c=0;c<l;c++)if(274==n.getUint16(i+12*c,s))return t(n.getUint16(i+12*c+8,s))}else{if(65280!=(65280&a))break;i+=n.getUint16(i,!1)}}return t(-1)}},r.readAsArrayBuffer(e)}))})(n).then((function(e){-1===e||-2===e||1===e?(r.props.setCurrentPhotoUrl(o),r.props.setBackgroundType(u.default.BACKGROUND_MODES.PHOTO)):function(e,t){return new Promise((function(r,n){var o=new Image;o.onload=function(){var e=o.width,i=o.height,a=document.createElement("canvas"),s=a.getContext("2d");if(!s)return n();switch(4<t&&t<9?(a.width=i,a.height=e):(a.width=e,a.height=i),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,i);break;case 4:s.transform(1,0,0,-1,0,i);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,i,0);break;case 7:s.transform(0,-1,-1,0,i,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(a.toDataURL())},o.src=e}))}(o,e).then((function(e){r.props.setCurrentPhotoUrl(e),r.props.setBackgroundType(u.default.BACKGROUND_MODES.PHOTO)})).catch((function(){}))})).catch((function(){}))})).catch((function(){(0,ye.showFastBox)({title:(0,yt.getLang)("global_error")},(0,yt.getLang)("stories_create_image_incorrect"))}))}else console.error("File not found")},r.inputFile=(0,i.createRef)(),r}return(0,n.__extends)(t,e),t.prototype.setBackground=function(e){var t=e.advice_gradients,r=e.colors,o=u.default.CONTEXT_TYPES,i=u.default.BACKGROUND_MODES,a=i.PHOTO;this.props.data.context===o.STORY&&(a=this.props.data.photoUrl?i.PHOTO:i.BACKGROUND),this.props.setBackgroundType(a),this.props.data.photoUrl&&this.props.setCurrentPhotoUrl(this.props.data.photoUrl);var s=(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(t),!1),(0,n.__read)(r),!1),l=s[Math.floor(Math.random()*s.length)].id;return this.props.setCurrentBackgroundId(l),l},t}(i.Component),Mn=Object.assign(l.ActionCreators,{setMode:ke,addLayerSticker:function(e){return(0,we.sendStat)(we.EVENTS.ADD_STICKER),Se(H,{type:u.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,canDelete:e.canDelete,scale:e.scale})},addLayerText:be,addLayerImage:function(e){return Se(z,{type:u.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,clickableZones:e.clickableZones,canDelete:e.canDelete,scale:e.scale})},setLayerPosition:function(e,t){return function(r,n){var o=n().present.layers,i=o.currentIndex,a=o.items;null!==i&&a[i]&&r({type:W,payload:{x:e,y:t}})}},deleteLayer:Re,setCurrentLayer:Te,setDataLoaded:function(){return{type:_}},setShowDropBox:Le,setSaveLoading:function(e){return{type:v,value:e}},closeTextEditor:Ae,setData:Fe,setBlurPosition:function(e){return{type:k,position:e}},setBackgroundType:De,setCurrentPhotoUrl:Me,setCurrentBackgroundId:Be});const Bn=(0,a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data}}),Mn,null,{forwardRef:!0})(Dn);const Fn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.render=function(){var e,t,r;return window.cur.photoEditorStore=(e={data:this.props},t=(0,l.newHistory)([],e,[]),r=c.composeWithDevTools((0,s.applyMiddleware)(d.default)),(0,s.createStore)(me,t,r)),(0,o.jsx)(a.Provider,(0,n.__assign)({store:window.cur.photoEditorStore},{children:(0,o.jsx)(Bn,{stickers:this.props.stickers,ref:function(e){e&&(window.cur.renderImageFromState=e.renderImageFromState)}},void 0)}),void 0)},t.defaultProps={originalWidth:u.default.STORY_BASE_WIDTH,originalHeight:u.default.STORY_BASE_HEIGHT},t}(i.Component)},52205:(e,t,r)=>{"use strict";r.d(t,{EVENTS:()=>c,prepareMediaEditorStat:()=>h,prepareStat:()=>p,sendStat:()=>u});var n=r(70655),o=r(19331),i=r(79957);function a(e,t,r,n,o){return(0,i.statlogsValueEvent)(e,t,r,n,o)}var s=r(87481),l=r(34790),c={FLIP_X:"flipX",FLIP_Y:"flipY",ADD_FILTER:"add_filter",REMOVE_FILTER:"remove_filter",UNDO:"undo",REDO:"redo",ENABLE_AUTOCORRECTION:"enable_autocorrection",DISABLE_AUTOCORRECTION:"disable_autocorrection",ENABLE_BLUR:"enable_blur",DISABLE_BLUR:"disable_blur",ZOOM:"zoom",UNZOOM:"unzoom",TURN_LEFT:"turn_left",TURN_RIGHT:"turn_right",ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",SELECT_BACKGROUND:"select_background"},d=[c.ADD_STORY,c.ADD_STORY_FROM_SHARING,c.CLICK_TO_CAMERA_ICON,c.CLICK_TO_GRADIENT_ICON,c.ADD_TEXT,c.EDIT_TEXT,c.DELETE_TEXT,c.ADD_STICKER,c.DELETE_STICKER,c.ADD_GRAFFITI,c.SELECT_BACKGROUND];function u(e){var t=0,r=0;if(window.cur.pvCurPhoto){var i=(0,n.__read)(window.cur.pvCurPhoto.id.split("_"),2),l=i[0],c=i[1];t=parseInt(l),r=parseInt(c)}var u={event_type:e,media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:t,media_id:r};(0,o.partConfigEnabled)("story_publish_analytics_log")&&(0,s.debugLog)(u),a("media_editor_product_analytics",u),d.includes(e)&&a("story_create_product_analytics",{event_type:e,story_type:"photo"})}function p(e,t,r,o){var i=0,a="photo";r===l.default.BACKGROUND_MODES.BACKGROUND&&(a=(i=o||0)>=300?"colors":i>=200?"advice_gradients":i>=100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:a,background_id:i},c=[],d=[],u=[];return e.forEach((function(e){if(e.type===l.default.LAYER_TYPES.STICKER){var t=e,r=(0,n.__read)(t.id.split("_"),2),o=r[0],i=r[1],a=parseInt(o);c.push({id:parseInt(i),pack_id:a||0,type:a?"from_pack":"individual"})}else if(e.type===l.default.LAYER_TYPES.TEXT){t=e;d.push({text:t.text,font:t.fontStyle,size:Math.round(t.fontSize*l.default.FONT_SIZE_COEFFICIENT),color:t.color.slice(1),background:"none",align:"center"})}})),d.length&&(s.has_text=1,s.texts=d),c.length&&(s.has_sticker=1,s.stickers=c),t.forEach((function(e){u.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})})),u.length&&(s.has_graffiti=1,s.graffities=u),s}function h(e,t){var r=0,o=0;if(window.cur.pvCurPhoto){var i=(0,n.__read)(window.cur.pvCurPhoto.id.split("_"),2),a=i[0],s=i[1];r=parseInt(a),o=parseInt(s)}var c={media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:r,media_id:o,is_cropped:t.isCropped,is_autocorrected:t.isAutoCorrection,rotation:t.rotation,filter:t.filter.name,filter_value:100*t.filter.value,ratio:t.cropAspect,photo_correction:[{type:"exposure",value:100*t.colorCorrection.exposure},{type:"contrast",value:100*t.colorCorrection.contrast},{type:"saturation",value:100*t.colorCorrection.saturation},{type:"warmth",value:100*t.colorCorrection.warmth},{type:"vignette",value:100*t.colorCorrection.vignette},{type:"sharpness",value:100*t.colorCorrection.sharpness},{type:"grain",value:100*t.colorCorrection.grain}]};t.blur.isEnabled&&(c.blur_type=t.blur.form,c.blur_value=t.blur.size);var d=[];return e.forEach((function(e){if(e.type===l.default.LAYER_TYPES.TEXT){var t=e;d.push({text:t.text,font:t.fontStyle,size:Math.round(t.fontSize*l.default.FONT_SIZE_COEFFICIENT),color:t.color.slice(1),background:"none",align:"center"})}})),d.length&&(c.has_text=1,c.texts=d),c}}}]);try{stManager.done("dist/9b69690c2f17eb6642dea9531af86fbd.d82ecd92edf29a9ffa40.js")}catch(e){}